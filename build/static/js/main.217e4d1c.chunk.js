(this["webpackJsonpScore-Tool-2.0"]=this["webpackJsonpScore-Tool-2.0"]||[]).push([[0],{147:function(e,t,a){},178:function(e,t,a){e.exports=a(213)},183:function(e,t,a){},186:function(e,t,a){},213:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),s=a(60),o=a.n(s),l=(a(183),a(110));a(186);function i(e){let{help:t}=e;switch(t){case"Scoretool":return"An orchestration psychoacoustic analysis web app for composers, conductors and musicians.";case"Score":return"This the primary component of the Score-Tool App, where you can upload your own score.";case"Chord":return"Here you can create, modify, load and save orchestral chords and see the psychoacoustic analysis results as graphs.";case"Compare":return"Here you can compare two timbres and see the overtone structure of them in musical staff.";case"Search":return"If you have saved orchestral chords, here you can search matching timbres from database using various algorithms.";case"Manage":return"Here you can delete, download, and upload your own orchestral chords.";case"Examples":return"Choose here and example score. 'Test Score' is a small and short example you can use to try the features of the Score-Tool App.";case"Dropzone":return"Drop an MusicXml file here, or click to choose one from your filesystem. You can find plenty of MusicXml orchestral scores for example from Musescore site.";case"ScoreSlider":return"Choose here the bar range of the score. Only the selected range will be visible when you click 'Show score'. This can be useful if you have a very large score, because visual rendering takes time."}return""}var c=a(289),m=a(286),d=a(259),h=a(288),u=a(284),p=a(155),f=a(150),g=a.n(f),y=a(287),E=a(277),b=a(267),v=a(270),_=a(151),x=a.n(_),C=a(129),w=a(282);const k=Object(C.a)({palette:{neutral:{main:"#dcc4ac",contrastText:"black"}}}),S=["Score","Chord","Compare","Search","Manage"];function T(e){const[t,a]=r.useState(null),[n,s]=r.useState(null),[o,l]=r.useState(!1),f=t=>{console.log(t),"Help"===t&&(e.help(!o),l(e=>!o)),e.navClick(t),a(null),_()},_=e=>{s(null)};return r.createElement(w.a,{theme:k},r.createElement(m.a,{color:"neutral",sx:{height:50}},r.createElement(y.a,{maxWidth:"xl"},r.createElement(h.a,{disableGutters:!0},r.createElement(b.a,{title:r.createElement(i,{help:"Scoretool"}),disableHoverListener:!o},r.createElement(c.a,{variant:"h6",noWrap:!0,component:"div",sx:{mr:2,display:{xs:"none",md:"flex"},cursor:"pointer"},onClick:()=>e.navClick("About")},"Score-Tool 2.0")),r.createElement(d.a,{sx:{flexGrow:1,display:{xs:"flex",md:"none"}}},r.createElement(u.a,{size:"large","aria-label":"account of current user","aria-controls":"menu-appbar","aria-haspopup":"true",onClick:e=>{a(e.currentTarget)},color:"inherit"},r.createElement(g.a,null)),r.createElement(p.a,{id:"menu-appbar",anchorEl:t,anchorOrigin:{vertical:"bottom",horizontal:"left"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"left"},open:Boolean(t),onClose:f,sx:{display:{xs:"block",md:"none"}}},S.map(e=>r.createElement(b.a,{title:r.createElement(i,{help:e}),disableHoverListener:!o},r.createElement(v.a,{key:e,onClick:t=>f(e)},r.createElement(c.a,{textAlign:"center"},e)))))),r.createElement(c.a,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1,display:{xs:"flex",md:"none"}}},"Score-Tool"),r.createElement(d.a,{sx:{flexGrow:1,display:{xs:"none",md:"flex"}}},S.map(e=>r.createElement(b.a,{title:r.createElement(i,{help:e}),disableHoverListener:!o},r.createElement(E.a,{key:e,onClick:t=>f(e),sx:{my:2,display:"block",color:"black"}},e)))),r.createElement(d.a,{sx:{flexGrow:0}},r.createElement(b.a,{title:"Toggle help"},r.createElement(u.a,{onClick:e=>f("Help"),sx:{p:0}},r.createElement(x.a,null),o?"on":"off")),r.createElement(p.a,{sx:{mt:"45px"},id:"menu-appbar",anchorEl:n,anchorOrigin:{vertical:"top",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:Boolean(n),onClose:_},r.createElement(v.a,{key:"About Score-Tool",onClick:e=>f("About")},r.createElement(c.a,{textAlign:"center"},"About Score-Tool")),r.createElement(v.a,{key:"Enable help",onClick:e=>f("Help")},r.createElement(c.a,{textAlign:"center"},o?"Disable help":"Enable help"))))))))}var N=a(32),I=a(272);function A(e){const[t,a]=r.useState({measureRange:[1,2],maxMeasure:2});r.useEffect(()=>{a(t=>({...t,measureRange:e.range,maxMeasure:e.max}))},[e]);return r.createElement(I.a,{style:e.style,value:t.measureRange,min:1,max:t.maxMeasure,step:1,marks:!0,onChange:(e,t,r)=>{if(!Array.isArray(t))return;let n=t;a(e=>({...e,measureRange:n}))},onChangeCommitted:e.measureHandleChange,valueLabelDisplay:"auto",disableSwap:!0})}var M=a(269),O=a(274),D=a(285),P=a(295),L=a(296),z=a(273),R=a(276),F=a(297),W=a(298),V=a(153),j=a.n(V),G=a(25),B=a.n(G),H=a(122);const K={alto_flute:["normal"],alto_sax:["normal"],baritone_generic:["normal"],bassoon:["normal"],bass_cl:["normal"],bass_flute:["normal"],bass_trombone:["normal"],cello:["harmonics","normal","pizz","pizz_harmonics","sord","sord_trem","trem"],clarinet:["normal"],clarinet_eb:["normal"],crotale:["normal"],cymbal:["13crash_bell","13crash_bow","13crash_chokecrash","13crash_mallet","13crash_normal","13crash_roll","13crash_shoulder","16chinese_bell","16chinese_bow","16chinese_chokecrash","16chinese_mallet","16chinese_normal","16chinese_roll","16chinese_shoulder","17crash_bell","17crash_bow","17crash_chokecrash","17crash_mallet","17crash_normal","17crash_roll","17crash_shoulder","17orchcrash","18crash_bell","18crash_bow","18crash_chokecrash","18crash_mallet","18crash_normal","18crash_roll","18crash_shoulder","18orchcrash_french","18orchcrash_germanic","18orchcrash_viennese","19chinese_bell","19chinese_bow","19chinese_chokecrash","19chinese_mallet","19chinese_normal","19chinese_roll","19chinese_shoulder","20chinese_bell","20chinese_bow","20chinese_chokecrash","20chinese_mallet","20chinese_normal","20chinese_roll","20chinese_shoulder","20crash_bell","20crash_bow","20crash_chokecrash","20crash_mallet","20crash_normal","20crash_roll","20crash_shoulder","21ride_bell","21ride_mallet","21ride_normal","21ride_roll","21ride_shoulder","hihat_bell","hihat_footclose","hihat_footsplash","hihat_normal","hihat_shoulder","normal","smallmetals","splash_bell","splash_mallet","splash_roll","splash_splash","windgong","windgong_bow"],double_bass:["harmonics","normal","pizz","pizz_harmonics","trem"],english_horn:["normal"],flute:["normal","vib"],guitar:["normal","normal_sulA","normal_sulB","normal_sulD","normal_sulE","normal_sulG","normal_sul_E"],harp:["normal"],horn:["normal"],oboe:["normal"],percussion_misc:["castanet","guiro_away","guiro_toward","shakers"],piano:["normal"],piccolo:["normal"],solo_cello:["arco_sulA","arco_sulC","arco_sulD","arco_sulG","normal"],solo_double_bass:["arco_sulA","arco_sulD","arco_sulE","arco_sulG","normal","pizz","pizz_sulA","pizz_sulD","pizz_sulE","pizz_sulG"],solo_viola:["arco_sulA","arco_sulC","arco_sulD","arco_sulG","normal"],solo_violin:["arco_sulA","arco_sulD","arco_sulE","arco_sulG","normal"],soprano_generic:["normal"],soprano_sax:["normal","normal_Vib"],tambourine:["normal","normal_fingerroll","normal_sforzando","normal_shakeroll","normal_thumbroll"],tamtam:["bow","normal"],tamtam_22:["bow","normal"],tamtam_40:["bow","normal"],tenor_generic:["normal"],thaigong:["normal"],triangle_6:["normal","normal_roll"],triangle_8:["normal","normal_roll"],trumpet:["normal","vib"],tuba:["normal"],vibraphone:["normal","normal_bow"],viola:["harmonics","normal","pizz","sord","sord_trem","trem"],violin:["harmonics","normal","pizz","sord","sord_trem","tremolo"],woodblock:["clave","graniteblock","normal"],xylophone:["gliss_down","gliss_up","normal","normal_hardrubber"],tenor_trombone:["normal"],timp:["normal"]},U={alto_flute:{normal:{f:[55,92],mf:[54,92],p:[54,80]}},alto_sax:{normal:{f:[48,81],mf:[48,81],p:[48,81]}},baritone_generic:{normal:{f:[30,66],mf:[30,66],p:[30,66]}},bassoon:{normal:{f:[33,75],mf:[33,75],p:[33,75]}},bass_cl:{normal:{f:[36,83],mf:[36,83],p:[36,83]}},bass_flute:{normal:{f:[47,86],mf:[47,83],p:[47,77]}},bass_trombone:{normal:{f:[24,66],mf:[24,68],p:[23,71]}},cello:{harmonics:{f:[36,72],mf:[36,72],p:[36,72]},normal:{f:[36,74],mf:[36,74],p:[36,74]},pizz:{f:[35,67],mf:[35,67],p:[35,67]},pizz_harmonics:{f:[47,70],mf:[47,70],p:[47,70]},sord:{f:[36,74],mf:[36,74],p:[36,74]},sord_trem:{f:[35,73],mf:[35,73],p:[35,73]},trem:{f:[36,74],mf:[36,74],p:[36,74]}},clarinet:{normal:{f:[49,95],mf:[49,96],p:[49,95]}},clarinet_eb:{normal:{f:[54,94],mf:[54,96],p:[54,93]}},crotale:{normal:{f:[83,108],p:[83,108]}},cymbal:{"13crash_bell":{f:[60,60],mf:[60,60],p:[60,60]},"13crash_bow":{mf:[60,60]},"13crash_chokecrash":{mf:[60,60]},"13crash_mallet":{f:[60,60],mf:[60,60],p:[60,60]},"13crash_normal":{f:[60,60],mf:[60,60],p:[60,60]},"13crash_roll":{mf:[60,60]},"13crash_shoulder":{f:[60,60],mf:[60,60],p:[60,60]},"16chinese_bell":{f:[60,60],mf:[60,60],p:[60,60]},"16chinese_bow":{mf:[60,60]},"16chinese_chokecrash":{mf:[60,60]},"16chinese_mallet":{f:[60,60],mf:[60,60],p:[60,60]},"16chinese_normal":{f:[60,60],mf:[60,60],p:[60,60]},"16chinese_roll":{mf:[60,60]},"16chinese_shoulder":{f:[60,60],mf:[60,60],p:[60,60]},"17crash_bell":{f:[60,60],mf:[60,60],p:[60,60]},"17crash_bow":{mf:[60,60]},"17crash_chokecrash":{mf:[60,60]},"17crash_mallet":{f:[60,60],mf:[60,60],p:[60,60]},"17crash_normal":{f:[60,60],mf:[60,60],p:[60,60]},"17crash_roll":{mf:[60,60]},"17crash_shoulder":{f:[60,60],mf:[60,60],p:[60,60]},"17orchcrash":{f:[60,60],mf:[60,60],p:[60,60]},"18crash_bell":{f:[60,60]},"18crash_bow":{mf:[60,60]},"18crash_chokecrash":{mf:[60,60]},"18crash_mallet":{f:[60,60],mf:[60,60],p:[60,60]},"18crash_normal":{f:[60,60],mf:[60,60],p:[60,60]},"18crash_roll":{mf:[60,60]},"18crash_shoulder":{f:[60,60],mf:[60,60],p:[60,60]},"18orchcrash_french":{f:[60,60],mf:[60,60],p:[60,60]},"18orchcrash_germanic":{f:[60,60],mf:[60,60],p:[60,60]},"18orchcrash_viennese":{f:[60,60],mf:[60,60],p:[60,60]},"19chinese_bell":{f:[60,60],mf:[60,60],p:[60,60]},"19chinese_bow":{mf:[60,60]},"19chinese_chokecrash":{mf:[60,60]},"19chinese_mallet":{f:[60,60],mf:[60,60],p:[60,60]},"19chinese_normal":{f:[60,60],mf:[60,60],p:[60,60]},"19chinese_roll":{mf:[60,60]},"19chinese_shoulder":{f:[60,60],mf:[60,60],p:[60,60]},"20chinese_bell":{f:[60,60],mf:[60,60],p:[60,60]},"20chinese_bow":{mf:[60,60]},"20chinese_chokecrash":{mf:[60,60]},"20chinese_mallet":{f:[60,60],mf:[60,60],p:[60,60]},"20chinese_normal":{f:[60,60],mf:[60,60],p:[60,60]},"20chinese_roll":{mf:[60,60]},"20chinese_shoulder":{f:[60,60],mf:[60,60],p:[60,60]},"20crash_bell":{f:[60,60],mf:[60,60],p:[60,60]},"20crash_bow":{mf:[60,60]},"20crash_chokecrash":{mf:[60,60]},"20crash_mallet":{f:[60,60],mf:[60,60],p:[60,60]},"20crash_normal":{f:[60,60],mf:[60,60],p:[60,60]},"20crash_roll":{mf:[60,60]},"20crash_shoulder":{f:[60,60],mf:[60,60],p:[60,60]},"21ride_bell":{f:[60,60],mf:[60,60],p:[60,60]},"21ride_mallet":{f:[60,60],mf:[60,60],p:[60,60]},"21ride_normal":{f:[60,60],mf:[60,60],p:[60,60]},"21ride_roll":{mf:[60,60]},"21ride_shoulder":{f:[60,60],mf:[60,60],p:[60,60]},hihat_bell:{f:[60,60],mf:[60,60],p:[60,60]},hihat_footclose:{f:[60,60],mf:[60,60],p:[60,60]},hihat_footsplash:{f:[60,60],mf:[60,60],p:[60,60]},hihat_normal:{f:[60,60],mf:[60,60],p:[60,60]},hihat_shoulder:{f:[60,60],mf:[60,60],p:[60,60]},normal:{f:[60,60],mf:[60,60],p:[60,60]},smallmetals:{mf:[60,60]},splash_bell:{f:[60,60],mf:[60,60],p:[60,60]},splash_mallet:{f:[60,60],mf:[60,60],p:[60,60]},splash_roll:{mf:[60,60]},splash_splash:{f:[60,60],mf:[60,60],p:[60,60]},windgong:{f:[60,60],mf:[60,60],p:[60,60]},windgong_bow:{mf:[60,60]}},double_bass:{harmonics:{f:[39,72],mf:[39,72],p:[39,72]},normal:{f:[22,61],mf:[22,61],p:[22,61]},pizz:{f:[28,51],mf:[28,51],p:[28,51]},pizz_harmonics:{f:[39,63],mf:[39,63],p:[39,63]},trem:{f:[23,61],mf:[23,61],p:[23,61]}},english_horn:{normal:{f:[51,84],mf:[51,84],p:[51,84]}},flute:{normal:{f:[58,97],mf:[58,96],p:[58,95]},vib:{f:[58,97],mf:[58,97],p:[58,95]}},guitar:{normal:{f:[39,84],mf:[39,85],p:[38,85]},normal_sulA:{f:[43,66],mf:[43,66],p:[43,66]},normal_sulB:{f:[57,80],mf:[57,80],p:[57,80]},normal_sulD:{f:[48,70],mf:[48,70],p:[48,70]},normal_sulE:{f:[38,61],mf:[38,61],p:[38,61]},normal_sulG:{f:[53,75],mf:[53,75],p:[53,75]},normal_sul_E:{f:[62,84],mf:[62,85],p:[62,85]}},harp:{normal:{f:[17,90],mf:[19,90],p:[17,90]}},horn:{normal:{f:[32,79],mf:[32,79],p:[32,78]}},oboe:{normal:{f:[57,93],mf:[57,93],p:[57,92]}},percussion_misc:{castanet:{f:[60,60],mf:[60,60],p:[60,60]},guiro_away:{f:[60,60],mf:[60,60],p:[60,60]},guiro_toward:{f:[60,60],mf:[60,60]},shakers:{mf:[60,60]}},piano:{normal:{f:[20,108],mf:[22,108],p:[21,108]}},piccolo:{normal:{f:[74,109],mf:[74,109],p:[74,109]}},solo_cello:{arco_sulA:{f:[56,83],mf:[56,82],p:[56,84]},arco_sulC:{f:[35,61],mf:[35,62],p:[35,62]},arco_sulD:{f:[49,75],mf:[49,75],p:[49,75]},arco_sulG:{f:[42,69],mf:[42,68],p:[42,68]},normal:{f:[35,83],mf:[35,82],p:[35,83]}},solo_double_bass:{arco_sulA:{f:[32,58],mf:[32,58],p:[32,58]},arco_sulD:{f:[37,63],mf:[37,63],p:[37,63]},arco_sulE:{f:[27,51],mf:[27,51],p:[27,51]},arco_sulG:{f:[42,68],mf:[42,60],p:[42,68]},normal:{f:[27,68],mf:[27,68],p:[27,68]},pizz:{f:[27,68],mf:[27,68],p:[27,68]},pizz_sulA:{f:[32,58],mf:[32,58],p:[32,58]},pizz_sulD:{f:[37,63],mf:[37,63],p:[37,63]},pizz_sulE:{f:[27,53],mf:[27,53],p:[27,53]},pizz_sulG:{f:[42,68],mf:[42,68],p:[42,68]}},solo_viola:{arco_sulA:{f:[68,93],mf:[68,93],p:[68,92]},arco_sulC:{f:[47,72],mf:[47,72],p:[47,73]},arco_sulD:{f:[61,87],mf:[61,86],p:[61,84]},arco_sulG:{f:[54,81],mf:[54,79],p:[54,79]},normal:{f:[47,93],mf:[47,93],p:[47,91]}},solo_violin:{arco_sulA:{f:[68,92],mf:[68,93],p:[68,93]},arco_sulD:{f:[61,87],mf:[61,87],p:[61,85]},arco_sulE:{f:[75,108],mf:[75,105],p:[75,107]},arco_sulG:{f:[54,79],mf:[54,80],p:[54,78]},normal:{f:[54,108],mf:[54,105],p:[54,107]}},soprano_generic:{normal:{f:[59,82],mf:[59,82],p:[65,87]}},soprano_sax:{normal:{f:[55,88],mf:[55,88],p:[55,88]},normal_Vib:{f:[55,88],mf:[55,88],p:[55,88]}},tambourine:{normal:{f:[60,60],mf:[60,60],p:[60,60]},normal_fingerroll:{f:[60,60],mf:[60,60],p:[60,60]},normal_sforzando:{mf:[60,60]},normal_shakeroll:{f:[60,60],mf:[60,60],p:[60,60]},normal_thumbroll:{f:[60,60],mf:[60,60],p:[60,60]}},tamtam:{bow:{mf:[60,60]},normal:{f:[60,60],mf:[60,60],p:[60,60]}},tamtam_22:{bow:{mf:[60,60]},normal:{f:[60,60],mf:[60,60],p:[60,60]}},tamtam_40:{bow:{mf:[60,60]},normal:{f:[60,60],mf:[60,60],p:[60,60]}},TenorTrombone:{normal:{f:[39,73],mf:[39,73],p:[39,73]}},tenor_generic:{normal:{f:[49,72],mf:[49,72],p:[49,71]}},thaigong:{normal:{f:[59,73],mf:[59,73],p:[59,73]}},triangle_6:{normal:{f:[60,60],mf:[60,60],p:[60,60]},normal_roll:{f:[60,60],mf:[60,60],p:[60,60]}},triangle_8:{normal:{f:[60,60],mf:[60,60],p:[60,60]},normal_roll:{f:[60,60],mf:[60,60],p:[60,60]}},trumpet:{normal:{f:[51,88],mf:[51,87],p:[51,88]},vib:{f:[51,87],mf:[51,87],p:[51,87]}},tuba:{normal:{f:[23,61],mf:[23,61],p:[23,61]}},vibraphone:{normal:{f:[47,91],mf:[47,90],p:[47,90]},normal_bow:{mf:[47,90]}},viola:{harmonics:{f:[66,88],mf:[66,88],p:[66,88]},normal:{f:[48,86],mf:[48,86],p:[48,86]},pizz:{f:[47,85],mf:[47,85],p:[47,85]},sord:{f:[48,86],mf:[48,86],p:[48,86]},sord_trem:{f:[47,85],mf:[47,85],p:[47,85]},trem:{f:[47,85],mf:[47,85],p:[47,85]}},violin:{harmonics:{f:[66,104],mf:[66,104],p:[66,104]},normal:{f:[54,97],mf:[55,96],p:[55,96]},pizz:{f:[54,96],mf:[54,96],p:[54,96]},sord:{f:[55,93],mf:[55,93],p:[55,93]},sord_trem:{f:[55,96],mf:[55,96],p:[55,96]},tremolo:{f:[54,96],mf:[54,96],p:[55,96]}},woodblock:{clave:{f:[60,60],mf:[60,60],p:[60,60]},graniteblock:{f:[60,60],mf:[60,60],p:[60,60]},normal:{f:[60,60],mf:[60,60],p:[60,60]}},xylophone:{gliss_down:{mf:[59,60]},gliss_up:{mf:[60,60]},normal:{f:[64,108],mf:[64,108],p:[64,108]},normal_hardrubber:{f:[64,108],mf:[64,108],p:[64,108]}},tenor_trombone:{normal:{f:[39,73],mf:[39,73],p:[39,73]}},timp:{normal:{f:[37,61],mf:[37,61],p:[37,57]}}};var J=a(281),X=a(275),q=a(265),Y=a(61),Q=a.n(Y),$=a(74);const Z=$.a.Flow;class ee extends r.Component{constructor(e){super(e),this.notes=0,this.target=0,this.instruments=0,this.renderer=0,this.context=0,this.scale=1,this.state={x:0,y:0}}setupScore(){const e=document.createElement("div"),{id:t,notes:a,target:r,instruments:n,setProps:s,width:o,height:l,t_score_y:i,b_score_y:c,target_color:m,text_space:d,highlights:h,indexing:u,scale:p}=this.props;this.notes=a,this.target=r,this.instruments=n,this.scale=p,this.renderer=new Z.Renderer(e,Z.Renderer.Backends.SVG),this.renderer.resize(o+d,l);var f=this.renderer.getContext();this.context=f,this.context.scale(this.scale,this.scale);var g=new Z.Stave(20,i,o);g.addClef("treble"),g.setContext(this.context).draw();var y=new Z.Stave(20,c,o);y.addClef("bass"),y.setContext(this.context).draw();var E=function(e,t,a){var r,n,s,o,l,i,c,m=[],d=[],p=[],f=[],g=[],y=[],E=[],b=[],v=[],_=[],x=[],C=[],w=[],k=[],S=[];for(r=0;r<e.length;r++){l=e[r],c=u?r+": "+t[r]:t[r];var T="";if("undefined"!==typeof h[r]&&(T=h[r]),n=l[0],s=l[l.length-1],o=l.length>2?l[1]:"n",i=n.concat("/",s),N=a[r],parseInt(s)>=4&&parseInt(s)<6){m.push(i),d.push(o),f.push(c),g.push(T);for(var N=0,I=0;I<a.length;I++)a[I]===r&&(N=1);p.push(N)}else if(parseInt(s)>=6){s-=2,i=n.concat("/",s),x.push(i),C.push(o),k.push(c),S.push(T);for(N=0,I=0;I<a.length;I++)a[I]===r&&(N=1);w.push(N)}else{y.push(i),E.push(o),v.push(c),_.push(T);for(N=0,I=0;I<a.length;I++)a[I]===r&&(N=1);b.push(N)}}return[m,d,p,y,E,b,f,v,g,_,x,C,w,k,S]}(this.notes,this.instruments,this.target);if(Array.isArray(E[10])&&E[10].length){var b=new Z.Stave(20,40,o);b.addClef("treble"),b.setContext(this.context).draw(),this.context.fillText("15ma",b.x+6,b.y+26);for(var v=[],_=0;_<E[10].length;_++)v.push("c/4");var x=new Z.StaveNote({clef:"treble",keys:v,duration:"q"});x.setStemStyle({strokeStyle:"none"}),x.setLedgerLineStyle({strokeStyle:"none"});for(_=0;_<E[10].length;_++)x.setKeyLine(_,_-1.5);var C=new Z.StaveNote({clef:"treble",keys:E[10],duration:"q"}),w=E[13],k=E[14];for(_=0;_<E[11].length;_++){"n"!==E[11][_]&&C.addAccidental(_,new Z.Accidental(E[11][_]));var S=W(w[_],Z.Modifier.Position.RIGHT);S.setOffsetX(-10),x.note_heads[_].glyph_code="v23",x.addModifier(_,S),k[_]&&C.setKeyStyle(_,{shadowColor:k[_],shadowBlur:100}),1===E[12][_]&&(C.setKeyStyle(_,{fillStyle:m}),x.setKeyStyle(_,{fillStyle:m}))}var T=new Z.StaveConnector(b,y),N=new Z.StaveConnector(b,y)}else T=new Z.StaveConnector(g,y),N=new Z.StaveConnector(g,y);T.setType(Z.StaveConnector.type.SINGLE_LEFT),T.setContext(this.context),T.draw(),N.setType(Z.StaveConnector.type.BRACKET),N.setContext(this.context),N.draw();var I=[];for(_=0;_<E[0].length;_++)I.push("c/4");var A=new Z.StaveNote({clef:"treble",keys:I,duration:"q"});A.setStemStyle({strokeStyle:"none"}),A.setLedgerLineStyle({strokeStyle:"none"});for(_=0;_<E[0].length;_++)A.setKeyLine(_,_-1.5);var M=[];for(_=0;_<E[3].length;_++)M.push("c/3");var O=new Z.StaveNote({clef:"bass",keys:M,duration:"q"});O.setStemStyle({strokeStyle:"none"}),O.setLedgerLineStyle({strokeStyle:"none"});for(_=0;_<E[3].length;_++)O.setKeyLine(_,_-1.5);var D=new Z.StaveNote({clef:"treble",keys:E[0],duration:"q"}),P=new Z.StaveNote({clef:"bass",keys:E[3],duration:"q"}),L=E[6],z=E[7],R=E[8],F=E[9];function W(e,t){return new Z.FretHandFinger(e).setPosition(t)}for(_=0;_<E[1].length;_++){"n"!==E[1][_]&&D.addAccidental(_,new Z.Accidental(E[1][_]));var V=W(L[_],Z.Modifier.Position.RIGHT);V.setOffsetX(-10),A.note_heads[_].glyph_code="v23",A.addModifier(_,V),R[_]&&D.setKeyStyle(_,{shadowColor:R[_],shadowBlur:100}),1===E[2][_]&&(D.setKeyStyle(_,{fillStyle:m}),A.setKeyStyle(_,{fillStyle:m}))}for(_=0;_<E[3].length;_++){"n"!==E[4][_]&&P.addAccidental(_,new Z.Accidental(E[4][_]));var j=W(z[_],Z.Modifier.Position.RIGHT);j.setOffsetX(-10),O.note_heads[_].glyph_code="v23",O.addModifier(_,j),F[_]&&P.setKeyStyle(_,{shadowColor:F[_],shadowBlur:100}),1===E[5][_]&&(P.setKeyStyle(_,{fillStyle:m}),O.setKeyStyle(_,{fillStyle:m}))}if(Array.isArray(E[0])&&E[0].length){var G=new Z.Voice({num_beats:1,beat_value:4}).setMode(2),B=new Z.Voice({num_beats:1,beat_value:4}).setMode(2);G.addTickables([D]),B.addTickables([A]);(new Z.Formatter).joinVoices([G]).format([G],o);(new Z.Formatter).joinVoices([B]).format([B],o).tickContexts.array[0].x=o-40,G.draw(this.context,g),B.draw(this.context,g)}var H=new Z.Voice({num_beats:1,beat_value:4}),K=new Z.Voice({num_beats:1,beat_value:4});if(K.addTickables([O]),Array.isArray(E[3])&&E[3].length){H.addTickables([P]);(new Z.Formatter).joinVoices([H]).format([H],o);(new Z.Formatter).joinVoices([K]).format([K],o).tickContexts.array[0].x=o-40,H.draw(this.context,y),K.draw(this.context,y)}if(Array.isArray(E[10])&&E[10].length){var U=new Z.Voice({num_beats:1,beat_value:4}).setMode(2),J=new Z.Voice({num_beats:1,beat_value:4}).setMode(2);U.addTickables([C]),J.addTickables([x]);(new Z.Formatter).joinVoices([U]).format([U],o);(new Z.Formatter).joinVoices([J]).format([J],o).tickContexts.array[0].x=o-40,U.draw(this.context,b),J.draw(this.context,b);var X=[];for(_=0;_<v.length;_++){var q=new Z.StaveLine({first_note:C,last_note:x,first_indices:[_],last_indices:[_]});q.render_options.line_width=3,q.render_options.padding_right=-4,k[_]&&(q.render_options.color=k[_]),1===E[12][_]&&(q.render_options.color=m),X.push(q)}for(var Y=0;Y<X.length;Y++)X[Y].setContext(f),X[Y].draw()}var Q=[];for(_=0;_<I.length;_++){var $=new Z.StaveLine({first_note:D,last_note:A,first_indices:[_],last_indices:[_]});$.render_options.line_width=3,$.render_options.padding_right=-4,R[_]&&($.render_options.color=R[_]),1===E[2][_]&&($.render_options.color=m),Q.push($)}var ee=[];for(_=0;_<M.length;_++){var te=new Z.StaveLine({first_note:P,last_note:O,first_indices:[_],last_indices:[_]});te.render_options.line_width=3,te.render_options.padding_right=-4,F[_]&&(te.render_options.color=F[_]),1===E[5][_]&&(te.render_options.color=m),ee.push(te)}for(Y=0;Y<Q.length;Y++)Q[Y].setContext(f),Q[Y].draw();for(Y=0;Y<ee.length;Y++)ee[Y].setContext(f),ee[Y].draw();this.refs.outer.appendChild(e),this.refs.outer.addEventListener("click",this.orchClick.bind(this),!1)}orchClick(e){const{setProps:t,indexing:a}=this.props;if(e.target.closest("text")&&a){var r=e.target.innerHTML.split(":"),n=parseInt(r[0]);t&&t({onClick:n}),console.log(n)}}componentDidMount(){this.setupScore()}componentDidUpdate(e){for(var t=this.refs.outer;t.hasChildNodes();)t.removeChild(t.lastChild);this.setupScore()}render(){const{id:e,notes:t,instruments:a,target:r}=this.props;return n.a.createElement("div",{id:e,ref:"outer",style:{border:"none",padding:0,borderRadius:0,display:"inline-block"}})}}ee.defaultProps={width:200,height:400,t_score_y:110,b_score_y:200,text_space:120,target_color:"red",highlights:[],indexing:!0};const te=$.a.Flow;class ae extends r.Component{constructor(e){super(e),this.state={x:0,y:0}}setupScore(){const e=document.createElement("div"),{id:t,masking_notevalues:a,masking_notesizes:r,masking_colors:n,target_notevalues:s,target_notesizes:o,target_colors:l,setProps:i}=this.props;var c=new te.Renderer(e,te.Renderer.Backends.SVG);c.resize(100,250);var m=c.getContext(),d=new te.Stave(10,60,100);d.addClef("treble"),d.setContext(m).draw();var h=new te.Stave(10,120,100);h.addClef("bass"),h.setContext(m).draw();var u=new te.StaveConnector(d,h);u.setType(te.StaveConnector.type.SINGLE_LEFT),u.setContext(m),u.draw();var p=new te.StaveConnector(d,h);p.setType(te.StaveConnector.type.BRACKET),p.setContext(m),p.draw();for(var f=[],g=[],y=[],E=[],b=[],v=[],_=0;_<a.length;_++)a[_]>59?(f.push(a[_]),g.push(r[_]),y.push(n[_])):(E.push(a[_]),b.push(r[_]),v.push(n[_]));var x=[],C=[],w=[],k=[],S=[],T=[];for(_=0;_<s.length;_++)s[_]>59?(x.push(s[_]),C.push(o[_]),w.push(l[_])):(k.push(s[_]),S.push(o[_]),T.push(l[_]));var N=new Array,I=new Array,A=new Array,M=new Array;function O(e,t){var a=0;return 40===t&&(a=-1),(e=(e-t)/4)>1+a&&(e+=.25),e>3+a&&(e+=.25),e>4.5+a&&(e+=.25),e>6.5+a&&(e+=.25),e>8+a&&(e+=.25),e>10+a&&(e+=.25),e>13.5+a&&(e+=.25),e>15.5+a&&(e+=.25),e}var D=[];if(Array.isArray(E)&&E.length){for(_=0;_<E.length;_++){var P=O(E[_],40);(F=new te.NoteHead({duration:"128",line:P,custom_glyph_code:"vd2",glyph_font_scale:b[_],style:{fillStyle:"none"}})).setCenterAlignment(!0),I.push(F)}var L=new te.Voice({num_beats:1,beat_value:1}).setMode(2);L.addTickables(I);(new te.Formatter).joinVoices([L]).format([L],1);L.draw(m,h)}if(Array.isArray(f)&&f.length){for(_=0;_<f.length;_++){P=O(f[_],60);(F=new te.NoteHead({duration:"128",line:P,custom_glyph_code:"vd2",glyph_font_scale:g[_],style:{fillStyle:"none"}})).setCenterAlignment(!0),N.push(F)}var z=new te.Voice({num_beats:1,beat_value:1}).setMode(2);z.addTickables(N);(new te.Formatter).joinVoices([z]).format([z],1);z.draw(m,d)}if(Array.isArray(x)&&x.length){A.push(new te.GhostNote("q"));for(_=0;_<x.length;_++){P=O(x[_],60);(F=new te.NoteHead({duration:"128",displaced:!1,line:P,custom_glyph_code:"vb",glyph_font_scale:C[_],style:{fillStyle:w[_]}})).setCenterAlignment(!0),A.push(F)}var R=new te.Voice({num_beats:1,beat_value:1}).setMode(2);R.addTickables(A);(new te.Formatter).joinVoices([R]).format([R],10);R.draw(m,d)}if(Array.isArray(k)&&k.length){M.push(new te.GhostNote("q"));for(_=0;_<k.length;_++){var F;P=O(k[_],60);(F=new te.NoteHead({duration:"128",displaced:!1,line:P,custom_glyph_code:"vb",glyph_font_scale:S[_],style:{fillStyle:T[_]}})).setCenterAlignment(!0),M.push(F)}var W=new te.Voice({num_beats:1,beat_value:1}).setMode(2);W.addTickables(M);(new te.Formatter).joinVoices([W]).format([W],10);W.draw(m,d)}if(Array.isArray(E)&&E.length)for(_=0;_<E.length;_++)D.push(L.tickables[_].y);if(Array.isArray(f)&&f.length)for(_=0;_<f.length;_++)D.push(z.tickables[_].y);for(var V=0;V<D.length-1;V++)m.beginPath().moveTo(40,D[V]).lineTo(90,D[V]).lineTo(90,D[V+1]).lineTo(40,D[V+1]).closePath().fill({fill:n[V]});m.beginPath().closePath(),this.refs.outer2.appendChild(e)}componentDidMount(){this.setupScore()}componentDidUpdate(e){for(var t=this.refs.outer2;t.hasChildNodes();)t.removeChild(t.lastChild);this.setupScore()}render(){const{id:e}=this.props;return n.a.createElement("div",{id:e,ref:"outer2",style:{border:"none",padding:0,borderRadius:0,display:"inline-block"}})}}ae.defaultProps={};var re=a(279),ne=a(6),se=a(283);const oe=Object(ne.a)(se.a)(e=>{let{theme:t}=e;return{...t.typography.body2,backgroundColor:"#fffef0",padding:t.spacing(1),textAlign:"center",color:t.palette.text.secondary}});function le(e){const t=["C","C#","D","D#","E","F","F#","G","G#","A","B#","B"];if(e.data.length<2)return null;const a=[{domain:{x:[0,1],y:[0,1]},value:e.data[2].var_coeff_graph,title:{text:"Orch. timbre homogeneity"},type:"indicator",mode:"gauge+number",gauge:{axis:{range:[null,100]}}}],n=e.data[2].fig_config,s=e.data[2].msking_graph.data,o=e.data[2].msking_graph.layout;return o.width=window.innerWidth-380,r.createElement("div",null,r.createElement(re.a,{style:{marginTop:.5},container:!0,direction:"row",justifyContent:"center",alignItems:"center",spacing:.5},r.createElement(re.a,{item:!0,xs:12,md:6},r.createElement(oe,{style:{height:452,backgroundColor:"#fffef0"}},r.createElement(c.a,null,"Orchestration at clicked point"),r.createElement("div",{style:{backgroundColor:"rgba(0,255,0,0.3)",display:"inline"}},"Target"),r.createElement("div",{style:{backgroundColor:"rgba(255,0,0,0.5)",display:"inline"}}," Heaviest masker"),r.createElement("div",{style:{backgroundColor:"rgba(255,0,255,0.5)",display:"inline"}}," 2nd masker"),r.createElement("div",{style:{backgroundColor:"rgba(255,255,0,0.5)",display:"inline"}}," 3rd masker "),r.createElement(ee,{notes:e.data[4].notenumbers.map(e=>function(e){var a=e-Math.floor(e);let r=Math.round(e),n=t[r%12];return a>=.2&&a<.5?/[#]/.test(n)?n=t[(r+1)%12]+"d":n+="+":a>=.5&&a<=.8&&(/[#]/.test(n)?n=t[(r-1)%12]+"+":n+="d"),n+(Math.floor(r/12)-1)}(e)),instruments:e.data[4].instruments,target:e.data[4].target,target_color:"green",highlights:e.data[4].highlights,width:200,text_space:200}))),r.createElement(re.a,{item:!0,xs:12,md:6},r.createElement(oe,{style:{height:452,backgroundColor:"#fffef0"}},r.createElement(c.a,null,"Spectral centroid at clicked point"),r.createElement(ee,{notes:e.data[2].centroid_graph.notes,instruments:e.data[2].centroid_graph.markings,target:[],width:150,text_space:200})))),r.createElement(re.a,{style:{marginTop:.5},container:!0,direction:"row",justifyContent:"center",alignItems:"center",spacing:.5},r.createElement(re.a,{item:!0,xs:12,md:6},r.createElement(oe,{style:{height:452,backgroundColor:"#fffef0"}},r.createElement(c.a,null,"Timbre distance data"),r.createElement(c.a,null,"Target timbre distance from orchestration: ",e.data[2].distance_graph,"/100"),r.createElement(Q.a,{data:a,layout:{width:350,margin:{t:0,b:0},plot_bgcolor:"#fffef0",paper_bgcolor:"#fffef0"},config:n}))),r.createElement(re.a,{item:!0,xs:12,md:6},r.createElement(oe,{style:{height:452,backgroundColor:"#fffef0",verticalAlign:"center"}},r.createElement(c.a,null,"Masking staff graph"),r.createElement("br",null),r.createElement("br",null),r.createElement(ae,{masking_notevalues:e.data[2].masking_score.masking_notevalues,masking_colors:e.data[2].masking_score.masking_colors,masking_notesizes:e.data[2].masking_score.masking_notesizes,target_notevalues:e.data[2].masking_score.target_notevalues,target_colors:e.data[2].masking_score.target_colors,target_notesizes:e.data[2].masking_score.target_notesizes})))),r.createElement(re.a,{style:{marginTop:.5,marginInline:0},container:!0,direction:"row",justifyContent:"left",alignItems:"left",spacing:.5},r.createElement(re.a,{item:!0,xs:12,md:12},r.createElement(oe,null,r.createElement(Q.a,{data:s,layout:{...o,width:window.innerWidth-50,margin:{l:0,r:0}},config:n})))),r.createElement(re.a,{style:{marginTop:.5},container:!0,direction:"row",justifyContent:"center",alignItems:"center",spacing:.5},r.createElement(re.a,{item:!0,xs:12,md:8},r.createElement(oe,null,r.createElement(Q.a,{data:e.data[2].mfcc_graph.data,layout:{...e.data[2].mfcc_graph.layout,width:window.innerWidth/1.5-50,margin:{l:0,r:0},legend:{orientation:"h"}},config:n,width:200}))),r.createElement(re.a,{item:!0,xs:12,md:4},r.createElement(oe,{style:{height:452,backgroundColor:"#fffef0"}},r.createElement(c.a,null,"Summary of the current orchestration"),r.createElement("br",null),r.createElement("br",null),r.createElement(c.a,null,e.data[2].summary)))))}var ie=a(128);let ce="https://rest.score-tool.com/";const me=ce,de=me;function he(e){const t=e=>{let t=21;const a={violin:2,viola:8,cello:11,double_bass:14,flute:15,oboe:16,clarinet:17,bassoon:18,horn:19,trumpet:22,tenor_trombone:23,bass_trombone:21,timpani:22,cymbal:24};return Object.keys(a).includes(e)&&(t=a[e]),t};let a=[];e.instrumentList.map(e=>a.push(e[0]));const n=[[10,50,3],[20,50,2],[30,50,1],[60,50,10],[70,50,11],[80,50,12],[15,35,6],[25,35,5],[40,40,4],[55,40,7],[65,35,8],[75,35,9],[86,35,13],[18,20,20],[32,20,19],[45,30,15],[50,30,16],[70,20,24],[80,20,14],[40,10,22],[50,10,21],[60,10,23],[45,20,17],[50,20,18],[45,55,25]];let s=[];n.map(e=>s.push(!1));const[o,l]=r.useState({clicked:!1,over:!1,drop:"not yet",instrument_assignment:a.map(e=>t(e)),hoverState:s,position:"audience",audio:"",play:!1});if(r.useEffect(()=>{l(e=>({...e,instrument_assignment:a.map(e=>t(e))}))},[e]),r.useEffect(()=>{o.play&&document.getElementById("AUDIOPLAY").play()},[]),0===e.instrumentList.length)return null;const i=(e,t)=>{if(console.log(e),t){const a=[...o.instrument_assignment];a[t.dragData.data]=e;const r=[...o.hoverState];r[e-1]=!1,l({...o,instrument_assignment:a,hoverState:r})}},c=(e,t,a)=>{const n=e+"%",s=t+"%";return r.createElement("div",{style:{left:n,position:"absolute",top:s}},r.createElement(ie.DropTarget,{onHit:e=>i(a,e),targetKey:"foo",onDragEnter:e=>((e,t)=>{const a=[...o.hoverState];a[e]=!0,l({...o,hoverState:a})})(a-1),onDragLeave:e=>((e,t)=>{const a=[...o.hoverState];a[e]=!1,l({...o,hoverState:a})})(a-1)},r.createElement("h2",{style:{backgroundColor:"rgba(0,255,0,0.3)",borderRadius:"30px",padding:6}},a," ",o.hoverState[a-1]?"DROP HERE":"")))};return r.createElement("div",{style:{maxWidth:800,textAlign:"center",margin:"auto",alignItems:"center"}},r.createElement("div",{style:{padding:20}},"Here you can listen how your orchestration sounds like played with real instruments in Helsinki Music Center hall. The algorithm utilize pre-calculated impulse responses. Helsinki Musiikkitalo spatial impulse response measurements are done by Aalto University. They are used here with permission from Prof. Tapio Lokki, who has computed the binaural responses"),r.createElement("div",{style:{marginTop:-20,padding:20}},"Drag the instruments of your orchestration to the place on stage you want them to play. Select the listening position, selecting 'conductor' places you on the conductor podium and 'audience' to the center of row 6. When you are ready, tap 'listen' and wait for a few seconds for calculations."),r.createElement(E.a,{onClick:()=>{l({...o,audio:""});const t={orchestration:e.instrumentList.map(e=>e[0]+","+e[1]+","+e[2]+","+e[3]),positions:o.instrument_assignment,listeningPosition:o.position};B.a.post(de+"listen",t,{headers:{auth:"uljasPulkkis"}}).then(e=>{const t=r.createElement("div",null,r.createElement("audio",{controls:!0,autoPlay:"true",id:"AUDIOPLAY"}," ",r.createElement("source",{src:e.data,type:"audio/x-wav"})," "));l({...o,audio:t,play:!0})}).catch(e=>console.log(e))},variant:"contained"},"click here to calculate acoustics and listen"),o.audio,r.createElement("div",{style:{display:"block"}},r.createElement(D.a,{sx:{m:1,minWidth:50}},r.createElement(O.a,{id:"listen-select"},"Position"),r.createElement(M.a,{labelId:"listen-select",id:"listen-select",value:o.position,onChange:e=>l({...o,position:e.target.value}),autoWidth:!0,label:"listen-select"},r.createElement(v.a,{value:"audience"},"audience"),r.createElement(v.a,{value:"conductor"},"conductor")))),r.createElement("div",{style:{float:"left"}},a.map((e,t)=>r.createElement(ie.DragDropContainer,{dragClone:!1,targetKey:"foo",onDrop:i,dragData:{data:t}},r.createElement("div",{style:{backgroundColor:"rgba(0,255,255,0.3)",borderRadius:"30px",fontSize:24,padding:10}},e+": "+o.instrument_assignment[t])))),r.createElement("div",{style:{clear:"both"}},"\xa0"),r.createElement("div",{style:{backgroundImage:"url(./musatalo.jpg)",position:"relative",backgroundSize:"100% 120%",backgroundRepeat:"no-repeat"}},r.createElement("div",{style:{minHeight:"50vh"}},n.map(e=>c(e[0],e[1],e[2])))))}function ue(e){let{text:t,orchestration:a}=e;const[n,s]=r.useState({textFieldValue:t,saved:!1});r.useEffect(()=>{s(e=>({...e,saved:!1,textFieldValue:t}))},[a]);const o=()=>{if(a.length>0){let e=JSON.parse(localStorage.getItem("orchestrations")),t=0;null!=e&&(e.length>0&&(t=e[e.length-1].id+1),console.log(a),console.log(typeof a[0][3]),"number"===typeof a[0][3]?e.push({id:t,name:n.textFieldValue,data:a.map(e=>[e[0],e[1],e[2],[e[3]],e[4],e[5],e[6]])}):e.push({id:t,name:n.textFieldValue,data:a}),localStorage.setItem("orchestrations",JSON.stringify(e)),s(e=>({...e,saved:!0})))}},l=e=>{const t=e.target.value;s(e=>({...e,textFieldValue:t}))};return r.createElement("div",null,n.saved?r.createElement("div",{style:{textAlign:"center"}},"Saved!"):r.createElement("div",null,r.createElement(X.a,{fullWidth:!0,value:n.textFieldValue,label:"save name",onChange:l}),r.createElement(E.a,{fullWidth:!0,variant:"contained",color:"secondary",onClick:o}," Save to your list of orchestrations ")))}var pe=a(264);function fe(e){const[t,a]=Object(r.useState)({idx:e.idx,scoreNames:e.row[0],scoreTechs:e.row[1],scoreDyns:e.row[2],scorePitch:e.row[3],scoreTgt:e.row[4],scoreOnoff:e.row[5],scoreIdx:e.row[6],scoreMicro:0,color:e.color,scoreModify:0}),s=(r,n)=>{let s=0;0===t.scoreModify?s=-12:-12===t.scoreModify&&(s=12),a(t=>({...t,scoreModify:s,scorePitch:e.row[3]+s})),e.onChange({idx:t.idx,row:[t.scoreNames,t.scoreTechs,t.scoreDyns,e.row[3]+s,t.scoreTgt,t.scoreOnoff,t.scoreIdx,t.scoreMicro]})};let o=[];-12===t.scoreModify?o=n.a.createElement("div",{onClick:s,style:{backgroundColor:"rgba(123,30,30,0.3)",borderRadius:10,padding:3,textAlign:"center"}},"-12"):12===t.scoreModify?o=n.a.createElement("div",{onClick:s,style:{backgroundColor:"rgba(30,123,30,0.3)",borderRadius:10,padding:3,textAlign:"center"}},"12"):0===t.scoreModify&&(o=n.a.createElement("div",{onClick:s,style:{backgroundColor:"rgba(30,30,30,0.3)",borderRadius:10,padding:3,textAlign:"center"}},"0"));const l=(e,t)=>{a(e=>({...e,scoreMicro:t}))},i=(a,r)=>{e.onChange({idx:t.idx,row:[t.scoreNames,t.scoreTechs,t.scoreDyns,t.scorePitch,t.scoreTgt,t.scoreOnoff,t.scoreIdx,t.scoreMicro]})};return n.a.createElement("tr",null,n.a.createElement("td",{key:"scor"+t.idx,style:{backgroundColor:t.color}},t.scoreNames),n.a.createElement("td",{key:"tec"+t.idx},t.scoreTechs),n.a.createElement("td",{key:"dy"+t.idx},n.a.createElement("div",{onClick:(r,n)=>{let s="mf";"mf"===t.scoreDyns?s="f":"f"===t.scoreDyns&&(s="p"),a(e=>({...e,scoreDyns:s})),e.onChange({idx:t.idx,row:[t.scoreNames,t.scoreTechs,s,t.scorePitch,t.scoreTgt,t.scoreOnoff,t.scoreIdx,t.scoreMicro]})},style:{backgroundColor:"rgba(123,200,30,0.3)",borderRadius:10,padding:3,textAlign:"center"}}," ",t.scoreDyns," ")),n.a.createElement("td",{key:"micro"+t.idx},n.a.createElement(d.a,{sx:{width:60,height:15,verticalAlign:"top",marginTop:-2}},n.a.createElement(pe.a,{spacing:1,direction:"row",sx:{mb:1},alignItems:"center"},n.a.createElement("img",{src:"/flat.png",height:"15"}),n.a.createElement(I.a,{valueLabelDisplay:"auto","aria-label":"tune",size:"small",min:-.49,step:.01,max:.49,value:t.scoreMicro,onChangeCommitted:i,onChange:l}),n.a.createElement("img",{src:"/sharp.png",height:"15"})))),n.a.createElement("td",{key:"tg"+t.idx},n.a.createElement("div",{onClick:(r,n)=>{a(e=>({...e,scoreTgt:!e.scoreTgt})),e.onChange({idx:t.idx,row:[t.scoreNames,t.scoreTechs,t.scoreDyns,t.scorePitch,!t.scoreTgt,t.scoreOnoff,t.scoreIdx,t.scoreMicro]})},style:{backgroundColor:"rgba(123,200,30,0.3)",borderRadius:10,padding:3,textAlign:"center"}},t.scoreTgt?"target":"orchestration")),n.a.createElement("td",{key:"onof"+t.idx}," ",n.a.createElement("div",{onClick:(r,n)=>{a(e=>({...e,scoreOnoff:!e.scoreOnoff})),e.onChange({idx:t.idx,row:[t.scoreNames,t.scoreTechs,t.scoreDyns,t.scorePitch,t.scoreTgt,!t.scoreOnoff,t.scoreIdx,t.scoreMicro]})},style:{backgroundColor:t.scoreOnoff?"rgba(123,200,30,0.3)":"rgba(200,123,30,0.3)",borderRadius:10,padding:3,textAlign:"center"}},t.scoreOnoff?"ON":"OFF"," ")),n.a.createElement("td",{key:"mo"+t.idx},o))}var ge=a(293);function ye(e){let t=[];e.instrumentList.map(e=>t.push(e[0]));const a=e=>{let t=21;const a={violin:2,viola:8,cello:11,double_bass:14,flute:15,oboe:16,clarinet:17,bassoon:18,horn:19,trumpet:22,tenor_trombone:23,bass_trombone:21,timpani:22,cymbal:24};return Object.keys(a).includes(e)&&(t=a[e]),t},[n,s]=r.useState({instrument_assignment:t.map(e=>a(e))});r.useEffect(()=>{s(e=>({...e,instrument_assignment:t.map(e=>a(e))}))},[e]);return r.createElement("div",{style:{transform:"scale(0.8,0.8)"}},r.createElement(E.a,{size:"small",onClick:()=>{s({...n,audio:""});const t={orchestration:e.instrumentList.map(e=>e[0]+","+e[1]+","+e[2]+","+e[3]),positions:n.instrument_assignment,listeningPosition:"audience"};B.a.post("https://rest.score-tool.com/listen",t,{headers:{auth:"uljasPulkkis"}}).then(e=>{const t=r.createElement("div",{style:{transform:"scale(0.5,0.5)"}},r.createElement("audio",{controls:!0,autoPlay:"true",id:"AUDIOPLAY"}," ",r.createElement("source",{src:e.data,type:"audio/x-wav"})," "));s({...n,audio:t})}).catch(e=>console.log(e))},variant:"contained"},"Quick listen"),n.audio)}const Ee=me,be=r.forwardRef((function(e,t){return r.createElement(q.a,Object.assign({direction:"up",ref:t},e))}));function ve(e){const[t,a]=r.useState(!1),[n,s]=r.useState([]),[o,l]=r.useState([]),[i,p]=r.useState([]),[f,g]=r.useState([]),[y,E]=r.useState([]),[b,v]=r.useState(!1),[_,x]=r.useState({textFieldValue:"orchestration"}),[C,w]=r.useState(0);let k=[],S=[];r.useEffect(()=>{a(t=>e.open),e.data.length>1&&(s(t=>e.data[1]),l([])),e.data.length>1&&(w(t=>100-e.data[0].data[2].masking_percent),p(t=>e.data[0].data),x(t=>({...t,textFieldValue:JSON.parse(localStorage.getItem("orchestrations")).length+": "+e.data[2]})),e.data[1].map(e=>{k.push(""),S.push("")}),e.data[0].data[3].map((e,t)=>{0===t?(k[e]="red",S[e]="strongest masker"):1===t?(k[e]="magenta",S[e]="2nd masker"):2===t?(k[e]="yellow",S[e]="3rd masker"):(k[e]="",S[e]="")}),g(k),E(S))},[e]);const T=t=>{let a=[];a=0===o.length?[...n]:[...o],a[t.idx]=t.row,l(e=>a);let r=[];a.map(e=>{e[5]&&r.push(e)}),B.a.post(Ee+"modalSlice",r).then(t=>{var a=t.data;p(e=>e.data=a.data),w(e=>100-a.data[2].masking_percent);let n=[],s=[];e.data[1].map(e=>{n.push(""),s.push("")}),a.data[3].map((t,a)=>{if(0===a){const a=r[t][6];e.data[1].map((e,t)=>{e[6]===a&&(n[t]="red",s[t]="strongest masker")})}else if(1===a){const a=r[t][6];e.data[1].map((e,t)=>{e[6]===a&&(n[t]="magenta",s[t]="2nd masker")})}else if(2===a){const a=r[t][6];e.data[1].map((e,t)=>{e[6]===a&&(n[t]="yellow",s[t]="3rd masker")})}}),g(e=>n),E(s)})};let N=[];0===o.length?N=n:o.map(e=>{e[5]&&N.push([e[0],e[1],e[2],e[3]+e[7]])});const I=["C","C#","D","D#","E","F","F#","G","G#","A","Bb","B"];return r.createElement("div",null,r.createElement(J.a,{fullScreen:!0,open:t,onClose:e.handleClose,TransitionComponent:be,PaperProps:{style:{backgroundColor:"#fffef0"}}},r.createElement(m.a,{sx:{position:"relative",backgroundColor:"#dcc4ac",color:"#4c4c48"}},r.createElement(h.a,null,r.createElement(u.a,{edge:"start",color:"inherit",onClick:e.handleClose,"aria-label":"close"},r.createElement("div",null,"Click here, or press ESC to close")))),r.createElement("div",{style:{textAlign:"center"}},r.createElement(c.a,null,"You can alter the orchestration by clicking the colored values. The changes do not affect the original score."),r.createElement("table",{style:{margin:"auto",display:"inline"}},r.createElement("tbody",null,r.createElement("tr",null,r.createElement("td",null,"Instr."),r.createElement("td",null,"Tech."),r.createElement("td",null,"Dyn."),r.createElement("td",null,"Tune"),r.createElement("td",null,"Role"),r.createElement("td",null,"On/Off"),r.createElement("td",null,"Transpose +- oct.")),n.map((e,t)=>r.createElement(fe,{onChange:T,idx:t,row:e,color:""})))),r.createElement("table",{style:{margin:"auto",display:"inline"}},r.createElement("tbody",null,r.createElement("tr",null,r.createElement("td",null,"maskers")),f.map((e,t)=>{return r.createElement("tr",null,r.createElement("td",{style:{backgroundColor:e,borderRadius:10,padding:4,textAlign:"center",margin:4}},n[t][0]," ",(a=n[t][3],I[a%12]+(Math.floor(a/12)-1))," "+y[t]));var a}))),r.createElement("br",null),r.createElement(c.a,{variant:"caption",component:"div",color:"text.secondary"},"Target audibility:"),r.createElement(d.a,{sx:{position:"relative",display:"inline-flex"}},r.createElement(ge.a,{variant:"determinate",value:C,color:C<=30?"error":C<=50?"warning":"success"}),r.createElement(d.a,{sx:{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center"}},r.createElement(c.a,{variant:"caption",component:"div",color:"text.secondary"},"".concat(Math.round(C),"%")))),r.createElement("br",null),r.createElement(ue,{text:_.textFieldValue,orchestration:n}),r.createElement(ye,{instrumentList:N}),r.createElement(le,{data:i}),r.createElement(he,{instrumentList:N}))))}var _e=a(294);function xe(e){const[t,a]=Object(r.useState)({idx:e.idx,instName:e.instName,scoreNames:e.scoreNames,scoreTechs:e.scoreTechs,scoreDyns:e.scoreDyns,scoreTgt:e.scoreTgt,scoreOnoff:e.scoreOnoff,scoreModify:e.scoreModify});e.onChange({instName:t.instName,scoreNames:t.scoreNames,scoreTechs:t.scoreTechs,scoreDyns:t.scoreDyns,scoreTgt:t.scoreTgt,scoreOnoff:t.scoreOnoff,scoreModify:t.scoreModify});return n.a.createElement("tr",null,n.a.createElement("td",{key:"nam"+t.idx},t.instName),n.a.createElement("td",{key:"scor"+t.idx},((e,t)=>{const r=Object.keys(K);return n.a.createElement("div",null,n.a.createElement(D.a,{sx:{m:1,minWidth:50}},n.a.createElement(O.a,{id:"instrument-select"},"Instr."),n.a.createElement(M.a,{labelId:"instrument-select",id:"instrument-sel"+t,value:e,onChange:e=>{return t=e,void a(e=>({...e,scoreNames:t.target.value}));var t},autoWidth:!0,label:"instr."},r.map(e=>n.a.createElement(v.a,{value:e},e)))))})(t.scoreNames,t.idx)),n.a.createElement("td",{key:"tec"+t.idx},((e,r)=>{const s=K[t.scoreNames];return n.a.createElement("div",null,n.a.createElement(D.a,{sx:{m:1,minWidth:50}},n.a.createElement(O.a,{id:"tech-select"},"Tech."),n.a.createElement(M.a,{labelId:"tech-select",id:"tech-sel"+r,value:e,onChange:e=>{return t=e,void a(e=>({...e,scoreTechs:t.target.value}));var t},autoWidth:!0,label:"tech."},s.map(e=>n.a.createElement(v.a,{value:e},e)))))})(t.scoreTechs,t.idx)),n.a.createElement("td",{key:"dy"+t.idx},(s=t.scoreDyns,o=t.idx,n.a.createElement("div",null,n.a.createElement(D.a,{sx:{m:1,minWidth:50}},n.a.createElement(O.a,{id:"dyn-select"},"Dyn."),n.a.createElement(M.a,{labelId:"dyn-select",id:"dyn-sel"+o,value:s,onChange:e=>{return t=e,void a(e=>({...e,scoreDyns:t.target.value}));var t},autoWidth:!0,label:"dyn."},["from_score","p","mf","f"].map(e=>n.a.createElement(v.a,{value:e},e))))))),n.a.createElement("td",{key:"tg"+t.idx},n.a.createElement("div",{style:{border:"1px solid lightGray",borderRadius:5,padding:8}},n.a.createElement(pe.a,{direction:"row",spacing:1,alignItems:"center"},n.a.createElement(c.a,null,"orch."),n.a.createElement(_e.a,{key:"tgtswitch"+t.idx,checked:t.scoreTgt,color:"secondary",onChange:e=>{return t.idx,(r=e).persist(),void a(e=>({...e,scoreTgt:r.target.checked}));var r}}),n.a.createElement(c.a,null,"tgt")))),n.a.createElement("td",{key:"onoff"+t.idx},n.a.createElement("div",{style:{border:"1px solid lightGray",borderRadius:5,padding:8}},n.a.createElement(pe.a,{direction:"row",spacing:1,alignItems:"center"},n.a.createElement(c.a,null,"off"),n.a.createElement(_e.a,{key:"onoffswitch"+t.idx,checked:t.scoreOnoff,onChange:e=>{return t.idx,(r=e).persist(),void a(e=>({...e,scoreOnoff:r.target.checked}));var r}}),n.a.createElement(c.a,null,"on")))),n.a.createElement("td",{key:"mod"+t.idx},((e,t)=>n.a.createElement("div",null,n.a.createElement(D.a,{sx:{m:1,minWidth:50}},n.a.createElement(O.a,{id:"mod-select"},"Transpose"),n.a.createElement(M.a,{labelId:"mod-select",id:"mod-sel"+t,value:e,onChange:e=>{return t=e,void a(e=>({...e,scoreModify:t.target.value}));var t},autoWidth:!0,label:"trans."},[0,12,-12,24,-24].map(e=>n.a.createElement(v.a,{value:e},e))))))(t.scoreModify,t.idx)));var s,o}var Ce=a(152),we=a(278);const ke=Object(C.a)({palette:{neutral:{main:"#dcc4ac",contrastText:"black"}}}),Se=Object(ne.a)(se.a)(e=>{let{theme:t}=e;return{...t.typography.body2,backgroundColor:"#fffef0",padding:t.spacing(1),textAlign:"center",color:t.palette.text.secondary}}),Te=me;class Ne extends r.Component{constructor(e){super(e),this.state={calculatingState:"",help:!1,tooltip:"",showTooltip:!0,expanded:!0,interruptCalculation:!1,dataReady:!1,loading:!1,loaded:!1,cur:!1,calculIndications:!1,measureTimestamps:[],measureRange:[1,2],maxMeasure:2,instNames:[],scoreNames:[],scoreTechs:[],scoreDyns:[],scoreTgt:[],scoreOnoff:[],scoreModify:[],instData:{},open:!1,time:[],modalData:[]},this.osmd=void 0,this.orchestrationChords=void 0,this.cursor=void 0,this.next=void 0,this.show=!0,this.divRef=n.a.createRef(),this.measureHandleChange=this.measureHandleChange.bind(this),this.calculateMasking=this.calculateMasking.bind(this),this.update=this.update.bind(this),this.handleClose=this.handleClose.bind(this)}setupOsmd(){this.setState(e=>({...e,loading:!0,help:this.props.help}));const e={autoResize:void 0!==this.props.autoResize&&this.props.autoResize,drawTitle:void 0===this.props.drawTitle||this.props.drawTitle,loadUrlTimeout:1e4,drawSlurs:!1};this.osmd=new N.OpenSheetMusicDisplay(this.divRef.current,e),this.osmd.load(this.props.file).then(()=>{let e=.5;const t=this.osmd.sheet.staves.length;t>10?e=.4:t>20?e=.2:t>30?e=.1:t>40&&(e=.05),this.osmd.zoom=e;let a=[],r=[],n=[],s=[],o=[],l=[],i=[];try{const e=JSON.parse(localStorage.getItem(this.props.filename));a=e.instNames,r=e.scoreNames,n=e.scoreTechs,s=e.scoreDyns,o=e.scoreTgt,l=e.scoreOnoff,i=e.scoreModify}catch{a=[],r=[],n=[],s=[],o=[],l=[],i=[],this.osmd.sheet.staves.map(e=>{a.push(e.parentInstrument.nameLabel.text),r.push((e=>{let t=e;e.toLowerCase().startsWith("clarinet in b")&&(t="clarinet"),e.toLowerCase().startsWith("bass clarinet")&&(t="bass_cl"),e.toLowerCase().startsWith("solo")&&(t=e.substr(5)),e.toLowerCase().startsWith("trombone")&&(t="tenor_trombone"),e.toLowerCase().startsWith("contrabass")&&(t="double_bass"),"baritone"===e.toLowerCase()&&(t="tuba"),t.toLowerCase().startsWith("natural")&&(t="horn");return Object(H.a)(t,Object.keys(K))[0][0]})(e.parentInstrument.nameLabel.text)),n.push("normal"),s.push("from_score"),o.push(0),l.push(1),i.push(0)})}let c=[];this.osmd.sheet.sourceMeasures.map(e=>c.push(e.absoluteTimestamp.realValue)),c.push(999999),this.setState(e=>{e.measureRange=[1,this.osmd.sheet.SourceMeasures.length],e.maxMeasure=this.osmd.sheet.SourceMeasures.length,e.instNames=a,e.scoreNames=r,e.scoreTechs=n,e.scoreDyns=s,e.scoreTgt=o,e.scoreOnoff=l,e.scoreModify=i,e.measureTimestamps=c}),this.forceUpdate()}).then(()=>this.setState(e=>({...e,loading:!1}))).catch(()=>this.setState(e=>({...e,loading:!1})))}update(){this.osmd.updateGraphic()}setLoading(){this.setState(e=>({...e,loading:!0,expanded:!1})),this.osmd.setOptions({drawFromMeasureNumber:this.state.measureRange[0],drawUpToMeasureNumber:this.state.measureRange[1]}),setTimeout(()=>this.osmd.render(),200),setTimeout(()=>this.renderScore(),210)}renderScore(){this.osmd.render(),this.setState(e=>e.loaded=!0);let e=[];for(let s=0;s<this.osmd.graphic.VerticalGraphicalStaffEntryContainers[0].StaffEntries.length;s++)e.push({0:"mf"});let t={},a={},r=[];r.length=this.state.instNames.length;let n=[];for(let s=0;s<this.state.instNames.length;s++)n.push("mf");this.osmd.sheet.sourceMeasures.map(e=>{e.absoluteTimestamp.realValue<this.state.measureTimestamps[this.state.measureRange[0]-1]&&e.staffLinkedExpressions.map((e,t)=>{e.length>0&&e.map(e=>{e.expressions.map(e=>{e.expression.dynamicEnum<=5?n[t]="p":e.expression.dynamicEnum<=7?n[t]="mf":e.expression.dynamicEnum<=13&&(n[t]="f")})})})}),this.osmd.graphic.VerticalGraphicalStaffEntryContainers.map(s=>{let o=[];if(o.length=s.StaffEntries.length,s.absoluteTimestamp.realValue>=this.state.measureTimestamps[this.state.measureRange[0]-1]&&s.absoluteTimestamp.realValue<=this.state.measureTimestamps[this.state.measureRange[1]])for(let t=0;t<s.StaffEntries.length;t++)o[t]=[],s.StaffEntries[t]?("undefined"!==typeof s.StaffEntries[t].parentMeasure.parentStaffLine&&s.StaffEntries[t].parentMeasure.parentStaffLine.hasOwnProperty("abstractExpressions")&&s.StaffEntries[t].parentMeasure.parentStaffLine.abstractExpressions.map(a=>{a.SourceExpression.hasOwnProperty("multiExpression")&&(e[t][String(a.SourceExpression.multiExpression.AbsoluteTimestamp.realValue)]=a.Expression)}),s.StaffEntries[t].sourceStaffEntry.voiceEntries&&s.StaffEntries[t].sourceStaffEntry.voiceEntries[0].notes.map(l=>{l.halfTone>0&&(e[t].hasOwnProperty(String(s.AbsoluteTimestamp.realValue))&&(n[t]=e[t][String(s.AbsoluteTimestamp.realValue)]),a[String(s.AbsoluteTimestamp.realValue)]=s.StaffEntries[t].boundingBox.absolutePosition.x,o[t].push({note:Math.round(l.halfTone),dynamic:n[t]}),r[t]={note:Math.round(l.halfTone),start:s.AbsoluteTimestamp.realValue,duration:l.length.realValue})})):r[t]&&(r[t].start+r[t].duration>=s.AbsoluteTimestamp.realValue?(e[t].hasOwnProperty(String(s.AbsoluteTimestamp.realValue))&&(n[t]=e[t][String(s.AbsoluteTimestamp.realValue)]),o[t].push({note:r[t].note,dynamic:n[t]})):r[t]=[]);t[s.AbsoluteTimestamp.realValue]=o}),this.orchestrationChords={instruments:this.state.instNames,databaseEntries:{inst:this.state.scoreNames,tech:this.state.scoreTechs,dyn:this.state.scoreDyns,tgt:this.state.scoreTgt,onoff:this.state.scoreOnoff,modify:this.state.scoreModify},dynamics:e,notes:t,xpos:a},this.setState(e=>({...e,loading:!1}))}resize(){}handleClose(){this.setState(e=>e.open=!1)}calcStop(){this.setState(e=>e.interruptCalculation=!0)}measureHandleChange(e,t,a){Array.isArray(t)&&this.setState(e=>({...this.state,measureRange:t}))}calculateMasking(){this.osmd.graphic.musicPages[0].musicSystems.map(e=>{e.staffLines.map((e,t)=>{if(this.state.scoreTgt[t]){this.osmd.drawer.drawBoundingBox(e.boundingBox,"rgba(255, 0, 0,0.2)",!1,"TARGET");let t=new N.Label("Target"),a=new N.GraphicalLabel(t,4,N.TextAlignmentEnum.LeftBottom,this.osmd.EngravingRules,e.boundingBox);a.PositionAndShape=e.boundingBox,a.PositionAndShape.AbsolutePosition.x=a.PositionAndShape.AbsolutePosition.x-10,a.setLabelPositionAndShapeBorders(),this.osmd.drawer.drawLabel(a)}})}),this.setState(e=>e.interruptCalculation=!1);let e=0;r=r.bind(this);const t=this.state.measureTimestamps.slice(this.state.measureRange[0]-1,this.state.measureRange[1]);let a=999999999;function r(s){let o=this.osmd.graphic.VerticalGraphicalStaffEntryContainers[s];if(o.absoluteTimestamp.realValue>=this.state.measureTimestamps[this.state.measureRange[0]-1]&&o.absoluteTimestamp.realValue<=this.state.measureTimestamps[this.state.measureRange[1]]){t.filter(e=>e>o.absoluteTimestamp.realValue).length+1<a&&(a=t.filter(e=>e>o.absoluteTimestamp.realValue).length+1,this.setState(e=>({...e,calculatingState:n.a.createElement(n.a.Fragment,null," ",n.a.createElement(c.a,null," Measures left to calculate: ",t.filter(e=>e>o.absoluteTimestamp.realValue).length+1," of ",t.length)," ",n.a.createElement(E.a,{variant:"contained",color:"info",onClick:this.calcStop.bind(this)},"Stop calculation")," ")})));let s=this.orchestrationChords.notes[o.absoluteTimestamp.realValue],l=[],i=[],m=!1;s.map((e,t)=>{if(this.orchestrationChords.databaseEntries.tgt[t]&&i.push(t),e.length>0){let a=[];"from_score"!==this.orchestrationChords.databaseEntries.dyn[t]&&(a=this.orchestrationChords.databaseEntries.dyn[t]),this.orchestrationChords.databaseEntries.tgt[t]&&(m=!0),e.map(e=>{0===a.length&&["ppppp","pppp","ppp","pp","p"].includes(e.dynamic)?a="p":0===a.length&&["fffff","ffff","fff","ff","f","sfz","sf"].includes(e.dynamic)?a="f":0===a.length&&["mf","mp","mfz"].includes(e.dynamic)&&(a="mf"),l.push([this.orchestrationChords.databaseEntries.inst[t],this.orchestrationChords.databaseEntries.tech[t],a,e.note+12+this.orchestrationChords.databaseEntries.modify[t],this.orchestrationChords.databaseEntries.tgt[t],this.orchestrationChords.databaseEntries.onoff[t],t])})}}),l=l.filter((e,t,a)=>{if(!e[5])return!1;try{return e[3]>=U[e[0]][e[1]][e[2]][0]&&e[3]<=U[e[0]][e[1]][e[2]][1]}catch{return!1}});const d=e=>{let t="rgba(0,255,0,0.3)";if(e>=75){const a=1-(e-74.9)/50;t="rgba(".concat(Math.round(255*a),",0,0,0.7)")}else if(e>=50){const a=1-(e-54.9)/25;t="rgba(255,".concat(Math.round(255*a),",0,0.5)")}else if(e>=25){const a=(e-24.9)/25;t="rgba(".concat(Math.round(255*a),",255,0,0.5)")}return t};B.a.post(Te+"maskingSlice",l).then(e=>{var t=e.data;let a=[];o.StaffEntries.map(e=>a=e.sourceStaffEntry.voiceEntries[0].notes[0]);var r=a.parentStaffEntry.verticalContainerParent.parentMeasure.measureNumber;const n=this.orchestrationChords.xpos[o.absoluteTimestamp.realValue]-1;var s=this.osmd.graphic.MusicPages[0];t&&(m&&i.map(e=>{var a=this.osmd.graphic.musicSheet.sourceMeasures[r-1].verticalMeasureList[e].boundingBox.absolutePosition.y+2;const o=new N.PointF2D(n,a),l=new N.PointF2D(n+2,a);let i=d(t[0]);this.osmd.Drawer.DrawOverlayLine(o,l,s,i,4)}),t[1]&&t[1].map((e,t)=>{var a=this.osmd.graphic.musicSheet.sourceMeasures[r-1].verticalMeasureList[e].boundingBox.absolutePosition.y+2;const o=new N.PointF2D(n,a),l=new N.PointF2D(n+2,a);let i=[];0===t?(i="rgba(255,51,255,0.5)",this.osmd.Drawer.DrawOverlayLine(o,l,s,i,4)):1===t?(i="rgba(255,153,51,0.5)",this.osmd.Drawer.DrawOverlayLine(o,l,s,i,4)):2===t&&(i="rgba(51,153,355,0.5)",this.osmd.Drawer.DrawOverlayLine(o,l,s,i,4))}))}).finally(()=>{e++,this.osmd.graphic.VerticalGraphicalStaffEntryContainers.length>e?this.state.interruptCalculation?this.setState(e=>({...e,interruptCalculation:!1,calculatingState:n.a.createElement(c.a,null," Calculation stopped! ")})):r(e):this.setState(e=>({...e,calculatingState:n.a.createElement(c.a,null," Calculation complete! ")}))})}else this.setState(e=>({...e,calculatingState:n.a.createElement(c.a,null," Calculation complete! ")})),e++,this.osmd.graphic.VerticalGraphicalStaffEntryContainers.length>e&&(this.state.interruptCalculation?this.setState(e=>({...e,interruptCalculation:!1,calculatingState:n.a.createElement(c.a,null," Calculation stopped! ")})):r(e))}r(e),this.setState(e=>e.calculIndications=!0)}componentWillUnmount(){window.removeEventListener("resize",this.resize)}componentDidUpdate(e){(this.props.drawTitle!==e.drawTitle||this.props.file!==e.file)&&this.setupOsmd();var t=!1;this.props.file&&"undefined"!==typeof this.osmd&&"undefined"!==typeof this.osmd.cursor&&(("undefined"===typeof this.osmd.cursor.hidden||this.osmd.cursor.hidden)&&(t=!0),this.props.show&&t&&this.osmd.cursor.show(),this.props.next!==e.next&&(this.osmd.cursor.next(),console.log(this.osmd.cursor),console.log(this.osmd.cursor.NotesUnderCursor()),console.log(this.osmd.cursor.VoicesUnderCursor()),console.log(this.osmd.cursor.iterator.currentTimeStamp.RealValue)),this.props.help!==e.help&&this.setState(e=>({...e,help:this.props.help})),window.addEventListener("resize",this.resize))}componentDidMount(){this.props.file&&this.setupOsmd()}render(){let e=[],t="inline-block";const a=()=>{this.setState(e=>e.showTooltip=!this.state.showTooltip)};this.state.loaded&&(t="none",e=n.a.createElement("div",null,n.a.createElement("div",{style:{display:"block",maxWidth:"50%",textAlign:"center",margin:"auto"}},n.a.createElement(c.a,{style:{display:"inline-block"}}," Set calculation bar range:"),n.a.createElement("div",{style:{display:"inline-block",width:"30vh",marginInlineStart:"10px"}},n.a.createElement(A,{style:{display:"inline-block"},range:this.state.measureRange,max:this.state.maxMeasure,measureHandleChange:this.measureHandleChange}))),n.a.createElement(E.a,{size:"small",sx:{display:"inline-block"},variant:"contained",color:"secondary",onClick:()=>{this.calculateMasking()}},"calculate masking, bars ",this.state.measureRange[0]," to ",this.state.measureRange[1]," (",this.state.measureRange[1]-this.state.measureRange[0]+1," bars)"),n.a.createElement(E.a,{size:"small",style:{marginInline:10,display:"inline-block"},variant:"contained",color:"warning",onClick:()=>{this.setLoading()}},"redraw score"),n.a.createElement(E.a,{size:"small",variant:"contained",color:"primary",onClick:()=>Ce.saveSvgAsPng(document.getElementById("osmdSvgPage1"),"score.png")},"Download score"),n.a.createElement("div",{style:{display:"inline-block",marginInlineStart:10}},n.a.createElement(P.a,{sx:{display:"inline-block"}},n.a.createElement(L.a,{sx:{display:"inline-block"},control:n.a.createElement(z.a,{style:{display:"inline-block"},checked:this.state.showTooltip,onChange:a}),label:"Orch. under mouse"})))));const r=(e,t)=>{let a={instNames:[...this.state.instNames],scoreNames:[...this.state.scoreNames],scoreTechs:[...this.state.scoreTechs],scoreDyns:[...this.state.scoreDyns],scoreTgt:[...this.state.scoreTgt],scoreOnoff:[...this.state.scoreOnoff],scoreModify:[...this.state.scoreModify]};a.scoreNames[e]=t.scoreNames,a.scoreTechs[e]=t.scoreTechs,a.scoreDyns[e]=t.scoreDyns,a.scoreTgt[e]=t.scoreTgt,a.scoreOnoff[e]=t.scoreOnoff,a.scoreModify[e]=t.scoreModify,this.setState(a=>{a.scoreNames[e]=t.scoreNames,a.scoreTechs[e]=t.scoreTechs,a.scoreDyns[e]=t.scoreDyns,a.scoreTgt[e]=t.scoreTgt,a.scoreOnoff[e]=t.scoreOnoff,a.scoreModify[e]=t.scoreModify}),localStorage.setItem(this.props.filename,JSON.stringify({instNames:a.instNames,scoreNames:a.scoreNames,scoreTechs:a.scoreTechs,scoreDyns:a.scoreDyns,scoreTgt:a.scoreTgt,scoreOnoff:a.scoreOnoff,scoreModify:a.scoreModify}))},s=["C","C#","D","D#","E","F","F#","G","G#","A","B#","B"];return console.log(this.props.help),n.a.createElement(n.a.Fragment,null,n.a.createElement(w.a,{theme:ke},n.a.createElement("small",null,n.a.createElement(m.a,{color:"neutral",style:{overflow:"auto",marginTop:50}},n.a.createElement(y.a,{maxWidth:"xl",style:{overflow:"auto"}},n.a.createElement(Se,{style:{textAlign:"center",justifyContent:"center",alignItems:"center",alignContent:"center",marginLeft:"auto",marginRight:"auto"}},n.a.createElement(R.a,{expanded:this.state.expanded,onChange:()=>{this.setState(e=>e.expanded=!this.state.expanded)},style:{backgroundColor:"#f9fff0"}},n.a.createElement(F.a,{expandIcon:n.a.createElement(j.a,null),"aria-controls":"panel1a-content",id:"panel1a-header",style:{textAlign:"center"}},n.a.createElement(c.a,{style:{textAlign:"center"}},"Click here to show/hide masking calculation properties")),n.a.createElement(W.a,null,n.a.createElement(b.a,{title:n.a.createElement(i,{help:"ScoreSlider"}),disableHoverListener:!this.props.help,placement:"top",sx:{zIndex:99999}},n.a.createElement("div",null,n.a.createElement(c.a,null,"Select bar range with slider"),n.a.createElement(A,{range:this.state.measureRange,max:this.state.maxMeasure,measureHandleChange:this.measureHandleChange}))),n.a.createElement(E.a,{style:{display:t,margin:5},variant:"contained",onClick:()=>{this.setLoading()}}," Show score"),n.a.createElement("div",{style:{overflow:"auto",maxHeight:"65vh"}},n.a.createElement("table",{style:{margin:"auto"}},n.a.createElement("tbody",null,n.a.createElement("tr",null,n.a.createElement("th",null,"score name"),n.a.createElement("th",null,"instrument"),n.a.createElement("th",null,"technique"),n.a.createElement("th",null,"dynamic"),n.a.createElement("th",null,"orch/target"),n.a.createElement("th",null,"on/off"),n.a.createElement("th",null,"transpose")),this.state.instNames.map((e,t)=>n.a.createElement(xe,{idx:t,instName:e,scoreNames:this.state.scoreNames[t],scoreTechs:this.state.scoreTechs[t],scoreDyns:this.state.scoreDyns[t],scoreTgt:this.state.scoreTgt[t],scoreOnoff:this.state.scoreOnoff[t],scoreModify:this.state.scoreModify[t],onChange:e=>r(t,e)}))))))),this.state.loading,n.a.createElement(E.a,{style:{display:t,margin:5},variant:"contained",onClick:()=>{this.setLoading()}},"Show score"),e,this.state.calculatingState,this.state.calculIndications&&n.a.createElement(n.a.Fragment,null,n.a.createElement(c.a,{style:{display:"inline"}},"Colors:",n.a.createElement("div",{style:{backgroundImage:"linear-gradient(to right, rgba(120,0,0,0.7) , rgba(255,0,0,0.5))",display:"inline",marginInline:2}}," Tgt masked"),n.a.createElement("div",{style:{backgroundImage:"linear-gradient(to right, rgba(255,0,0,0.5) , rgba(255,255,0,0.5))",display:"inline",marginInline:2}}," nearly masked"),n.a.createElement("div",{style:{backgroundImage:"linear-gradient(to right, rgba(255,255,0,0.5) , rgba(0,255,0,0.3))",display:"inline",marginInline:2}}," audible"),n.a.createElement("div",{style:{backgroundColor:"rgba(255,51,255,0.5)",display:"inline"}}," heaviest masker"),n.a.createElement("div",{style:{backgroundColor:"rgba(255,153,51,0.5)",display:"inline"}}," 2nd masker"),n.a.createElement("div",{style:{backgroundColor:"rgba(51,153,255,0.5)",display:"inline"}}," 3rd masker ")))))))),n.a.createElement(Se,null,n.a.createElement(b.a,{title:n.a.createElement("div",null,this.state.tooltip),placement:"top-start",followCursor:!0},n.a.createElement("div",{ref:this.divRef,style:{width:window.innerWidth-100,marginTop:240},onClick:e=>{let t=e.clientX,a=e.clientY;var r=new N.PointF2D(t,a);r=this.osmd.graphic.domToSvg(r),r=this.osmd.graphic.svgToOsmd(r);const n=this.osmd.graphic.GetNearestNote(r,{x:10,y:10});if("undefined"!==typeof n){const e=n.sourceNote.voiceEntry.parentSourceStaffEntry.AbsoluteTimestamp.realValue;let t="";try{t=n.ParentMusicPage.labels[0].label.text+", Bar:"+n.vfnote[0].stave.MeasureNumber+", Position:"+n.parentVoiceEntry.parentStaffEntry.relInMeasureTimestamp.realValue}catch{t="Score orchestral chord"}for(this.osmd.cursor.hide(),this.osmd.cursor.reset();this.osmd.cursor.iterator.currentTimeStamp.RealValue!=e;)this.osmd.cursor.next();this.osmd.cursor.show();let a=this.orchestrationChords.notes[e],r=[],s=[],o=!1;a.map((e,t)=>{if(this.orchestrationChords.databaseEntries.tgt[t]&&s.push(t),e.length>0){let a=[];"from_score"!==this.orchestrationChords.databaseEntries.dyn[t]&&(a=this.orchestrationChords.databaseEntries.dyn[t]),this.orchestrationChords.databaseEntries.tgt[t]&&(o=!0),e.map(e=>{0===a.length&&["ppppp","pppp","ppp","pp","p"].includes(e.dynamic)?a="p":0===a.length&&["fffff","ffff","fff","ff","f","sfz","sf"].includes(e.dynamic)?a="f":0===a.length&&["mf","mp","mfz"].includes(e.dynamic)&&(a="mf"),r.push([this.orchestrationChords.databaseEntries.inst[t],this.orchestrationChords.databaseEntries.tech[t],a,e.note+12+this.orchestrationChords.databaseEntries.modify[t],this.orchestrationChords.databaseEntries.tgt[t],this.orchestrationChords.databaseEntries.onoff[t],t,0])})}}),r=r.filter((e,t,a)=>{if(!e[5])return!1;try{return e[3]>=U[e[0]][e[1]][e[2]][0]&&e[3]<=U[e[0]][e[1]][e[2]][1]}catch{return!1}}),B.a.post(Te+"modalSlice",r).then(a=>{var l=a.data,i=n.sourceNote.parentStaffEntry.verticalContainerParent.parentMeasure.measureNumber;const c=this.orchestrationChords.xpos[String(e)]-1;this.osmd.graphic.MusicPages[0];l&&(o&&s.map(e=>{var t=this.osmd.graphic.musicSheet.sourceMeasures[i-1].verticalMeasureList[e].boundingBox.absolutePosition.y+2;new N.PointF2D(c,t),new N.PointF2D(c+2,t);let a=[];a=l[0]>=75?"rgba(255,0,0,0.7)":l[0]>=55?"rgba(255,255,0,0.5)":"rgba(0,255,0,0.3)"}),l[1]&&l[1].map((e,t)=>{var a=this.osmd.graphic.musicSheet.sourceMeasures[i-1].verticalMeasureList[e].boundingBox.absolutePosition.y+2;new N.PointF2D(c,a),new N.PointF2D(c+2,a);let r=[];0===t?r="rgba(255,153,51,0.5)":1===t?r="rgba(255,51,255,0.5)":2===t&&(r="rgba(51,153,355,0.5)")})),this.setState(e=>e.modalData=[l,r,t])}).finally(()=>{this.setState(e=>{e.open=!0,e.time=Date.now()}),this.forceUpdate()})}},onMouseOver:e=>{if(this.state.showTooltip){let a=e.clientX,r=e.clientY;var t=new N.PointF2D(a,r);t=this.osmd.graphic.domToSvg(t),t=this.osmd.graphic.svgToOsmd(t);const o=this.osmd.graphic.tryGetTimeStampFromPosition(t);if("undefined"!==typeof o){for(this.osmd.cursor.hide(),this.osmd.cursor.cursorOptions.color="purple",this.osmd.cursor.reset();this.osmd.cursor.iterator.currentTimeStamp.RealValue!=o.realValue;)this.osmd.cursor.next();this.osmd.cursor.show();let e=this.orchestrationChords.notes[o.realValue],t=[],a=[],r=!1;e.map((e,n)=>{if(this.orchestrationChords.databaseEntries.tgt[n]&&a.push(n),e.length>0){let a=[];"from_score"!==this.orchestrationChords.databaseEntries.dyn[n]&&(a=this.orchestrationChords.databaseEntries.dyn[n]),this.orchestrationChords.databaseEntries.tgt[n]&&(r=!0),e.map(e=>{0===a.length&&["ppppp","pppp","ppp","pp","p"].includes(e.dynamic)?a="p":0===a.length&&["fffff","ffff","fff","ff","f","sfz","sf"].includes(e.dynamic)?a="f":0===a.length&&["mf","mp","mfz"].includes(e.dynamic)&&(a="mf"),t.push([this.orchestrationChords.databaseEntries.inst[n],this.orchestrationChords.databaseEntries.tech[n],a,e.note+12+this.orchestrationChords.databaseEntries.modify[n],this.orchestrationChords.databaseEntries.tgt[n]])})}}),t.sort((function(e,t){return e[3]-t[3]}));let l=t.map(e=>function(e){var t=e-Math.floor(e);let a=Math.round(e),r=s[a%12];return t>=.2&&t<.5?/[#]/.test(r)?r=s[(a+1)%12]+"d":r+="+":t>=.5&&t<=.8&&(/[#]/.test(r)?r=s[(a-1)%12]+"+":r+="d"),r+(Math.floor(a/12)-1)}(e[3])),i=t.map(e=>e[0]),c=t.map((e,t)=>{if(e[4])return t});const m=n.a.createElement("div",{style:{textAlign:"center",margin:"auto",verticalAlign:"bottom",backgroundColor:"#fffef0cc",width:200}},n.a.createElement("div",{style:{color:"black"}},"Orchestration under mouse pointer, target on green. Click to see detailed analysis."),n.a.createElement(ee,{notes:l,instruments:i,target:c,target_color:"green",height:250,width:160,scale:.7}));this.setState(e=>e.tooltip=m)}}else this.setState(e=>e.tooltip="click any note for orchestration details"),this.osmd.cursor.hide()},onMouseLeave:()=>{this.osmd.cursor.hide()}}))),n.a.createElement(ve,{handleClose:this.handleClose,open:this.state.open,time:this.state.time,data:this.state.modalData}),n.a.createElement(we.a,{sx:{color:"#fff",zIndex:e=>e.zIndex.drawer+1},open:this.state.loading},n.a.createElement(ge.a,{disableShrink:!0,color:"success"}),n.a.createElement(c.a,null," Calculating... (for large scores, 30+ staves and 100+ measures, this can take several minutes)")),n.a.createElement("div",{style:{display:"none"}},this.state.tooltip))}}var Ie=Ne,Ae=a(123),Me=(a(212),a(290)),Oe=a(38),De=a.n(Oe),Pe=a(69),Le=a.n(Pe),ze=a(55),Re=a.n(ze);const Fe=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],We=["Db","Eb","Gb","Ab","Bb"],Ve={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11},je=/([a-g])([#b]?)(\d+)/;const Ge=Re()(12,128).reduce((e,t)=>(e[t]=function(e){const t=(e-12)%12,a=Math.floor((e-12)/12),r=Fe[t];return{note:"".concat(r).concat(a),pitchName:r,octave:a,midiNumber:e,isAccidental:We.includes(r)}}(t),e),{});function Be(e){const t=Ge[e];if(!t)throw Error("Invalid MIDI number");return t}const He=Re()(12,128).filter(e=>!Be(e).isAccidental);var Ke={fromNote:function(e){if(!e)throw Error("Invalid note argument");const t=je.exec(e.toLowerCase());if(!t)throw Error("Invalid note argument");const[,a,r,n]=t,s="".concat(a.toUpperCase()).concat(r),o=Ve[s];if(null==o)throw Error("Invalid note argument");return 12+o+12*parseInt(n,10)},getAttributes:Be,MIN_MIDI_NUMBER:12,MAX_MIDI_NUMBER:127,NATURAL_MIDI_NUMBERS:He};class Ue extends n.a.Component{constructor(){super(...arguments),this.onPlayNoteInput=()=>{this.props.onPlayNoteInput(this.props.midiNumber)},this.onStopNoteInput=()=>{this.props.onStopNoteInput(this.props.midiNumber)},this.onLeaveNote=()=>{this.props.onLeaveNote(this.props.midiNumber)}}getAbsoluteKeyPosition(e){const{octave:t,pitchName:a}=Ke.getAttributes(e);return this.props.pitchPositions[a]+7*t}getRelativeKeyPosition(e){return this.getAbsoluteKeyPosition(e)-this.getAbsoluteKeyPosition(this.props.noteRange.first)}render(){const{naturalKeyWidth:e,accidentalWidthRatio:t,midiNumber:a,gliss:r,useTouchEvents:s,accidental:o,active:l,disabled:i,children:c}=this.props;return n.a.createElement("div",{className:De()("ReactPiano__Key",{"ReactPiano__Key--accidental":o,"ReactPiano__Key--natural":!o,"ReactPiano__Key--disabled":i,"ReactPiano__Key--active":l}),style:{left:Je(this.getRelativeKeyPosition(a)*e),width:Je(o?t*e:e)},onMouseDown:s?null:this.onPlayNoteInput,onMouseUp:s?null:this.onStopNoteInput,onMouseEnter:null,onMouseLeave:r?this.onStopNoteInput:null,onTouchStart:s?this.onPlayNoteInput:null,onTouchCancel:r?this.onStopNoteInput:null,onTouchMove:null,onTouchEnd:s?this.onStopNoteInput:null},n.a.createElement("div",{className:"ReactPiano__NoteLabelContainer"},c))}}function Je(e){return"".concat(100*e,"%")}Ue.defaultProps={accidentalWidthRatio:.65,pitchPositions:{C:0,Db:.55,D:1,Eb:1.8,E:2,F:3,Gb:3.5,G:4,Ab:4.7,A:5,Bb:5.85,B:6}};var Xe=Ue;class qe extends n.a.Component{getMidiNumbers(){return Re()(this.props.noteRange.first,this.props.noteRange.last+1)}getNaturalKeyCount(){return this.getMidiNumbers().filter(e=>{const{isAccidental:t}=Ke.getAttributes(e);return!t}).length}getNaturalKeyWidth(){return 1/this.getNaturalKeyCount()}getWidth(){return this.props.width?this.props.width:"100%"}getHeight(){if(!this.props.width)return"100%";const e=this.props.width*this.getNaturalKeyWidth();return"".concat(e/this.props.keyWidthToHeight,"px")}render(){const e=this.getNaturalKeyWidth();return n.a.createElement("div",{className:De()("ReactPiano__Keyboard",this.props.className),style:{width:this.getWidth(),height:this.getHeight()}},this.getMidiNumbers().map(t=>{const{note:a,isAccidental:r}=Ke.getAttributes(t),s=!this.props.disabled&&this.props.activeNotes.includes(t);return n.a.createElement(Xe,{naturalKeyWidth:e,midiNumber:t,noteRange:this.props.noteRange,active:s,accidental:r,disabled:this.props.disabled,onPlayNoteInput:this.props.onPlayNoteInput,onStopNoteInput:this.props.onStopNoteInput,onLeaveNote:this.props.onLeaveNote,gliss:this.props.gliss,useTouchEvents:this.props.useTouchEvents,key:t},this.props.disabled?null:this.props.renderNoteLabel({isActive:s,isAccidental:r,midiNumber:t}))}))}}qe.defaultProps={disabled:!1,gliss:!1,useTouchEvents:!1,keyWidthToHeight:.33,renderNoteLabel:()=>{}};var Ye=qe;class Qe extends n.a.Component{constructor(){super(...arguments),this.state={isMouseDown:!1,useTouchEvents:!1},this.handleNoteChanges=e=>{let{prevActiveNotes:t,nextActiveNotes:a}=e;if(this.props.disabled)return;const r=Le()(t,a);Le()(a,t).forEach(e=>{this.props.playNote(e)}),r.forEach(e=>{this.props.stopNote(e)})},this.getMidiNumberForKey=e=>{if(!this.props.keyboardShortcuts)return null;const t=this.props.keyboardShortcuts.find(t=>t.key===e);return t&&t.midiNumber},this.getKeyForMidiNumber=e=>{if(!this.props.keyboardShortcuts)return null;const t=this.props.keyboardShortcuts.find(t=>t.midiNumber===e);return t&&t.key},this.onKeyDown=e=>{if(e.ctrlKey||e.metaKey||e.shiftKey)return;const t=this.getMidiNumberForKey(e.key);t&&this.onPlayNoteInput(t)},this.onKeyUp=e=>{const t=this.getMidiNumberForKey(e.key);t&&this.onStopNoteInput(t)},this.onPlayNoteInput=e=>{this.props.disabled||this.props.onPlayNoteInput(e,this.props.activeNotes)},this.onStopNoteInput=e=>{this.props.disabled||this.props.onStopNoteInput(e,this.props.activeNotes)},this.onLeaveNote=e=>{this.props.disabled||this.props.onLeaveNote(e,this.props.activeNotes)},this.onMouseDown=()=>{this.setState({isMouseDown:!0})},this.onMouseUp=()=>{this.setState({isMouseDown:!1})},this.onTouchStart=()=>{this.setState({useTouchEvents:!0})},this.renderNoteLabel=e=>{let{midiNumber:t,isActive:a,isAccidental:r}=e;const n=this.getKeyForMidiNumber(t);return this.props.renderNoteLabel({keyboardShortcut:n,midiNumber:t,isActive:a,isAccidental:r})}}componentDidMount(){window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)}componentWillUnmount(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}componentDidUpdate(e,t){this.props.activeNotes!==e.activeNotes&&this.handleNoteChanges({prevActiveNotes:e.activeNotes||[],nextActiveNotes:this.props.activeNotes||[]})}render(){return n.a.createElement("div",{style:{width:"100%",height:"100%"},onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onTouchStart:this.onTouchStart,"data-testid":"container"},n.a.createElement(Ye,{noteRange:this.props.noteRange,onPlayNoteInput:this.onPlayNoteInput,onStopNoteInput:this.onStopNoteInput,onLeaveNote:this.onLeaveNote,activeNotes:this.props.activeNotes,className:this.props.className,disabled:this.props.disabled,width:this.props.width,keyWidthToHeight:this.props.keyWidthToHeight,gliss:this.state.isMouseDown,useTouchEvents:this.state.useTouchEvents,renderNoteLabel:this.renderNoteLabel}))}}Qe.defaultProps={renderNoteLabel:e=>{let{keyboardShortcut:t,midiNumber:a,isActive:r,isAccidental:s}=e;return t?n.a.createElement("div",{className:De()("ReactPiano__NoteLabel",{"ReactPiano__NoteLabel--active":r,"ReactPiano__NoteLabel--accidental":s,"ReactPiano__NoteLabel--natural":!s})},t):null}};var $e=Qe;class Ze extends n.a.Component{constructor(){super(...arguments),this.state={activeNotes:this.props.activeNotes||[]},this.handlePlayNoteInput=e=>{this.setState(t=>(this.props.onPlayNoteInput&&this.props.onPlayNoteInput(e,{prevActiveNotes:t.activeNotes}),t.activeNotes.includes(e)?null:{activeNotes:t.activeNotes.concat(e)}))},this.handleStopNoteInput=e=>{this.setState(t=>(this.props.onStopNoteInput&&this.props.onStopNoteInput(e),{activeNotes:t.activeNotes.filter(t=>e!==t)}))},this.handleLeave=e=>{this.setState(t=>({activeNotes:t.activeNotes.filter(t=>e!==t)}))}}componentDidUpdate(e){e.activeNotes!==this.props.activeNotes&&this.state.activeNotes!==this.props.activeNotes&&this.setState({activeNotes:this.props.activeNotes||[]})}render(){const{activeNotes:e,onPlayNoteInput:t,onStopNoteInput:a,...r}=this.props;return n.a.createElement($e,Object.assign({activeNotes:this.state.activeNotes,onLeaveNote:this.handleLeave,onPlayNoteInput:this.handlePlayNoteInput,onStopNoteInput:this.handleStopNoteInput},r))}}var et=Ze,tt=(a(147),a(59));const at=$.a.Flow;var rt=e=>{let{note:t}=e;return n.a.createElement("div",{ref:e=>{if(e){const r=e;for(;r.hasChildNodes();)r.removeChild(r.lastChild);const n=new at.Renderer(r,at.Renderer.Backends.SVG);n.resize(100,100);var a=n.getContext();a.scale(.5,.5);const s=new tt.a(20,40,150);s.setContext(a);const o=t.filter((function(e,t,a){return parseInt(e.slice(-1))<4})),l=t.filter((function(e,t,a){return parseInt(e.slice(-1))>=4}));let i="treble";o.length>l.length&&(i="bass"),s.setClef(i);let c=[],m=[];if(t.map(e=>{var t=e.slice(0,1)+"/"+e.slice(-1),a=e.slice(-2,-1);/[#db+n]/.test(a)||(a="n"),c.push(t),m.push(a)}),0===t.length)s.draw();else{const e=new at.StaveNote({clef:i,keys:c,duration:"4"});m.map((t,a)=>e.addAccidental(a,new at.Accidental(t)));const t=new at.Voice({num_beats:1,beat_value:4});t.addTickables([e]),s.draw();(new at.Formatter).joinVoices([t]).formatToStave([t],s);t.draw(a,s)}}}})};function nt(e){let t=0;"number"===typeof e.data[7]&&(t=e.data[7]);const[a,s]=Object(r.useState)({idx:e.data[6],scoreNames:e.data[0],scoreTechs:e.data[1],scoreDyns:e.data[2],scorePitch:e.data[3],scoreTgt:e.data[4],scoreOnoff:e.data[5],scoreIdx:e.data[6],scoreMicro:t,scoreModify:0,popOpen:!1,anchorEl:null}),o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function l(e){var t=e-Math.floor(e);let a=Math.round(e),r=o[a%12];return t>=.2&&t<.5?/[#]/.test(r)?r=o[(a+1)%12]+"d":r+="+":t>=.5&&t<=.8&&(/[#]/.test(r)?r=o[(a-1)%12]+"+":r+="d"),r+(Math.floor(a/12)-1)}const i=e=>{const t=e.currentTarget;s(e=>({...e,popOpen:!e.popOpen,anchorEl:t}))},m=()=>{s(e=>({...e,anchorEl:null,popOpen:!1})),e.onChange([a.scoreNames,a.scoreTechs,a.scoreDyns,a.scorePitch,a.scoreTgt,a.scoreOnoff,a.scoreIdx,a.scoreMicro])},h=(e,t)=>{s(e=>({...e,scoreMicro:t}))},p=(t,r)=>{e.onChange([a.scoreNames,a.scoreTechs,a.scoreDyns,a.scorePitch,a.scoreTgt,a.scoreOnoff,a.scoreIdx,a.scoreMicro])},f=()=>s(e=>({...e,scoreMicro:0}));a.scorePitch.map(e=>l(e));return n.a.createElement("tr",null,n.a.createElement("td",{key:"nam"+a.idx},a.instName),n.a.createElement("td",{key:"scor"+a.idx},((t,r)=>{const o=Object.keys(U);return n.a.createElement("div",null,n.a.createElement(D.a,{sx:{m:1,minWidth:50}},n.a.createElement(O.a,{id:"instrument-select"},"Instr."),n.a.createElement(M.a,{labelId:"instrument-select",id:"instrument-sel"+r,value:t,onChange:t=>((t,r)=>{const n=r.target.value;s(e=>({...e,popOpen:!1})),s(e=>({...e,scoreNames:n,scoreTechs:"normal",scoreDyns:"mf"})),e.onChange([n,"normal","mf",a.scorePitch,a.scoreTgt,a.scoreOnoff,a.scoreIdx,a.scoreMicro])})(0,t),autoWidth:!0,label:"instr."},o.map(e=>n.a.createElement(v.a,{value:e},e)))))})(a.scoreNames,a.idx)),n.a.createElement("td",{key:"tec"+a.idx},((t,r)=>{const o=Object.keys(U[a.scoreNames]);return n.a.createElement("div",null,n.a.createElement(D.a,{sx:{m:1,minWidth:50}},n.a.createElement(O.a,{id:"tech-select"},"Tech."),n.a.createElement(M.a,{labelId:"tech-select",id:"tech-sel"+r,value:t,onChange:t=>((t,r)=>{const n=r.target.value;s(e=>({...e,scoreTechs:n})),e.onChange([a.scoreNames,n,a.scoreDyns,a.scorePitch,a.scoreTgt,a.scoreOnoff,a.scoreIdx,a.scoreMicro])})(0,t),autoWidth:!0,label:"tech."},o.map(e=>n.a.createElement(v.a,{value:e},e)))))})(a.scoreTechs,a.idx)),n.a.createElement("td",{key:"dy"+a.idx},((t,r)=>{const o=Object.keys(U[a.scoreNames][a.scoreTechs]);return n.a.createElement("div",null,n.a.createElement(D.a,{sx:{m:1,minWidth:50}},n.a.createElement(O.a,{id:"dyn-select"},"Dyn."),n.a.createElement(M.a,{labelId:"dyn-select",id:"dyn-sel"+r,value:t,onChange:t=>((t,r)=>{const n=r.target.value;s(e=>({...e,scoreDyns:n})),e.onChange([a.scoreNames,a.scoreTechs,n,a.scorePitch,a.scoreTgt,a.scoreOnoff,a.scoreIdx,a.scoreMicro])})(0,t),autoWidth:!0,label:"dyn."},o.map(e=>n.a.createElement(v.a,{value:e},e)))))})(a.scoreDyns,a.idx)),n.a.createElement("td",{key:"mi"+a.idx},(a.scoreMicro,a.idx,n.a.createElement(d.a,{sx:{width:70}},n.a.createElement(pe.a,{spacing:0,direction:"row",sx:{mb:1},alignItems:"center"},n.a.createElement(c.a,{variant:"caption",style:{textAlign:"center"}}," tune "),n.a.createElement(u.a,{"aria-label":"zero",size:"small",onClick:f},n.a.createElement(c.a,{variant:"caption",style:{textAlign:"center"}}," (reset) "))),n.a.createElement(pe.a,{spacing:1,direction:"row",sx:{mb:1},alignItems:"center"},n.a.createElement("img",{src:"/flat.png",height:"20"}),n.a.createElement(I.a,{valueLabelDisplay:"auto","aria-label":"tune",size:"small",min:-.49,step:.01,max:.49,value:a.scoreMicro,onChangeCommitted:p,onChange:h}),n.a.createElement("img",{src:"/sharp.png",height:"20"}))))),n.a.createElement("td",{key:"pi"+a.idx},((e,t)=>{const r=[U[a.scoreNames][a.scoreTechs][a.scoreDyns][0],U[a.scoreNames][a.scoreTechs][a.scoreDyns][U[a.scoreNames][a.scoreTechs][a.scoreDyns].length-1]];return n.a.createElement("div",null,n.a.createElement("div",{"aria-describedby":t,onClick:i},n.a.createElement(rt,{note:a.scorePitch.sort().map(e=>l(e+a.scoreMicro))})),n.a.createElement(Me.a,{id:t,open:a.popOpen,anchorEl:a.anchorEl,onClose:m,style:{zIndex:1e4},anchorOrigin:{vertical:"bottom",horizontal:"left"},sx:{marginTop:3},transformOrigin:{vertical:"bottom",horizontal:"right"}},n.a.createElement(d.a,{sx:{border:1,p:1,bgcolor:"white"}},n.a.createElement(et,{noteRange:{first:r[0],last:r[1]},activeNotes:a.scorePitch,playNote:e=>{},stopNote:e=>{let t=[...a.scorePitch];if(t.includes(e)){const a=t.filter((function(t,a,r){return t!=e}));s(e=>({...e,scorePitch:a}))}else t.push(e),s(e=>({...e,scorePitch:t}))},width:400}))))})(a.scorePitch,"pi"+a.idx)),n.a.createElement("td",null," ",n.a.createElement(E.a,{variant:"outlined",color:"warning",onClick:()=>{s(e=>({...e,popOpen:!1})),s(e=>({...e,scorePitch:[]})),s(e=>({...e,scoreMicro:0})),e.onChange([a.scoreNames,a.scoreTechs,a.scoreDyns,[],a.scoreTgt,a.scoreOnoff,a.scoreIdx,0])},size:"small"}," clear notes ")),n.a.createElement("td",{key:"tg"+a.idx},n.a.createElement("div",{style:{border:"1px solid lightGray",borderRadius:5,padding:8}},n.a.createElement(pe.a,{direction:"row",spacing:1,alignItems:"center"},n.a.createElement(c.a,null,"orch."),n.a.createElement(_e.a,{key:"tgtswitch"+a.idx,checked:a.scoreTgt,color:"secondary",onChange:t=>((t,r)=>{const n=r.target.checked;s(e=>({...e,scoreTgt:n})),e.onChange([a.scoreNames,a.scoreTechs,a.scoreDyns,a.scorePitch,n,a.scoreOnoff,a.scoreIdx,a.scoreMicro])})(a.idx,t)}),n.a.createElement(c.a,null,"tgt")))),n.a.createElement("td",{key:"onoff"+a.idx},n.a.createElement("div",{style:{border:"1px solid lightGray",borderRadius:5,padding:8}},n.a.createElement(pe.a,{direction:"row",spacing:1,alignItems:"center"},n.a.createElement(c.a,null,"off"),n.a.createElement(_e.a,{key:"onoffswitch"+a.idx,checked:a.scoreOnoff,onChange:t=>((t,r)=>{const n=r.target.checked;s(e=>({...e,scoreOnoff:n})),e.onChange([a.scoreNames,a.scoreTechs,a.scoreDyns,a.scorePitch,a.scoreTgt,n,a.scoreIdx,a.scoreMicro])})(a.idx,t)}),n.a.createElement(c.a,null,"on")))),n.a.createElement("td",{key:"mod"+a.idx},(g=a.scoreModify,y=a.idx,n.a.createElement("div",null,n.a.createElement(D.a,{sx:{m:1,minWidth:50}},n.a.createElement(O.a,{id:"mod-select"},"Transpose"),n.a.createElement(M.a,{labelId:"mod-select",id:"mod-sel"+y,value:g,onChange:t=>((t,r)=>{const n=r.target.value;let o=a.scorePitch.map(e=>e+n>=U[a.scoreNames][a.scoreTechs][a.scoreDyns][0]&&e+n<=U[a.scoreNames][a.scoreTechs][a.scoreDyns][1]?e+n:null);o=o.filter((e,t,a)=>null!=e),console.log(o),s(e=>({...e,scorePitch:o,scoreModify:0})),e.onChange([a.scoreNames,a.scoreTechs,a.scoreDyns,o,a.scoreTgt,a.scoreOnoff,a.scoreIdx,a.scoreMicro])})(0,t),autoWidth:!0,label:"trans."},[0,12,-12,24,-24].map(e=>n.a.createElement(v.a,{value:e},e))))))),n.a.createElement("td",null," ",n.a.createElement(E.a,{variant:"outlined",color:"warning",onClick:t=>e.onDelete(a.scoreIdx),size:"small"}," delete ")));var g,y}const st=Object(C.a)({palette:{neutral:{main:"#dcc4ac",contrastText:"#black"}}});console.log(me);const ot=me;function lt(e){const[t,a]=Object(r.useState)({instList:[],listenList:[],data:[],selected:null,saved:!1,audibilityPercent:0,textFieldValue:"Chord Editor orchestration "+JSON.parse(localStorage.getItem("orchestrations")).length});r.useEffect(()=>{if(null!=sessionStorage.getItem("LastChord")){const e=JSON.parse(sessionStorage.getItem("LastChord"));a(t=>({...t,instList:e})),n(e)}},[]);const n=e=>{let t=[],r=[],n=0;e.map((e,a)=>{e[3].map(a=>{let s=0;"number"===typeof e[7]&&(s=e[7]),e[5]&&(t.push([e[0],e[1],e[2],a,e[4],e[5],n,s]),r.push([e[0],e[1],e[2],a+s,e[4],e[5],n])),n+=1})}),B.a.post(ot+"modalSlice",t).then(e=>{var t=e.data;a(e=>({...e,data:t.data,listenList:r,audibilityPercent:100-t.data[2].masking_percent}))})},s=e=>{e.persist();const r=e.target.textContent.toLowerCase();let n=[...t.instList],s="normal";"percussion_misc"===r&&(s="castanet");let o="mf";"crotale"===r&&(o="f");let l=[];U[r][s][o][0]===U[r][s][o][1]&&(l=[U[r][s][o][0]]),0===n.length?n.push([r,s,o,l,!1,!0,0]):n.push([r,s,o,l,!1,!0,n[n.length-1][6]+1]),console.log(n),a(e=>({...e,instList:n}))},o=e=>{console.log(t.instList);var r=t.instList.filter((function(t,a,r){return t[6]!=e}));console.log(r),a(e=>({...e,instList:r})),n(r)};return r.createElement(r.Fragment,null,r.createElement(w.a,{theme:st},r.createElement(E.a,{variant:"contained",color:"warning",onClick:()=>{a(e=>({...e,instList:[],listenList:[],data:[],selected:null,saved:!1}))}}," Clear all instruments "),r.createElement(c.a,{style:{textAlign:"center"}}," Select orchestration from your saved orchestrations  "),r.createElement(D.a,{sx:{m:1,minWidth:50}},r.createElement(O.a,{id:"orchestration-select"},"Orchestrations"),r.createElement(M.a,{labelId:"orchestration-select",id:"orchestration-select1",value:t.selected,onChange:e=>{const t=e.target.value,r=JSON.parse(localStorage.getItem("orchestrations")).filter((e,a,r)=>e.id===t)[0].data.map((e,t)=>[e[0],e[1],e[2],e[3],e[4],e[5],t]);a(e=>({...e,instList:r,selected:t})),n(r)},autoWidth:!0,label:"orch."},null===localStorage.getItem("orchestrations")?null:JSON.parse(localStorage.getItem("orchestrations")).map(e=>r.createElement(v.a,{value:e.id},e.name)))),r.createElement(c.a,{style:{textAlign:"center"}}," or/and  "),r.createElement(c.a,{style:{textAlign:"center"}}," Click below to add instrument to orchestration  "),r.createElement("table",null,r.createElement("tbody",null,r.createElement("tr",null,r.createElement("td",null,"Woodwinds"),r.createElement("td",null,"Brass"),r.createElement("td",null,"Strings"),r.createElement("td",null,"Percussion"),r.createElement("td",null,"Various")),r.createElement("tr",null,r.createElement("td",null,["piccolo","flute","alto_flute","bass_flute","oboe","english_horn","clarinet","clarinet_eb","bass_cl","bassoon"].map(e=>r.createElement(E.a,{variant:"contained",onClick:s,color:"neutral",size:"small"},e))),r.createElement("td",null,["trumpet","horn","tenor_trombone","bass_trombone","soprano_sax","alto_sax"].map(e=>r.createElement(E.a,{variant:"contained",onClick:s,color:"neutral",size:"small"},e))),r.createElement("td",null,["violin","viola","cello","double_bass","solo_violin","solo_viola","solo_cello","solo_double_bass"].map(e=>r.createElement(E.a,{variant:"contained",onClick:s,color:"neutral",size:"small"},e))),r.createElement("td",null,["crotale","cymbal","percussion_misc","tambourine","tamtam","tamtam_22","tamtam_40","thaigong","triangle_6","triangle_8","vibraphone","woodblock","xylophone","timp"].map(e=>r.createElement(E.a,{variant:"contained",onClick:s,color:"neutral",size:"small"},e))),r.createElement("td",null,["piano","harp","guitar","soprano_generic","tenor_generic","baritone_generic"].map(e=>r.createElement(E.a,{variant:"contained",onClick:s,color:"neutral",size:"small"},e))))))),r.createElement("div",{style:{zoom:1}},r.createElement("table",null,t.instList.map((e,s)=>r.createElement(nt,{key:e,data:e,onChange:e=>((e,r)=>{let s=[...t.instList];s[e]=r,a(e=>({...e,instList:s,saved:!1})),sessionStorage.setItem("LastChord",JSON.stringify(s)),n(s)})(s,e),onDelete:o,idx:"fgfg"+s})))),r.createElement("br",null),r.createElement("div",{style:{margin:"auto",textAlign:"center"}},r.createElement(c.a,{variant:"caption",component:"div",color:"text.secondary"},"Target audibility:"),r.createElement(d.a,{sx:{position:"relative",display:"inline-flex"}},r.createElement(ge.a,{variant:"determinate",value:t.audibilityPercent,color:t.audibilityPercent<=30?"error":t.audibilityPercent<=50?"warning":"success"}),r.createElement(d.a,{sx:{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center"}},r.createElement(c.a,{variant:"caption",component:"div",color:"text.secondary"},"".concat(Math.round(t.audibilityPercent),"%"))))),r.createElement("br",null),r.createElement(w.a,{theme:st},r.createElement(E.a,{variant:"contained",color:"neutral",onClick:()=>n(t.instList),style:{display:"none"}}," Click to update graphs "),r.createElement(ue,{text:t.textFieldValue,orchestration:t.instList})),r.createElement("div",{style:{textAlign:"center",margin:"auto"}},r.createElement(ye,{instrumentList:t.listenList})),r.createElement(le,{data:t.data}),r.createElement(he,{instrumentList:t.listenList}))}const it=r.forwardRef((function(e,t){return r.createElement(q.a,Object.assign({direction:"up",ref:t},e))}));function ct(e){const[t,a]=r.useState(!1);return r.useEffect(()=>{a(t=>e.open)},[e]),r.createElement("div",null,r.createElement(J.a,{fullScreen:!0,open:t,onClose:e.handleClose,TransitionComponent:it,PaperProps:{style:{backgroundColor:"#fffef0"}}},r.createElement(lt,null)))}function mt(e){const[t,a]=Object(r.useState)({idx:e.data[6],scoreNames:e.data[0],scoreTechs:e.data[1],scoreDyns:e.data[2],scorePitch:e.data[3],scoreTgt:e.data[4],scoreOnoff:e.data[5],scoreIdx:e.data[6],scoreModify:0,popOpen:!1,anchorEl:null}),s=["C","C#","D","D#","E","F","F#","G","G#","A","Bb","B"];const o=e=>{const t=e.currentTarget;a(e=>({...e,popOpen:!e.popOpen,anchorEl:t}))},l=()=>{a(e=>({...e,anchorEl:null,popOpen:!1})),e.onChange([t.scoreNames,t.scoreTechs,t.scoreDyns,t.scorePitch,t.scoreTgt,t.scoreOnoff,t.scoreIdx])};return n.a.createElement("tr",null,n.a.createElement("td",{key:"nam"+t.idx},t.instName),n.a.createElement("td",{key:"scor"+t.idx},((r,s)=>{const o=Object.keys(U);return n.a.createElement("div",null,n.a.createElement(D.a,{sx:{m:1,minWidth:50}},n.a.createElement(O.a,{id:"instrument-select"},"Instr."),n.a.createElement(M.a,{labelId:"instrument-select",id:"instrument-sel"+s,value:r,onChange:r=>((r,n)=>{const s=n.target.value;a(e=>({...e,popOpen:!1}));let o="mf";"crotale"===s&&(o="f");let l="normal";"percussion_misc"===s&&(l="castanet");let i=60;U[s][l][o][0]>60&&(i=U[s][l][o][0]),U[s][l][o][1]<60&&(i=U[s][l][o][0]),a(e=>({...e,scorePitch:i,scoreNames:s,scoreTechs:l,scoreDyns:o})),e.onChange([s,l,o,i,t.scoreTgt,t.scoreOnoff,t.scoreIdx])})(0,r),autoWidth:!0,label:"instr."},o.map(e=>n.a.createElement(v.a,{value:e},e)))))})(t.scoreNames,t.idx)),n.a.createElement("td",{key:"tec"+t.idx},((r,s)=>{const o=Object.keys(U[t.scoreNames]);return n.a.createElement("div",null,n.a.createElement(D.a,{sx:{m:1,minWidth:50}},n.a.createElement(O.a,{id:"tech-select"},"Tech."),n.a.createElement(M.a,{labelId:"tech-select",id:"tech-sel"+s,value:r,onChange:r=>((r,n)=>{const s=n.target.value;a(e=>({...e,scoreTechs:s})),e.onChange([t.scoreNames,s,t.scoreDyns,t.scorePitch,t.scoreTgt,t.scoreOnoff,t.scoreIdx])})(0,r),autoWidth:!0,label:"tech."},o.map(e=>n.a.createElement(v.a,{value:e},e)))))})(t.scoreTechs,t.idx)),n.a.createElement("td",{key:"dy"+t.idx},((r,s)=>{const o=Object.keys(U[t.scoreNames][t.scoreTechs]);return n.a.createElement("div",null,n.a.createElement(D.a,{sx:{m:1,minWidth:50}},n.a.createElement(O.a,{id:"dyn-select"},"Dyn."),n.a.createElement(M.a,{labelId:"dyn-select",id:"dyn-sel"+s,value:r,onChange:r=>((r,n)=>{const s=n.target.value;a(e=>({...e,scoreDyns:s})),e.onChange([t.scoreNames,t.scoreTechs,s,t.scorePitch,t.scoreTgt,t.scoreOnoff,t.scoreIdx])})(0,r),autoWidth:!0,label:"dyn."},o.map(e=>n.a.createElement(v.a,{value:e},e)))))})(t.scoreDyns,t.idx)),n.a.createElement("td",{key:"pi"+t.idx},((e,r)=>{const i=[U[t.scoreNames][t.scoreTechs][t.scoreDyns][0],U[t.scoreNames][t.scoreTechs][t.scoreDyns][U[t.scoreNames][t.scoreTechs][t.scoreDyns].length-1]];return n.a.createElement("div",null,n.a.createElement("div",{"aria-describedby":r,onClick:o},n.a.createElement(rt,{note:[(c=t.scorePitch,s[c%12]+(Math.floor(c/12)-1))]})),n.a.createElement(Me.a,{id:r,open:t.popOpen,anchorEl:t.anchorEl,onClose:l,style:{zIndex:1e4},anchorOrigin:{vertical:"bottom",horizontal:"left"},sx:{marginTop:3},transformOrigin:{vertical:"bottom",horizontal:"right"}},n.a.createElement(d.a,{sx:{border:1,p:1,bgcolor:"white"}},n.a.createElement(Ae.a,{noteRange:{first:i[0],last:i[1]},activeNotes:[t.scorePitch],playNote:e=>{},onPlayNoteInput:e=>{a(t=>({...t,scorePitch:e}))},stopNote:e=>null,width:400}))));var c})(t.scorePitch,"pi"+t.idx)),n.a.createElement("td",{key:"mod"+t.idx},(i=t.scoreModify,c=t.idx,n.a.createElement("div",null,n.a.createElement(D.a,{sx:{m:1,minWidth:50}},n.a.createElement(O.a,{id:"mod-select"},"Transpose"),n.a.createElement(M.a,{labelId:"mod-select",id:"mod-sel"+c,value:i,onChange:e=>((e,t)=>{const r=t.target.value;a(e=>({...e,scorePitch:e.scorePitch+r,scoreModify:0}))})(0,e),autoWidth:!0,label:"trans."},[0,12,-12,24,-24].map(e=>n.a.createElement(v.a,{value:e},e))))))));var i,c}const dt=Object(ne.a)(se.a)(e=>{let{theme:t}=e;return{...t.typography.body2,backgroundColor:"#fffef0",padding:t.spacing(1),textAlign:"center",color:t.palette.text.secondary}});function ht(e){let{data:t}=e;return t.length<2?null:r.createElement("div",null,r.createElement(re.a,{style:{marginTop:.5},container:!0,direction:"row",justifyContent:"center",alignItems:"center",spacing:.5},r.createElement(re.a,{item:!0,xs:12,md:6},r.createElement(dt,{style:{height:452,backgroundColor:"#fffef0"}},r.createElement(c.a,null,"Overtone structure of ",t[3].instruments[0]),r.createElement(ee,{notes:t[1].notes,instruments:t[1].instruments,target:t[1].target,target_color:"red",width:200,text_space:200}))),r.createElement(re.a,{item:!0,xs:12,md:6},r.createElement(dt,{style:{height:452,backgroundColor:"#fffef0"}},r.createElement(c.a,null,"Overtone structure of ",t[3].instruments[1]),r.createElement(ee,{notes:t[2].notes,instruments:t[2].instruments,target:t[2].target,target_color:"red",width:200,text_space:200}))),r.createElement(re.a,{style:{marginTop:.5},container:!0,direction:"row",justifyContent:"center",alignItems:"center",spacing:.5},r.createElement(re.a,{item:!0,xs:12,md:6},r.createElement(dt,{style:{height:452,backgroundColor:"#fffef0"}},r.createElement(c.a,null,"Spectral centroids"),r.createElement(ee,{notes:t[3].notes,instruments:t[3].instruments,target:[],width:150,text_space:200}))),r.createElement(re.a,{item:!0,xs:12,md:6},r.createElement(dt,null,r.createElement(Q.a,{data:t[0][1].data,layout:{...t[0][1].layout,width:window.innerWidth/2-50,margin:{l:0,r:0},legend:{orientation:"h"}},config:{displayModeBar:!1},width:200}))))),r.createElement(re.a,{style:{marginTop:.5},container:!0,direction:"row",justifyContent:"left",alignItems:"left",spacing:.5},r.createElement(re.a,{item:!0,xs:12,md:12},r.createElement(dt,null,r.createElement(Q.a,{data:t[0][0].data,layout:{...t[0][0].layout,width:window.innerWidth-50,margin:{l:0,r:0},legend:{orientation:"h"},xaxis:{title:{text:"Frequency in Hz",standoff:3},type:"log",showgrid:!1,range:[1.6,4.3]}},config:{displayModeBar:!1}})))))}const ut=me,pt=(Object(ne.a)(se.a)(e=>{let{theme:t}=e;return{...t.typography.body2,backgroundColor:"#fffef0",padding:t.spacing(1),textAlign:"center",color:t.palette.text.secondary}}),Object(C.a)({palette:{neutral:{main:"#dcc4ac",contrastText:"#black"}}})),ft=r.forwardRef((function(e,t){return r.createElement(q.a,Object.assign({direction:"up",ref:t},e))}));function gt(e){const[t,a]=r.useState(!1),[n,s]=r.useState([["flute","normal","mf",60,0,1,0],["flute","normal","mf",60,0,1,1]]),[o,l]=r.useState([]);r.useEffect(()=>{a(t=>e.open)},[e]),r.useEffect(()=>{if(null!=sessionStorage.getItem("LastCompare")){const e=JSON.parse(sessionStorage.getItem("LastCompare"));s(()=>e),m(e)}},[]);const i=e=>{let t=[...n];t[e[6]]=e,s(()=>t),sessionStorage.setItem("LastCompare",JSON.stringify(t)),m(t)},m=e=>{let t=[];e.map(e=>{t.push([e[0],e[1],e[2],e[3]])}),B.a.post(ut+"compare",t).then(e=>{var t=e.data;l(()=>t)})};return r.createElement("div",null,r.createElement(J.a,{fullScreen:!0,open:t,onClose:e.handleClose,TransitionComponent:ft,PaperProps:{style:{backgroundColor:"#fffef0"}}},r.createElement(c.a,{style:{textAlign:"center"}},"Compare two instrument timbres. Select instruments to compare below."),r.createElement("table",{style:{marginInline:"20vw"}},r.createElement("tbody",null,r.createElement(mt,{data:n[0],onChange:i}),r.createElement(mt,{data:n[1],onChange:i}))),r.createElement(w.a,{theme:pt},r.createElement(E.a,{variant:"contained",color:"neutral",onClick:()=>m(n),style:{display:"none"}}," Click to compare")),r.createElement(ht,{data:o})))}var yt=a(266);const Et=me,bt=r.forwardRef((function(e,t){return r.createElement(q.a,Object.assign({direction:"up",ref:t},e))}));function vt(e){const t=["piccolo","flute","alto_flute","bass_flute","oboe","english_horn","clarinet","clarinet_eb","bass_cl","bassoon"],a=["trumpet","horn","tenor_trombone","bass_trombone","soprano_sax","alto_sax"],n=["crotale","cymbal","percussion_misc","tambourine","tamtam","tamtam_22","tamtam_40","thaigong","triangle_6","triangle_8","vibraphone","woodblock","xylophone","timp"],s=["piano","harp","guitar","soprano_generic","tenor_generic","baritone_generic"],o=["violin","viola","cello","double_bass","solo_violin","solo_viola","solo_cello","solo_double_bass"],l=["p","mf","f"],i=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],m=[1,2,3,4,5,6,7,8];function d(e){var t=e-Math.floor(e);let a=Math.round(e),r=i[a%12];return t>=.2&&t<.5?/[#]/.test(r)?r=i[(a+1)%12]+"d":r+="+":t>=.5&&t<=.8&&(/[#]/.test(r)?r=i[(a-1)%12]+"+":r+="d"),r+(Math.floor(a/12)-1)}const[h,u]=r.useState(!1),[p,f]=r.useState({selected:null,instList:[],searchInstruments:t.concat(a).concat(o),searchTechs:["normal"],availableTechs:[],searchPitch:i,searchOct:m,searchDyn:l,searchMethod:["match"],searchPeaks:3,toggle:[!0,!0,!0,!1,!1,!1],result:null});r.useEffect(()=>{u(t=>e.open)},[e]),r.useEffect(()=>{let e=[];p.searchInstruments.map(t=>{Object.keys(U[t]).map(t=>{e.includes(t)||e.push(t)})}),f(t=>({...t,availableTechs:e}))},[p.searchInstruments]);const g=(e,t,a)=>{if(a.target.checked){let e=[...p.searchInstruments];e.push(t),f(t=>({...t,searchInstruments:e}))}else{const e=p.searchInstruments.filter((function(e,a,r){return e!==t}));f(t=>({...t,searchInstruments:e}))}},y=(e,r)=>{let l=[...p.toggle];if(l[e]=!l[e],f(e=>({...e,toggle:l})),0===e)if(l[e]){const e=p.searchInstruments.concat(t);f(t=>({...t,searchInstruments:e}))}else{let e=p.searchInstruments.filter((e,a,r)=>!t.includes(e));f(t=>({...t,searchInstruments:e}))}if(1===e)if(l[e]){const e=p.searchInstruments.concat(a);f(t=>({...t,searchInstruments:e}))}else{let e=p.searchInstruments.filter((e,t,r)=>!a.includes(e));f(t=>({...t,searchInstruments:e}))}if(2===e)if(l[e]){const e=p.searchInstruments.concat(o);f(t=>({...t,searchInstruments:e}))}else{let e=p.searchInstruments.filter((e,t,a)=>!o.includes(e));f(t=>({...t,searchInstruments:e}))}if(3===e)if(l[e]){const e=p.searchInstruments.concat(n);f(t=>({...t,searchInstruments:e}))}else{let e=p.searchInstruments.filter((e,t,a)=>!n.includes(e));f(t=>({...t,searchInstruments:e}))}if(4===e)if(l[e]){const e=p.searchInstruments.concat(s);f(t=>({...t,searchInstruments:e}))}else{let e=p.searchInstruments.filter((e,t,a)=>!s.includes(e));f(t=>({...t,searchInstruments:e}))}if(5===e)if(l[e]){const e=p.searchTechs.concat(p.availableTechs);f(t=>({...t,searchTechs:e}))}else f(e=>({...e,searchTechs:["normal"]}))};return r.createElement("div",null,r.createElement(J.a,{fullScreen:!0,open:h,onClose:e.handleClose,TransitionComponent:bt,PaperProps:{style:{backgroundColor:"#fffef0"}}},r.createElement(c.a,{style:{textAlign:"center"}}," Select search source from your saved orchestrations  "),r.createElement(D.a,{sx:{m:1,minWidth:50}},r.createElement(O.a,{id:"orchestration-select"},"Orchestrations"),r.createElement(M.a,{labelId:"orchestration-select",id:"orchestration-select1",value:p.selected,onChange:e=>{const t=e.target.value,a=JSON.parse(localStorage.getItem("orchestrations")).filter((e,a,r)=>e.id===t)[0].data.map((e,t)=>[e[0],e[1],e[2],e[3],e[4],e[5],t,e[7]]);f(e=>({...e,instList:a,selected:t}))},autoWidth:!0,label:"orch."},null===localStorage.getItem("orchestrations")?null:JSON.parse(localStorage.getItem("orchestrations")).map(e=>r.createElement(v.a,{value:e.id},e.name)))),r.createElement(c.a,{variant:"h5",style:{textAlign:"center",margin:"auto"}},"Search source"),(e=>{if(e.length>0){let t=[],a=0;e.map((e,r)=>{e[3].map(r=>{let n=0;"number"===typeof e[7]&&(n=e[7]),t.push([e[0],e[1],e[2],r,e[4],e[5],a,n]),a+=1})}),t.sort((function(e,t){return e[3]-t[3]}));let n=t.map(e=>d(e[3]+e[7])),s=t.map(e=>e[0]);return r.createElement("div",{style:{textAlign:"center",margin:"auto"}},r.createElement(ee,{notes:n,instruments:s,target:[],scale:.8,width:200,height:250,t_score_y:110,b_score_y:170,text_space:100}))}})(p.instList),r.createElement(c.a,{variant:"h5",style:{textAlign:"center",margin:"auto"}},"Search space"),r.createElement("table",null,r.createElement("tbody",null,r.createElement("tr",null,r.createElement("td",null,r.createElement(c.a,null,"Woodwinds"),r.createElement(L.a,{style:{color:"green"},label:"toggle all",control:r.createElement(z.a,{checked:p.toggle[0],size:"small",color:"success",onChange:e=>y(0)})})),r.createElement("td",null,r.createElement(c.a,null,"Brass"),r.createElement(L.a,{style:{color:"green"},label:"toggle all",control:r.createElement(z.a,{checked:p.toggle[1],size:"small",color:"success",onChange:e=>y(1)})})),r.createElement("td",null,r.createElement(c.a,null,"Strings"),r.createElement(L.a,{style:{color:"green"},label:"toggle all",control:r.createElement(z.a,{checked:p.toggle[2],color:"success",size:"small",onChange:e=>y(2)})})),r.createElement("td",null,r.createElement(c.a,null,"Percussion"),r.createElement(L.a,{style:{color:"green"},label:"toggle all",control:r.createElement(z.a,{checked:p.toggle[3],color:"success",size:"small",onChange:e=>y(3)})})),r.createElement("td",null,r.createElement(c.a,null,"Other"),r.createElement(L.a,{style:{color:"green"},label:"toggle all",control:r.createElement(z.a,{checked:p.toggle[4],color:"success",size:"small",onChange:e=>y(4)})}))),r.createElement("tr",null,r.createElement("td",null,r.createElement(yt.a,{sx:{display:"inline"}},t.map((e,t)=>r.createElement(L.a,{label:e,control:r.createElement(z.a,{checked:p.searchInstruments.includes(e),size:"small",onChange:t=>g(0,e,t)})})))),r.createElement("td",null,r.createElement(yt.a,{sx:{display:"inline"}},a.map((e,t)=>r.createElement(L.a,{label:e,control:r.createElement(z.a,{checked:p.searchInstruments.includes(e),size:"small",onChange:t=>g(0,e,t)})})))),r.createElement("td",null,r.createElement(yt.a,{sx:{display:"inline"}},o.map((e,t)=>r.createElement(L.a,{label:e,control:r.createElement(z.a,{checked:p.searchInstruments.includes(e),size:"small",onChange:t=>g(0,e,t)})})))),r.createElement("td",null,r.createElement(yt.a,{sx:{display:"inline"}},n.map((e,t)=>r.createElement(L.a,{label:e,control:r.createElement(z.a,{checked:p.searchInstruments.includes(e),size:"small",onChange:t=>g(0,e,t)})})))),r.createElement("td",null,r.createElement(yt.a,{sx:{display:"inline"}},s.map((e,t)=>r.createElement(L.a,{label:e,control:r.createElement(z.a,{checked:p.searchInstruments.includes(e),onChange:t=>g(0,e,t)})}))))))),r.createElement(c.a,null,"Techniques"),r.createElement(L.a,{style:{color:"green"},label:"toggle all",control:r.createElement(z.a,{checked:p.toggle[5],color:"success",size:"small",onChange:e=>y(5)})}),r.createElement(yt.a,{sx:{display:"inline"}},p.availableTechs.map((e,t)=>r.createElement(L.a,{label:e,control:r.createElement(z.a,{checked:p.searchTechs.includes(e),size:"small",onChange:t=>((e,t,a)=>{if(a.target.checked){let e=[...p.searchTechs];e.push(t),f(t=>({...t,searchTechs:e}))}else{const e=p.searchTechs.filter((function(e,a,r){return e!==t}));f(t=>({...t,searchTechs:e}))}})(0,e,t)})}))),r.createElement(c.a,null,"Dynamics"),r.createElement(yt.a,{sx:{display:"inline"}},l.map((e,t)=>r.createElement(L.a,{label:e,control:r.createElement(z.a,{checked:p.searchDyn.includes(e),size:"small",onChange:t=>((e,t,a)=>{if(a.target.checked){let e=[...p.searchDyn];e.push(t),f(t=>({...t,searchDyn:e}))}else{const e=p.searchDyn.filter((function(e,a,r){return e!==t}));f(t=>({...t,searchDyn:e}))}})(0,e,t)})}))),r.createElement(c.a,null,"Pitch classes"),r.createElement(yt.a,{sx:{display:"inline"}},i.map((e,t)=>r.createElement(L.a,{label:e,control:r.createElement(z.a,{checked:p.searchPitch.includes(e),size:"small",onChange:t=>((e,t,a)=>{if(a.target.checked){let e=[...p.searchPitch];e.push(t),f(t=>({...t,searchPitch:e}))}else{const e=p.searchPitch.filter((function(e,a,r){return e!==t}));f(t=>({...t,searchPitch:e}))}})(0,e,t)})}))),r.createElement(c.a,null,"Octaves"),r.createElement(yt.a,{sx:{display:"inline"}},m.map((e,t)=>r.createElement(L.a,{label:e,control:r.createElement(z.a,{checked:p.searchOct.includes(e),size:"small",onChange:t=>((e,t,a)=>{if(a.target.checked){let e=[...p.searchOct];e.push(t),f(t=>({...t,searchOct:e}))}else{const e=p.searchOct.filter((function(e,a,r){return e!==t}));f(t=>({...t,searchOct:e}))}})(0,e,t)})}))),r.createElement(c.a,null,"Search method"),r.createElement(yt.a,{sx:{display:"inline"}},["mfcc","centroid","masking_curve","peaks","match"].map((e,t)=>r.createElement(L.a,{label:e,control:r.createElement(z.a,{checked:p.searchMethod.includes(e),size:"small",onChange:t=>((e,t,a)=>{if(a.target.checked){let e=[...p.searchMethod];e.push(t),f(t=>({...t,searchMethod:e}))}else{const e=p.searchMethod.filter((function(e,a,r){return e!==t}));f(t=>({...t,searchMethod:e}))}})(0,e,t)})})),r.createElement(D.a,{fullWidth:!0},r.createElement(O.a,{id:"overlapping"},"Overlappin partials for peaks"),r.createElement(M.a,{labelId:"overlapping",id:"overlapping-select",value:p.searchPeaks,label:"Overlappin partials for peaks",onChange:e=>{const t=e.target.value;f(e=>({...e,searchPeaks:t}))}},[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15].map(e=>r.createElement(v.a,{value:e},e))))),r.createElement(E.a,{onClick:()=>{f(e=>({...e,result:""}));let e=[];p.instList.map((t,a)=>{t[3].map(a=>{e.push(t[0]+","+t[1]+","+t[2]+","+Math.round(a))})});const t=[e,p.searchMethod,p.searchInstruments,p.searchTechs,p.searchDyn,p.searchPitch,p.searchOct,p.searchPeaks];B.a.post(Et+"search",t).then(e=>{const t=e.data,a=r.createElement("div",{id:t[0]},r.createElement(c.a,{style:{textAlign:"center",margin:"auto"}}," Search result: ",t[0][0]," ",t[0][1]," ",t[0][2]," ",d(t[0][3])),r.createElement("div",{style:{textAlign:"center",margin:"auto"}},r.createElement(ee,{notes:[d(t[0][3])],instruments:[t[0][0]],target:[],scale:.8,width:200,height:250,t_score_y:50,b_score_y:140,text_space:100})),r.createElement(c.a,{style:{textAlign:"center",margin:"auto"}}," Play search result, ",t[0][0],": "),r.createElement("div",null,r.createElement("audio",{controls:!0,id:"yks"+t[0]}," ",r.createElement("source",{src:t[1],autoPlay:"true",type:"audio/x-wav"})," ")),r.createElement(c.a,{style:{textAlign:"center",margin:"auto"}}," Play search source: "),r.createElement("div",null,r.createElement("audio",{controls:!0,id:"kaks"+t[0]}," ",r.createElement("source",{src:t[2],type:"audio/x-wav"})," ")),r.createElement(c.a,{style:{textAlign:"center",margin:"auto"}}," Play both together: "),r.createElement("div",null,r.createElement("audio",{controls:!0,id:"kol"+t[0]},"  ",r.createElement("source",{src:t[3],type:"audio/x-wav"})," ")),r.createElement(E.a,{onClick:e=>((e,t)=>{let a=[...p.instList];a.push([e[0],e[1],e[2],[e[3]],0,1,a[a.length-1][6]+1,0]),f(e=>({...e,instList:a}))})(t[0]),variant:"contained",color:"secondary",style:{padding:10,margin:5}}," Add search result to search source "),r.createElement(E.a,{onClick:e=>((e,t)=>{let a=[...p.instList];a.push([e[0],e[1],e[2],[e[3]],0,1,a[a.length-1][6]+1,0]),f(e=>({...e,instList:a}));let r=JSON.parse(localStorage.getItem("orchestrations"));r[p.selected].data=a,localStorage.setItem("orchestrations",JSON.stringify(r))})(t[0]),variant:"contained",color:"secondary",style:{padding:10,margin:5}}," Update your saved orchestration with search result "));f(e=>({...e,result:a}))})},variant:"contained",color:"primary",style:{padding:10,margin:5}}," SEARCH "),r.createElement("br",null),p.result))}const _t=me,xt=r.forwardRef((function(e,t){return r.createElement(q.a,Object.assign({direction:"up",ref:t},e))}));function Ct(e){const t=["C","C#","D","D#","E","F","F#","G","G#","A","B#","B"];const[a,n]=r.useState(!1),[s,o]=r.useState([]),[i,m]=r.useState([]);r.useEffect(()=>{n(t=>e.open);let t=[];t.length=JSON.parse(localStorage.getItem("orchestrations")).length,m(()=>t)},[e]),r.useEffect(()=>{o(()=>JSON.parse(localStorage.getItem("orchestrations")));let e=[];e.length=JSON.parse(localStorage.getItem("orchestrations")).length,m(()=>e)},[]),r.useEffect(()=>{o(()=>JSON.parse(localStorage.getItem("orchestrations")));let e=[];e.length=JSON.parse(localStorage.getItem("orchestrations")).length,m(()=>e)},[localStorage.getItem("orchestrations")]);const d=e=>{if(e.length>0){let a=[],n=0;e.map((e,t)=>{e[3].map(t=>{let r=0;"number"===typeof e[7]&&(r=e[7]),a.push([e[0],e[1],e[2],t+r,e[4],e[5],n]),n+=1})}),a.sort((function(e,t){return e[3]-t[3]}));let s=a.map(e=>function(e){var a=e-Math.floor(e);let r=Math.round(e),n=t[r%12];return a>=.2&&a<.5?/[#]/.test(n)?n=t[(r+1)%12]+"d":n+="+":a>=.5&&a<=.8&&(/[#]/.test(n)?n=t[(r-1)%12]+"+":n+="d"),n+(Math.floor(r/12)-1)}(e[3])),o=a.map(e=>e[0]);return r.createElement("div",{style:{textAlign:"center",margin:"auto"}},r.createElement(ee,{notes:s,instruments:o,target:[],scale:.3,width:150,height:90,t_score_y:110,b_score_y:170,text_space:30}))}};return r.createElement("div",null,r.createElement(J.a,{fullScreen:!0,open:a,onClose:e.handleClose,TransitionComponent:xt,PaperProps:{style:{backgroundColor:"#fffef0"}}},r.createElement(c.a,{style:{textAlign:"center"}},"Here you can manage your saved orchestrations"),r.createElement(l.a,{onDrop:e=>{e.forEach(e=>{const t=new FileReader;t.onabort=()=>console.log("file reading was aborted"),t.onerror=()=>console.log("file reading has failed"),t.onload=()=>{let e=JSON.parse(localStorage.getItem("orchestrations")),a=0;e.length>0&&(a=e[e.length-1].id+1);const r=JSON.parse(t.result);r.map(e=>{e.id,e.name,e.data}),r.map((t,r)=>{let n=t;n.id=a+r,e.push(n)}),o(()=>e),localStorage.setItem("orchestrations",JSON.stringify(e))},t.readAsText(e)})},maxFiles:1,accept:".chords"},e=>{let{getRootProps:t,getInputProps:a}=e;return r.createElement("section",{className:"container"},r.createElement("div",Object.assign({},t({className:"dropzone Upload"}),{style:{margin:5,padding:5,borderRadius:10,border:"2px dashed #4c4c48"}}),r.createElement("input",a()),r.createElement("p",{style:{textAlign:"center"}},"Upload your saved file of orchestration chords")),r.createElement("aside",null,r.createElement("div",null)))}),0===s.length&&r.createElement(c.a,{style:{textAlign:"center"}},"Add some orchestrations to your list (Upload a pre-saved file, or click save either in Score Analyzer or in Chord Editor.)"),s.length>0&&r.createElement("div",null,r.createElement(E.a,{onClick:()=>{const e=document.createElement("a"),t=new Blob([localStorage.getItem("orchestrations")],{type:"text/plain"});e.href=URL.createObjectURL(t),e.download="orchestration.chords",document.body.appendChild(e),e.click()},variant:"contained",color:"primary",style:{padding:10,margin:5}}," Download your orchestrations "),r.createElement(c.a,{style:{textAlign:"center"}},"List of your orchestrations"),r.createElement("table",{style:{textAlign:"center",margin:"auto"}},r.createElement("tbody",null,r.createElement("tr",null,r.createElement("td",null,"Name"),r.createElement("td",null,"Orchestration"),r.createElement("td",null,"Listen"),r.createElement("td",null,"Delete")),s.map((e,t)=>r.createElement("tr",null," ",r.createElement("td",null,e.name),"  ",r.createElement("td",null,d(e.data)),r.createElement("td",null,r.createElement(E.a,{onClick:a=>((e,t,a)=>{let n=[];t.map((e,t)=>{e[3].map(t=>{let a=0;"number"===typeof e[7]&&(a=e[7]),n.push(e[0]+","+e[1]+","+e[2]+","+(t+a))})}),B.a.post(_t+"listen",{orchestration:n,positions:Array(n.length).fill(17),listeningPosition:"audience"},{headers:{auth:"uljasPulkkis"}}).then(t=>{const a=r.createElement("div",null,r.createElement("audio",{controls:!0,autoPlay:"true"}," ",r.createElement("source",{src:t.data,type:"audio/x-wav"})," "));let n=[...i];n[e]=a,m(()=>n)})})(t,e.data),variant:"contained",color:"secondary",style:{padding:10,margin:5}}," LISTEN "),i[t]),r.createElement("td",null,r.createElement(E.a,{onClick:t=>((e,t)=>{const a=JSON.parse(localStorage.getItem("orchestrations")).filter((t,a,r)=>t.id!=e);o(()=>a),localStorage.setItem("orchestrations",JSON.stringify(a))})(e.id),variant:"contained",color:"warning",style:{padding:10,margin:5}}," DELETE ")))))),r.createElement(E.a,{onClick:()=>{o(()=>[]),localStorage.setItem("orchestrations",JSON.stringify([]))},variant:"contained",color:"error",style:{padding:10,margin:5}}," Erase all your orchestrations "))))}function wt(e){return r.createElement("div",{style:{marginTop:10}},r.createElement(c.a,{variant:"h4",style:{border:"1px solid",padding:5}},"This is a completely new version of Score-Tool. If you want to use the old version, visit ",r.createElement("a",{href:"https://old.score-tool.com",target:"_blank"},"old.score-tool.com")," "),r.createElement(c.a,{variant:"h5"},"About"),r.createElement(c.a,null,"Score-Tool is an analysis tool for music orchestration. The purpose of the tool is to help composers, conductors and other musicians to extract information about audibility and timbre from the score. The analysis results are showed on graphs, and there is also a possibility to listen any orchestration chord in a real binaural simulation of the concert hall."),r.createElement(c.a,{variant:"h5"},"Score"),r.createElement(c.a,null,'For analysis, the score must be in musicXML or mxl (compressed musicXML) format. All current notation programs can export musicXML from the "SaveAs" menu. Drag and drop, or click drop area to upload your score to Score-Tool. Click "load score". Analyzed score can be downloaded as PNG file.'),r.createElement(c.a,{variant:"h5"},"Chord"),r.createElement(c.a,null,'The Chord editor can be used without any files. Click any instrument name to add it to your orchestration. Click the notation stave and add notes with piano keyboard. After editing the instrumentation press "Update graphs" to view the analysis information.'),r.createElement(c.a,{variant:"h5"},"Compare"),r.createElement(c.a,null,"The Compare editor lets you compare two individual timbres. Click the mini-staff to select pitch for each instrument. The graphs show the overtone structure and timbre data of both instruments."),r.createElement(c.a,{variant:"h5"},"Search"),r.createElement(c.a,null,"The Search feature requires you to save some orchestrations first. Orchestrations can be saved in Score and Chord editors. Select the search source from your saved orchestrations, select search space from orchestra instruments, select search method(s) and click SEARCH. As result you will get the closest match from database, which can be added to your saved orchestration."),r.createElement(c.a,{variant:"h5"},"Manage"),r.createElement(c.a,null,"Here you can manage your saved orchestrations. You can listen individual chords, and delete the ones you don't need anymore. The saved chords are already in your machine, in browser's local storage, but here you can also download them as file, or upload your orchestratrions to browser."),r.createElement(c.a,{variant:"h6",style:{padding:10}},"Created in 2021 by ",r.createElement("a",{href:"https://uljaspulkkis.com",target:"_blank"},"Uljas Pulkkis")," "))}var kt=a(154),St=a.n(kt);Object(C.a)({palette:{neutral:{main:"#dcc4ac",contrastText:"#black"}}});const Tt=Object(ne.a)(se.a)(e=>{let{theme:t}=e;return{...t.typography.body2,backgroundColor:"#fffef0",padding:t.spacing(1),textAlign:"center",color:t.palette.text.secondary}});class Nt extends r.Component{constructor(e){super(e),this.state={file:"",cursor:!1,help:!1,next:0,files:[],load:"none",chord:!1,compare:!1,search:!1,manage:!1,analyze:"none",about:"block",osmd:""},this.setcursor=this.setcursor.bind(this),this.setnext=this.setnext.bind(this),this.loadFile=this.loadFile.bind(this),this.onDrop=e=>{this.setState({files:e})},document.title="Score-Tool 2.0"}componentDidMount(){null===JSON.parse(localStorage.getItem("orchestrations"))&&localStorage.setItem("orchestrations",JSON.stringify([]))}chordClose(){this.setState(e=>e.chord=!1)}compareClose(){this.setState(e=>e.compare=!1)}searchClose(){this.setState(e=>e.search=!1)}manageClose(){this.setState(e=>e.manage=!1)}setcursor(){this.setState(e=>e.cursor=!0)}loadFile(){this.state.files.forEach(e=>{const t=new FileReader;t.onabort=()=>console.log("file reading was aborted"),t.onerror=()=>console.log("file reading has failed"),t.onload=()=>{const e=t.result;this.setState(t=>{t.file=e,t.load="inline-block"}),this.forceUpdate()};var a=e.name;a.toLowerCase().indexOf(".xml")>0||a.toLowerCase().indexOf(".musicxml")>0?t.readAsText(e):a.toLowerCase().indexOf(".mxl")>0?t.readAsBinaryString(e):alert("No vaild .xml/.mxl/.musicxml file!")})}setnext(){var e=this.state.next;this.setState(t=>t.next=e+1)}handleClick(e){const t=e.target.value;this.setState(e=>e.file=t)}render(){const e=this.state.files.map(e=>n.a.createElement("li",{key:e.name},e.name," - ",e.size," bytes"));var t=[];if(this.state.files[0]){let e="inline-block";"inline-block"===this.state.load&&(e="none"),t=n.a.createElement("div",null,n.a.createElement("div",{style:{display:e}},n.a.createElement(E.a,{onClick:this.loadFile,variant:"contained"},"Load current file (Warning! Large scores with 200+ bars can freeze the browser)")),n.a.createElement("div",{style:{display:this.state.load}},n.a.createElement(Ie,{file:this.state.file,filename:this.state.files[0].name+this.state.files[0].size,help:this.state.help,show:this.state.cursor,next:this.state.next})))}document.body.style.backgroundColor="#fffef0";return n.a.createElement("div",{className:"App"},n.a.createElement(T,{navClick:e=>{switch(e){case"Score":this.setState(e=>({...e,analyze:"block",about:"none"}));break;case"Chord":this.setState(e=>({...e,chord:!0,analyze:"block",about:"none"}));break;case"Compare":this.setState(e=>({...e,compare:!0,analyze:"block",about:"none"}));break;case"Search":this.setState(e=>({...e,search:!0,analyze:"block",about:"none"}));break;case"About":this.setState(e=>({...e,analyze:"none",about:"block"}));break;case"Manage":this.setState(e=>({...e,manage:!0,analyze:"block",about:"none"}))}},help:e=>{this.setState(t=>t.help=e)}}),n.a.createElement(Tt,null,n.a.createElement("div",{style:{display:this.state.about}},n.a.createElement("header",{className:"App-header",style:{padding:10,borderRadius:20}},n.a.createElement("h1",{className:"App-title",style:{padding:10,borderRadius:20}},"Score-Tool 2.0"),n.a.createElement("h1",{className:"App-title",style:{padding:10,borderRadius:20}},"Psychoacoustic orchestration tool by Uljas Pulkkis 2021"))),n.a.createElement(ct,{handleClose:this.chordClose.bind(this),open:this.state.chord}),n.a.createElement(gt,{handleClose:this.compareClose.bind(this),open:this.state.compare}),n.a.createElement(vt,{handleClose:this.searchClose.bind(this),open:this.state.search}),n.a.createElement(Ct,{handleClose:this.manageClose.bind(this),open:this.state.manage}),n.a.createElement("div",{className:"",style:{display:this.state.analyze}},"none"===this.state.load&&n.a.createElement("div",null,n.a.createElement(c.a,{style:{textAlign:"center"}}," Select an example score  "),n.a.createElement(b.a,{title:n.a.createElement(i,{help:"Examples"}),disableHoverListener:!this.state.help,placement:"top"},n.a.createElement(D.a,{sx:{m:1,minWidth:150}},n.a.createElement(O.a,{id:"score-select"},"Scores"),n.a.createElement(M.a,{labelId:"score-select",id:"score-select1",value:this.state.selected,onChange:e=>{const t=e.target.value;this.setState(e=>e.load="block"),this.setState(e=>e.file=t),this.setState(e=>e.files=[{name:t,size:"fromExamples"}])},autoWidth:!0,label:"score"},["test_score2.xml","sonority.xml"].map(e=>n.a.createElement(v.a,{value:e},e))))),n.a.createElement(c.a,{style:{textAlign:"center"}}," or  "),n.a.createElement(l.a,{onDrop:this.onDrop,maxFiles:1,accept:".xml,.musicXml,.mxl"},t=>{let{getRootProps:a,getInputProps:r}=t;return n.a.createElement(b.a,{title:n.a.createElement(i,{help:"Dropzone"}),disableHoverListener:!this.state.help},n.a.createElement("section",{className:"container"},n.a.createElement("div",Object.assign({},a({className:"dropzone Upload"}),{style:{margin:20,padding:10,borderRadius:10,border:"2px dashed #4c4c48",backgroundColor:"#dcc4ac"}}),n.a.createElement("input",r()),n.a.createElement("p",null,"Drop musicXML or click")),n.a.createElement("aside",null,n.a.createElement("div",null,e))))})),t,this.state.osmd),n.a.createElement("div",{style:{display:this.state.about,textAlign:"left",textJustify:"left",paddingInline:"20vw"}},n.a.createElement(wt,null),n.a.createElement(E.a,{size:"small",onClick:()=>{localStorage.clear(),localStorage.setItem("orchestrations",JSON.stringify([]))},variant:"contained",color:"warning",startIcon:n.a.createElement(St.a,null),style:{padding:10,margin:5}}," If you get errors, click here to clear all your orchestration data "))))}}var It=Nt;const At=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Mt(e){navigator.serviceWorker.register(e).then(e=>{e.onupdatefound=()=>{const t=e.installing;t.onstatechange=()=>{"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(e=>{console.error("Error during service worker registration:",e)})}o.a.render(n.a.createElement(It,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL(".",window.location).origin!==window.location.origin)return;window.addEventListener("load",()=>{const e="".concat(".","/service-worker.js");At?(!function(e){fetch(e).then(t=>{404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(e=>{e.unregister().then(()=>{window.location.reload()})}):Mt(e)}).catch(()=>{console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(()=>{console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):Mt(e)})}}()}},[[178,1,2]]]);