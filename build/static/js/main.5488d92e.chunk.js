(this["webpackJsonpScore-Tool-2.0"]=this["webpackJsonpScore-Tool-2.0"]||[]).push([[0],{179:function(e,t,r){},217:function(e,t,r){},220:function(e,t,r){},273:function(e,t,r){"use strict";r.r(t);var n=r(1),s=r.n(n),a=r(74),o=r.n(a),i=(r(217),r(6)),c=r(7),l=r(37),h=r(9),d=r(10),u=r(4),f=r(132),b=(r(220),r(13));function j(e){switch(e.help){case"Scoretool":return"An orchestration psychoacoustic analysis web app for composers, conductors and musicians.";case"Score":return"This the primary component of the Score-Tool App, where you can upload your own score.";case"Chord":return"Here you can create, modify, load and save orchestral chords and see the psychoacoustic analysis results as graphs.";case"Compare":return"Here you can compare two timbres and see the overtone structure of them in musical staff.";case"Search":return"If you have saved orchestral chords, here you can search matching timbres from database using various algorithms.";case"Manage":return"Here you can delete, download, and upload your own orchestral chords.";case"Examples":return"Choose here an example score. 'Test Score' is a small and short example you can use to try the features of the Score-Tool App.";case"Dropzone":return"Drop an MusicXml file here, or click to choose one from your filesystem. You can find plenty of MusicXml orchestral scores for example from Musescore site.";case"ScoreSlider":return"Choose here the bar range of the score. Only the selected range will be visible when you click 'Show score'. This can be useful if you have a very large score, because visual rendering takes time.";case"ShowHide":return"Click here to alter the masking calculation parameters of the score. If they are visible, clicking here will hide them.";case"Instruments":return"Here you assign the orchestration from your score to instruments on Score-Tool database. The Score-Tool App tries to guess the most suitable database instrument according to the name of your staff, but it may fail.";case"Scorename":return"Here is the text on the staff of your score. Compare this to the instrument selection on right. Select the most suitable instrument from database, i.e. if you have a Baritone horn in socre, the closest instrument on database might be Tuba.";case"Techs":return"Select playing technique. Unfortunately Score-Tool cannot read for example pizzicato indication from score. You must select it manually, and do the masking calculation separately for the pizzicato section.";case"Dyns":return"Score-Tool reads the dynamics from the score, but if you want to try, for example, to set all the trumpets to play p, you can do it here.";case"Target":return"This is an important parameter. Here you select the current staff as target, i.e. the staff who's audibility is tested.";case"Onoff":return"Here you can swith the staff off, i.e. omit it from the masking calculation.";case"Transpose":return"Here you can set the transposition for the whole staff. You can, for example, try to set the target to play an octave higher to see if that helps for the audibility issues.";case"Showscore":return"Click here to render the score on screen. This can take several minutes for a big score. Only the bar range you set is rendered.";case"CalcRange":return"Set range for masking calculation. This does not have to be the range of the whole score. You can calculate, for example, one bar here, two bars there etc. This affects also to rendered range, if you click 'Redraw' button.";case"CalcButton":return"Clicking here starts the masking calculation. You can follow the progress on score, and even use other features of the App while the calculation advances. The calculation can be stopped and resumed at will.";case"Redraw":return"Clicking here will redraw the score, which might be a lengthy process. Note that redraw will erase all the masking calculation color codes from the score.";case"DownloadScore":return"Clicking here will initiate the download of your rendered score with masking indications. The downloaded score will be in PDF from, all systems on single page.";case"UnderMouse":return"This toggles the view of the orchestration under the mouse cursor in score. This is checked by default, because with this feature it is quick and easy to check which instruments are playing together at any point in the score.";case"Colors":return"In the masking calculation the score will be color-coded according to these indications. Once the calculation begin, the target staff will be highlighted, and colored reddish if target audibility is poor, yellowish if audibility is moderate, and green if audibility is good. The surrounding orchestral instruments are colored according to their masking properties. Magenta is the heaviest, brownish yellow the 2nd heaviest and light blue the 3rd heaviest masker.";case"AnScorenames":return"This is the name if the staff in your score where this entry of current orchestral chord reside.";case"AnTech":return"Here you can modify the playing technique of the current entry. Click the text to browse through different techniques.";case"AnDyn":return"Click the dynamic to browse through three dynamic levels, p, mf, and f. Play with these first to find possible solution to the audibility issues.";case"AnMicro":return"Here you can tune your orchestral chord entry. Tuning range is +-25 cents.";case"AnTgt":return"click here to toggle entry target status on/off.";case"AnOnoff":return"Click here to temporarely switch entry on/off. This is handy if you want to try if this instrument is causing the masking; switch it off and see if target audibility is better.";case"AnMo":return"This toggles transposition level between 0, -12 and +12. This can also be used to find solution to the audibility issues; try your target an octave higher, or masker octave lower.";case"Maskers":return"This column indicates the heaviest maskers in you orchestration chord. The red indicates the heaviest, yellow 2nd and magenta 3rd masker. Try to alter dynamics, playing techniques, transpositions etc... and see if the masking order changes.";case"Prediction":return"This is one of the most important parameters on this page. The audibility prediction value is the result of an algorithm that takes the masking, blending and timbre similarity prameters into account. If this value is low, it moght be wise to revise the orchestration, if you like to have an audible target.";case"SaveOrch":return"Here you can save the orchestration chord for yourself. The chord will be saved in your browser cache so, that when you start the Score-Tool App again, your chord is there. Saved orchestrations can be used, for example, in Search panel. The App suggest a name, but you can alter it or write your own.";case"QuickListen":return"Click here to quickly listen how your orchestration chord sounds like.";case"Listen":return"Here is implemented an acoustic model of Helsinki Music Centre hall. You can drag your orchestration instruments to pre-marked places in the picture to see how the placement affects the timbre and audibility. You can also change the listening position between conductor and audience. The conductor hears, for example, the nearest players louder than the audience.";case"Orchestration":return"This is your orchestration on musical staff. The target is colored green, heaviest masker on red, second magenta and third yellow.";case"Centroid":return"Here you can see the spectral centroids, i.e. the brightness value of your target and orchestration. Values under 2 kHz can be concidered 'dark'";case"Distance":return"Here you see the timbre distance value in percentage, i.e. how different your target's timbre is from orchestration. Similar timbres tend to blend together. The orhcestration homogeneity value tells you is the orchestration timbre sounds like a one entity or like a collection of different timbres.";case"MaskStaff":return"In this graph you see the masking curve as colors of musical staff. The target overtones are marked on black noteheads, and the faintness indicates the loudness of the partial. The red color indictes heavy masking on vurrent frequency band, yellow moderate masking and green light masking.";case"MaskCurve":return"This is the 'Main' graph of the Score-Tool App. Here you see the result of masking curve calculation along with the overtones of the target. Target peak overtone above the masking curve means, in theorym, that the partial is audible. Above the graph you also see the mix engineer classifications for different frequency areas. These can be useful to estimate, for example, muddiness or ear tiring properties of the orchestration. Clicking 'Orchestration formant' text shows the 'ideal orchestration formant', i.e. the big orchestral timbre graph against the graph of your orchestration. If they match, you propably have a 'big' sounding orchestration chord.";case"Glyph":return"This is a visual representation of the timbre. This glyph shows the formant structure of your orchestration. If you have, for example, a nasal sounding timbre, it shows here as a peak on some formant area. This can be used also to quickly see how different your target and orchestration timbres are.";case"Summary":return"This is a automatically generated summary of your orchestration. Here you see at a glance some properties, that can be read also from the graphs.";case"ClearInstr":return"Clicking here clears current orchestration. It does not clear your saved items, so you can, for example, load a saved orchestration, look at it, and safely click here to 'clear the table' without losing your saved work.";case"SelectSaved":return"If you save an orchestration either here or in Score-, or in Search section, it will appear here. Your orchestrations are saved in your browser memory, if you want to check, choose 'developer tools' menu from browser and check the application->local storage section.";case"AddInstr":return"Click any of the instrument names to add it into the orchestration chord. These are all the instruments currently available in the database.";case"InstrDropdown":return"Here you can change the the database instrument from dropdown menu.";case"SelPitch":return"Click the staff to select pitches for the instrument. The piano keyboard that pops up is shows the playing range. Clicking a piano key will select/deselect the current pitch.";case"ClearPitch":return"Clears the selected pitches for current instrument.";case"ChordTranspose":return"Transposes all the selected pitches. If the transposition results out-of-range pitches, they will be dropped out.";case"DelInstr":return"Delete the current instrument with all of its data from the orchestration chord.";case"CompPitch":return"Click the staff to select the pitch for the instrument. In here you can select only one pitch.";case"CompTrans":return"Select here the temporary transposition for your pitch.";case"Overtone":return"Here you can see the overtone structure of your comparable instrument. The loudest overtone is marked as 0dB, and other ones in relation to that.";case"CompCentroid":return"Here you can see the spectral centroids, i.e. the brightness value of your comparable instruments. Values under 2 kHz can be concidered 'dark'";case"CompGlyph":return"This is a visual representation of the timbre. This glyph shows the formant structure of your instruments. If you have, for example, a nasal sounding instrument, it shows here as a peak on some formant area. This can be used also to quickly see how different your timbres are.";case"CompSpectra":return"This graph shows the masking curves and spectral peaks of both of your comparable instruments. This is not the actual frequency spectrum of the sound, but quite close to it. This can be used to quickly check the spectral differences between the timbres.";case"SelSource":return"Here you can select the search source from your saved orchestrations. If the list is empty, go to the chord section, create an orchestration chord and click save, which make the orchestration chord appear in this menu.";case"SearchSource":return"Here you see the selected search source orchestration chord in musical staff.";case"SearchSpace":return"Click here to select which instruments you want to include in your search. The selection is typically the instrumentation in your score.";case"SearchTechs":return"Select here which techniques are included in the search. Usually it is good to first try only with 'normal' selected, and then a bigger search space.";case"SearchDyns":return"Select dynamics for search space. For example, of the results are only loud dynamics, try to exclude forte from search.";case"SearchPitches":return"Select here the pitch space you are searching. This is handy if you have, i.e., a specific harmony set in the piece.";case"SearchOct":return"Select here which octaves are included in the search. Octave 4 is the middle octave in piano keyboard. For example, disable high octaves if you want to find a good bass for your chord.";case"SearchMethod":return"This is the most important parameter in search. 'Match' tries to find instrument that matches into overtone structure of your orchestration. It usually finds somthing above the register of your orchestration. 'Peaks' is the opposite of 'Match', it tries to find an instrument with overtone structure that matches the orchestration. It returns usually an instrument in low octave. For both, 'Match' and 'Peaks', the number of partials involved in search is selected from dropdown menu below. 'Masking curve' will try to find a timbre with matching masking properties. 'Mfcc' will try to find a matching format structure, and 'Centroid' will try to find a timbre with matching brightness. You can select any combination of these at the same time, but selecting everything does not quarantee a better search result.";case"SearchResult":return"This is the result of your search. If the resulting instrument is in totally wrong octave, try to deselect that octave from search space.";case"AddToSearch":return"This button adds the result to search source. This is handy if you want to construct an entire orchestration using the Search.";case"Update":return"This updates your current saved orchestration chord with the instruments found in Search.";case"UploadChords":return"Here you can upload the list of chords saved by Score-Tool App. I do not recommend editing the saved files manually, because uploading uncompatible file may result crashing the App. If that happens, clear local storage from the brpwser 'developement tools' section.";case"DownloadOrch":return"clicking here you can download the entire list of orchestration chords in your browser. This might be a good idea to do every now and then, especially if you have a big orchestration chord collection.";case"OrchList":return"Here you find all of your saved orchestration chords listed.";case"ListListen":return"A click here will let you hear the current orchestration chord";case"ListDelete":return"Clicking here will delete the current orchestration chord. If you are not sure, better to save everything first.";case"EraseAll":return"WARNING! Clicking here will erase all of your orchestration data!"}return""}var p=r(355),m=r(352),g=r(324),x=r(354),O=r(349),v=r(189),y=r(183),w=r.n(y),C=r(353),k=r(350),_=r(333),S=r(336),T=r(184),I=r.n(T),N=r(155),L=r(347),A=r(0),M=Object(N.a)({palette:{neutral:{main:"#dcc4ac",contrastText:"black"}}}),D=["Score","Chord","Compare","Search","Manage"];function P(e){var t=n.useState(null),r=Object(b.a)(t,2),s=r[0],a=r[1],o=n.useState(null),i=Object(b.a)(o,2),c=i[0],l=i[1],h=n.useState(!1),d=Object(b.a)(h,2),u=d[0],f=d[1],y=function(t){console.log(t),"Help"===t&&(e.help(!u),f((function(e){return!u}))),e.navClick(t),a(null),T()},T=function(e){l(null)};return Object(A.jsx)(L.a,{theme:M,children:Object(A.jsx)(m.a,{color:"neutral",sx:{height:50,paddingTop:0,minHeight:20,marginTop:-2},children:Object(A.jsx)(C.a,{maxWidth:"xl",children:Object(A.jsxs)(x.a,{disableGutters:!0,children:[Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"Scoretool"}),disableHoverListener:!u,disableTouchListener:!u,children:Object(A.jsx)(p.a,{variant:"h6",noWrap:!0,component:"div",sx:{mr:2,display:{xs:"none",md:"flex"},cursor:"pointer"},onClick:function(){return e.navClick("About")},children:"Score-Tool 2.0"})}),Object(A.jsxs)(g.a,{sx:{flexGrow:1,display:{xs:"flex",md:"none"}},children:[Object(A.jsx)(O.a,{size:"large","aria-label":"account of current user","aria-controls":"menu-appbar","aria-haspopup":"true",onClick:function(e){a(e.currentTarget)},color:"inherit",children:Object(A.jsx)(w.a,{})}),Object(A.jsx)(v.a,{id:"menu-appbar",anchorEl:s,anchorOrigin:{vertical:"bottom",horizontal:"left"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"left"},open:Boolean(s),onClose:y,sx:{display:{xs:"block",md:"none"}},children:D.map((function(e){return Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:e}),disableHoverListener:!u,children:Object(A.jsx)(S.a,{onClick:function(t){return y(e)},children:Object(A.jsx)(p.a,{textAlign:"center",children:e})},e)})}))})]}),Object(A.jsx)(p.a,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1,display:{xs:"flex",md:"none"}},children:"Score-Tool"}),Object(A.jsx)(g.a,{sx:{flexGrow:1,display:{xs:"none",md:"flex"}},children:D.map((function(e){return Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:e}),disableHoverListener:!u,children:Object(A.jsx)(k.a,{onClick:function(t){return y(e)},sx:{my:2,display:"block",color:"black"},children:e},e)})}))}),Object(A.jsxs)(g.a,{sx:{flexGrow:0},children:[Object(A.jsx)(_.a,{title:"Toggle help",children:Object(A.jsxs)(O.a,{onClick:function(e){return y("Help")},sx:{p:0},children:[Object(A.jsx)(I.a,{}),u?"on":"off"]})}),Object(A.jsxs)(v.a,{sx:{mt:"45px"},id:"menu-appbar",anchorEl:c,anchorOrigin:{vertical:"top",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:Boolean(c),onClose:T,children:[Object(A.jsx)(S.a,{onClick:function(e){return y("About")},children:Object(A.jsx)(p.a,{textAlign:"center",children:"About Score-Tool"})},"About Score-Tool"),Object(A.jsx)(S.a,{onClick:function(e){return y("Help")},children:Object(A.jsx)(p.a,{textAlign:"center",children:u?"Disable help":"Enable help"})},"Enable help")]})]})]})})})})}var z=r(19),E=r(39),H=r(338);function R(e){var t=n.useState({measureRange:[1,2],maxMeasure:2}),r=Object(b.a)(t,2),s=r[0],a=r[1];n.useEffect((function(){a((function(t){return Object(u.a)(Object(u.a)({},t),{},{measureRange:e.range,maxMeasure:e.max})}))}),[e]);return Object(A.jsx)(H.a,{style:e.style,value:s.measureRange,min:1,max:s.maxMeasure,step:1,marks:!0,onChange:function(e,t,r){if(Array.isArray(t)){var n=t;a((function(e){return Object(u.a)(Object(u.a)({},e),{},{measureRange:n})}))}},onChangeCommitted:e.measureHandleChange,valueLabelDisplay:"auto",disableSwap:!0})}var F=r(335),V=r(341),W=r(351),G=r(361),B=r(362),U=r(339),K=r(340),J=r(363),q=r(364),X=r(187),Y=r.n(X),Q=r(36),$=r.n(Q),Z=r(148),ee={alto_flute:["normal"],alto_sax:["normal"],baritone_generic:["normal"],bassoon:["normal"],bass_cl:["normal"],bass_flute:["normal"],bass_trombone:["normal"],cello:["harmonics","normal","pizz","pizz_harmonics","sord","sord_trem","trem"],clarinet:["normal"],clarinet_eb:["normal"],crotale:["normal"],cymbal:["13crash_bell","13crash_bow","13crash_chokecrash","13crash_mallet","13crash_normal","13crash_roll","13crash_shoulder","16chinese_bell","16chinese_bow","16chinese_chokecrash","16chinese_mallet","16chinese_normal","16chinese_roll","16chinese_shoulder","17crash_bell","17crash_bow","17crash_chokecrash","17crash_mallet","17crash_normal","17crash_roll","17crash_shoulder","17orchcrash","18crash_bell","18crash_bow","18crash_chokecrash","18crash_mallet","18crash_normal","18crash_roll","18crash_shoulder","18orchcrash_french","18orchcrash_germanic","18orchcrash_viennese","19chinese_bell","19chinese_bow","19chinese_chokecrash","19chinese_mallet","19chinese_normal","19chinese_roll","19chinese_shoulder","20chinese_bell","20chinese_bow","20chinese_chokecrash","20chinese_mallet","20chinese_normal","20chinese_roll","20chinese_shoulder","20crash_bell","20crash_bow","20crash_chokecrash","20crash_mallet","20crash_normal","20crash_roll","20crash_shoulder","21ride_bell","21ride_mallet","21ride_normal","21ride_roll","21ride_shoulder","hihat_bell","hihat_footclose","hihat_footsplash","hihat_normal","hihat_shoulder","normal","smallmetals","splash_bell","splash_mallet","splash_roll","splash_splash","windgong","windgong_bow"],double_bass:["harmonics","normal","pizz","pizz_harmonics","trem"],english_horn:["normal"],flute:["normal","vib"],guitar:["normal","normal_sulA","normal_sulB","normal_sulD","normal_sulE","normal_sulG","normal_sul_E"],harp:["normal"],horn:["normal"],oboe:["normal"],percussion_misc:["castanet","guiro_away","guiro_toward","shakers"],piano:["normal"],piccolo:["normal"],solo_cello:["arco_sulA","arco_sulC","arco_sulD","arco_sulG","normal"],solo_double_bass:["arco_sulA","arco_sulD","arco_sulE","arco_sulG","normal","pizz","pizz_sulA","pizz_sulD","pizz_sulE","pizz_sulG"],solo_viola:["arco_sulA","arco_sulC","arco_sulD","arco_sulG","normal"],solo_violin:["arco_sulA","arco_sulD","arco_sulE","arco_sulG","normal"],soprano_generic:["normal"],soprano_sax:["normal","normal_Vib"],tambourine:["normal","normal_fingerroll","normal_sforzando","normal_shakeroll","normal_thumbroll"],tamtam:["bow","normal"],tamtam_22:["bow","normal"],tamtam_40:["bow","normal"],tenor_generic:["normal"],thaigong:["normal"],triangle_6:["normal","normal_roll"],triangle_8:["normal","normal_roll"],trumpet:["normal","vib"],tuba:["normal"],vibraphone:["normal","normal_bow"],viola:["harmonics","normal","pizz","sord","sord_trem","trem"],violin:["harmonics","normal","pizz","sord","sord_trem","tremolo"],woodblock:["clave","graniteblock","normal"],xylophone:["gliss_down","gliss_up","normal","normal_hardrubber"],tenor_trombone:["normal"],timp:["normal"]},te={alto_flute:{normal:{f:[55,92],mf:[54,92],p:[54,80]}},alto_sax:{normal:{f:[48,81],mf:[48,81],p:[48,81]}},baritone_generic:{normal:{f:[30,66],mf:[30,66],p:[30,66]}},bassoon:{normal:{f:[33,75],mf:[33,75],p:[33,75]}},bass_cl:{normal:{f:[36,83],mf:[36,83],p:[36,83]}},bass_flute:{normal:{f:[47,86],mf:[47,83],p:[47,77]}},bass_trombone:{normal:{f:[24,66],mf:[24,68],p:[23,71]}},cello:{harmonics:{f:[36,72],mf:[36,72],p:[36,72]},normal:{f:[36,74],mf:[36,74],p:[36,74]},pizz:{f:[35,67],mf:[35,67],p:[35,67]},pizz_harmonics:{f:[47,70],mf:[47,70],p:[47,70]},sord:{f:[36,74],mf:[36,74],p:[36,74]},sord_trem:{f:[35,73],mf:[35,73],p:[35,73]},trem:{f:[36,74],mf:[36,74],p:[36,74]}},clarinet:{normal:{f:[49,95],mf:[49,96],p:[49,95]}},clarinet_eb:{normal:{f:[54,94],mf:[54,96],p:[54,93]}},crotale:{normal:{f:[83,108],p:[83,108]}},cymbal:{"13crash_bell":{f:[60,60],mf:[60,60],p:[60,60]},"13crash_bow":{mf:[60,60]},"13crash_chokecrash":{mf:[60,60]},"13crash_mallet":{f:[60,60],mf:[60,60],p:[60,60]},"13crash_normal":{f:[60,60],mf:[60,60],p:[60,60]},"13crash_roll":{mf:[60,60]},"13crash_shoulder":{f:[60,60],mf:[60,60],p:[60,60]},"16chinese_bell":{f:[60,60],mf:[60,60],p:[60,60]},"16chinese_bow":{mf:[60,60]},"16chinese_chokecrash":{mf:[60,60]},"16chinese_mallet":{f:[60,60],mf:[60,60],p:[60,60]},"16chinese_normal":{f:[60,60],mf:[60,60],p:[60,60]},"16chinese_roll":{mf:[60,60]},"16chinese_shoulder":{f:[60,60],mf:[60,60],p:[60,60]},"17crash_bell":{f:[60,60],mf:[60,60],p:[60,60]},"17crash_bow":{mf:[60,60]},"17crash_chokecrash":{mf:[60,60]},"17crash_mallet":{f:[60,60],mf:[60,60],p:[60,60]},"17crash_normal":{f:[60,60],mf:[60,60],p:[60,60]},"17crash_roll":{mf:[60,60]},"17crash_shoulder":{f:[60,60],mf:[60,60],p:[60,60]},"17orchcrash":{f:[60,60],mf:[60,60],p:[60,60]},"18crash_bell":{f:[60,60]},"18crash_bow":{mf:[60,60]},"18crash_chokecrash":{mf:[60,60]},"18crash_mallet":{f:[60,60],mf:[60,60],p:[60,60]},"18crash_normal":{f:[60,60],mf:[60,60],p:[60,60]},"18crash_roll":{mf:[60,60]},"18crash_shoulder":{f:[60,60],mf:[60,60],p:[60,60]},"18orchcrash_french":{f:[60,60],mf:[60,60],p:[60,60]},"18orchcrash_germanic":{f:[60,60],mf:[60,60],p:[60,60]},"18orchcrash_viennese":{f:[60,60],mf:[60,60],p:[60,60]},"19chinese_bell":{f:[60,60],mf:[60,60],p:[60,60]},"19chinese_bow":{mf:[60,60]},"19chinese_chokecrash":{mf:[60,60]},"19chinese_mallet":{f:[60,60],mf:[60,60],p:[60,60]},"19chinese_normal":{f:[60,60],mf:[60,60],p:[60,60]},"19chinese_roll":{mf:[60,60]},"19chinese_shoulder":{f:[60,60],mf:[60,60],p:[60,60]},"20chinese_bell":{f:[60,60],mf:[60,60],p:[60,60]},"20chinese_bow":{mf:[60,60]},"20chinese_chokecrash":{mf:[60,60]},"20chinese_mallet":{f:[60,60],mf:[60,60],p:[60,60]},"20chinese_normal":{f:[60,60],mf:[60,60],p:[60,60]},"20chinese_roll":{mf:[60,60]},"20chinese_shoulder":{f:[60,60],mf:[60,60],p:[60,60]},"20crash_bell":{f:[60,60],mf:[60,60],p:[60,60]},"20crash_bow":{mf:[60,60]},"20crash_chokecrash":{mf:[60,60]},"20crash_mallet":{f:[60,60],mf:[60,60],p:[60,60]},"20crash_normal":{f:[60,60],mf:[60,60],p:[60,60]},"20crash_roll":{mf:[60,60]},"20crash_shoulder":{f:[60,60],mf:[60,60],p:[60,60]},"21ride_bell":{f:[60,60],mf:[60,60],p:[60,60]},"21ride_mallet":{f:[60,60],mf:[60,60],p:[60,60]},"21ride_normal":{f:[60,60],mf:[60,60],p:[60,60]},"21ride_roll":{mf:[60,60]},"21ride_shoulder":{f:[60,60],mf:[60,60],p:[60,60]},hihat_bell:{f:[60,60],mf:[60,60],p:[60,60]},hihat_footclose:{f:[60,60],mf:[60,60],p:[60,60]},hihat_footsplash:{f:[60,60],mf:[60,60],p:[60,60]},hihat_normal:{f:[60,60],mf:[60,60],p:[60,60]},hihat_shoulder:{f:[60,60],mf:[60,60],p:[60,60]},normal:{f:[60,60],mf:[60,60],p:[60,60]},smallmetals:{mf:[60,60]},splash_bell:{f:[60,60],mf:[60,60],p:[60,60]},splash_mallet:{f:[60,60],mf:[60,60],p:[60,60]},splash_roll:{mf:[60,60]},splash_splash:{f:[60,60],mf:[60,60],p:[60,60]},windgong:{f:[60,60],mf:[60,60],p:[60,60]},windgong_bow:{mf:[60,60]}},double_bass:{harmonics:{f:[39,72],mf:[39,72],p:[39,72]},normal:{f:[22,61],mf:[22,61],p:[22,61]},pizz:{f:[28,51],mf:[28,51],p:[28,51]},pizz_harmonics:{f:[39,63],mf:[39,63],p:[39,63]},trem:{f:[23,61],mf:[23,61],p:[23,61]}},english_horn:{normal:{f:[51,84],mf:[51,84],p:[51,84]}},flute:{normal:{f:[58,97],mf:[58,96],p:[58,95]},vib:{f:[58,97],mf:[58,97],p:[58,95]}},guitar:{normal:{f:[39,84],mf:[39,85],p:[38,85]},normal_sulA:{f:[43,66],mf:[43,66],p:[43,66]},normal_sulB:{f:[57,80],mf:[57,80],p:[57,80]},normal_sulD:{f:[48,70],mf:[48,70],p:[48,70]},normal_sulE:{f:[38,61],mf:[38,61],p:[38,61]},normal_sulG:{f:[53,75],mf:[53,75],p:[53,75]},normal_sul_E:{f:[62,84],mf:[62,85],p:[62,85]}},harp:{normal:{f:[17,90],mf:[19,90],p:[17,90]}},horn:{normal:{f:[32,79],mf:[32,79],p:[32,78]}},oboe:{normal:{f:[57,93],mf:[57,93],p:[57,92]}},percussion_misc:{castanet:{f:[60,60],mf:[60,60],p:[60,60]},guiro_away:{f:[60,60],mf:[60,60],p:[60,60]},guiro_toward:{f:[60,60],mf:[60,60]},shakers:{mf:[60,60]}},piano:{normal:{f:[20,108],mf:[22,108],p:[21,108]}},piccolo:{normal:{f:[74,109],mf:[74,109],p:[74,109]}},solo_cello:{arco_sulA:{f:[56,83],mf:[56,82],p:[56,84]},arco_sulC:{f:[35,61],mf:[35,62],p:[35,62]},arco_sulD:{f:[49,75],mf:[49,75],p:[49,75]},arco_sulG:{f:[42,69],mf:[42,68],p:[42,68]},normal:{f:[35,83],mf:[35,82],p:[35,83]}},solo_double_bass:{arco_sulA:{f:[32,58],mf:[32,58],p:[32,58]},arco_sulD:{f:[37,63],mf:[37,63],p:[37,63]},arco_sulE:{f:[27,51],mf:[27,51],p:[27,51]},arco_sulG:{f:[42,68],mf:[42,60],p:[42,68]},normal:{f:[27,68],mf:[27,68],p:[27,68]},pizz:{f:[27,68],mf:[27,68],p:[27,68]},pizz_sulA:{f:[32,58],mf:[32,58],p:[32,58]},pizz_sulD:{f:[37,63],mf:[37,63],p:[37,63]},pizz_sulE:{f:[27,53],mf:[27,53],p:[27,53]},pizz_sulG:{f:[42,68],mf:[42,68],p:[42,68]}},solo_viola:{arco_sulA:{f:[68,93],mf:[68,93],p:[68,92]},arco_sulC:{f:[47,72],mf:[47,72],p:[47,73]},arco_sulD:{f:[61,87],mf:[61,86],p:[61,84]},arco_sulG:{f:[54,81],mf:[54,79],p:[54,79]},normal:{f:[47,93],mf:[47,93],p:[47,91]}},solo_violin:{arco_sulA:{f:[68,92],mf:[68,93],p:[68,93]},arco_sulD:{f:[61,87],mf:[61,87],p:[61,85]},arco_sulE:{f:[75,108],mf:[75,105],p:[75,107]},arco_sulG:{f:[54,79],mf:[54,80],p:[54,78]},normal:{f:[54,108],mf:[54,105],p:[54,107]}},soprano_generic:{normal:{f:[59,82],mf:[59,82],p:[65,87]}},soprano_sax:{normal:{f:[55,88],mf:[55,88],p:[55,88]},normal_Vib:{f:[55,88],mf:[55,88],p:[55,88]}},tambourine:{normal:{f:[60,60],mf:[60,60],p:[60,60]},normal_fingerroll:{f:[60,60],mf:[60,60],p:[60,60]},normal_sforzando:{mf:[60,60]},normal_shakeroll:{f:[60,60],mf:[60,60],p:[60,60]},normal_thumbroll:{f:[60,60],mf:[60,60],p:[60,60]}},tamtam:{bow:{mf:[60,60]},normal:{f:[60,60],mf:[60,60],p:[60,60]}},tamtam_22:{bow:{mf:[60,60]},normal:{f:[60,60],mf:[60,60],p:[60,60]}},tamtam_40:{bow:{mf:[60,60]},normal:{f:[60,60],mf:[60,60],p:[60,60]}},TenorTrombone:{normal:{f:[39,73],mf:[39,73],p:[39,73]}},tenor_generic:{normal:{f:[49,72],mf:[49,72],p:[49,71]}},thaigong:{normal:{f:[59,73],mf:[59,73],p:[59,73]}},triangle_6:{normal:{f:[60,60],mf:[60,60],p:[60,60]},normal_roll:{f:[60,60],mf:[60,60],p:[60,60]}},triangle_8:{normal:{f:[60,60],mf:[60,60],p:[60,60]},normal_roll:{f:[60,60],mf:[60,60],p:[60,60]}},trumpet:{normal:{f:[51,88],mf:[51,87],p:[51,88]},vib:{f:[51,87],mf:[51,87],p:[51,87]}},tuba:{normal:{f:[23,61],mf:[23,61],p:[23,61]}},vibraphone:{normal:{f:[47,91],mf:[47,90],p:[47,90]},normal_bow:{mf:[47,90]}},viola:{harmonics:{f:[66,88],mf:[66,88],p:[66,88]},normal:{f:[48,86],mf:[48,86],p:[48,86]},pizz:{f:[47,85],mf:[47,85],p:[47,85]},sord:{f:[48,86],mf:[48,86],p:[48,86]},sord_trem:{f:[47,85],mf:[47,85],p:[47,85]},trem:{f:[47,85],mf:[47,85],p:[47,85]}},violin:{harmonics:{f:[66,104],mf:[66,104],p:[66,104]},normal:{f:[54,97],mf:[55,96],p:[55,96]},pizz:{f:[54,96],mf:[54,96],p:[54,96]},sord:{f:[55,93],mf:[55,93],p:[55,93]},sord_trem:{f:[55,96],mf:[55,96],p:[55,96]},tremolo:{f:[54,96],mf:[54,96],p:[55,96]}},woodblock:{clave:{f:[60,60],mf:[60,60],p:[60,60]},graniteblock:{f:[60,60],mf:[60,60],p:[60,60]},normal:{f:[60,60],mf:[60,60],p:[60,60]}},xylophone:{gliss_down:{mf:[59,60]},gliss_up:{mf:[60,60]},normal:{f:[64,108],mf:[64,108],p:[64,108]},normal_hardrubber:{f:[64,108],mf:[64,108],p:[64,108]}},tenor_trombone:{normal:{f:[39,73],mf:[39,73],p:[39,73]}},timp:{normal:{f:[37,61],mf:[37,61],p:[37,57]}}},re=r(346),ne=r(342),se=r(330),ae=r(75),oe=r.n(ae),ie=r(91),ce=ie.a.Flow,le=function(e){Object(h.a)(r,e);var t=Object(d.a)(r);function r(e){var n;return Object(i.a)(this,r),(n=t.call(this,e)).notes=0,n.target=0,n.instruments=0,n.renderer=0,n.context=0,n.scale=1,n.state={x:0,y:0},n}return Object(c.a)(r,[{key:"setupScore",value:function(){var e=document.createElement("div"),t=this.props,r=(t.id,t.notes),n=t.target,s=t.instruments,a=(t.setProps,t.width),o=t.height,i=t.t_score_y,c=t.b_score_y,l=t.target_color,h=t.text_space,d=t.highlights,u=t.indexing,f=t.scale;this.notes=r,this.target=n,this.instruments=s,this.scale=f,this.renderer=new ce.Renderer(e,ce.Renderer.Backends.SVG),this.renderer.resize(a+h,o);var b=this.renderer.getContext();this.context=b,this.context.scale(this.scale,this.scale);var j=new ce.Stave(20,i,a);j.addClef("treble"),j.setContext(this.context).draw();var p=new ce.Stave(20,c,a);p.addClef("bass"),p.setContext(this.context).draw();var m=function(e,t,r){var n,s,a,o,i,c,l,h=[],f=[],b=[],j=[],p=[],m=[],g=[],x=[],O=[],v=[],y=[],w=[],C=[],k=[],_=[];for(n=0;n<e.length;n++){i=e[n],l=u?n+": "+t[n]:t[n];var S="";if("undefined"!==typeof d[n]&&(S=d[n]),s=i[0],a=i[i.length-1],o=i.length>2?i[1]:"n",c=s.concat("/",a),T=r[n],parseInt(a)>=4&&parseInt(a)<6){h.push(c),f.push(o),j.push(l),p.push(S);for(var T=0,I=0;I<r.length;I++)r[I]===n&&(T=1);b.push(T)}else if(parseInt(a)>=6){a-=2,c=s.concat("/",a),y.push(c),w.push(o),k.push(l),_.push(S);for(T=0,I=0;I<r.length;I++)r[I]===n&&(T=1);C.push(T)}else{m.push(c),g.push(o),O.push(l),v.push(S);for(T=0,I=0;I<r.length;I++)r[I]===n&&(T=1);x.push(T)}}return[h,f,b,m,g,x,j,O,p,v,y,w,C,k,_]}(this.notes,this.instruments,this.target);if(Array.isArray(m[10])&&m[10].length){var g=new ce.Stave(20,40,a);g.addClef("treble"),g.setContext(this.context).draw(),this.context.fillText("15ma",g.x+6,g.y+26);for(var x=[],O=0;O<m[10].length;O++)x.push("c/4");var v=new ce.StaveNote({clef:"treble",keys:x,duration:"q"});v.setStemStyle({strokeStyle:"none"}),v.setLedgerLineStyle({strokeStyle:"none"});for(O=0;O<m[10].length;O++)v.setKeyLine(O,O-1.5);var y=new ce.StaveNote({clef:"treble",keys:m[10],duration:"q"}),w=m[13],C=m[14];for(O=0;O<m[11].length;O++){"n"!==m[11][O]&&y.addAccidental(O,new ce.Accidental(m[11][O]));var k=H(w[O],ce.Modifier.Position.RIGHT);k.setOffsetX(-10),v.note_heads[O].glyph_code="v23",v.addModifier(O,k),C[O]&&y.setKeyStyle(O,{shadowColor:C[O],shadowBlur:100}),1===m[12][O]&&(y.setKeyStyle(O,{fillStyle:l}),v.setKeyStyle(O,{fillStyle:l}))}var _=new ce.StaveConnector(g,p),S=new ce.StaveConnector(g,p)}else _=new ce.StaveConnector(j,p),S=new ce.StaveConnector(j,p);_.setType(ce.StaveConnector.type.SINGLE_LEFT),_.setContext(this.context),_.draw(),S.setType(ce.StaveConnector.type.BRACKET),S.setContext(this.context),S.draw();var T=[];for(O=0;O<m[0].length;O++)T.push("c/4");var I=new ce.StaveNote({clef:"treble",keys:T,duration:"q"});I.setStemStyle({strokeStyle:"none"}),I.setLedgerLineStyle({strokeStyle:"none"});for(O=0;O<m[0].length;O++)I.setKeyLine(O,O-1.5);var N=[];for(O=0;O<m[3].length;O++)N.push("c/3");var L=new ce.StaveNote({clef:"bass",keys:N,duration:"q"});L.setStemStyle({strokeStyle:"none"}),L.setLedgerLineStyle({strokeStyle:"none"});for(O=0;O<m[3].length;O++)L.setKeyLine(O,O-1.5);var A=new ce.StaveNote({clef:"treble",keys:m[0],duration:"q"}),M=new ce.StaveNote({clef:"bass",keys:m[3],duration:"q"}),D=m[6],P=m[7],z=m[8],E=m[9];function H(e,t){return new ce.FretHandFinger(e).setPosition(t)}for(O=0;O<m[1].length;O++){"n"!==m[1][O]&&A.addAccidental(O,new ce.Accidental(m[1][O]));var R=H(D[O],ce.Modifier.Position.RIGHT);R.setOffsetX(-10),I.note_heads[O].glyph_code="v23",I.addModifier(O,R),z[O]&&A.setKeyStyle(O,{shadowColor:z[O],shadowBlur:100}),1===m[2][O]&&(A.setKeyStyle(O,{fillStyle:l}),I.setKeyStyle(O,{fillStyle:l}))}for(O=0;O<m[3].length;O++){"n"!==m[4][O]&&M.addAccidental(O,new ce.Accidental(m[4][O]));var F=H(P[O],ce.Modifier.Position.RIGHT);F.setOffsetX(-10),L.note_heads[O].glyph_code="v23",L.addModifier(O,F),E[O]&&M.setKeyStyle(O,{shadowColor:E[O],shadowBlur:100}),1===m[5][O]&&(M.setKeyStyle(O,{fillStyle:l}),L.setKeyStyle(O,{fillStyle:l}))}if(Array.isArray(m[0])&&m[0].length){var V=new ce.Voice({num_beats:1,beat_value:4}).setMode(2),W=new ce.Voice({num_beats:1,beat_value:4}).setMode(2);V.addTickables([A]),W.addTickables([I]);(new ce.Formatter).joinVoices([V]).format([V],a);(new ce.Formatter).joinVoices([W]).format([W],a).tickContexts.array[0].x=a-40,V.draw(this.context,j),W.draw(this.context,j)}var G=new ce.Voice({num_beats:1,beat_value:4}),B=new ce.Voice({num_beats:1,beat_value:4});if(B.addTickables([L]),Array.isArray(m[3])&&m[3].length){G.addTickables([M]);(new ce.Formatter).joinVoices([G]).format([G],a);(new ce.Formatter).joinVoices([B]).format([B],a).tickContexts.array[0].x=a-40,G.draw(this.context,p),B.draw(this.context,p)}if(Array.isArray(m[10])&&m[10].length){var U=new ce.Voice({num_beats:1,beat_value:4}).setMode(2),K=new ce.Voice({num_beats:1,beat_value:4}).setMode(2);U.addTickables([y]),K.addTickables([v]);(new ce.Formatter).joinVoices([U]).format([U],a);(new ce.Formatter).joinVoices([K]).format([K],a).tickContexts.array[0].x=a-40,U.draw(this.context,g),K.draw(this.context,g);var J=[];for(O=0;O<x.length;O++){var q=new ce.StaveLine({first_note:y,last_note:v,first_indices:[O],last_indices:[O]});q.render_options.line_width=3,q.render_options.padding_right=-4,C[O]&&(q.render_options.color=C[O]),1===m[12][O]&&(q.render_options.color=l),J.push(q)}for(var X=0;X<J.length;X++)J[X].setContext(b),J[X].draw()}var Y=[];for(O=0;O<T.length;O++){var Q=new ce.StaveLine({first_note:A,last_note:I,first_indices:[O],last_indices:[O]});Q.render_options.line_width=3,Q.render_options.padding_right=-4,z[O]&&(Q.render_options.color=z[O]),1===m[2][O]&&(Q.render_options.color=l),Y.push(Q)}var $=[];for(O=0;O<N.length;O++){var Z=new ce.StaveLine({first_note:M,last_note:L,first_indices:[O],last_indices:[O]});Z.render_options.line_width=3,Z.render_options.padding_right=-4,E[O]&&(Z.render_options.color=E[O]),1===m[5][O]&&(Z.render_options.color=l),$.push(Z)}for(X=0;X<Y.length;X++)Y[X].setContext(b),Y[X].draw();for(X=0;X<$.length;X++)$[X].setContext(b),$[X].draw();this.refs.outer.appendChild(e),this.refs.outer.addEventListener("click",this.orchClick.bind(this),!1)}},{key:"orchClick",value:function(e){var t=this.props,r=t.setProps,n=t.indexing;if(e.target.closest("text")&&n){var s=e.target.innerHTML.split(":"),a=parseInt(s[0]);r&&r({onClick:a}),console.log(a)}}},{key:"componentDidMount",value:function(){this.setupScore()}},{key:"componentDidUpdate",value:function(e){for(var t=this.refs.outer;t.hasChildNodes();)t.removeChild(t.lastChild);this.setupScore()}},{key:"render",value:function(){var e=this.props,t=e.id;e.notes,e.instruments,e.target;return Object(A.jsx)("div",{id:t,ref:"outer",style:{border:"none",padding:0,borderRadius:0,display:"inline-block"}})}}]),r}(n.Component);le.defaultProps={width:200,height:400,t_score_y:110,b_score_y:200,text_space:120,target_color:"red",highlights:[],indexing:!0};var he=ie.a.Flow,de=function(e){Object(h.a)(r,e);var t=Object(d.a)(r);function r(e){var n;return Object(i.a)(this,r),(n=t.call(this,e)).state={x:0,y:0},n}return Object(c.a)(r,[{key:"setupScore",value:function(){var e=document.createElement("div"),t=this.props,r=(t.id,t.masking_notevalues),n=t.masking_notesizes,s=t.masking_colors,a=t.target_notevalues,o=t.target_notesizes,i=t.target_colors,c=(t.setProps,new he.Renderer(e,he.Renderer.Backends.SVG));c.resize(100,250);var l=c.getContext(),h=new he.Stave(10,60,100);h.addClef("treble"),h.setContext(l).draw();var d=new he.Stave(10,120,100);d.addClef("bass"),d.setContext(l).draw();var u=new he.StaveConnector(h,d);u.setType(he.StaveConnector.type.SINGLE_LEFT),u.setContext(l),u.draw();var f=new he.StaveConnector(h,d);f.setType(he.StaveConnector.type.BRACKET),f.setContext(l),f.draw();for(var b=[],j=[],p=[],m=[],g=[],x=[],O=0;O<r.length;O++)r[O]>59?(b.push(r[O]),j.push(n[O]),p.push(s[O])):(m.push(r[O]),g.push(n[O]),x.push(s[O]));var v=[],y=[],w=[],C=[],k=[],_=[];for(O=0;O<a.length;O++)a[O]>59?(v.push(a[O]),y.push(o[O]),w.push(i[O])):(C.push(a[O]),k.push(o[O]),_.push(i[O]));var S=new Array,T=new Array,I=new Array,N=new Array;function L(e,t){var r=0;return 40===t&&(r=-1),(e=(e-t)/4)>1+r&&(e+=.25),e>3+r&&(e+=.25),e>4.5+r&&(e+=.25),e>6.5+r&&(e+=.25),e>8+r&&(e+=.25),e>10+r&&(e+=.25),e>13.5+r&&(e+=.25),e>15.5+r&&(e+=.25),e}var A=[];if(Array.isArray(m)&&m.length){for(O=0;O<m.length;O++){var M=L(m[O],40);(E=new he.NoteHead({duration:"128",line:M,custom_glyph_code:"vd2",glyph_font_scale:g[O],style:{fillStyle:"none"}})).setCenterAlignment(!0),T.push(E)}var D=new he.Voice({num_beats:1,beat_value:1}).setMode(2);D.addTickables(T);(new he.Formatter).joinVoices([D]).format([D],1);D.draw(l,d)}if(Array.isArray(b)&&b.length){for(O=0;O<b.length;O++){M=L(b[O],60);(E=new he.NoteHead({duration:"128",line:M,custom_glyph_code:"vd2",glyph_font_scale:j[O],style:{fillStyle:"none"}})).setCenterAlignment(!0),S.push(E)}var P=new he.Voice({num_beats:1,beat_value:1}).setMode(2);P.addTickables(S);(new he.Formatter).joinVoices([P]).format([P],1);P.draw(l,h)}if(Array.isArray(v)&&v.length){I.push(new he.GhostNote("q"));for(O=0;O<v.length;O++){M=L(v[O],60);(E=new he.NoteHead({duration:"128",displaced:!1,line:M,custom_glyph_code:"vb",glyph_font_scale:y[O],style:{fillStyle:w[O]}})).setCenterAlignment(!0),I.push(E)}var z=new he.Voice({num_beats:1,beat_value:1}).setMode(2);z.addTickables(I);(new he.Formatter).joinVoices([z]).format([z],10);z.draw(l,h)}if(Array.isArray(C)&&C.length){N.push(new he.GhostNote("q"));for(O=0;O<C.length;O++){var E;M=L(C[O],60);(E=new he.NoteHead({duration:"128",displaced:!1,line:M,custom_glyph_code:"vb",glyph_font_scale:k[O],style:{fillStyle:_[O]}})).setCenterAlignment(!0),N.push(E)}var H=new he.Voice({num_beats:1,beat_value:1}).setMode(2);H.addTickables(N);(new he.Formatter).joinVoices([H]).format([H],10);H.draw(l,h)}if(Array.isArray(m)&&m.length)for(O=0;O<m.length;O++)A.push(D.tickables[O].y);if(Array.isArray(b)&&b.length)for(O=0;O<b.length;O++)A.push(P.tickables[O].y);for(var R=0;R<A.length-1;R++)l.beginPath().moveTo(40,A[R]).lineTo(90,A[R]).lineTo(90,A[R+1]).lineTo(40,A[R+1]).closePath().fill({fill:s[R]});l.beginPath().closePath(),this.refs.outer2.appendChild(e)}},{key:"componentDidMount",value:function(){this.setupScore()}},{key:"componentDidUpdate",value:function(e){for(var t=this.refs.outer2;t.hasChildNodes();)t.removeChild(t.lastChild);this.setupScore()}},{key:"render",value:function(){var e=this.props.id;return Object(A.jsx)("div",{id:e,ref:"outer2",style:{border:"none",padding:0,borderRadius:0,display:"inline-block"}})}}]),r}(n.Component);de.defaultProps={};var ue=r(344),fe=r(12),be=r(348),je=Object(fe.a)(be.a)((function(e){var t=e.theme;return Object(u.a)(Object(u.a)({},t.typography.body2),{},{backgroundColor:"#fffef0",padding:t.spacing(1),textAlign:"center",color:t.palette.text.secondary})}));function pe(e){var t=["C","C#","D","D#","E","F","F#","G","G#","A","B#","B"];if(e.data.length<2)return null;var r=[{domain:{x:[0,1],y:[0,1]},value:e.data[2].var_coeff_graph,title:{text:"Orch. timbre homogeneity"},type:"indicator",mode:"gauge+number",gauge:{axis:{range:[null,100]}}}],n=e.data[2].fig_config,s=e.data[2].msking_graph.data,a=e.data[2].msking_graph.layout;return a.width=window.innerWidth-380,Object(A.jsxs)("div",{children:[Object(A.jsxs)(ue.a,{style:{marginTop:.5},container:!0,direction:"row",justifyContent:"center",alignItems:"center",spacing:.5,children:[Object(A.jsx)(ue.a,{item:!0,xs:12,md:6,children:Object(A.jsx)(_.a,{followCursor:!0,title:Object(A.jsx)(j,{help:"Orchestration"}),disableHoverListener:!e.help,sx:{zIndex:99999},children:Object(A.jsxs)(je,{style:{height:452,backgroundColor:"#fffef0"},children:[Object(A.jsx)(p.a,{children:"Orchestration at clicked point"}),Object(A.jsx)("div",{style:{backgroundColor:"rgba(0,255,0,0.3)",display:"inline"},children:"Target"}),Object(A.jsx)("div",{style:{backgroundColor:"rgba(255,0,0,0.5)",display:"inline"},children:" Heaviest masker"}),Object(A.jsx)("div",{style:{backgroundColor:"rgba(255,0,255,0.5)",display:"inline"},children:" 2nd masker"}),Object(A.jsx)("div",{style:{backgroundColor:"rgba(255,255,0,0.5)",display:"inline"},children:" 3rd masker "}),Object(A.jsx)(le,{notes:e.data[4].notenumbers.map((function(e){return function(e){var r=e-Math.floor(e),n=Math.round(e),s=t[n%12];return r>=.2&&r<.5?/[#]/.test(s)?s=t[(n+1)%12]+"d":s+="+":r>=.5&&r<=.8&&(/[#]/.test(s)?s=t[(n-1)%12]+"+":s+="d"),s+(Math.floor(n/12)-1)}(e)})),instruments:e.data[4].instruments,target:e.data[4].target,target_color:"green",highlights:e.data[4].highlights,width:200,text_space:200})]})})}),Object(A.jsx)(ue.a,{item:!0,xs:12,md:6,children:Object(A.jsx)(_.a,{followCursor:!0,title:Object(A.jsx)(j,{help:"Centroid"}),disableHoverListener:!e.help,sx:{zIndex:99999},children:Object(A.jsxs)(je,{style:{height:452,backgroundColor:"#fffef0"},children:[Object(A.jsx)(p.a,{children:"Spectral centroid at clicked point"}),Object(A.jsx)(le,{notes:e.data[2].centroid_graph.notes,instruments:e.data[2].centroid_graph.markings,target:[],width:150,text_space:200})]})})})]}),Object(A.jsxs)(ue.a,{style:{marginTop:.5},container:!0,direction:"row",justifyContent:"center",alignItems:"center",spacing:.5,children:[Object(A.jsx)(ue.a,{item:!0,xs:12,md:6,children:Object(A.jsx)(_.a,{followCursor:!0,title:Object(A.jsx)(j,{help:"Distance"}),disableHoverListener:!e.help,sx:{zIndex:99999},children:Object(A.jsxs)(je,{style:{height:452,backgroundColor:"#fffef0"},children:[Object(A.jsx)(p.a,{children:"Timbre distance data"}),Object(A.jsxs)(p.a,{children:["Target timbre distance from orchestration: ",e.data[2].distance_graph,"/100"]}),Object(A.jsx)(oe.a,{data:r,layout:{width:350,margin:{t:0,b:0},plot_bgcolor:"#fffef0",paper_bgcolor:"#fffef0"},config:n})]})})}),Object(A.jsx)(ue.a,{item:!0,xs:12,md:6,children:Object(A.jsx)(_.a,{followCursor:!0,title:Object(A.jsx)(j,{help:"MaskStaff"}),disableHoverListener:!e.help,sx:{zIndex:99999},children:Object(A.jsxs)(je,{style:{height:452,backgroundColor:"#fffef0",verticalAlign:"center"},children:[Object(A.jsx)(p.a,{children:"Masking staff graph"}),Object(A.jsx)("br",{}),Object(A.jsx)("br",{}),Object(A.jsx)(de,{masking_notevalues:e.data[2].masking_score.masking_notevalues,masking_colors:e.data[2].masking_score.masking_colors,masking_notesizes:e.data[2].masking_score.masking_notesizes,target_notevalues:e.data[2].masking_score.target_notevalues,target_colors:e.data[2].masking_score.target_colors,target_notesizes:e.data[2].masking_score.target_notesizes})]})})})]}),Object(A.jsx)(ue.a,{style:{marginTop:.5,marginInline:0},container:!0,direction:"row",justifyContent:"left",alignItems:"left",spacing:.5,children:Object(A.jsx)(ue.a,{item:!0,xs:12,md:12,children:Object(A.jsx)(_.a,{followCursor:!0,title:Object(A.jsx)(j,{help:"MaskCurve"}),disableHoverListener:!e.help,sx:{zIndex:99999},children:Object(A.jsx)(je,{children:Object(A.jsx)(oe.a,{data:s,layout:Object(u.a)(Object(u.a)({},a),{},{width:window.innerWidth-50,margin:{l:0,r:0}}),config:n})})})})}),Object(A.jsxs)(ue.a,{style:{marginTop:.5},container:!0,direction:"row",justifyContent:"center",alignItems:"center",spacing:.5,children:[Object(A.jsx)(ue.a,{item:!0,xs:12,md:8,children:Object(A.jsx)(_.a,{followCursor:!0,title:Object(A.jsx)(j,{help:"Glyph"}),disableHoverListener:!e.help,sx:{zIndex:99999},children:Object(A.jsx)(je,{children:Object(A.jsx)(oe.a,{data:e.data[2].mfcc_graph.data,layout:Object(u.a)(Object(u.a)({},e.data[2].mfcc_graph.layout),{},{width:window.innerWidth/1.5-50,margin:{l:0,r:0},legend:{orientation:"h"}}),config:n,width:200})})})}),Object(A.jsx)(ue.a,{item:!0,xs:12,md:4,children:Object(A.jsx)(_.a,{followCursor:!0,title:Object(A.jsx)(j,{help:"Summary"}),disableHoverListener:!e.help,sx:{zIndex:99999},children:Object(A.jsxs)(je,{style:{height:452,backgroundColor:"#fffef0"},children:[Object(A.jsx)(p.a,{children:"Summary of the current orchestration"}),Object(A.jsx)("br",{}),Object(A.jsx)("br",{}),Object(A.jsx)(p.a,{children:e.data[2].summary})]})})})]})]})}var me=r(153),ge="https://rest.score-tool.com/";var xe=ge,Oe=xe;function ve(e){var t=function(e){var t=21,r={violin:2,viola:8,cello:11,double_bass:14,flute:15,oboe:16,clarinet:17,bassoon:18,horn:19,trumpet:22,tenor_trombone:23,bass_trombone:21,timpani:22,cymbal:24};return Object.keys(r).includes(e)&&(t=r[e]),t},r=[];e.instrumentList.map((function(e){return r.push(e[0])}));var s=[[10,50,3],[20,50,2],[30,50,1],[60,50,10],[70,50,11],[80,50,12],[15,35,6],[25,35,5],[40,40,4],[55,40,7],[65,35,8],[75,35,9],[86,35,13],[18,20,20],[32,20,19],[45,30,15],[50,30,16],[70,20,24],[80,20,14],[40,10,22],[50,10,21],[60,10,23],[45,20,17],[50,20,18],[45,55,25]],a=[];s.map((function(e){return a.push(!1)}));var o=n.useState({clicked:!1,over:!1,drop:"not yet",instrument_assignment:r.map((function(e){return t(e)})),hoverState:a,position:"audience",audio:"",play:!1}),i=Object(b.a)(o,2),c=i[0],l=i[1];if(n.useEffect((function(){l((function(e){return Object(u.a)(Object(u.a)({},e),{},{instrument_assignment:r.map((function(e){return t(e)}))})}))}),[e]),n.useEffect((function(){c.play&&document.getElementById("AUDIOPLAY").play()}),[]),0===e.instrumentList.length)return null;var h=function(e,t){if(console.log(e),t){var r=Object(z.a)(c.instrument_assignment);r[t.dragData.data]=e;var n=Object(z.a)(c.hoverState);n[e-1]=!1,l(Object(u.a)(Object(u.a)({},c),{},{instrument_assignment:r,hoverState:n}))}},d=function(e,t,r){var n=e+"%",s=t+"%";return Object(A.jsx)("div",{style:{left:n,position:"absolute",top:s},children:Object(A.jsx)(me.DropTarget,{onHit:function(e){return h(r,e)},targetKey:"foo",onDragEnter:function(e){return function(e,t){var r=Object(z.a)(c.hoverState);r[e]=!0,l(Object(u.a)(Object(u.a)({},c),{},{hoverState:r}))}(r-1)},onDragLeave:function(e){return function(e,t){var r=Object(z.a)(c.hoverState);r[e]=!1,l(Object(u.a)(Object(u.a)({},c),{},{hoverState:r}))}(r-1)},children:Object(A.jsxs)("h2",{style:{backgroundColor:"rgba(0,255,0,0.3)",borderRadius:"30px",padding:6},children:[r," ",c.hoverState[r-1]?"DROP HERE":""]})})})};return Object(A.jsxs)("div",{style:{maxWidth:800,textAlign:"center",margin:"auto",alignItems:"center"},children:[Object(A.jsx)("div",{style:{padding:20},children:"Here you can listen how your orchestration sounds like played with real instruments in Helsinki Music Center hall. The algorithm utilize pre-calculated impulse responses. Helsinki Musiikkitalo spatial impulse response measurements are done by Aalto University. They are used here with permission from Prof. Tapio Lokki, who has computed the binaural responses"}),Object(A.jsx)("div",{style:{marginTop:-20,padding:20},children:"Drag the instruments of your orchestration to the place on stage you want them to play. Select the listening position, selecting 'conductor' places you on the conductor podium and 'audience' to the center of row 6. When you are ready, tap 'listen' and wait for a few seconds for calculations."}),Object(A.jsx)(k.a,{onClick:function(){l(Object(u.a)(Object(u.a)({},c),{},{audio:""}));var t={orchestration:e.instrumentList.map((function(e){return e[0]+","+e[1]+","+e[2]+","+e[3]})),positions:c.instrument_assignment,listeningPosition:c.position};$.a.post(Oe+"listen",t,{headers:{auth:"uljasPulkkis"}}).then((function(e){var t=Object(A.jsx)("div",{children:Object(A.jsxs)("audio",{controls:!0,autoPlay:"true",id:"AUDIOPLAY",children:[" ",Object(A.jsx)("source",{src:e.data,type:"audio/x-wav"})," "]})});l(Object(u.a)(Object(u.a)({},c),{},{audio:t,play:!0}))})).catch((function(e){return console.log(e)}))},variant:"contained",children:"click here to calculate acoustics and listen"}),c.audio,Object(A.jsx)("div",{style:{display:"block"},children:Object(A.jsxs)(W.a,{sx:{m:1,minWidth:50},children:[Object(A.jsx)(V.a,{id:"listen-select",children:"Position"}),Object(A.jsxs)(F.a,{labelId:"listen-select",id:"listen-select",value:c.position,onChange:function(e){return l(Object(u.a)(Object(u.a)({},c),{},{position:e.target.value}))},autoWidth:!0,label:"listen-select",children:[Object(A.jsx)(S.a,{value:"audience",children:"audience"}),Object(A.jsx)(S.a,{value:"conductor",children:"conductor"})]})]})}),Object(A.jsx)("div",{style:{float:"left"},children:r.map((function(e,t){return Object(A.jsx)(me.DragDropContainer,{dragClone:!1,targetKey:"foo",onDrop:h,dragData:{data:t},children:Object(A.jsx)("div",{style:{backgroundColor:"rgba(0,255,255,0.3)",borderRadius:"30px",fontSize:24,padding:10},children:e+": "+c.instrument_assignment[t]})})}))}),Object(A.jsx)("div",{style:{clear:"both"},children:"\xa0"}),Object(A.jsx)("div",{style:{backgroundImage:"url(./musatalo.jpg)",position:"relative",backgroundSize:"100% 120%",backgroundRepeat:"no-repeat"},children:Object(A.jsx)("div",{style:{minHeight:"50vh"},children:s.map((function(e){return d(e[0],e[1],e[2])}))})})]})}function ye(e){var t=e.text,r=e.orchestration,s=n.useState({textFieldValue:t,saved:!1}),a=Object(b.a)(s,2),o=a[0],i=a[1];n.useEffect((function(){i((function(e){return Object(u.a)(Object(u.a)({},e),{},{saved:!1,textFieldValue:t})}))}),[r]);var c=function(){if(r.length>0){var e=JSON.parse(localStorage.getItem("orchestrations")),t=0;null!=e&&(e.length>0&&(t=e[e.length-1].id+1),console.log(r),console.log(typeof r[0][3]),"number"===typeof r[0][3]?e.push({id:t,name:o.textFieldValue,data:r.map((function(e){return[e[0],e[1],e[2],[e[3]],e[4],e[5],e[6]]}))}):e.push({id:t,name:o.textFieldValue,data:r}),localStorage.setItem("orchestrations",JSON.stringify(e)),i((function(e){return Object(u.a)(Object(u.a)({},e),{},{saved:!0})})))}},l=function(e){var t=e.target.value;i((function(e){return Object(u.a)(Object(u.a)({},e),{},{textFieldValue:t})}))};return Object(A.jsx)("div",{children:o.saved?Object(A.jsx)("div",{style:{textAlign:"center"},children:"Saved!"}):Object(A.jsxs)("div",{children:[Object(A.jsx)(ne.a,{fullWidth:!0,value:o.textFieldValue,label:"save name",onChange:l}),Object(A.jsx)(k.a,{fullWidth:!0,variant:"contained",color:"secondary",onClick:c,children:" Save to your list of orchestrations "})]})})}var we=r(329);function Ce(e){var t=Object(n.useState)({idx:e.idx,scoreNames:e.row[0],scoreTechs:e.row[1],scoreDyns:e.row[2],scorePitch:e.row[3],scoreTgt:e.row[4],scoreOnoff:e.row[5],scoreIdx:e.row[6],scoreMicro:0,color:e.color,scoreModify:0}),r=Object(b.a)(t,2),s=r[0],a=r[1],o=function(t,r){var n=0;0===s.scoreModify?n=-12:-12===s.scoreModify&&(n=12),a((function(t){return Object(u.a)(Object(u.a)({},t),{},{scoreModify:n,scorePitch:e.row[3]+n})})),e.onChange({idx:s.idx,row:[s.scoreNames,s.scoreTechs,s.scoreDyns,e.row[3]+n,s.scoreTgt,s.scoreOnoff,s.scoreIdx,s.scoreMicro]})},i=[];-12===s.scoreModify?i=Object(A.jsx)("div",{onClick:o,style:{backgroundColor:"rgba(123,30,30,0.3)",borderRadius:10,padding:3,textAlign:"center"},children:"-12"}):12===s.scoreModify?i=Object(A.jsx)("div",{onClick:o,style:{backgroundColor:"rgba(30,123,30,0.3)",borderRadius:10,padding:3,textAlign:"center"},children:"12"}):0===s.scoreModify&&(i=Object(A.jsx)("div",{onClick:o,style:{backgroundColor:"rgba(30,30,30,0.3)",borderRadius:10,padding:3,textAlign:"center"},children:"0"}));var c=function(e,t){a((function(e){return Object(u.a)(Object(u.a)({},e),{},{scoreMicro:t})}))},l=function(t,r){e.onChange({idx:s.idx,row:[s.scoreNames,s.scoreTechs,s.scoreDyns,s.scorePitch,s.scoreTgt,s.scoreOnoff,s.scoreIdx,s.scoreMicro]})};return Object(A.jsxs)("tr",{children:[Object(A.jsx)(_.a,{followCursor:!0,title:Object(A.jsx)(j,{help:"AnScorenames"}),disableHoverListener:!e.help,sx:{zIndex:99999},children:Object(A.jsx)("td",{style:{backgroundColor:s.color},children:s.scoreNames},"scor"+s.idx)}),Object(A.jsx)(_.a,{followCursor:!0,title:Object(A.jsx)(j,{help:"AnTech"}),disableHoverListener:!e.help,sx:{zIndex:99999},children:Object(A.jsx)("td",{children:s.scoreTechs},"tec"+s.idx)}),Object(A.jsx)(_.a,{followCursor:!0,title:Object(A.jsx)(j,{help:"AnDyn"}),disableHoverListener:!e.help,sx:{zIndex:99999},children:Object(A.jsx)("td",{children:Object(A.jsxs)("div",{onClick:function(t,r){var n="mf";"mf"===s.scoreDyns?n="f":"f"===s.scoreDyns&&(n="p"),a((function(e){return Object(u.a)(Object(u.a)({},e),{},{scoreDyns:n})})),e.onChange({idx:s.idx,row:[s.scoreNames,s.scoreTechs,n,s.scorePitch,s.scoreTgt,s.scoreOnoff,s.scoreIdx,s.scoreMicro]})},style:{backgroundColor:"rgba(123,200,30,0.3)",borderRadius:10,padding:3,textAlign:"center"},children:[" ",s.scoreDyns," "]})},"dy"+s.idx)}),Object(A.jsx)(_.a,{followCursor:!0,title:Object(A.jsx)(j,{help:"AnMicro"}),disableHoverListener:!e.help,sx:{zIndex:99999},children:Object(A.jsx)("td",{children:Object(A.jsx)(g.a,{sx:{width:60,height:15,verticalAlign:"top",marginTop:-2},children:Object(A.jsxs)(we.a,{spacing:1,direction:"row",sx:{mb:1},alignItems:"center",children:[Object(A.jsx)("img",{src:"/flat.png",height:"15"}),Object(A.jsx)(H.a,{valueLabelDisplay:"auto","aria-label":"tune",size:"small",min:-.49,step:.01,max:.49,value:s.scoreMicro,onChangeCommitted:l,onChange:c}),Object(A.jsx)("img",{src:"/sharp.png",height:"15"})]})})},"micro"+s.idx)}),Object(A.jsx)(_.a,{followCursor:!0,title:Object(A.jsx)(j,{help:"AnTgt"}),disableHoverListener:!e.help,sx:{zIndex:99999},children:Object(A.jsx)("td",{children:Object(A.jsx)("div",{onClick:function(t,r){a((function(e){return Object(u.a)(Object(u.a)({},e),{},{scoreTgt:!e.scoreTgt})})),e.onChange({idx:s.idx,row:[s.scoreNames,s.scoreTechs,s.scoreDyns,s.scorePitch,!s.scoreTgt,s.scoreOnoff,s.scoreIdx,s.scoreMicro]})},style:{backgroundColor:"rgba(123,200,30,0.3)",borderRadius:10,padding:3,textAlign:"center"},children:s.scoreTgt?"target":"orchestration"})},"tg"+s.idx)}),Object(A.jsx)(_.a,{followCursor:!0,title:Object(A.jsx)(j,{help:"AnOnoff"}),disableHoverListener:!e.help,sx:{zIndex:99999},children:Object(A.jsxs)("td",{children:[" ",Object(A.jsxs)("div",{onClick:function(t,r){a((function(e){return Object(u.a)(Object(u.a)({},e),{},{scoreOnoff:!e.scoreOnoff})})),e.onChange({idx:s.idx,row:[s.scoreNames,s.scoreTechs,s.scoreDyns,s.scorePitch,s.scoreTgt,!s.scoreOnoff,s.scoreIdx,s.scoreMicro]})},style:{backgroundColor:s.scoreOnoff?"rgba(123,200,30,0.3)":"rgba(200,123,30,0.3)",borderRadius:10,padding:3,textAlign:"center"},children:[s.scoreOnoff?"ON":"OFF"," "]})]},"onof"+s.idx)}),Object(A.jsx)(_.a,{followCursor:!0,title:Object(A.jsx)(j,{help:"AnMo"}),disableHoverListener:!e.help,sx:{zIndex:99999},children:Object(A.jsx)("td",{children:i},"mo"+s.idx)})]})}var ke=r(359);function _e(e){var t=[];e.instrumentList.map((function(e){return t.push(e[0])}));var r=function(e){var t=21,r={violin:2,viola:8,cello:11,double_bass:14,flute:15,oboe:16,clarinet:17,bassoon:18,horn:19,trumpet:22,tenor_trombone:23,bass_trombone:21,timpani:22,cymbal:24};return Object.keys(r).includes(e)&&(t=r[e]),t},s=n.useState({instrument_assignment:t.map((function(e){return r(e)}))}),a=Object(b.a)(s,2),o=a[0],i=a[1];n.useEffect((function(){i((function(e){return Object(u.a)(Object(u.a)({},e),{},{instrument_assignment:t.map((function(e){return r(e)}))})}))}),[e]);return Object(A.jsxs)("div",{style:{transform:"scale(0.8,0.8)"},children:[Object(A.jsx)(k.a,{size:"small",onClick:function(){i(Object(u.a)(Object(u.a)({},o),{},{audio:""}));var t={orchestration:e.instrumentList.map((function(e){return e[0]+","+e[1]+","+e[2]+","+e[3]})),positions:o.instrument_assignment,listeningPosition:"audience"};$.a.post("https://rest.score-tool.com/listen",t,{headers:{auth:"uljasPulkkis"}}).then((function(e){var t=Object(A.jsx)("div",{style:{transform:"scale(0.5,0.5)"},children:Object(A.jsxs)("audio",{controls:!0,autoPlay:"true",id:"AUDIOPLAY",children:[" ",Object(A.jsx)("source",{src:e.data,type:"audio/x-wav"})," "]})});i(Object(u.a)(Object(u.a)({},o),{},{audio:t}))})).catch((function(e){return console.log(e)}))},variant:"contained",children:"Quick listen"}),o.audio]})}var Se=xe,Te=n.forwardRef((function(e,t){return Object(A.jsx)(se.a,Object(u.a)({direction:"up",ref:t},e))}));function Ie(e){var t=n.useState(!1),r=Object(b.a)(t,2),s=r[0],a=r[1],o=n.useState([]),i=Object(b.a)(o,2),c=i[0],l=i[1],h=n.useState([]),d=Object(b.a)(h,2),f=d[0],v=d[1],y=n.useState([]),w=Object(b.a)(y,2),C=w[0],k=w[1],S=n.useState([]),T=Object(b.a)(S,2),I=T[0],N=T[1],L=n.useState([]),M=Object(b.a)(L,2),D=M[0],P=M[1],E=n.useState(!1),H=Object(b.a)(E,2),R=(H[0],H[1],n.useState({textFieldValue:"orchestration"})),F=Object(b.a)(R,2),V=F[0],W=F[1],G=n.useState(0),B=Object(b.a)(G,2),U=B[0],K=B[1],J=[],q=[];n.useEffect((function(){a((function(t){return e.open})),e.data.length>1&&(l((function(t){return e.data[1]})),v([])),e.data.length>1&&(K((function(t){return 100-e.data[0].data[2].masking_percent})),k((function(t){return e.data[0].data})),W((function(t){return Object(u.a)(Object(u.a)({},t),{},{textFieldValue:JSON.parse(localStorage.getItem("orchestrations")).length+": "+e.data[2]})})),e.data[1].map((function(e){J.push(""),q.push("")})),e.data[0].data[3].map((function(e,t){0===t?(J[e]="red",q[e]="strongest masker"):1===t?(J[e]="magenta",q[e]="2nd masker"):2===t?(J[e]="yellow",q[e]="3rd masker"):(J[e]="",q[e]="")})),N(J),P(q))}),[e]);var X=function(t){var r=[];(r=0===f.length?Object(z.a)(c):Object(z.a)(f))[t.idx]=t.row,v((function(e){return r}));var n=[];r.map((function(e){e[5]&&n.push(e)})),$.a.post(Se+"modalSlice",n).then((function(t){var r=t.data;k((function(e){return e.data=r.data})),K((function(e){return 100-r.data[2].masking_percent}));var s=[],a=[];e.data[1].map((function(e){s.push(""),a.push("")})),r.data[3].map((function(t,r){if(0===r){var o=n[t][6];e.data[1].map((function(e,t){e[6]===o&&(s[t]="red",a[t]="strongest masker")}))}else if(1===r){var i=n[t][6];e.data[1].map((function(e,t){e[6]===i&&(s[t]="magenta",a[t]="2nd masker")}))}else if(2===r){var c=n[t][6];e.data[1].map((function(e,t){e[6]===c&&(s[t]="yellow",a[t]="3rd masker")}))}})),N((function(e){return s})),P(a)}))},Y=[];0===f.length?Y=c:f.map((function(e){e[5]&&Y.push([e[0],e[1],e[2],e[3]+e[7]])}));var Q=["C","C#","D","D#","E","F","F#","G","G#","A","Bb","B"];return Object(A.jsx)("div",{children:Object(A.jsxs)(re.a,{fullScreen:!0,open:s,onClose:e.handleClose,TransitionComponent:Te,PaperProps:{style:{backgroundColor:"#fffef0"}},children:[Object(A.jsx)(m.a,{sx:{position:"relative",backgroundColor:"#dcc4ac",color:"#4c4c48"},children:Object(A.jsx)(x.a,{children:Object(A.jsx)(O.a,{edge:"start",color:"inherit",onClick:e.handleClose,"aria-label":"close",children:Object(A.jsx)("div",{children:"Click here, or press ESC to close"})})})}),Object(A.jsxs)("div",{style:{textAlign:"center"},children:[Object(A.jsx)(p.a,{children:"You can alter the orchestration by clicking the colored values. The changes do not affect the original score."}),Object(A.jsx)("table",{style:{margin:"auto",display:"inline"},children:Object(A.jsxs)("tbody",{children:[Object(A.jsxs)("tr",{children:[Object(A.jsx)("td",{children:"Instr."}),Object(A.jsx)("td",{children:"Tech."}),Object(A.jsx)("td",{children:"Dyn."}),Object(A.jsx)("td",{children:"Tune"}),Object(A.jsx)("td",{children:"Role"}),Object(A.jsx)("td",{children:"On/Off"}),Object(A.jsx)("td",{children:"Transpose +- oct."})]}),c.map((function(t,r){return Object(A.jsx)(Ce,{help:e.help,onChange:X,idx:r,row:t,color:""})}))]})}),Object(A.jsx)(_.a,{followCursor:!0,title:Object(A.jsx)(j,{help:"Maskers"}),disableHoverListener:!e.help,sx:{zIndex:99999},children:Object(A.jsx)("table",{style:{margin:"auto",display:"inline"},children:Object(A.jsxs)("tbody",{children:[Object(A.jsx)("tr",{children:Object(A.jsx)("td",{children:"maskers"})}),I.map((function(e,t){return Object(A.jsx)("tr",{children:Object(A.jsxs)("td",{style:{backgroundColor:e,borderRadius:10,padding:4,textAlign:"center",margin:4},children:[c[t][0]," ",(r=c[t][3],Q[r%12]+(Math.floor(r/12)-1))," "+D[t]]})});var r}))]})})}),Object(A.jsx)("br",{}),Object(A.jsx)(_.a,{followCursor:!0,title:Object(A.jsx)(j,{help:"Prediction"}),disableHoverListener:!e.help,sx:{zIndex:99999},children:Object(A.jsxs)("div",{children:[Object(A.jsx)(p.a,{variant:"caption",component:"div",color:"text.secondary",children:"Target audibility prediction:"}),Object(A.jsxs)(g.a,{sx:{position:"relative",display:"inline-flex"},children:[Object(A.jsx)(ke.a,{variant:"determinate",value:U,color:U<=30?"error":U<=50?"warning":"success"}),Object(A.jsx)(g.a,{sx:{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center"},children:Object(A.jsx)(p.a,{variant:"caption",component:"div",color:"text.secondary",children:"".concat(Math.round(U),"%")})})]})]})}),Object(A.jsx)("br",{}),Object(A.jsx)(_.a,{followCursor:!0,title:Object(A.jsx)(j,{help:"SaveOrch"}),disableHoverListener:!e.help,sx:{zIndex:99999},children:Object(A.jsx)("div",{children:Object(A.jsx)(ye,{text:V.textFieldValue,orchestration:c})})}),Object(A.jsx)(_.a,{followCursor:!0,title:Object(A.jsx)(j,{help:"QuickListen"}),disableHoverListener:!e.help,sx:{zIndex:99999},children:Object(A.jsx)("div",{children:Object(A.jsx)(_e,{instrumentList:Y})})}),Object(A.jsx)(pe,{data:C,help:e.help}),Object(A.jsx)(_.a,{followCursor:!0,title:Object(A.jsx)(j,{help:"Listen"}),disableHoverListener:!e.help,sx:{zIndex:99999},children:Object(A.jsx)("div",{children:Object(A.jsx)(ve,{instrumentList:Y})})})]})]})})}var Ne=r(360);function Le(e){var t=Object(n.useState)({idx:e.idx,instName:e.instName,scoreNames:e.scoreNames,scoreTechs:e.scoreTechs,scoreDyns:e.scoreDyns,scoreTgt:e.scoreTgt,scoreOnoff:e.scoreOnoff,scoreModify:e.scoreModify}),r=Object(b.a)(t,2),s=r[0],a=r[1];e.onChange({instName:s.instName,scoreNames:s.scoreNames,scoreTechs:s.scoreTechs,scoreDyns:s.scoreDyns,scoreTgt:s.scoreTgt,scoreOnoff:s.scoreOnoff,scoreModify:s.scoreModify});var o,i;return Object(A.jsxs)("tr",{children:[Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"Scorename"}),disableHoverListener:!e.help,placement:"top",sx:{zIndex:99999},children:Object(A.jsx)("td",{children:s.instName},"nam"+s.idx)}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"Instruments"}),disableHoverListener:!e.help,placement:"top",sx:{zIndex:99999},children:Object(A.jsx)("td",{children:function(e,t){var r=Object.keys(ee);return Object(A.jsx)("div",{children:Object(A.jsxs)(W.a,{sx:{m:1,minWidth:50},children:[Object(A.jsx)(V.a,{id:"instrument-select",children:"Instr."}),Object(A.jsx)(F.a,{labelId:"instrument-select",id:"instrument-sel"+t,value:e,onChange:function(e){return t=e,void a((function(e){return Object(u.a)(Object(u.a)({},e),{},{scoreNames:t.target.value})}));var t},autoWidth:!0,label:"instr.",children:r.map((function(e){return Object(A.jsx)(S.a,{value:e,children:e})}))})]})})}(s.scoreNames,s.idx)},"scor"+s.idx)}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"Techs"}),disableHoverListener:!e.help,placement:"top",sx:{zIndex:99999},children:Object(A.jsx)("td",{children:function(e,t){var r=ee[s.scoreNames];return Object(A.jsx)("div",{children:Object(A.jsxs)(W.a,{sx:{m:1,minWidth:50},children:[Object(A.jsx)(V.a,{id:"tech-select",children:"Tech."}),Object(A.jsx)(F.a,{labelId:"tech-select",id:"tech-sel"+t,value:e,onChange:function(e){return t=e,void a((function(e){return Object(u.a)(Object(u.a)({},e),{},{scoreTechs:t.target.value})}));var t},autoWidth:!0,label:"tech.",children:r.map((function(e){return Object(A.jsx)(S.a,{value:e,children:e})}))})]})})}(s.scoreTechs,s.idx)},"tec"+s.idx)}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"Dyns"}),disableHoverListener:!e.help,placement:"top",sx:{zIndex:99999},children:Object(A.jsx)("td",{children:(o=s.scoreDyns,i=s.idx,Object(A.jsx)("div",{children:Object(A.jsxs)(W.a,{sx:{m:1,minWidth:50},children:[Object(A.jsx)(V.a,{id:"dyn-select",children:"Dyn."}),Object(A.jsx)(F.a,{labelId:"dyn-select",id:"dyn-sel"+i,value:o,onChange:function(e){return t=e,void a((function(e){return Object(u.a)(Object(u.a)({},e),{},{scoreDyns:t.target.value})}));var t},autoWidth:!0,label:"dyn.",children:["from_score","p","mf","f"].map((function(e){return Object(A.jsx)(S.a,{value:e,children:e})}))})]})}))},"dy"+s.idx)}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"Target"}),disableHoverListener:!e.help,placement:"top",sx:{zIndex:99999},children:Object(A.jsx)("td",{children:Object(A.jsx)("div",{style:{border:"1px solid lightGray",borderRadius:5,padding:8},children:Object(A.jsxs)(we.a,{direction:"row",spacing:1,alignItems:"center",children:[Object(A.jsx)(p.a,{children:"orch."}),Object(A.jsx)(Ne.a,{checked:s.scoreTgt,color:"secondary",onChange:function(e){return s.idx,(t=e).persist(),void a((function(e){return Object(u.a)(Object(u.a)({},e),{},{scoreTgt:t.target.checked})}));var t}},"tgtswitch"+s.idx),Object(A.jsx)(p.a,{children:"tgt"})]})})},"tg"+s.idx)}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"Onoff"}),disableHoverListener:!e.help,placement:"top",sx:{zIndex:99999},children:Object(A.jsx)("td",{children:Object(A.jsx)("div",{style:{border:"1px solid lightGray",borderRadius:5,padding:8},children:Object(A.jsxs)(we.a,{direction:"row",spacing:1,alignItems:"center",children:[Object(A.jsx)(p.a,{children:"off"}),Object(A.jsx)(Ne.a,{checked:s.scoreOnoff,onChange:function(e){return s.idx,(t=e).persist(),void a((function(e){return Object(u.a)(Object(u.a)({},e),{},{scoreOnoff:t.target.checked})}));var t}},"onoffswitch"+s.idx),Object(A.jsx)(p.a,{children:"on"})]})})},"onoff"+s.idx)}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"Transpose"}),disableHoverListener:!e.help,placement:"top",sx:{zIndex:99999},children:Object(A.jsx)("td",{children:function(e,t){return Object(A.jsx)("div",{children:Object(A.jsxs)(W.a,{sx:{m:1,minWidth:50},children:[Object(A.jsx)(V.a,{id:"mod-select",children:"Transpose"}),Object(A.jsx)(F.a,{labelId:"mod-select",id:"mod-sel"+t,value:e,onChange:function(e){return t=e,void a((function(e){return Object(u.a)(Object(u.a)({},e),{},{scoreModify:t.target.value})}));var t},autoWidth:!0,label:"trans.",children:[0,12,-12,24,-24].map((function(e){return Object(A.jsx)(S.a,{value:e,children:e})}))})]})})}(s.scoreModify,s.idx)},"mod"+s.idx)})]})}r(266);var Ae=r(343),Me=r(60),De=(r(274),r(331));function Pe(e){var t=Object(De.a)();return Object(A.jsx)(se.a,{in:!t,children:e.children})}var ze=Object(N.a)({palette:{neutral:{main:"#dcc4ac",contrastText:"black"}}}),Ee=Object(fe.a)(be.a)((function(e){var t=e.theme;return Object(u.a)(Object(u.a)({},t.typography.body2),{},{backgroundColor:"#fffef0",padding:t.spacing(1),textAlign:"center",color:t.palette.text.secondary})})),He=xe,Re=function(e){Object(h.a)(r,e);var t=Object(d.a)(r);function r(e){var n;return Object(i.a)(this,r),(n=t.call(this,e)).state={calculatingState:"",help:!1,tooltip:"",showTooltip:!0,expanded:!0,interruptCalculation:!1,dataReady:!1,loading:!1,loaded:!1,cur:!1,calculIndications:!1,measureTimestamps:[],measureRange:[1,2],maxMeasure:2,instNames:[],scoreNames:[],scoreTechs:[],scoreDyns:[],scoreTgt:[],scoreOnoff:[],scoreModify:[],instData:{},open:!1,time:[],modalData:[]},n.osmd=void 0,n.orchestrationChords=void 0,n.cursor=void 0,n.next=void 0,n.show=!0,n.divRef=s.a.createRef(),n.measureHandleChange=n.measureHandleChange.bind(Object(l.a)(n)),n.calculateMasking=n.calculateMasking.bind(Object(l.a)(n)),n.update=n.update.bind(Object(l.a)(n)),n.handleClose=n.handleClose.bind(Object(l.a)(n)),n}return Object(c.a)(r,[{key:"setupOsmd",value:function(){var e=this;this.setState((function(t){return Object(u.a)(Object(u.a)({},t),{},{loading:!0,help:e.props.help})}));var t={autoResize:void 0!==this.props.autoResize&&this.props.autoResize,drawTitle:void 0===this.props.drawTitle||this.props.drawTitle,loadUrlTimeout:1e4,drawSlurs:!1};this.osmd=new E.OpenSheetMusicDisplay(this.divRef.current,t),this.osmd.load(this.props.file).then((function(){var t=.5,r=e.osmd.sheet.staves.length;r>10?t=.4:r>20?t=.2:r>30?t=.1:r>40&&(t=.05),e.osmd.zoom=t;var n=[],s=[],a=[],o=[],i=[],c=[],l=[];try{var h=JSON.parse(localStorage.getItem(e.props.filename));n=h.instNames,s=h.scoreNames,a=h.scoreTechs,o=h.scoreDyns,i=h.scoreTgt,c=h.scoreOnoff,l=h.scoreModify}catch(u){n=[],s=[],a=[],o=[],i=[],c=[],l=[],e.osmd.sheet.staves.map((function(e){n.push(e.parentInstrument.nameLabel.text),s.push(function(e){var t=e;return e.toLowerCase().startsWith("clarinet in b")&&(t="clarinet"),e.toLowerCase().startsWith("bass clarinet")&&(t="bass_cl"),e.toLowerCase().startsWith("solo")&&(t=e.substr(5)),e.toLowerCase().startsWith("trombone")&&(t="tenor_trombone"),e.toLowerCase().startsWith("contrabass")&&(t="double_bass"),"baritone"===e.toLowerCase()&&(t="tuba"),t.toLowerCase().startsWith("natural")&&(t="horn"),Object(Z.a)(t,Object.keys(ee))[0][0]}(e.parentInstrument.nameLabel.text)),a.push("normal"),o.push("from_score"),i.push(0),c.push(1),l.push(0)}))}var d=[];e.osmd.sheet.sourceMeasures.map((function(e){return d.push(e.absoluteTimestamp.realValue)})),d.push(999999),e.setState((function(t){t.measureRange=[1,e.osmd.sheet.SourceMeasures.length],t.maxMeasure=e.osmd.sheet.SourceMeasures.length,t.instNames=n,t.scoreNames=s,t.scoreTechs=a,t.scoreDyns=o,t.scoreTgt=i,t.scoreOnoff=c,t.scoreModify=l,t.measureTimestamps=d})),e.forceUpdate()})).then((function(){return e.setState((function(e){return Object(u.a)(Object(u.a)({},e),{},{loading:!1})}))})).catch((function(){return e.setState((function(e){return Object(u.a)(Object(u.a)({},e),{},{loading:!1})}))}))}},{key:"update",value:function(){this.osmd.updateGraphic()}},{key:"setLoading",value:function(){var e=this;this.setState((function(e){return Object(u.a)(Object(u.a)({},e),{},{loading:!0,expanded:!1})})),this.osmd.setOptions({drawFromMeasureNumber:this.state.measureRange[0],drawUpToMeasureNumber:this.state.measureRange[1]}),setTimeout((function(){return e.osmd.render()}),200),setTimeout((function(){return e.renderScore()}),210)}},{key:"renderScore",value:function(){var e=this;this.osmd.render(),this.setState((function(e){return e.loaded=!0}));for(var t=[],r=0;r<this.osmd.graphic.VerticalGraphicalStaffEntryContainers[0].StaffEntries.length;r++)t.push({0:"mf"});var n={},s={},a={},o=[];o.length=this.state.instNames.length;for(var i=[],c=0;c<this.state.instNames.length;c++)i.push("mf");this.osmd.sheet.sourceMeasures.map((function(t){t.absoluteTimestamp.realValue<e.state.measureTimestamps[e.state.measureRange[0]-1]&&t.staffLinkedExpressions.map((function(e,t){e.length>0&&e.map((function(e){e.expressions.map((function(e){e.expression.dynamicEnum<=5?i[t]="p":e.expression.dynamicEnum<=7?i[t]="mf":e.expression.dynamicEnum<=13&&(i[t]="f")}))}))}))})),this.osmd.graphic.VerticalGraphicalStaffEntryContainers.map((function(r){var c=[];if(c.length=r.StaffEntries.length,r.absoluteTimestamp.realValue>=e.state.measureTimestamps[e.state.measureRange[0]-1]&&r.absoluteTimestamp.realValue<=e.state.measureTimestamps[e.state.measureRange[1]])for(var l=function(e){c[e]=[],r.StaffEntries[e]?("undefined"!==typeof r.StaffEntries[e].parentMeasure.parentStaffLine&&r.StaffEntries[e].parentMeasure.parentStaffLine.hasOwnProperty("abstractExpressions")&&r.StaffEntries[e].parentMeasure.parentStaffLine.abstractExpressions.map((function(r){r.SourceExpression.hasOwnProperty("multiExpression")&&(t[e][String(r.SourceExpression.multiExpression.AbsoluteTimestamp.realValue)]=r.Expression)})),r.StaffEntries[e].sourceStaffEntry.voiceEntries&&r.StaffEntries[e].sourceStaffEntry.voiceEntries[0].notes.map((function(n){n.halfTone>0&&(t[e].hasOwnProperty(String(r.AbsoluteTimestamp.realValue))&&(i[e]=t[e][String(r.AbsoluteTimestamp.realValue)]),s[String(r.AbsoluteTimestamp.realValue)]=r.StaffEntries[e].boundingBox.absolutePosition.x,c[e].push({note:Math.round(n.halfTone),dynamic:i[e]}),o[e]={note:Math.round(n.halfTone),start:r.AbsoluteTimestamp.realValue,duration:n.length.realValue})}))):o[e]&&(o[e].start+o[e].duration>=r.AbsoluteTimestamp.realValue?(t[e].hasOwnProperty(String(r.AbsoluteTimestamp.realValue))&&(i[e]=t[e][String(r.AbsoluteTimestamp.realValue)]),c[e].push({note:o[e].note,dynamic:i[e]})):o[e]=[])},h=0;h<r.StaffEntries.length;h++)l(h);n[r.AbsoluteTimestamp.realValue]=c,a[r.AbsoluteTimestamp.realValue]=-1})),this.orchestrationChords={instruments:this.state.instNames,databaseEntries:{inst:this.state.scoreNames,tech:this.state.scoreTechs,dyn:this.state.scoreDyns,tgt:this.state.scoreTgt,onoff:this.state.scoreOnoff,modify:this.state.scoreModify},dynamics:t,notes:n,predictions:a,maskers:{},xpos:s},this.setState((function(e){return Object(u.a)(Object(u.a)({},e),{},{loading:!1})}))}},{key:"resize",value:function(){}},{key:"handleClose",value:function(){this.setState((function(e){return e.open=!1}))}},{key:"calcStop",value:function(){this.setState((function(e){return e.interruptCalculation=!0}))}},{key:"measureHandleChange",value:function(e,t,r){var n=this;Array.isArray(t)&&this.setState((function(e){return Object(u.a)(Object(u.a)({},n.state),{},{measureRange:t})}))}},{key:"calculateMasking",value:function(){var e=this;this.osmd.graphic.musicPages[0].musicSystems.map((function(t){t.staffLines.map((function(t,r){if(e.state.scoreTgt[r]){e.osmd.drawer.drawBoundingBox(t.boundingBox,"rgba(255, 0, 0,0.2)",!1,"TARGET");var n=new E.Label("Target"),s=new E.GraphicalLabel(n,4,E.TextAlignmentEnum.LeftBottom,e.osmd.EngravingRules,t.boundingBox);s.PositionAndShape=t.boundingBox,s.PositionAndShape.AbsolutePosition.x=s.PositionAndShape.AbsolutePosition.x-10,s.setLabelPositionAndShapeBorders(),e.osmd.drawer.drawLabel(s)}}))})),this.setState((function(e){return e.interruptCalculation=!1}));var t=0;s=s.bind(this);var r=this.state.measureTimestamps.slice(this.state.measureRange[0]-1,this.state.measureRange[1]),n=999999999;function s(e){var a=this,o=this.osmd.graphic.VerticalGraphicalStaffEntryContainers[e];if(o.absoluteTimestamp.realValue>=this.state.measureTimestamps[this.state.measureRange[0]-1]&&o.absoluteTimestamp.realValue<=this.state.measureTimestamps[this.state.measureRange[1]]){r.filter((function(e){return e>o.absoluteTimestamp.realValue})).length+1<n&&(n=r.filter((function(e){return e>o.absoluteTimestamp.realValue})).length+1,this.setState((function(e){return Object(u.a)(Object(u.a)({},e),{},{calculatingState:Object(A.jsxs)(A.Fragment,{children:[" ",Object(A.jsxs)(p.a,{children:[" Measures left to calculate: ",r.filter((function(e){return e>o.absoluteTimestamp.realValue})).length+1," of ",r.length]})," ",Object(A.jsx)(k.a,{variant:"contained",color:"info",onClick:a.calcStop.bind(a),children:"Stop calculation"})," "]})})})));var i=this.orchestrationChords.notes[o.absoluteTimestamp.realValue],c=[],l=[],h=!1;i.map((function(e,t){if(a.orchestrationChords.databaseEntries.tgt[t]&&l.push(t),e.length>0){var r=[];"from_score"!==a.orchestrationChords.databaseEntries.dyn[t]&&(r=a.orchestrationChords.databaseEntries.dyn[t]),a.orchestrationChords.databaseEntries.tgt[t]&&(h=!0),e.map((function(e){0===r.length&&["ppppp","pppp","ppp","pp","p"].includes(e.dynamic)?r="p":0===r.length&&["fffff","ffff","fff","ff","f","sfz","sf"].includes(e.dynamic)?r="f":0===r.length&&["mf","mp","mfz"].includes(e.dynamic)&&(r="mf"),c.push([a.orchestrationChords.databaseEntries.inst[t],a.orchestrationChords.databaseEntries.tech[t],r,e.note+12+a.orchestrationChords.databaseEntries.modify[t],a.orchestrationChords.databaseEntries.tgt[t],a.orchestrationChords.databaseEntries.onoff[t],t])}))}})),c=c.filter((function(e,t,r){if(!e[5])return!1;try{return e[3]>=te[e[0]][e[1]][e[2]][0]&&e[3]<=te[e[0]][e[1]][e[2]][1]}catch(n){return!1}}));$.a.post(He+"maskingSlice",c).then((function(e){var t=e.data,r=[];o.StaffEntries.map((function(e){return r=e.sourceStaffEntry.voiceEntries[0].notes[0]}));var n=r.parentStaffEntry.verticalContainerParent.parentMeasure.measureNumber,s=a.orchestrationChords.xpos[o.absoluteTimestamp.realValue]-1,i=a.osmd.graphic.MusicPages[0];t&&(h&&l.map((function(e){var r=a.osmd.graphic.musicSheet.sourceMeasures[n-1].verticalMeasureList[e].boundingBox.absolutePosition.y+2,c=new E.PointF2D(s,r),l=new E.PointF2D(s+2,r),h=function(e){var t="rgba(0,255,0,0.3)";if(e>=75){var r=1-(e-74.9)/50;t="rgba(".concat(Math.round(255*r),",0,0,0.7)")}else if(e>=50){var n=1-(e-54.9)/25;t="rgba(255,".concat(Math.round(255*n),",0,0.5)")}else if(e>=25){var s=(e-24.9)/25;t="rgba(".concat(Math.round(255*s),",255,0,0.5)")}return t}(t[0]);a.orchestrationChords.predictions[o.AbsoluteTimestamp.realValue]=t[0],a.orchestrationChords.maskers[o.AbsoluteTimestamp.realValue]=t[1],a.osmd.Drawer.DrawOverlayLine(c,l,i,h,4)})),t[1]&&t[1].map((function(e,t){var r=a.osmd.graphic.musicSheet.sourceMeasures[n-1].verticalMeasureList[e].boundingBox.absolutePosition.y+2,o=new E.PointF2D(s,r),c=new E.PointF2D(s+2,r),l=[];0===t?(l="rgba(255,51,255,0.5)",a.osmd.Drawer.DrawOverlayLine(o,c,i,l,4)):1===t?(l="rgba(255,153,51,0.5)",a.osmd.Drawer.DrawOverlayLine(o,c,i,l,4)):2===t&&(l="rgba(51,153,355,0.5)",a.osmd.Drawer.DrawOverlayLine(o,c,i,l,4))})))})).finally((function(){t++,a.osmd.graphic.VerticalGraphicalStaffEntryContainers.length>t?a.state.interruptCalculation?a.setState((function(e){return Object(u.a)(Object(u.a)({},e),{},{interruptCalculation:!1,calculatingState:Object(A.jsx)(p.a,{children:" Calculation stopped! "})})})):s(t):a.setState((function(e){return Object(u.a)(Object(u.a)({},e),{},{calculatingState:Object(A.jsx)(p.a,{children:" Calculation complete! "})})}))}))}else this.setState((function(e){return Object(u.a)(Object(u.a)({},e),{},{calculatingState:Object(A.jsx)(p.a,{children:" Calculation complete! "})})})),t++,this.osmd.graphic.VerticalGraphicalStaffEntryContainers.length>t&&(this.state.interruptCalculation?this.setState((function(e){return Object(u.a)(Object(u.a)({},e),{},{interruptCalculation:!1,calculatingState:Object(A.jsx)(p.a,{children:" Calculation stopped! "})})})):s(t))}s(t),this.setState((function(e){return e.calculIndications=!0}))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.resize)}},{key:"componentDidUpdate",value:function(e){var t=this;(this.props.drawTitle!==e.drawTitle||this.props.file!==e.file)&&this.setupOsmd();var r=!1;this.props.file&&"undefined"!==typeof this.osmd&&"undefined"!==typeof this.osmd.cursor&&(("undefined"===typeof this.osmd.cursor.hidden||this.osmd.cursor.hidden)&&(r=!0),this.props.show&&r&&this.osmd.cursor.show(),this.props.next!==e.next&&(this.osmd.cursor.next(),console.log(this.osmd.cursor),console.log(this.osmd.cursor.NotesUnderCursor()),console.log(this.osmd.cursor.VoicesUnderCursor()),console.log(this.osmd.cursor.iterator.currentTimeStamp.RealValue)),this.props.help!==e.help&&this.setState((function(e){return Object(u.a)(Object(u.a)({},e),{},{help:t.props.help})})),window.addEventListener("resize",this.resize))}},{key:"componentDidMount",value:function(){this.props.file&&this.setupOsmd()}},{key:"render",value:function(){var e=this,t=[],r="inline-block";this.state.loaded&&(r="none",t=Object(A.jsxs)("div",{children:[Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"CalcRange"}),disableHoverListener:!this.props.help,sx:{zIndex:99999},children:Object(A.jsxs)("div",{style:{display:"block",maxWidth:"50%",textAlign:"center",margin:"auto"},children:[Object(A.jsx)(p.a,{style:{display:"inline-block"},children:" Set calculation bar range:"}),Object(A.jsx)("div",{style:{display:"inline-block",width:"30vh",marginInlineStart:"10px"},children:Object(A.jsx)(R,{style:{display:"inline-block"},range:this.state.measureRange,max:this.state.maxMeasure,measureHandleChange:this.measureHandleChange})})]})}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"CalcButton"}),disableHoverListener:!this.props.help,sx:{zIndex:99999},children:Object(A.jsxs)(k.a,{size:"small",sx:{display:"inline-block"},variant:"contained",color:"secondary",onClick:function(){e.calculateMasking()},children:["calculate masking, bars ",this.state.measureRange[0]," to ",this.state.measureRange[1]," (",this.state.measureRange[1]-this.state.measureRange[0]+1," bars)"]})}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"Redraw"}),disableHoverListener:!this.props.help,sx:{zIndex:99999},children:Object(A.jsx)(k.a,{size:"small",style:{marginInline:10,display:"inline-block"},variant:"contained",color:"warning",onClick:function(){e.setLoading()},children:"redraw score"})}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"DownloadScore"}),disableHoverListener:!this.props.help,sx:{zIndex:99999},children:Object(A.jsx)(k.a,{size:"small",variant:"contained",color:"primary",onClick:function(){return function(){var t=e.osmd.drawer.Backends[0].getSvgElement(),r=210,n=297,s=e.osmd.rules.PageFormat;s&&!s.IsUndefined?(r=s.width,n=s.height):n=r*t.clientHeight/t.clientWidth,console.log(t);var a=n>r?"p":"l",o=new Me.d(a,"mm",[r,n]),i=r/t.clientWidth;o.svg(t,{x:0,y:0,width:t.clientWidth*i,height:t.clientHeight*i}).then((function(){o.save("Score-Tool-Score.pdf")}))}()},children:"Download score"})}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"UnderMouse"}),disableHoverListener:!this.props.help,sx:{zIndex:99999},children:Object(A.jsx)("div",{style:{display:"inline-block",marginInlineStart:10},children:Object(A.jsx)(G.a,{sx:{display:"inline-block"},children:Object(A.jsx)(B.a,{sx:{display:"inline-block"},control:Object(A.jsx)(U.a,{style:{display:"inline-block"},checked:this.state.showTooltip,onChange:function(){e.setState((function(t){return t.showTooltip=!e.state.showTooltip}))}}),label:"Orch. under mouse"})})})})]}));var n=["C","C#","D","D#","E","F","F#","G","G#","A","B#","B"];return Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(L.a,{theme:ze,children:Object(A.jsx)("small",{children:Object(A.jsx)(Pe,{children:Object(A.jsx)(m.a,{color:"neutral",style:{overflow:"auto",marginTop:30},children:Object(A.jsx)(C.a,{maxWidth:"xl",style:{overflow:"auto"},children:Object(A.jsxs)(Ee,{style:{textAlign:"center",justifyContent:"center",alignItems:"center",alignContent:"center",marginLeft:"auto",marginRight:"auto"},children:[Object(A.jsxs)(K.a,{expanded:this.state.expanded,onChange:function(){e.setState((function(t){return t.expanded=!e.state.expanded}))},style:{backgroundColor:"#f9fff0"},children:[Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"ShowHide"}),disableHoverListener:!this.props.help,sx:{zIndex:99999},children:Object(A.jsx)(J.a,{expandIcon:Object(A.jsx)(Y.a,{}),"aria-controls":"panel1a-content",id:"panel1a-header",style:{textAlign:"center"},children:Object(A.jsx)(p.a,{style:{textAlign:"center"},children:"Click here to show/hide masking calculation properties"})})}),Object(A.jsxs)(q.a,{children:[Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"ScoreSlider"}),disableHoverListener:!this.props.help,placement:"top",sx:{zIndex:99999},children:Object(A.jsxs)("div",{children:[Object(A.jsx)(p.a,{children:"Select bar range with slider"}),Object(A.jsx)(R,{range:this.state.measureRange,max:this.state.maxMeasure,measureHandleChange:this.measureHandleChange})]})}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"Showscore"}),disableHoverListener:!this.props.help,sx:{zIndex:99999},children:Object(A.jsx)(k.a,{style:{display:r,margin:5},variant:"contained",onClick:function(){e.setLoading()},children:" Show score"})}),Object(A.jsx)("div",{style:{overflow:"auto",maxHeight:"65vh"},children:Object(A.jsx)("table",{style:{margin:"auto"},children:Object(A.jsxs)("tbody",{children:[Object(A.jsxs)("tr",{children:[Object(A.jsx)("th",{children:"score name"}),Object(A.jsx)("th",{children:"instrument"}),Object(A.jsx)("th",{children:"technique"}),Object(A.jsx)("th",{children:"dynamic"}),Object(A.jsx)("th",{children:"orch/target"}),Object(A.jsx)("th",{children:"on/off"}),Object(A.jsx)("th",{children:"transpose"})]}),this.state.instNames.map((function(t,r){return Object(A.jsx)(Le,{idx:r,instName:t,scoreNames:e.state.scoreNames[r],scoreTechs:e.state.scoreTechs[r],scoreDyns:e.state.scoreDyns[r],scoreTgt:e.state.scoreTgt[r],scoreOnoff:e.state.scoreOnoff[r],scoreModify:e.state.scoreModify[r],onChange:function(t){return function(t,r){var n={instNames:Object(z.a)(e.state.instNames),scoreNames:Object(z.a)(e.state.scoreNames),scoreTechs:Object(z.a)(e.state.scoreTechs),scoreDyns:Object(z.a)(e.state.scoreDyns),scoreTgt:Object(z.a)(e.state.scoreTgt),scoreOnoff:Object(z.a)(e.state.scoreOnoff),scoreModify:Object(z.a)(e.state.scoreModify)};n.scoreNames[t]=r.scoreNames,n.scoreTechs[t]=r.scoreTechs,n.scoreDyns[t]=r.scoreDyns,n.scoreTgt[t]=r.scoreTgt,n.scoreOnoff[t]=r.scoreOnoff,n.scoreModify[t]=r.scoreModify,e.setState((function(e){e.scoreNames[t]=r.scoreNames,e.scoreTechs[t]=r.scoreTechs,e.scoreDyns[t]=r.scoreDyns,e.scoreTgt[t]=r.scoreTgt,e.scoreOnoff[t]=r.scoreOnoff,e.scoreModify[t]=r.scoreModify})),localStorage.setItem(e.props.filename,JSON.stringify({instNames:n.instNames,scoreNames:n.scoreNames,scoreTechs:n.scoreTechs,scoreDyns:n.scoreDyns,scoreTgt:n.scoreTgt,scoreOnoff:n.scoreOnoff,scoreModify:n.scoreModify}))}(r,t)},help:e.props.help})}))]})})})]})]}),this.state.loading,Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"Showscore"}),disableHoverListener:!this.props.help,sx:{zIndex:99999},children:Object(A.jsx)(k.a,{style:{display:r,margin:5},variant:"contained",onClick:function(){e.setLoading()},children:"Show score"})}),t,this.state.calculatingState,this.state.calculIndications&&Object(A.jsx)(A.Fragment,{children:Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"Colors"}),disableHoverListener:!this.props.help,sx:{zIndex:99999},children:Object(A.jsxs)(p.a,{style:{display:"inline"},children:["Colors:",Object(A.jsx)("div",{style:{backgroundImage:"linear-gradient(to right, rgba(120,0,0,0.7) , rgba(255,0,0,0.5))",display:"inline",marginInline:2},children:" Tgt masked"}),Object(A.jsx)("div",{style:{backgroundImage:"linear-gradient(to right, rgba(255,0,0,0.5) , rgba(255,255,0,0.5))",display:"inline",marginInline:2},children:" nearly masked"}),Object(A.jsx)("div",{style:{backgroundImage:"linear-gradient(to right, rgba(255,255,0,0.5) , rgba(0,255,0,0.3))",display:"inline",marginInline:2},children:" audible"}),Object(A.jsx)("div",{style:{backgroundColor:"rgba(255,51,255,0.5)",display:"inline"},children:" heaviest masker"}),Object(A.jsx)("div",{style:{backgroundColor:"rgba(255,153,51,0.5)",display:"inline"},children:" 2nd masker"}),Object(A.jsx)("div",{style:{backgroundColor:"rgba(51,153,255,0.5)",display:"inline"},children:" 3rd masker "})]})})})]})})})})})}),Object(A.jsx)(Ee,{children:Object(A.jsx)(_.a,{title:Object(A.jsx)("div",{children:this.state.tooltip}),placement:"top-start",followCursor:!0,children:Object(A.jsx)("div",{ref:this.divRef,style:{width:window.innerWidth-100,marginTop:240},onClick:function(t){var r=t.clientX,n=t.clientY,s=new E.PointF2D(r,n);s=e.osmd.graphic.domToSvg(s),s=e.osmd.graphic.svgToOsmd(s);var a=e.osmd.graphic.GetNearestNote(s,{x:10,y:10});if("undefined"!==typeof a){var o=a.sourceNote.voiceEntry.parentSourceStaffEntry.AbsoluteTimestamp.realValue,i="";try{i=a.ParentMusicPage.labels[0].label.text+", Bar:"+a.vfnote[0].stave.MeasureNumber+", Position:"+a.parentVoiceEntry.parentStaffEntry.relInMeasureTimestamp.realValue}catch(u){i="Score orchestral chord"}for(e.osmd.cursor.hide(),e.osmd.cursor.reset();e.osmd.cursor.iterator.currentTimeStamp.RealValue!=o;)e.osmd.cursor.next();e.osmd.cursor.show();var c=e.orchestrationChords.notes[o],l=[],h=[],d=!1;c.map((function(t,r){if(e.orchestrationChords.databaseEntries.tgt[r]&&h.push(r),t.length>0){var n=[];"from_score"!==e.orchestrationChords.databaseEntries.dyn[r]&&(n=e.orchestrationChords.databaseEntries.dyn[r]),e.orchestrationChords.databaseEntries.tgt[r]&&(d=!0),t.map((function(t){0===n.length&&["ppppp","pppp","ppp","pp","p"].includes(t.dynamic)?n="p":0===n.length&&["fffff","ffff","fff","ff","f","sfz","sf"].includes(t.dynamic)?n="f":0===n.length&&["mf","mp","mfz"].includes(t.dynamic)&&(n="mf"),l.push([e.orchestrationChords.databaseEntries.inst[r],e.orchestrationChords.databaseEntries.tech[r],n,t.note+12+e.orchestrationChords.databaseEntries.modify[r],e.orchestrationChords.databaseEntries.tgt[r],e.orchestrationChords.databaseEntries.onoff[r],r,0])}))}})),l=l.filter((function(e,t,r){if(!e[5])return!1;try{return e[3]>=te[e[0]][e[1]][e[2]][0]&&e[3]<=te[e[0]][e[1]][e[2]][1]}catch(n){return!1}})),$.a.post(He+"modalSlice",l).then((function(t){var r=t.data,n=a.sourceNote.parentStaffEntry.verticalContainerParent.parentMeasure.measureNumber,s=e.orchestrationChords.xpos[String(o)]-1;e.osmd.graphic.MusicPages[0];r&&(d&&h.map((function(t){var a=e.osmd.graphic.musicSheet.sourceMeasures[n-1].verticalMeasureList[t].boundingBox.absolutePosition.y+2;new E.PointF2D(s,a),new E.PointF2D(s+2,a);r[0]>=75||r[0]})),r[1]&&r[1].map((function(t,r){var a=e.osmd.graphic.musicSheet.sourceMeasures[n-1].verticalMeasureList[t].boundingBox.absolutePosition.y+2;new E.PointF2D(s,a),new E.PointF2D(s+2,a)}))),e.setState((function(e){return e.modalData=[r,l,i]}))})).finally((function(){e.setState((function(e){e.open=!0,e.time=Date.now()})),e.forceUpdate()}))}},onMouseOver:function(t){if(e.state.showTooltip){var r=t.clientX,s=t.clientY,a=new E.PointF2D(r,s);a=e.osmd.graphic.domToSvg(a),a=e.osmd.graphic.svgToOsmd(a);var o=e.osmd.graphic.tryGetTimeStampFromPosition(a);if("undefined"!==typeof o){for(e.osmd.cursor.hide(),e.osmd.cursor.cursorOptions.color="purple",e.osmd.cursor.reset();e.osmd.cursor.iterator.currentTimeStamp.RealValue!=o.realValue;)e.osmd.cursor.next();e.osmd.cursor.show();var i=e.orchestrationChords.notes[o.realValue],c=e.orchestrationChords.predictions[o.realValue],l=[],h=[];i.map((function(t,r){if(e.orchestrationChords.databaseEntries.tgt[r]&&h.push(r),t.length>0){var n=[];"from_score"!==e.orchestrationChords.databaseEntries.dyn[r]&&(n=e.orchestrationChords.databaseEntries.dyn[r]),e.orchestrationChords.databaseEntries.tgt[r]&&!0,t.map((function(t){0===n.length&&["ppppp","pppp","ppp","pp","p"].includes(t.dynamic)?n="p":0===n.length&&["fffff","ffff","fff","ff","f","sfz","sf"].includes(t.dynamic)?n="f":0===n.length&&["mf","mp","mfz"].includes(t.dynamic)&&(n="mf"),l.push([e.orchestrationChords.databaseEntries.inst[r],e.orchestrationChords.databaseEntries.tech[r],n,t.note+12+e.orchestrationChords.databaseEntries.modify[r],e.orchestrationChords.databaseEntries.tgt[r]])}))}}));var d="";if(c>=0){c=100-c;var u=e.orchestrationChords.maskers[o.realValue],f=Object(A.jsxs)("div",{children:[" ",Object(A.jsxs)(p.a,{variant:"caption",component:"div",color:"text.secondary",children:["Possible masker: ",e.orchestrationChords.instruments[u[0]]]})]});d=Object(A.jsxs)("div",{children:[Object(A.jsx)(p.a,{variant:"caption",component:"div",color:"text.secondary",children:"Target audibility prediction:"}),Object(A.jsxs)(g.a,{sx:{position:"relative",display:"inline-flex"},children:[Object(A.jsx)(ke.a,{variant:"determinate",value:c,color:c<=30?"error":c<=50?"warning":"success"}),Object(A.jsx)(g.a,{sx:{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center"},children:Object(A.jsx)(p.a,{variant:"caption",component:"div",color:"text.secondary",children:"".concat(Math.round(c),"%")})})]}),f]})}l.sort((function(e,t){return e[3]-t[3]}));var b=l.map((function(e){return function(e){var t=e-Math.floor(e),r=Math.round(e),s=n[r%12];return t>=.2&&t<.5?/[#]/.test(s)?s=n[(r+1)%12]+"d":s+="+":t>=.5&&t<=.8&&(/[#]/.test(s)?s=n[(r-1)%12]+"+":s+="d"),s+(Math.floor(r/12)-1)}(e[3])})),j=l.map((function(e){return e[0]})),m=l.map((function(e,t){if(e[4])return t})),x=Object(A.jsxs)("div",{style:{textAlign:"center",margin:"auto",verticalAlign:"bottom",backgroundColor:"#fffef0cc",width:200},children:[Object(A.jsx)("div",{style:{color:"black"},children:"Orchestration under mouse pointer, target on green. Click to see detailed analysis."}),d,Object(A.jsx)(le,{notes:b,instruments:j,target:m,target_color:"green",height:250,width:160,scale:.7})]});e.setState((function(e){return e.tooltip=x}))}}else e.setState((function(e){return e.tooltip="click any note for orchestration details"})),e.osmd.cursor.hide()},onMouseLeave:function(){e.osmd.cursor.hide()}})})}),Object(A.jsx)(Ie,{handleClose:this.handleClose,help:this.props.help,open:this.state.open,time:this.state.time,data:this.state.modalData}),Object(A.jsxs)(Ae.a,{sx:{color:"#fff",zIndex:function(e){return e.zIndex.drawer+1}},open:this.state.loading,children:[Object(A.jsx)(ke.a,{disableShrink:!0,color:"success"}),Object(A.jsx)(p.a,{children:" Calculating... (for large scores, 30+ staves and 100+ measures, this can take several minutes)"})]}),Object(A.jsx)("div",{style:{display:"none"},children:this.state.tooltip})]})}}]),r}(n.Component),Fe=r(149),Ve=(r(272),r(356)),We=r(190),Ge=r(50),Be=r.n(Ge),Ue=r(83),Ke=r.n(Ue),Je=r(68),qe=r.n(Je),Xe=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],Ye=["Db","Eb","Gb","Ab","Bb"],Qe={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11},$e=/([a-g])([#b]?)(\d+)/;var Ze=qe()(12,128).reduce((function(e,t){return e[t]=function(e){var t=(e-12)%12,r=Math.floor((e-12)/12),n=Xe[t];return{note:"".concat(n).concat(r),pitchName:n,octave:r,midiNumber:e,isAccidental:Ye.includes(n)}}(t),e}),{});function et(e){var t=Ze[e];if(!t)throw Error("Invalid MIDI number");return t}var tt=qe()(12,128).filter((function(e){return!et(e).isAccidental})),rt={fromNote:function(e){if(!e)throw Error("Invalid note argument");var t=$e.exec(e.toLowerCase());if(!t)throw Error("Invalid note argument");var r=Object(b.a)(t,4),n=r[1],s=r[2],a=r[3],o="".concat(n.toUpperCase()).concat(s),i=Qe[o];if(null==i)throw Error("Invalid note argument");return 12+i+12*parseInt(a,10)},getAttributes:et,MIN_MIDI_NUMBER:12,MAX_MIDI_NUMBER:127,NATURAL_MIDI_NUMBERS:tt},nt=function(e){Object(h.a)(r,e);var t=Object(d.a)(r);function r(){var e;Object(i.a)(this,r);for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return(e=t.call.apply(t,[this].concat(s))).onPlayNoteInput=function(){e.props.onPlayNoteInput(e.props.midiNumber)},e.onStopNoteInput=function(){e.props.onStopNoteInput(e.props.midiNumber)},e.onLeaveNote=function(){e.props.onLeaveNote(e.props.midiNumber)},e}return Object(c.a)(r,[{key:"getAbsoluteKeyPosition",value:function(e){var t=rt.getAttributes(e),r=t.octave,n=t.pitchName;return this.props.pitchPositions[n]+7*r}},{key:"getRelativeKeyPosition",value:function(e){return this.getAbsoluteKeyPosition(e)-this.getAbsoluteKeyPosition(this.props.noteRange.first)}},{key:"render",value:function(){var e=this.props,t=e.naturalKeyWidth,r=e.accidentalWidthRatio,n=e.midiNumber,s=e.gliss,a=e.useTouchEvents,o=e.accidental,i=e.active,c=e.disabled,l=e.children;return Object(A.jsx)("div",{className:Be()("ReactPiano__Key",{"ReactPiano__Key--accidental":o,"ReactPiano__Key--natural":!o,"ReactPiano__Key--disabled":c,"ReactPiano__Key--active":i}),style:{left:st(this.getRelativeKeyPosition(n)*t),width:st(o?r*t:t)},onMouseDown:a?null:this.onPlayNoteInput,onMouseUp:a?null:this.onStopNoteInput,onMouseEnter:null,onMouseLeave:s?this.onStopNoteInput:null,onTouchStart:a?this.onPlayNoteInput:null,onTouchCancel:s?this.onStopNoteInput:null,onTouchMove:null,onTouchEnd:a?this.onStopNoteInput:null,children:Object(A.jsx)("div",{className:"ReactPiano__NoteLabelContainer",children:l})})}}]),r}(s.a.Component);function st(e){return"".concat(100*e,"%")}nt.defaultProps={accidentalWidthRatio:.65,pitchPositions:{C:0,Db:.55,D:1,Eb:1.8,E:2,F:3,Gb:3.5,G:4,Ab:4.7,A:5,Bb:5.85,B:6}};var at=nt,ot=function(e){Object(h.a)(r,e);var t=Object(d.a)(r);function r(){return Object(i.a)(this,r),t.apply(this,arguments)}return Object(c.a)(r,[{key:"getMidiNumbers",value:function(){return qe()(this.props.noteRange.first,this.props.noteRange.last+1)}},{key:"getNaturalKeyCount",value:function(){return this.getMidiNumbers().filter((function(e){return!rt.getAttributes(e).isAccidental})).length}},{key:"getNaturalKeyWidth",value:function(){return 1/this.getNaturalKeyCount()}},{key:"getWidth",value:function(){return this.props.width?this.props.width:"100%"}},{key:"getHeight",value:function(){if(!this.props.width)return"100%";var e=this.props.width*this.getNaturalKeyWidth();return"".concat(e/this.props.keyWidthToHeight,"px")}},{key:"render",value:function(){var e=this,t=this.getNaturalKeyWidth();return Object(A.jsx)("div",{className:Be()("ReactPiano__Keyboard",this.props.className),style:{width:this.getWidth(),height:this.getHeight()},children:this.getMidiNumbers().map((function(r){var n=rt.getAttributes(r),s=(n.note,n.isAccidental),a=!e.props.disabled&&e.props.activeNotes.includes(r);return Object(A.jsx)(at,{naturalKeyWidth:t,midiNumber:r,noteRange:e.props.noteRange,active:a,accidental:s,disabled:e.props.disabled,onPlayNoteInput:e.props.onPlayNoteInput,onStopNoteInput:e.props.onStopNoteInput,onLeaveNote:e.props.onLeaveNote,gliss:e.props.gliss,useTouchEvents:e.props.useTouchEvents,children:e.props.disabled?null:e.props.renderNoteLabel({isActive:a,isAccidental:s,midiNumber:r})},r)}))})}}]),r}(s.a.Component);ot.defaultProps={disabled:!1,gliss:!1,useTouchEvents:!1,keyWidthToHeight:.33,renderNoteLabel:function(){}};var it=ot,ct=function(e){Object(h.a)(r,e);var t=Object(d.a)(r);function r(){var e;Object(i.a)(this,r);for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return(e=t.call.apply(t,[this].concat(s))).state={isMouseDown:!1,useTouchEvents:!1},e.handleNoteChanges=function(t){var r=t.prevActiveNotes,n=t.nextActiveNotes;if(!e.props.disabled){var s=Ke()(r,n);Ke()(n,r).forEach((function(t){e.props.playNote(t)})),s.forEach((function(t){e.props.stopNote(t)}))}},e.getMidiNumberForKey=function(t){if(!e.props.keyboardShortcuts)return null;var r=e.props.keyboardShortcuts.find((function(e){return e.key===t}));return r&&r.midiNumber},e.getKeyForMidiNumber=function(t){if(!e.props.keyboardShortcuts)return null;var r=e.props.keyboardShortcuts.find((function(e){return e.midiNumber===t}));return r&&r.key},e.onKeyDown=function(t){if(!(t.ctrlKey||t.metaKey||t.shiftKey)){var r=e.getMidiNumberForKey(t.key);r&&e.onPlayNoteInput(r)}},e.onKeyUp=function(t){var r=e.getMidiNumberForKey(t.key);r&&e.onStopNoteInput(r)},e.onPlayNoteInput=function(t){e.props.disabled||e.props.onPlayNoteInput(t,e.props.activeNotes)},e.onStopNoteInput=function(t){e.props.disabled||e.props.onStopNoteInput(t,e.props.activeNotes)},e.onLeaveNote=function(t){e.props.disabled||e.props.onLeaveNote(t,e.props.activeNotes)},e.onMouseDown=function(){e.setState({isMouseDown:!0})},e.onMouseUp=function(){e.setState({isMouseDown:!1})},e.onTouchStart=function(){e.setState({useTouchEvents:!0})},e.renderNoteLabel=function(t){var r=t.midiNumber,n=t.isActive,s=t.isAccidental,a=e.getKeyForMidiNumber(r);return e.props.renderNoteLabel({keyboardShortcut:a,midiNumber:r,isActive:n,isAccidental:s})},e}return Object(c.a)(r,[{key:"componentDidMount",value:function(){window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}},{key:"componentDidUpdate",value:function(e,t){this.props.activeNotes!==e.activeNotes&&this.handleNoteChanges({prevActiveNotes:e.activeNotes||[],nextActiveNotes:this.props.activeNotes||[]})}},{key:"render",value:function(){return Object(A.jsx)("div",{style:{width:"100%",height:"100%"},onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onTouchStart:this.onTouchStart,"data-testid":"container",children:Object(A.jsx)(it,{noteRange:this.props.noteRange,onPlayNoteInput:this.onPlayNoteInput,onStopNoteInput:this.onStopNoteInput,onLeaveNote:this.onLeaveNote,activeNotes:this.props.activeNotes,className:this.props.className,disabled:this.props.disabled,width:this.props.width,keyWidthToHeight:this.props.keyWidthToHeight,gliss:this.state.isMouseDown,useTouchEvents:this.state.useTouchEvents,renderNoteLabel:this.renderNoteLabel})})}}]),r}(s.a.Component);ct.defaultProps={renderNoteLabel:function(e){var t=e.keyboardShortcut,r=(e.midiNumber,e.isActive),n=e.isAccidental;return t?Object(A.jsx)("div",{className:Be()("ReactPiano__NoteLabel",{"ReactPiano__NoteLabel--active":r,"ReactPiano__NoteLabel--accidental":n,"ReactPiano__NoteLabel--natural":!n}),children:t}):null}};var lt=ct,ht=["activeNotes","onPlayNoteInput","onStopNoteInput"],dt=function(e){Object(h.a)(r,e);var t=Object(d.a)(r);function r(){var e;Object(i.a)(this,r);for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return(e=t.call.apply(t,[this].concat(s))).state={activeNotes:e.props.activeNotes||[]},e.handlePlayNoteInput=function(t){e.setState((function(r){return e.props.onPlayNoteInput&&e.props.onPlayNoteInput(t,{prevActiveNotes:r.activeNotes}),r.activeNotes.includes(t)?null:{activeNotes:r.activeNotes.concat(t)}}))},e.handleStopNoteInput=function(t){e.setState((function(r){return e.props.onStopNoteInput&&e.props.onStopNoteInput(t),{activeNotes:r.activeNotes.filter((function(e){return t!==e}))}}))},e.handleLeave=function(t){e.setState((function(e){return{activeNotes:e.activeNotes.filter((function(e){return t!==e}))}}))},e}return Object(c.a)(r,[{key:"componentDidUpdate",value:function(e){e.activeNotes!==this.props.activeNotes&&this.state.activeNotes!==this.props.activeNotes&&this.setState({activeNotes:this.props.activeNotes||[]})}},{key:"render",value:function(){var e=this.props,t=(e.activeNotes,e.onPlayNoteInput,e.onStopNoteInput,Object(We.a)(e,ht));return Object(A.jsx)(lt,Object(u.a)({activeNotes:this.state.activeNotes,onLeaveNote:this.handleLeave,onPlayNoteInput:this.handlePlayNoteInput,onStopNoteInput:this.handleStopNoteInput},t))}}]),r}(s.a.Component),ut=dt,ft=(r(179),r(73)),bt=ie.a.Flow,jt=function(e){var t=e.note;return Object(A.jsx)("div",{ref:function(e){if(e){for(var r=e;r.hasChildNodes();)r.removeChild(r.lastChild);var n=new bt.Renderer(r,bt.Renderer.Backends.SVG);n.resize(100,100);var s=n.getContext();s.scale(.5,.5);var a=new ft.a(20,40,150);a.setContext(s);var o=t.filter((function(e,t,r){return parseInt(e.slice(-1))<4})),i=t.filter((function(e,t,r){return parseInt(e.slice(-1))>=4})),c="treble";o.length>i.length&&(c="bass"),a.setClef(c);var l=[],h=[];if(t.map((function(e){var t=e.slice(0,1)+"/"+e.slice(-1),r=e.slice(-2,-1);/[#db+n]/.test(r)||(r="n"),l.push(t),h.push(r)})),0===t.length)a.draw();else{var d=new bt.StaveNote({clef:c,keys:l,duration:"4"});h.map((function(e,t){return d.addAccidental(t,new bt.Accidental(e))}));var u=new bt.Voice({num_beats:1,beat_value:4});u.addTickables([d]),a.draw();(new bt.Formatter).joinVoices([u]).formatToStave([u],a);u.draw(s,a)}}}})};function pt(e){var t=0;"number"===typeof e.data[7]&&(t=e.data[7]);var r=Object(n.useState)({idx:e.data[6],scoreNames:e.data[0],scoreTechs:e.data[1],scoreDyns:e.data[2],scorePitch:e.data[3],scoreTgt:e.data[4],scoreOnoff:e.data[5],scoreIdx:e.data[6],scoreMicro:t,scoreModify:0,popOpen:!1,anchorEl:null}),s=Object(b.a)(r,2),a=s[0],o=s[1],i=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function c(e){var t=e-Math.floor(e),r=Math.round(e),n=i[r%12];return t>=.2&&t<.5?/[#]/.test(n)?n=i[(r+1)%12]+"d":n+="+":t>=.5&&t<=.8&&(/[#]/.test(n)?n=i[(r-1)%12]+"+":n+="d"),n+(Math.floor(r/12)-1)}var l,h,d=function(e){var t=e.currentTarget;o((function(e){return Object(u.a)(Object(u.a)({},e),{},{popOpen:!e.popOpen,anchorEl:t})}))},f=function(){o((function(e){return Object(u.a)(Object(u.a)({},e),{},{anchorEl:null,popOpen:!1})})),e.onChange([a.scoreNames,a.scoreTechs,a.scoreDyns,a.scorePitch,a.scoreTgt,a.scoreOnoff,a.scoreIdx,a.scoreMicro])},m=function(e,t){o((function(e){return Object(u.a)(Object(u.a)({},e),{},{scoreMicro:t})}))},x=function(t,r){e.onChange([a.scoreNames,a.scoreTechs,a.scoreDyns,a.scorePitch,a.scoreTgt,a.scoreOnoff,a.scoreIdx,a.scoreMicro])},v=function(){return o((function(e){return Object(u.a)(Object(u.a)({},e),{},{scoreMicro:0})}))};a.scorePitch.map((function(e){return c(e)}));return Object(A.jsxs)("tr",{children:[Object(A.jsx)("td",{children:a.instName},"nam"+a.idx),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"InstrDropdown"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsx)("td",{children:function(t,r){var n=Object.keys(te);return Object(A.jsx)("div",{children:Object(A.jsxs)(W.a,{sx:{m:1,minWidth:50},children:[Object(A.jsx)(V.a,{id:"instrument-select",children:"Instr."}),Object(A.jsx)(F.a,{labelId:"instrument-select",id:"instrument-sel"+r,value:t,onChange:function(t){return function(t,r){var n=r.target.value;o((function(e){return Object(u.a)(Object(u.a)({},e),{},{popOpen:!1})})),o((function(e){return Object(u.a)(Object(u.a)({},e),{},{scoreNames:n,scoreTechs:"normal",scoreDyns:"mf"})})),e.onChange([n,"normal","mf",a.scorePitch,a.scoreTgt,a.scoreOnoff,a.scoreIdx,a.scoreMicro])}(0,t)},autoWidth:!0,label:"instr.",children:n.map((function(e){return Object(A.jsx)(S.a,{value:e,children:e})}))})]})})}(a.scoreNames,a.idx)},"scor"+a.idx)}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"AnTech"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsx)("td",{children:function(t,r){var n=Object.keys(te[a.scoreNames]);return Object(A.jsx)("div",{children:Object(A.jsxs)(W.a,{sx:{m:1,minWidth:50},children:[Object(A.jsx)(V.a,{id:"tech-select",children:"Tech."}),Object(A.jsx)(F.a,{labelId:"tech-select",id:"tech-sel"+r,value:t,onChange:function(t){return function(t,r){var n=r.target.value;o((function(e){return Object(u.a)(Object(u.a)({},e),{},{scoreTechs:n})})),e.onChange([a.scoreNames,n,a.scoreDyns,a.scorePitch,a.scoreTgt,a.scoreOnoff,a.scoreIdx,a.scoreMicro])}(0,t)},autoWidth:!0,label:"tech.",children:n.map((function(e){return Object(A.jsx)(S.a,{value:e,children:e})}))})]})})}(a.scoreTechs,a.idx)},"tec"+a.idx)}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"AnDyn"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsx)("td",{children:function(t,r){var n=Object.keys(te[a.scoreNames][a.scoreTechs]);return Object(A.jsx)("div",{children:Object(A.jsxs)(W.a,{sx:{m:1,minWidth:50},children:[Object(A.jsx)(V.a,{id:"dyn-select",children:"Dyn."}),Object(A.jsx)(F.a,{labelId:"dyn-select",id:"dyn-sel"+r,value:t,onChange:function(t){return function(t,r){var n=r.target.value;o((function(e){return Object(u.a)(Object(u.a)({},e),{},{scoreDyns:n})})),e.onChange([a.scoreNames,a.scoreTechs,n,a.scorePitch,a.scoreTgt,a.scoreOnoff,a.scoreIdx,a.scoreMicro])}(0,t)},autoWidth:!0,label:"dyn.",children:n.map((function(e){return Object(A.jsx)(S.a,{value:e,children:e})}))})]})})}(a.scoreDyns,a.idx)},"dy"+a.idx)}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"AnMicro"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsx)("td",{children:(a.scoreMicro,a.idx,Object(A.jsxs)(g.a,{sx:{width:70},children:[Object(A.jsxs)(we.a,{spacing:0,direction:"row",sx:{mb:1},alignItems:"center",children:[Object(A.jsx)(p.a,{variant:"caption",style:{textAlign:"center"},children:" tune "}),Object(A.jsx)(O.a,{"aria-label":"zero",size:"small",onClick:v,children:Object(A.jsx)(p.a,{variant:"caption",style:{textAlign:"center"},children:" (reset) "})})]}),Object(A.jsxs)(we.a,{spacing:1,direction:"row",sx:{mb:1},alignItems:"center",children:[Object(A.jsx)("img",{src:"/flat.png",height:"20"}),Object(A.jsx)(H.a,{valueLabelDisplay:"auto","aria-label":"tune",size:"small",min:-.49,step:.01,max:.49,value:a.scoreMicro,onChangeCommitted:x,onChange:m}),Object(A.jsx)("img",{src:"/sharp.png",height:"20"})]})]}))},"mi"+a.idx)}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"SelPitch"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsx)("td",{children:function(e,t){var r=[te[a.scoreNames][a.scoreTechs][a.scoreDyns][0],te[a.scoreNames][a.scoreTechs][a.scoreDyns][te[a.scoreNames][a.scoreTechs][a.scoreDyns].length-1]];return Object(A.jsxs)("div",{children:[Object(A.jsx)("div",{"aria-describedby":t,onClick:d,children:Object(A.jsx)(jt,{note:a.scorePitch.sort().map((function(e){return c(e+a.scoreMicro)}))})}),Object(A.jsx)(Ve.a,{id:t,open:a.popOpen,anchorEl:a.anchorEl,onClose:f,style:{zIndex:1e4},anchorOrigin:{vertical:"bottom",horizontal:"left"},sx:{marginTop:3},transformOrigin:{vertical:"bottom",horizontal:"right"},children:Object(A.jsx)(g.a,{sx:{border:1,p:1,bgcolor:"white"},children:Object(A.jsx)(ut,{noteRange:{first:r[0],last:r[1]},activeNotes:a.scorePitch,playNote:function(e){},stopNote:function(e){var t=Object(z.a)(a.scorePitch);if(t.includes(e)){var r=t.filter((function(t,r,n){return t!=e}));o((function(e){return Object(u.a)(Object(u.a)({},e),{},{scorePitch:r})}))}else t.push(e),o((function(e){return Object(u.a)(Object(u.a)({},e),{},{scorePitch:t})}))},width:400})})})]})}(a.scorePitch,"pi"+a.idx)},"pi"+a.idx)}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"ClearPitch"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsxs)("td",{children:[" ",Object(A.jsx)(k.a,{variant:"outlined",color:"warning",onClick:function(){o((function(e){return Object(u.a)(Object(u.a)({},e),{},{popOpen:!1})})),o((function(e){return Object(u.a)(Object(u.a)({},e),{},{scorePitch:[]})})),o((function(e){return Object(u.a)(Object(u.a)({},e),{},{scoreMicro:0})})),e.onChange([a.scoreNames,a.scoreTechs,a.scoreDyns,[],a.scoreTgt,a.scoreOnoff,a.scoreIdx,0])},size:"small",children:" clear notes "})]})}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"AnTgt"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsx)("td",{children:Object(A.jsx)("div",{style:{border:"1px solid lightGray",borderRadius:5,padding:8},children:Object(A.jsxs)(we.a,{direction:"row",spacing:1,alignItems:"center",children:[Object(A.jsx)(p.a,{children:"orch."}),Object(A.jsx)(Ne.a,{checked:a.scoreTgt,color:"secondary",onChange:function(t){return function(t,r){var n=r.target.checked;o((function(e){return Object(u.a)(Object(u.a)({},e),{},{scoreTgt:n})})),e.onChange([a.scoreNames,a.scoreTechs,a.scoreDyns,a.scorePitch,n,a.scoreOnoff,a.scoreIdx,a.scoreMicro])}(a.idx,t)}},"tgtswitch"+a.idx),Object(A.jsx)(p.a,{children:"tgt"})]})})},"tg"+a.idx)}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"AnOnoff"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsx)("td",{children:Object(A.jsx)("div",{style:{border:"1px solid lightGray",borderRadius:5,padding:8},children:Object(A.jsxs)(we.a,{direction:"row",spacing:1,alignItems:"center",children:[Object(A.jsx)(p.a,{children:"off"}),Object(A.jsx)(Ne.a,{checked:a.scoreOnoff,onChange:function(t){return function(t,r){var n=r.target.checked;o((function(e){return Object(u.a)(Object(u.a)({},e),{},{scoreOnoff:n})})),e.onChange([a.scoreNames,a.scoreTechs,a.scoreDyns,a.scorePitch,a.scoreTgt,n,a.scoreIdx,a.scoreMicro])}(a.idx,t)}},"onoffswitch"+a.idx),Object(A.jsx)(p.a,{children:"on"})]})})},"onoff"+a.idx)}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"ChordTranspose"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsx)("td",{children:(l=a.scoreModify,h=a.idx,Object(A.jsx)("div",{children:Object(A.jsxs)(W.a,{sx:{m:1,minWidth:50},children:[Object(A.jsx)(V.a,{id:"mod-select",children:"Transpose"}),Object(A.jsx)(F.a,{labelId:"mod-select",id:"mod-sel"+h,value:l,onChange:function(t){return function(t,r){var n=r.target.value,s=a.scorePitch.map((function(e){return e+n>=te[a.scoreNames][a.scoreTechs][a.scoreDyns][0]&&e+n<=te[a.scoreNames][a.scoreTechs][a.scoreDyns][1]?e+n:null}));s=s.filter((function(e,t,r){return null!=e})),console.log(s),o((function(e){return Object(u.a)(Object(u.a)({},e),{},{scorePitch:s,scoreModify:0})})),e.onChange([a.scoreNames,a.scoreTechs,a.scoreDyns,s,a.scoreTgt,a.scoreOnoff,a.scoreIdx,a.scoreMicro])}(0,t)},autoWidth:!0,label:"trans.",children:[0,12,-12,24,-24].map((function(e){return Object(A.jsx)(S.a,{value:e,children:e})}))})]})}))},"mod"+a.idx)}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"DelInstr"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsxs)("td",{children:[" ",Object(A.jsx)(k.a,{variant:"outlined",color:"warning",onClick:function(t){return e.onDelete(a.scoreIdx)},size:"small",children:" delete "})]})})]})}var mt=Object(N.a)({palette:{neutral:{main:"#dcc4ac",contrastText:"#black"}}});console.log(xe);var gt=xe;function xt(e){var t=Object(n.useState)({instList:[],listenList:[],data:[],selected:null,saved:!1,audibilityPercent:0,textFieldValue:"Chord Editor orchestration "+JSON.parse(localStorage.getItem("orchestrations")).length}),r=Object(b.a)(t,2),s=r[0],a=r[1];n.useEffect((function(){if(null!=sessionStorage.getItem("LastChord")){var e=JSON.parse(sessionStorage.getItem("LastChord"));a((function(t){return Object(u.a)(Object(u.a)({},t),{},{instList:e})})),o(e)}}),[]);var o=function(e){var t=[],r=[],n=0;e.map((function(e,s){e[3].map((function(s){var a=0;"number"===typeof e[7]&&(a=e[7]),e[5]&&(t.push([e[0],e[1],e[2],s,e[4],e[5],n,a]),r.push([e[0],e[1],e[2],s+a,e[4],e[5],n])),n+=1}))})),$.a.post(gt+"modalSlice",t).then((function(e){var t=e.data;a((function(e){return Object(u.a)(Object(u.a)({},e),{},{data:t.data,listenList:r,audibilityPercent:100-t.data[2].masking_percent})}))}))},i=function(e){e.persist();var t=e.target.textContent.toLowerCase(),r=Object(z.a)(s.instList),n="normal";"percussion_misc"===t&&(n="castanet");var o="mf";"crotale"===t&&(o="f");var i=[];te[t][n][o][0]===te[t][n][o][1]&&(i=[te[t][n][o][0]]),0===r.length?r.push([t,n,o,i,!1,!0,0]):r.push([t,n,o,i,!1,!0,r[r.length-1][6]+1]),console.log(r),a((function(e){return Object(u.a)(Object(u.a)({},e),{},{instList:r})}))},c=function(e){console.log(s.instList);var t=s.instList.filter((function(t,r,n){return t[6]!=e}));console.log(t),a((function(e){return Object(u.a)(Object(u.a)({},e),{},{instList:t})})),o(t)};return Object(A.jsxs)(A.Fragment,{children:[Object(A.jsxs)(L.a,{theme:mt,children:[Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"ClearInstr"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsx)(k.a,{variant:"contained",color:"warning",onClick:function(){a((function(e){return Object(u.a)(Object(u.a)({},e),{},{instList:[],listenList:[],data:[],selected:null,saved:!1})}))},children:" Clear all instruments "})}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"SelectSaved"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsxs)("div",{style:{textAlign:"center",margin:"auto"},children:[Object(A.jsx)(p.a,{style:{textAlign:"center"},children:" Select orchestration from your saved orchestrations  "}),Object(A.jsxs)(W.a,{sx:{m:1,minWidth:"50vw",textAlign:"center",margin:"auto"},children:[Object(A.jsx)(V.a,{id:"orchestration-select",children:"Orchestrations"}),Object(A.jsx)(F.a,{labelId:"orchestration-select",id:"orchestration-select1",value:s.selected,onChange:function(e){var t=e.target.value,r=JSON.parse(localStorage.getItem("orchestrations")).filter((function(e,r,n){return e.id===t}))[0].data.map((function(e,t){return[e[0],e[1],e[2],e[3],e[4],e[5],t]}));a((function(e){return Object(u.a)(Object(u.a)({},e),{},{instList:r,selected:t})})),o(r)},autoWidth:!0,label:"orch.",children:null===localStorage.getItem("orchestrations")?null:JSON.parse(localStorage.getItem("orchestrations")).map((function(e){return Object(A.jsx)(S.a,{value:e.id,children:e.name})}))})]})]})}),Object(A.jsx)(p.a,{style:{textAlign:"center"},children:" or/and  "}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"AddInstr"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsxs)("div",{children:[Object(A.jsx)(p.a,{style:{textAlign:"center"},children:" Click below to add instrument to orchestration  "}),Object(A.jsx)("table",{children:Object(A.jsxs)("tbody",{children:[Object(A.jsxs)("tr",{children:[Object(A.jsx)("td",{children:"Woodwinds"}),Object(A.jsx)("td",{children:"Brass"}),Object(A.jsx)("td",{children:"Strings"}),Object(A.jsx)("td",{children:"Percussion"}),Object(A.jsx)("td",{children:"Various"})]}),Object(A.jsxs)("tr",{children:[Object(A.jsx)("td",{children:["piccolo","flute","alto_flute","bass_flute","oboe","english_horn","clarinet","clarinet_eb","bass_cl","bassoon"].map((function(e){return Object(A.jsx)(k.a,{variant:"contained",onClick:i,color:"neutral",size:"small",children:e})}))}),Object(A.jsx)("td",{children:["trumpet","horn","tenor_trombone","bass_trombone","soprano_sax","alto_sax"].map((function(e){return Object(A.jsx)(k.a,{variant:"contained",onClick:i,color:"neutral",size:"small",children:e})}))}),Object(A.jsx)("td",{children:["violin","viola","cello","double_bass","solo_violin","solo_viola","solo_cello","solo_double_bass"].map((function(e){return Object(A.jsx)(k.a,{variant:"contained",onClick:i,color:"neutral",size:"small",children:e})}))}),Object(A.jsx)("td",{children:["crotale","cymbal","percussion_misc","tambourine","tamtam","tamtam_22","tamtam_40","thaigong","triangle_6","triangle_8","vibraphone","woodblock","xylophone","timp"].map((function(e){return Object(A.jsx)(k.a,{variant:"contained",onClick:i,color:"neutral",size:"small",children:e})}))}),Object(A.jsx)("td",{children:["piano","harp","guitar","soprano_generic","tenor_generic","baritone_generic"].map((function(e){return Object(A.jsx)(k.a,{variant:"contained",onClick:i,color:"neutral",size:"small",children:e})}))})]})]})})]})}),Object(A.jsx)("div",{style:{zoom:1},children:Object(A.jsx)("table",{children:s.instList.map((function(t,r){return Object(A.jsx)(pt,{help:e.help,data:t,onChange:function(e){return function(e,t){var r=Object(z.a)(s.instList);r[e]=t,a((function(e){return Object(u.a)(Object(u.a)({},e),{},{instList:r,saved:!1})})),sessionStorage.setItem("LastChord",JSON.stringify(r)),o(r)}(r,e)},onDelete:c,idx:"fgfg"+r},t)}))})})]}),Object(A.jsx)("br",{}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"Prediction"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsxs)("div",{style:{margin:"auto",textAlign:"center"},children:[Object(A.jsx)(p.a,{variant:"caption",component:"div",color:"text.secondary",children:"Target audibility prediction:"}),Object(A.jsxs)(g.a,{sx:{position:"relative",display:"inline-flex"},children:[Object(A.jsx)(ke.a,{variant:"determinate",value:s.audibilityPercent,color:s.audibilityPercent<=30?"error":s.audibilityPercent<=50?"warning":"success"}),Object(A.jsx)(g.a,{sx:{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center"},children:Object(A.jsx)(p.a,{variant:"caption",component:"div",color:"text.secondary",children:"".concat(Math.round(s.audibilityPercent),"%")})})]})]})}),Object(A.jsx)("br",{}),Object(A.jsxs)(L.a,{theme:mt,children:[Object(A.jsx)(k.a,{variant:"contained",color:"neutral",onClick:function(){return o(s.instList)},style:{display:"none"},children:" Click to update graphs "}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"SaveOrch"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsx)("div",{children:Object(A.jsx)(ye,{text:s.textFieldValue,orchestration:s.instList})})})]}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"QuickListen"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsx)("div",{style:{textAlign:"center",margin:"auto"},children:Object(A.jsx)(_e,{instrumentList:s.listenList})})}),Object(A.jsx)(pe,{data:s.data,help:e.help}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"Listen"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsx)("div",{children:Object(A.jsx)(ve,{instrumentList:s.listenList})})})]})}var Ot=n.forwardRef((function(e,t){return Object(A.jsx)(se.a,Object(u.a)({direction:"up",ref:t},e))}));function vt(e){var t=n.useState(!1),r=Object(b.a)(t,2),s=r[0],a=r[1];return n.useEffect((function(){a((function(t){return e.open}))}),[e]),Object(A.jsx)("div",{children:Object(A.jsx)(re.a,{fullScreen:!0,open:s,onClose:e.handleClose,TransitionComponent:Ot,PaperProps:{style:{backgroundColor:"#fffef0"}},children:Object(A.jsx)(xt,{help:e.help})})})}function yt(e){var t=Object(n.useState)({idx:e.data[6],scoreNames:e.data[0],scoreTechs:e.data[1],scoreDyns:e.data[2],scorePitch:e.data[3],scoreTgt:e.data[4],scoreOnoff:e.data[5],scoreIdx:e.data[6],scoreModify:0,popOpen:!1,anchorEl:null}),r=Object(b.a)(t,2),s=r[0],a=r[1],o=["C","C#","D","D#","E","F","F#","G","G#","A","Bb","B"];var i,c,l=function(e){var t=e.currentTarget;a((function(e){return Object(u.a)(Object(u.a)({},e),{},{popOpen:!e.popOpen,anchorEl:t})}))},h=function(){a((function(e){return Object(u.a)(Object(u.a)({},e),{},{anchorEl:null,popOpen:!1})})),e.onChange([s.scoreNames,s.scoreTechs,s.scoreDyns,s.scorePitch,s.scoreTgt,s.scoreOnoff,s.scoreIdx])};return Object(A.jsxs)("tr",{children:[Object(A.jsx)("td",{children:s.instName},"nam"+s.idx),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"InstrDropdown"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsx)("td",{children:function(t,r){var n=Object.keys(te);return Object(A.jsx)("div",{children:Object(A.jsxs)(W.a,{sx:{m:1,minWidth:50},children:[Object(A.jsx)(V.a,{id:"instrument-select",children:"Instr."}),Object(A.jsx)(F.a,{labelId:"instrument-select",id:"instrument-sel"+r,value:t,onChange:function(t){return function(t,r){var n=r.target.value;a((function(e){return Object(u.a)(Object(u.a)({},e),{},{popOpen:!1})}));var o="mf";"crotale"===n&&(o="f");var i="normal";"percussion_misc"===n&&(i="castanet");var c=60;te[n][i][o][0]>60&&(c=te[n][i][o][0]),te[n][i][o][1]<60&&(c=te[n][i][o][0]),a((function(e){return Object(u.a)(Object(u.a)({},e),{},{scorePitch:c,scoreNames:n,scoreTechs:i,scoreDyns:o})})),e.onChange([n,i,o,c,s.scoreTgt,s.scoreOnoff,s.scoreIdx])}(0,t)},autoWidth:!0,label:"instr.",children:n.map((function(e){return Object(A.jsx)(S.a,{value:e,children:e})}))})]})})}(s.scoreNames,s.idx)},"scor"+s.idx)}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"AnTech"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsx)("td",{children:function(t,r){var n=Object.keys(te[s.scoreNames]);return Object(A.jsx)("div",{children:Object(A.jsxs)(W.a,{sx:{m:1,minWidth:50},children:[Object(A.jsx)(V.a,{id:"tech-select",children:"Tech."}),Object(A.jsx)(F.a,{labelId:"tech-select",id:"tech-sel"+r,value:t,onChange:function(t){return function(t,r){var n=r.target.value;a((function(e){return Object(u.a)(Object(u.a)({},e),{},{scoreTechs:n})})),e.onChange([s.scoreNames,n,s.scoreDyns,s.scorePitch,s.scoreTgt,s.scoreOnoff,s.scoreIdx])}(0,t)},autoWidth:!0,label:"tech.",children:n.map((function(e){return Object(A.jsx)(S.a,{value:e,children:e})}))})]})})}(s.scoreTechs,s.idx)},"tec"+s.idx)}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"AnDyn"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsx)("td",{children:function(t,r){var n=Object.keys(te[s.scoreNames][s.scoreTechs]);return Object(A.jsx)("div",{children:Object(A.jsxs)(W.a,{sx:{m:1,minWidth:50},children:[Object(A.jsx)(V.a,{id:"dyn-select",children:"Dyn."}),Object(A.jsx)(F.a,{labelId:"dyn-select",id:"dyn-sel"+r,value:t,onChange:function(t){return function(t,r){var n=r.target.value;a((function(e){return Object(u.a)(Object(u.a)({},e),{},{scoreDyns:n})})),e.onChange([s.scoreNames,s.scoreTechs,n,s.scorePitch,s.scoreTgt,s.scoreOnoff,s.scoreIdx])}(0,t)},autoWidth:!0,label:"dyn.",children:n.map((function(e){return Object(A.jsx)(S.a,{value:e,children:e})}))})]})})}(s.scoreDyns,s.idx)},"dy"+s.idx)}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"CompPitch"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsx)("td",{children:function(e,t){var r,n=[te[s.scoreNames][s.scoreTechs][s.scoreDyns][0],te[s.scoreNames][s.scoreTechs][s.scoreDyns][te[s.scoreNames][s.scoreTechs][s.scoreDyns].length-1]];return Object(A.jsxs)("div",{children:[Object(A.jsx)("div",{"aria-describedby":t,onClick:l,children:Object(A.jsx)(jt,{note:[(r=s.scorePitch,o[r%12]+(Math.floor(r/12)-1))]})}),Object(A.jsx)(Ve.a,{id:t,open:s.popOpen,anchorEl:s.anchorEl,onClose:h,style:{zIndex:1e4},anchorOrigin:{vertical:"bottom",horizontal:"left"},sx:{marginTop:3},transformOrigin:{vertical:"bottom",horizontal:"right"},children:Object(A.jsx)(g.a,{sx:{border:1,p:1,bgcolor:"white"},children:Object(A.jsx)(Fe.a,{noteRange:{first:n[0],last:n[1]},activeNotes:[s.scorePitch],playNote:function(e){},onPlayNoteInput:function(e){a((function(t){return Object(u.a)(Object(u.a)({},t),{},{scorePitch:e})}))},stopNote:function(e){return null},width:400})})})]})}(s.scorePitch,"pi"+s.idx)},"pi"+s.idx)}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"CompTrans"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsx)("td",{children:(i=s.scoreModify,c=s.idx,Object(A.jsx)("div",{children:Object(A.jsxs)(W.a,{sx:{m:1,minWidth:50},children:[Object(A.jsx)(V.a,{id:"mod-select",children:"Transpose"}),Object(A.jsx)(F.a,{labelId:"mod-select",id:"mod-sel"+c,value:i,onChange:function(e){return function(e,t){var r=t.target.value;a((function(e){return Object(u.a)(Object(u.a)({},e),{},{scorePitch:e.scorePitch+r,scoreModify:0})}))}(0,e)},autoWidth:!0,label:"trans.",children:[0,12,-12,24,-24].map((function(e){return Object(A.jsx)(S.a,{value:e,children:e})}))})]})}))},"mod"+s.idx)})]})}var wt=Object(fe.a)(be.a)((function(e){var t=e.theme;return Object(u.a)(Object(u.a)({},t.typography.body2),{},{backgroundColor:"#fffef0",padding:t.spacing(1),textAlign:"center",color:t.palette.text.secondary})}));function Ct(e){var t=e.data,r=e.help;return t.length<2?null:Object(A.jsxs)("div",{children:[Object(A.jsxs)(ue.a,{style:{marginTop:.5},container:!0,direction:"row",justifyContent:"center",alignItems:"center",spacing:.5,children:[Object(A.jsx)(ue.a,{item:!0,xs:12,md:6,children:Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"Overtone"}),disableHoverListener:!r,followCursor:!0,children:Object(A.jsxs)(wt,{style:{height:452,backgroundColor:"#fffef0"},children:[Object(A.jsxs)(p.a,{children:["Overtone structure of ",t[3].instruments[0]]}),Object(A.jsx)(le,{notes:t[1].notes,instruments:t[1].instruments,target:t[1].target,target_color:"red",width:200,text_space:200})]})})}),Object(A.jsx)(ue.a,{item:!0,xs:12,md:6,children:Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"Overtone"}),disableHoverListener:!r,followCursor:!0,children:Object(A.jsxs)(wt,{style:{height:452,backgroundColor:"#fffef0"},children:[Object(A.jsxs)(p.a,{children:["Overtone structure of ",t[3].instruments[1]]}),Object(A.jsx)(le,{notes:t[2].notes,instruments:t[2].instruments,target:t[2].target,target_color:"red",width:200,text_space:200})]})})}),Object(A.jsxs)(ue.a,{style:{marginTop:.5},container:!0,direction:"row",justifyContent:"center",alignItems:"center",spacing:.5,children:[Object(A.jsx)(ue.a,{item:!0,xs:12,md:6,children:Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"CompCentroids"}),disableHoverListener:!r,followCursor:!0,children:Object(A.jsxs)(wt,{style:{height:452,backgroundColor:"#fffef0"},children:[Object(A.jsx)(p.a,{children:"Spectral centroids"}),Object(A.jsx)(le,{notes:t[3].notes,instruments:t[3].instruments,target:[],width:150,text_space:200})]})})}),Object(A.jsx)(ue.a,{item:!0,xs:12,md:6,children:Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"CompGlyph"}),disableHoverListener:!r,followCursor:!0,children:Object(A.jsx)(wt,{children:Object(A.jsx)(oe.a,{data:t[0][1].data,layout:Object(u.a)(Object(u.a)({},t[0][1].layout),{},{width:window.innerWidth/2-50,margin:{l:0,r:0},legend:{orientation:"h"}}),config:{displayModeBar:!1},width:200})})})})]})]}),Object(A.jsx)(ue.a,{style:{marginTop:.5},container:!0,direction:"row",justifyContent:"left",alignItems:"left",spacing:.5,children:Object(A.jsx)(ue.a,{item:!0,xs:12,md:12,children:Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"CompSpectra"}),disableHoverListener:!r,followCursor:!0,children:Object(A.jsx)(wt,{children:Object(A.jsx)(oe.a,{data:t[0][0].data,layout:Object(u.a)(Object(u.a)({},t[0][0].layout),{},{width:window.innerWidth-50,margin:{l:0,r:0},legend:{orientation:"h"},xaxis:{title:{text:"Frequency in Hz",standoff:3},type:"log",showgrid:!1,range:[1.6,4.3]}}),config:{displayModeBar:!1}})})})})})]})}var kt=xe,_t=(Object(fe.a)(be.a)((function(e){var t=e.theme;return Object(u.a)(Object(u.a)({},t.typography.body2),{},{backgroundColor:"#fffef0",padding:t.spacing(1),textAlign:"center",color:t.palette.text.secondary})})),Object(N.a)({palette:{neutral:{main:"#dcc4ac",contrastText:"#black"}}})),St=n.forwardRef((function(e,t){return Object(A.jsx)(se.a,Object(u.a)({direction:"up",ref:t},e))}));function Tt(e){var t=n.useState(!1),r=Object(b.a)(t,2),s=r[0],a=r[1],o=n.useState([["flute","normal","mf",60,0,1,0],["flute","normal","mf",60,0,1,1]]),i=Object(b.a)(o,2),c=i[0],l=i[1],h=n.useState([]),d=Object(b.a)(h,2),u=d[0],f=d[1];n.useEffect((function(){a((function(t){return e.open}))}),[e]),n.useEffect((function(){if(null!=sessionStorage.getItem("LastCompare")){var e=JSON.parse(sessionStorage.getItem("LastCompare"));l((function(){return e})),m(e)}}),[]);var j=function(e){var t=Object(z.a)(c);t[e[6]]=e,l((function(){return t})),sessionStorage.setItem("LastCompare",JSON.stringify(t)),m(t)},m=function(e){var t=[];e.map((function(e){t.push([e[0],e[1],e[2],e[3]])})),$.a.post(kt+"compare",t).then((function(e){var t=e.data;f((function(){return t}))}))};return Object(A.jsx)("div",{children:Object(A.jsxs)(re.a,{fullScreen:!0,open:s,onClose:e.handleClose,TransitionComponent:St,PaperProps:{style:{backgroundColor:"#fffef0"}},children:[Object(A.jsx)(p.a,{style:{textAlign:"center"},children:"Compare two instrument timbres. Select instruments to compare below."}),Object(A.jsx)("table",{style:{marginInline:"20vw"},children:Object(A.jsxs)("tbody",{children:[Object(A.jsx)(yt,{help:e.help,data:c[0],onChange:j}),Object(A.jsx)(yt,{help:e.help,data:c[1],onChange:j})]})}),Object(A.jsx)(L.a,{theme:_t,children:Object(A.jsx)(k.a,{variant:"contained",color:"neutral",onClick:function(){return m(c)},style:{display:"none"},children:" Click to compare"})}),Object(A.jsx)(Ct,{data:u,help:e.help})]})})}var It=r(332),Nt=xe,Lt=n.forwardRef((function(e,t){return Object(A.jsx)(se.a,Object(u.a)({direction:"up",ref:t},e))}));function At(e){var t=["piccolo","flute","alto_flute","bass_flute","oboe","english_horn","clarinet","clarinet_eb","bass_cl","bassoon"],r=["trumpet","horn","tenor_trombone","bass_trombone","soprano_sax","alto_sax"],s=["crotale","cymbal","percussion_misc","tambourine","tamtam","tamtam_22","tamtam_40","thaigong","triangle_6","triangle_8","vibraphone","woodblock","xylophone","timp"],a=["piano","harp","guitar","soprano_generic","tenor_generic","baritone_generic"],o=["violin","viola","cello","double_bass","solo_violin","solo_viola","solo_cello","solo_double_bass"],i=["p","mf","f"],c=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],l=[1,2,3,4,5,6,7,8];function h(e){var t=e-Math.floor(e),r=Math.round(e),n=c[r%12];return t>=.2&&t<.5?/[#]/.test(n)?n=c[(r+1)%12]+"d":n+="+":t>=.5&&t<=.8&&(/[#]/.test(n)?n=c[(r-1)%12]+"+":n+="d"),n+(Math.floor(r/12)-1)}var d=n.useState(!1),f=Object(b.a)(d,2),m=f[0],g=f[1],x=n.useState({selected:null,instList:[],searchInstruments:t.concat(r).concat(o),searchTechs:["normal"],availableTechs:[],searchPitch:c,searchOct:l,searchDyn:i,searchMethod:["match"],searchPeaks:3,toggle:[!0,!0,!0,!1,!1,!1],result:null}),O=Object(b.a)(x,2),v=O[0],y=O[1];n.useEffect((function(){g((function(t){return e.open}))}),[e]),n.useEffect((function(){var e=[];v.searchInstruments.map((function(t){Object.keys(te[t]).map((function(t){e.includes(t)||e.push(t)}))})),y((function(t){return Object(u.a)(Object(u.a)({},t),{},{availableTechs:e})}))}),[v.searchInstruments]);var w=function(e,t,r){if(r.target.checked){var n=Object(z.a)(v.searchInstruments);n.push(t),y((function(e){return Object(u.a)(Object(u.a)({},e),{},{searchInstruments:n})}))}else{var s=v.searchInstruments.filter((function(e,r,n){return e!==t}));y((function(e){return Object(u.a)(Object(u.a)({},e),{},{searchInstruments:s})}))}},C=function(e,n){var i=Object(z.a)(v.toggle);if(i[e]=!i[e],y((function(e){return Object(u.a)(Object(u.a)({},e),{},{toggle:i})})),0===e)if(i[e]){var c=v.searchInstruments.concat(t);y((function(e){return Object(u.a)(Object(u.a)({},e),{},{searchInstruments:c})}))}else{var l=v.searchInstruments.filter((function(e,r,n){return!t.includes(e)}));y((function(e){return Object(u.a)(Object(u.a)({},e),{},{searchInstruments:l})}))}if(1===e)if(i[e]){var h=v.searchInstruments.concat(r);y((function(e){return Object(u.a)(Object(u.a)({},e),{},{searchInstruments:h})}))}else{var d=v.searchInstruments.filter((function(e,t,n){return!r.includes(e)}));y((function(e){return Object(u.a)(Object(u.a)({},e),{},{searchInstruments:d})}))}if(2===e)if(i[e]){var f=v.searchInstruments.concat(o);y((function(e){return Object(u.a)(Object(u.a)({},e),{},{searchInstruments:f})}))}else{var b=v.searchInstruments.filter((function(e,t,r){return!o.includes(e)}));y((function(e){return Object(u.a)(Object(u.a)({},e),{},{searchInstruments:b})}))}if(3===e)if(i[e]){var j=v.searchInstruments.concat(s);y((function(e){return Object(u.a)(Object(u.a)({},e),{},{searchInstruments:j})}))}else{var p=v.searchInstruments.filter((function(e,t,r){return!s.includes(e)}));y((function(e){return Object(u.a)(Object(u.a)({},e),{},{searchInstruments:p})}))}if(4===e)if(i[e]){var m=v.searchInstruments.concat(a);y((function(e){return Object(u.a)(Object(u.a)({},e),{},{searchInstruments:m})}))}else{var g=v.searchInstruments.filter((function(e,t,r){return!a.includes(e)}));y((function(e){return Object(u.a)(Object(u.a)({},e),{},{searchInstruments:g})}))}if(5===e)if(i[e]){var x=v.searchTechs.concat(v.availableTechs);y((function(e){return Object(u.a)(Object(u.a)({},e),{},{searchTechs:x})}))}else y((function(e){return Object(u.a)(Object(u.a)({},e),{},{searchTechs:["normal"]})}))};return Object(A.jsx)("div",{children:Object(A.jsxs)(re.a,{fullScreen:!0,open:m,onClose:e.handleClose,TransitionComponent:Lt,PaperProps:{style:{backgroundColor:"#fffef0"}},children:[Object(A.jsx)(p.a,{style:{textAlign:"center"},children:" Select search source from your saved orchestrations  "}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"SelSource"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsxs)(W.a,{sx:{m:1,minWidth:50},children:[Object(A.jsx)(V.a,{id:"orchestration-select",children:"Orchestrations"}),Object(A.jsx)(F.a,{labelId:"orchestration-select",id:"orchestration-select1",value:v.selected,onChange:function(e){var t=e.target.value,r=JSON.parse(localStorage.getItem("orchestrations")).filter((function(e,r,n){return e.id===t}))[0].data.map((function(e,t){return[e[0],e[1],e[2],e[3],e[4],e[5],t,e[7]]}));y((function(e){return Object(u.a)(Object(u.a)({},e),{},{instList:r,selected:t})}))},autoWidth:!0,label:"orch.",children:null===localStorage.getItem("orchestrations")?null:JSON.parse(localStorage.getItem("orchestrations")).map((function(e){return Object(A.jsx)(S.a,{value:e.id,children:e.name})}))})]})}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"SearchSource"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsxs)("div",{children:[Object(A.jsx)(p.a,{variant:"h5",style:{textAlign:"center",margin:"auto"},children:"Search source"}),function(e){if(e.length>0){var t=[],r=0;e.map((function(e,n){e[3].map((function(n){var s=0;"number"===typeof e[7]&&(s=e[7]),t.push([e[0],e[1],e[2],n,e[4],e[5],r,s]),r+=1}))})),t.sort((function(e,t){return e[3]-t[3]}));var n=t.map((function(e){return h(e[3]+e[7])})),s=t.map((function(e){return e[0]}));return Object(A.jsx)("div",{style:{textAlign:"center",margin:"auto"},children:Object(A.jsx)(le,{notes:n,instruments:s,target:[],scale:.8,width:200,height:250,t_score_y:110,b_score_y:170,text_space:100})})}}(v.instList)]})}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"SearchSpace"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsxs)("div",{children:[Object(A.jsx)(p.a,{variant:"h5",style:{textAlign:"center",margin:"auto"},children:"Search space"}),Object(A.jsx)("table",{children:Object(A.jsxs)("tbody",{children:[Object(A.jsxs)("tr",{children:[Object(A.jsxs)("td",{children:[Object(A.jsx)(p.a,{children:"Woodwinds"}),Object(A.jsx)(B.a,{style:{color:"green"},label:"toggle all",control:Object(A.jsx)(U.a,{checked:v.toggle[0],size:"small",color:"success",onChange:function(e){return C(0)}})})]}),Object(A.jsxs)("td",{children:[Object(A.jsx)(p.a,{children:"Brass"}),Object(A.jsx)(B.a,{style:{color:"green"},label:"toggle all",control:Object(A.jsx)(U.a,{checked:v.toggle[1],size:"small",color:"success",onChange:function(e){return C(1)}})})]}),Object(A.jsxs)("td",{children:[Object(A.jsx)(p.a,{children:"Strings"}),Object(A.jsx)(B.a,{style:{color:"green"},label:"toggle all",control:Object(A.jsx)(U.a,{checked:v.toggle[2],color:"success",size:"small",onChange:function(e){return C(2)}})})]}),Object(A.jsxs)("td",{children:[Object(A.jsx)(p.a,{children:"Percussion"}),Object(A.jsx)(B.a,{style:{color:"green"},label:"toggle all",control:Object(A.jsx)(U.a,{checked:v.toggle[3],color:"success",size:"small",onChange:function(e){return C(3)}})})]}),Object(A.jsxs)("td",{children:[Object(A.jsx)(p.a,{children:"Other"}),Object(A.jsx)(B.a,{style:{color:"green"},label:"toggle all",control:Object(A.jsx)(U.a,{checked:v.toggle[4],color:"success",size:"small",onChange:function(e){return C(4)}})})]})]}),Object(A.jsxs)("tr",{children:[Object(A.jsx)("td",{children:Object(A.jsx)(It.a,{sx:{display:"inline"},children:t.map((function(e,t){return Object(A.jsx)(B.a,{label:e,control:Object(A.jsx)(U.a,{checked:v.searchInstruments.includes(e),size:"small",onChange:function(t){return w(0,e,t)}})})}))})}),Object(A.jsx)("td",{children:Object(A.jsx)(It.a,{sx:{display:"inline"},children:r.map((function(e,t){return Object(A.jsx)(B.a,{label:e,control:Object(A.jsx)(U.a,{checked:v.searchInstruments.includes(e),size:"small",onChange:function(t){return w(0,e,t)}})})}))})}),Object(A.jsx)("td",{children:Object(A.jsx)(It.a,{sx:{display:"inline"},children:o.map((function(e,t){return Object(A.jsx)(B.a,{label:e,control:Object(A.jsx)(U.a,{checked:v.searchInstruments.includes(e),size:"small",onChange:function(t){return w(0,e,t)}})})}))})}),Object(A.jsx)("td",{children:Object(A.jsx)(It.a,{sx:{display:"inline"},children:s.map((function(e,t){return Object(A.jsx)(B.a,{label:e,control:Object(A.jsx)(U.a,{checked:v.searchInstruments.includes(e),size:"small",onChange:function(t){return w(0,e,t)}})})}))})}),Object(A.jsx)("td",{children:Object(A.jsx)(It.a,{sx:{display:"inline"},children:a.map((function(e,t){return Object(A.jsx)(B.a,{label:e,control:Object(A.jsx)(U.a,{checked:v.searchInstruments.includes(e),onChange:function(t){return w(0,e,t)}})})}))})})]})]})})]})}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"SearchTechs"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsxs)("div",{children:[Object(A.jsx)(p.a,{children:"Techniques"}),Object(A.jsx)(B.a,{style:{color:"green"},label:"toggle all",control:Object(A.jsx)(U.a,{checked:v.toggle[5],color:"success",size:"small",onChange:function(e){return C(5)}})}),Object(A.jsx)(It.a,{sx:{display:"inline"},children:v.availableTechs.map((function(e,t){return Object(A.jsx)(B.a,{label:e,control:Object(A.jsx)(U.a,{checked:v.searchTechs.includes(e),size:"small",onChange:function(t){return function(e,t,r){if(r.target.checked){var n=Object(z.a)(v.searchTechs);n.push(t),y((function(e){return Object(u.a)(Object(u.a)({},e),{},{searchTechs:n})}))}else{var s=v.searchTechs.filter((function(e,r,n){return e!==t}));y((function(e){return Object(u.a)(Object(u.a)({},e),{},{searchTechs:s})}))}}(0,e,t)}})})}))})]})}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"SearchDyns"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsxs)("div",{children:[Object(A.jsx)(p.a,{children:"Dynamics"}),Object(A.jsx)(It.a,{sx:{display:"inline"},children:i.map((function(e,t){return Object(A.jsx)(B.a,{label:e,control:Object(A.jsx)(U.a,{checked:v.searchDyn.includes(e),size:"small",onChange:function(t){return function(e,t,r){if(r.target.checked){var n=Object(z.a)(v.searchDyn);n.push(t),y((function(e){return Object(u.a)(Object(u.a)({},e),{},{searchDyn:n})}))}else{var s=v.searchDyn.filter((function(e,r,n){return e!==t}));y((function(e){return Object(u.a)(Object(u.a)({},e),{},{searchDyn:s})}))}}(0,e,t)}})})}))})]})}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"SearchPitches"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsxs)("div",{children:[Object(A.jsx)(p.a,{children:"Pitch classes"}),Object(A.jsx)(It.a,{sx:{display:"inline"},children:c.map((function(e,t){return Object(A.jsx)(B.a,{label:e,control:Object(A.jsx)(U.a,{checked:v.searchPitch.includes(e),size:"small",onChange:function(t){return function(e,t,r){if(r.target.checked){var n=Object(z.a)(v.searchPitch);n.push(t),y((function(e){return Object(u.a)(Object(u.a)({},e),{},{searchPitch:n})}))}else{var s=v.searchPitch.filter((function(e,r,n){return e!==t}));y((function(e){return Object(u.a)(Object(u.a)({},e),{},{searchPitch:s})}))}}(0,e,t)}})})}))})]})}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"SearchOct"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsxs)("div",{children:[Object(A.jsx)(p.a,{children:"Octaves"}),Object(A.jsx)(It.a,{sx:{display:"inline"},children:l.map((function(e,t){return Object(A.jsx)(B.a,{label:e,control:Object(A.jsx)(U.a,{checked:v.searchOct.includes(e),size:"small",onChange:function(t){return function(e,t,r){if(r.target.checked){var n=Object(z.a)(v.searchOct);n.push(t),y((function(e){return Object(u.a)(Object(u.a)({},e),{},{searchOct:n})}))}else{var s=v.searchOct.filter((function(e,r,n){return e!==t}));y((function(e){return Object(u.a)(Object(u.a)({},e),{},{searchOct:s})}))}}(0,e,t)}})})}))})]})}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"SearchMethod"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsxs)("div",{children:[Object(A.jsx)(p.a,{children:"Search method"}),Object(A.jsxs)(It.a,{sx:{display:"inline"},children:[["mfcc","centroid","masking_curve","peaks","match"].map((function(e,t){return Object(A.jsx)(B.a,{label:e,control:Object(A.jsx)(U.a,{checked:v.searchMethod.includes(e),size:"small",onChange:function(t){return function(e,t,r){if(r.target.checked){var n=Object(z.a)(v.searchMethod);n.push(t),y((function(e){return Object(u.a)(Object(u.a)({},e),{},{searchMethod:n})}))}else{var s=v.searchMethod.filter((function(e,r,n){return e!==t}));y((function(e){return Object(u.a)(Object(u.a)({},e),{},{searchMethod:s})}))}}(0,e,t)}})})})),Object(A.jsxs)(W.a,{fullWidth:!0,children:[Object(A.jsx)(V.a,{id:"overlapping",children:"Overlappin partials for peaks"}),Object(A.jsx)(F.a,{labelId:"overlapping",id:"overlapping-select",value:v.searchPeaks,label:"Overlappin partials for peaks",onChange:function(e){var t=e.target.value;y((function(e){return Object(u.a)(Object(u.a)({},e),{},{searchPeaks:t})}))},children:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15].map((function(e){return Object(A.jsx)(S.a,{value:e,children:e})}))})]})]})]})}),Object(A.jsx)(k.a,{onClick:function(){y((function(e){return Object(u.a)(Object(u.a)({},e),{},{result:""})}));var t=[];v.instList.map((function(e,r){e[3].map((function(r){t.push(e[0]+","+e[1]+","+e[2]+","+Math.round(r))}))}));var r=[t,v.searchMethod,v.searchInstruments,v.searchTechs,v.searchDyn,v.searchPitch,v.searchOct,v.searchPeaks];$.a.post(Nt+"search",r).then((function(t){var r=t.data,n=Object(A.jsxs)("div",{id:r[0],children:[Object(A.jsxs)(p.a,{style:{textAlign:"center",margin:"auto"},children:[" Search result: ",r[0][0]," ",r[0][1]," ",r[0][2]," ",h(r[0][3])]}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"SearchResult"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsx)("div",{style:{textAlign:"center",margin:"auto"},children:Object(A.jsx)(le,{notes:[h(r[0][3])],instruments:[r[0][0]],target:[],scale:.8,width:200,height:250,t_score_y:50,b_score_y:140,text_space:100})})}),Object(A.jsxs)(p.a,{style:{textAlign:"center",margin:"auto"},children:[" Play search result, ",r[0][0],": "]}),Object(A.jsx)("div",{children:Object(A.jsxs)("audio",{controls:!0,id:"yks"+r[0],children:[" ",Object(A.jsx)("source",{src:r[1],autoPlay:"true",type:"audio/x-wav"})," "]})}),Object(A.jsx)(p.a,{style:{textAlign:"center",margin:"auto"},children:" Play search source: "}),Object(A.jsx)("div",{children:Object(A.jsxs)("audio",{controls:!0,id:"kaks"+r[0],children:[" ",Object(A.jsx)("source",{src:r[2],type:"audio/x-wav"})," "]})}),Object(A.jsx)(p.a,{style:{textAlign:"center",margin:"auto"},children:" Play both together: "}),Object(A.jsx)("div",{children:Object(A.jsxs)("audio",{controls:!0,id:"kol"+r[0],children:["  ",Object(A.jsx)("source",{src:r[3],type:"audio/x-wav"})," "]})}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"AddToSearch"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsx)(k.a,{onClick:function(e){return function(e,t){var r=Object(z.a)(v.instList);r.push([e[0],e[1],e[2],[e[3]],0,1,r[r.length-1][6]+1,0]),y((function(e){return Object(u.a)(Object(u.a)({},e),{},{instList:r})}))}(r[0])},variant:"contained",color:"secondary",style:{padding:10,margin:5},children:" Add search result to search source "})}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"Update"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsx)(k.a,{onClick:function(e){return function(e,t){var r=Object(z.a)(v.instList);r.push([e[0],e[1],e[2],[e[3]],0,1,r[r.length-1][6]+1,0]),y((function(e){return Object(u.a)(Object(u.a)({},e),{},{instList:r})}));var n=JSON.parse(localStorage.getItem("orchestrations"));n[v.selected].data=r,localStorage.setItem("orchestrations",JSON.stringify(n))}(r[0])},variant:"contained",color:"secondary",style:{padding:10,margin:5},children:" Update your saved orchestration with search result "})})]});y((function(e){return Object(u.a)(Object(u.a)({},e),{},{result:n})}))}))},variant:"contained",color:"primary",style:{padding:10,margin:5},children:" SEARCH "}),Object(A.jsx)("br",{}),v.result,Object(A.jsx)("br",{}),Object(A.jsx)("br",{}),Object(A.jsx)("br",{}),Object(A.jsx)("br",{}),Object(A.jsx)("br",{}),Object(A.jsx)("br",{}),Object(A.jsx)("br",{})]})})}var Mt=xe,Dt=n.forwardRef((function(e,t){return Object(A.jsx)(se.a,Object(u.a)({direction:"up",ref:t},e))}));function Pt(e){var t=["C","C#","D","D#","E","F","F#","G","G#","A","B#","B"];var r=n.useState(!1),s=Object(b.a)(r,2),a=s[0],o=s[1],i=n.useState([]),c=Object(b.a)(i,2),l=c[0],h=c[1],d=n.useState([]),m=Object(b.a)(d,2),g=m[0],x=m[1];n.useEffect((function(){o((function(t){return e.open}));var t=[];t.length=JSON.parse(localStorage.getItem("orchestrations")).length,x((function(){return t}))}),[e]),n.useEffect((function(){h((function(){return JSON.parse(localStorage.getItem("orchestrations"))}));var e=[];e.length=JSON.parse(localStorage.getItem("orchestrations")).length,x((function(){return e}))}),[]),n.useEffect((function(){h((function(){return JSON.parse(localStorage.getItem("orchestrations"))}));var e=[];e.length=JSON.parse(localStorage.getItem("orchestrations")).length,x((function(){return e}))}),[localStorage.getItem("orchestrations")]);var O=function(e){if(e.length>0){var r=[],n=0;e.map((function(e,t){e[3].map((function(t){var s=0;"number"===typeof e[7]&&(s=e[7]),r.push([e[0],e[1],e[2],t+s,e[4],e[5],n]),n+=1}))})),r.sort((function(e,t){return e[3]-t[3]}));var s=r.map((function(e){return function(e){var r=e-Math.floor(e),n=Math.round(e),s=t[n%12];return r>=.2&&r<.5?/[#]/.test(s)?s=t[(n+1)%12]+"d":s+="+":r>=.5&&r<=.8&&(/[#]/.test(s)?s=t[(n-1)%12]+"+":s+="d"),s+(Math.floor(n/12)-1)}(e[3])})),a=r.map((function(e){return e[0]}));return Object(A.jsx)("div",{style:{textAlign:"center",margin:"auto"},children:Object(A.jsx)(le,{notes:s,instruments:a,target:[],scale:.3,width:150,height:90,t_score_y:110,b_score_y:170,text_space:30})})}};return Object(A.jsx)("div",{children:Object(A.jsxs)(re.a,{fullScreen:!0,open:a,onClose:e.handleClose,TransitionComponent:Dt,PaperProps:{style:{backgroundColor:"#fffef0"}},children:[Object(A.jsx)(p.a,{style:{textAlign:"center"},children:"Here you can manage your saved orchestrations"}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"UploadChords"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsx)("div",{children:Object(A.jsx)(f.a,{onDrop:function(e){e.forEach((function(e){var t=new FileReader;t.onabort=function(){return console.log("file reading was aborted")},t.onerror=function(){return console.log("file reading has failed")},t.onload=function(){var e=JSON.parse(localStorage.getItem("orchestrations")),r=0;e.length>0&&(r=e[e.length-1].id+1);var n=JSON.parse(t.result);n.map((function(e){e.id,e.name,e.data})),n.map((function(t,n){var s=t;s.id=r+n,e.push(s)})),h((function(){return e})),localStorage.setItem("orchestrations",JSON.stringify(e))},t.readAsText(e)}))},maxFiles:1,accept:".chords",children:function(e){var t=e.getRootProps,r=e.getInputProps;return Object(A.jsxs)("section",{className:"container",children:[Object(A.jsxs)("div",Object(u.a)(Object(u.a)({},t({className:"dropzone Upload"})),{},{style:{margin:5,padding:5,borderRadius:10,border:"2px dashed #4c4c48"},children:[Object(A.jsx)("input",Object(u.a)({},r())),Object(A.jsx)("p",{style:{textAlign:"center"},children:"Upload your saved file of orchestration chords"})]})),Object(A.jsx)("aside",{children:Object(A.jsx)("div",{})})]})}})})}),0===l.length&&Object(A.jsx)(p.a,{style:{textAlign:"center"},children:"Add some orchestrations to your list (Upload a pre-saved file, or click save either in Score Analyzer or in Chord Editor.)"}),l.length>0&&Object(A.jsxs)("div",{children:[Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"DownloadOrch"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsx)(k.a,{onClick:function(){var e=document.createElement("a"),t=new Blob([localStorage.getItem("orchestrations")],{type:"text/plain"});e.href=URL.createObjectURL(t),e.download="orchestration.chords",document.body.appendChild(e),e.click()},variant:"contained",color:"primary",style:{padding:10,margin:5},children:" Download your orchestrations "})}),Object(A.jsx)(p.a,{style:{textAlign:"center"},children:"List of your orchestrations"}),Object(A.jsx)("table",{style:{textAlign:"center",margin:"auto"},children:Object(A.jsxs)("tbody",{children:[Object(A.jsxs)("tr",{children:[Object(A.jsx)("td",{children:"Name"}),Object(A.jsx)("td",{children:"Orchestration"}),Object(A.jsx)("td",{children:"Listen"}),Object(A.jsx)("td",{children:"Delete"})]}),l.map((function(t,r){return Object(A.jsxs)("tr",{children:["               ",Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"OrchList"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsxs)("div",{children:[Object(A.jsx)("td",{children:t.name}),"  ",Object(A.jsx)("td",{children:O(t.data)})]})}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"ListListen"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsxs)("td",{children:[Object(A.jsx)(k.a,{onClick:function(e){return function(e,t,r){var n=[];t.map((function(e,t){e[3].map((function(t){var r=0;"number"===typeof e[7]&&(r=e[7]),n.push(e[0]+","+e[1]+","+e[2]+","+(t+r))}))})),$.a.post(Mt+"listen",{orchestration:n,positions:Array(n.length).fill(17),listeningPosition:"audience"},{headers:{auth:"uljasPulkkis"}}).then((function(t){var r=Object(A.jsx)("div",{children:Object(A.jsxs)("audio",{controls:!0,autoPlay:"true",children:[" ",Object(A.jsx)("source",{src:t.data,type:"audio/x-wav"})," "]})}),n=Object(z.a)(g);n[e]=r,x((function(){return n}))}))}(r,t.data)},variant:"contained",color:"secondary",style:{padding:10,margin:5},children:" LISTEN "}),g[r]]})}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"ListDelete"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsx)("td",{children:Object(A.jsx)(k.a,{onClick:function(e){return function(e,t){var r=JSON.parse(localStorage.getItem("orchestrations")).filter((function(t,r,n){return t.id!=e}));h((function(){return r})),localStorage.setItem("orchestrations",JSON.stringify(r))}(t.id)},variant:"contained",color:"warning",style:{padding:10,margin:5},children:" DELETE "})})})]})}))]})}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"EraseAll"}),disableHoverListener:!e.help,followCursor:!0,children:Object(A.jsx)(k.a,{onClick:function(){h((function(){return[]})),localStorage.setItem("orchestrations",JSON.stringify([]))},variant:"contained",color:"error",style:{padding:10,margin:5},children:" Erase all your orchestrations "})})]})]})})}function zt(e){return Object(A.jsxs)("div",{style:{marginTop:10},children:[Object(A.jsxs)(p.a,{variant:"h4",style:{border:"1px solid",padding:5},children:["This is a completely new version of Score-Tool. If you want to use the old version, visit ",Object(A.jsx)("a",{href:"https://old.score-tool.com",target:"_blank",children:"old.score-tool.com"})," "]}),Object(A.jsx)(p.a,{variant:"h5",children:"About"}),Object(A.jsx)(p.a,{children:"Score-Tool is an analysis tool for music orchestration. The purpose of the tool is to help composers, conductors and other musicians to extract information about audibility and timbre from the score. The analysis results are showed on graphs, and there is also a possibility to listen any orchestration chord in a real binaural simulation of the concert hall."}),Object(A.jsx)(p.a,{variant:"h5",children:"Score"}),Object(A.jsx)(p.a,{children:'For analysis, the score must be in musicXML or mxl (compressed musicXML) format. All current notation programs can export musicXML from the "SaveAs" menu. Drag and drop, or click drop area to upload your score to Score-Tool. Click "load score". Analyzed score can be downloaded as PNG file.'}),Object(A.jsx)(p.a,{variant:"h5",children:"Chord"}),Object(A.jsx)(p.a,{children:'The Chord editor can be used without any files. Click any instrument name to add it to your orchestration. Click the notation stave and add notes with piano keyboard. After editing the instrumentation press "Update graphs" to view the analysis information.'}),Object(A.jsx)(p.a,{variant:"h5",children:"Compare"}),Object(A.jsx)(p.a,{children:"The Compare editor lets you compare two individual timbres. Click the mini-staff to select pitch for each instrument. The graphs show the overtone structure and timbre data of both instruments."}),Object(A.jsx)(p.a,{variant:"h5",children:"Search"}),Object(A.jsx)(p.a,{children:"The Search feature requires you to save some orchestrations first. Orchestrations can be saved in Score and Chord editors. Select the search source from your saved orchestrations, select search space from orchestra instruments, select search method(s) and click SEARCH. As result you will get the closest match from database, which can be added to your saved orchestration."}),Object(A.jsx)(p.a,{variant:"h5",children:"Manage"}),Object(A.jsx)(p.a,{children:"Here you can manage your saved orchestrations. You can listen individual chords, and delete the ones you don't need anymore. The saved chords are already in your machine, in browser's local storage, but here you can also download them as file, or upload your orchestratrions to browser."}),Object(A.jsxs)(p.a,{variant:"h6",style:{padding:10},children:["Created in 2021 by ",Object(A.jsx)("a",{href:"https://uljaspulkkis.com",target:"_blank",children:"Uljas Pulkkis"})," "]})]})}var Et=r(188),Ht=r.n(Et),Rt=(Object(N.a)({palette:{neutral:{main:"#dcc4ac",contrastText:"#black"}}}),Object(fe.a)(be.a)((function(e){var t=e.theme;return Object(u.a)(Object(u.a)({},t.typography.body2),{},{backgroundColor:"#fffef0",padding:t.spacing(1),textAlign:"center",color:t.palette.text.secondary})}))),Ft=function(e){Object(h.a)(r,e);var t=Object(d.a)(r);function r(e){var n;return Object(i.a)(this,r),(n=t.call(this,e)).state={loading:!1,from:0,to:0,file:"",filetype:"",cursor:!1,help:!1,next:0,files:[],load:"none",chord:!1,compare:!1,search:!1,manage:!1,analyze:"none",about:"block",osmd:""},n.setcursor=n.setcursor.bind(Object(l.a)(n)),n.setnext=n.setnext.bind(Object(l.a)(n)),n.loadFile=n.loadFile.bind(Object(l.a)(n)),n.onDrop=function(e){n.setState({files:e})},document.title="Score-Tool 2.0",n}return Object(c.a)(r,[{key:"componentDidMount",value:function(){null===JSON.parse(localStorage.getItem("orchestrations"))&&localStorage.setItem("orchestrations",JSON.stringify([]))}},{key:"componentDidUpdate",value:function(e){}},{key:"chordClose",value:function(){this.setState((function(e){return e.chord=!1}))}},{key:"compareClose",value:function(){this.setState((function(e){return e.compare=!1}))}},{key:"searchClose",value:function(){this.setState((function(e){return e.search=!1}))}},{key:"manageClose",value:function(){this.setState((function(e){return e.manage=!1}))}},{key:"setcursor",value:function(){this.setState((function(e){return e.cursor=!0}))}},{key:"loadFile",value:function(){var e=this;this.state.files.forEach((function(t){var r=t.name,n="",s=new FileReader;r.toLowerCase().indexOf(".xml")>0||r.toLowerCase().indexOf(".musicxml")>0?(e.setState((function(e){return e.filetype="xml"})),n="xml",s.readAsText(t)):r.toLowerCase().indexOf(".mxl")>0?(e.setState((function(e){return e.filetype="mxl"})),n="mxl",s.readAsBinaryString(t)):alert("No vaild .xml/.mxl/.musicxml file!"),s.onabort=function(){return console.log("file reading was aborted")},s.onerror=function(){return console.log("file reading has failed")},s.onload=function(){var t=s.result;if("mxl"===n)if(e.state.from>0&&e.state.to>0){var r=new DOMParser;E.MXLHelper.MXLtoXMLstring(t).then((function(t){for(var n=r.parseFromString(t,"text/xml"),s=n.getElementsByTagName("measure"),a=s.length-1;a>=0;a--)a%100===0&&console.log("Bars left to check: "+a),(parseInt(s[a].getAttribute("number"))<e.state.from||parseInt(s[a].getAttribute("number"))>e.state.to)&&1!==parseInt(s[a].getAttribute("number"))&&s[a].parentNode.removeChild(s[a]);e.setState((function(e){return e.loading=!1})),e.setState((function(t){return t.osmd=Object(A.jsx)("div",{children:Object(A.jsx)(Re,{file:n,filename:e.state.files[0].name+e.state.files[0].size,help:e.state.help,show:e.state.cursor,next:e.state.next})})})),e.setState((function(e){return e.filetype="done"}))}))}else e.setState((function(e){return e.loading=!1})),e.setState((function(r){return r.osmd=Object(A.jsx)("div",{children:Object(A.jsx)(Re,{file:t,filename:e.state.files[0].name+e.state.files[0].size,help:e.state.help,show:e.state.cursor,next:e.state.next})})})),e.setState((function(e){return e.filetype="done"}));else if("xml"===n)if(e.state.from>0&&e.state.to>0){for(var a=(new DOMParser).parseFromString(t,"text/xml"),o=a.getElementsByTagName("measure"),i=o.length-1;i>=0;i--)(parseInt(o[i].getAttribute("number"))<e.state.from||parseInt(o[i].getAttribute("number"))>e.state.to)&&1!==parseInt(o[i].getAttribute("number"))&&o[i].parentNode.removeChild(o[i]);e.setState((function(e){return e.loading=!1})),e.setState((function(t){return t.osmd=Object(A.jsx)("div",{children:Object(A.jsx)(Re,{file:a,filename:e.state.files[0].name+e.state.files[0].size,help:e.state.help,show:e.state.cursor,next:e.state.next})})})),e.setState((function(e){return e.filetype="done"}))}else e.setState((function(e){return e.loading=!1})),e.setState((function(r){return r.osmd=Object(A.jsx)("div",{children:Object(A.jsx)(Re,{file:t,filename:e.state.files[0].name+e.state.files[0].size,help:e.state.help,show:e.state.cursor,next:e.state.next})})})),e.setState((function(e){return e.filetype="done"}));e.setState((function(e){e.file="",e.load="inline-block"}))}}))}},{key:"setnext",value:function(){var e=this.state.next;this.setState((function(t){return t.next=e+1}))}},{key:"handleClick",value:function(e){var t=e.target.value;this.setState((function(e){return e.file=t}))}},{key:"render",value:function(){var e=this,t=this.state.files.map((function(e){return Object(A.jsxs)("li",{children:[e.name," - ",e.size," bytes"]},e.name)})),r=[];if(this.state.files[0]){var n="inline-block";"inline-block"===this.state.load&&(n="none"),r="done"===this.state.filetype?"":Object(A.jsx)("div",{children:Object(A.jsxs)("div",{style:{display:n},children:[Object(A.jsx)(p.a,{children:"If you have huge score, you can set the bar range here to conciderably reduce the loading time (numbers only, first bar will always show because of the musicXML format restrictions)"}),Object(A.jsxs)("div",{children:[Object(A.jsx)(ne.a,{label:"from bar",id:"outlined-size-small",defaultValue:0,size:"small",value:this.state.from,onChange:function(t){return e.setState((function(e){return e.from=t.target.value}))}}),Object(A.jsx)(ne.a,{label:"to bar",id:"outlined-size-small",defaultValue:0,size:"small",value:this.state.to,onChange:function(t){return e.setState((function(e){return e.to=t.target.value}))}})]}),Object(A.jsx)(k.a,{onClick:function(){e.setState((function(e){return e.loading=!0})),setTimeout((function(){return e.loadFile()}),200)},variant:"contained",children:"Load current file (Warning! Large scores with 200+ bars can freeze the browser)"})]})})}document.body.style.backgroundColor="#fffef0";return Object(A.jsxs)("div",{className:"App",children:[Object(A.jsx)(P,{navClick:function(t){switch(t){case"Score":e.setState((function(e){return Object(u.a)(Object(u.a)({},e),{},{analyze:"block",about:"none"})}));break;case"Chord":e.setState((function(e){return Object(u.a)(Object(u.a)({},e),{},{chord:!0,analyze:"block",about:"none"})}));break;case"Compare":e.setState((function(e){return Object(u.a)(Object(u.a)({},e),{},{compare:!0,analyze:"block",about:"none"})}));break;case"Search":e.setState((function(e){return Object(u.a)(Object(u.a)({},e),{},{search:!0,analyze:"block",about:"none"})}));break;case"About":e.setState((function(e){return Object(u.a)(Object(u.a)({},e),{},{analyze:"none",about:"block"})}));break;case"Manage":e.setState((function(e){return Object(u.a)(Object(u.a)({},e),{},{manage:!0,analyze:"block",about:"none"})}))}},help:function(t){e.setState((function(e){return e.help=t}))}}),Object(A.jsxs)(Rt,{children:[Object(A.jsx)("div",{style:{display:this.state.about},children:Object(A.jsxs)("header",{className:"App-header",style:{padding:10,borderRadius:20},children:[Object(A.jsx)("h1",{className:"App-title",style:{padding:10,borderRadius:20},children:"Score-Tool 2.0"}),Object(A.jsx)("h1",{className:"App-title",style:{padding:10,borderRadius:20},children:"Psychoacoustic orchestration tool by Uljas Pulkkis 2021"})]})}),Object(A.jsx)(vt,{help:this.state.help,handleClose:this.chordClose.bind(this),open:this.state.chord}),Object(A.jsx)(Tt,{help:this.state.help,handleClose:this.compareClose.bind(this),open:this.state.compare}),Object(A.jsx)(At,{help:this.state.help,handleClose:this.searchClose.bind(this),open:this.state.search}),Object(A.jsx)(Pt,{help:this.state.help,handleClose:this.manageClose.bind(this),open:this.state.manage}),Object(A.jsxs)("div",{className:"",style:{display:this.state.analyze},children:["none"===this.state.load&&Object(A.jsxs)("div",{children:[Object(A.jsx)(p.a,{style:{textAlign:"center"},children:" Select an example score  "}),Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"Examples"}),disableHoverListener:!this.state.help,placement:"top",children:Object(A.jsxs)(W.a,{sx:{m:1,minWidth:150},children:[Object(A.jsx)(V.a,{id:"score-select",children:"Scores"}),Object(A.jsx)(F.a,{labelId:"score-select",id:"score-select1",value:this.state.selected,onChange:function(t){var r=t.target.value;e.setState((function(e){return e.filetype="done"})),e.setState((function(e){return e.load="block"})),e.setState((function(e){return e.file=r})),e.setState((function(t){return t.osmd=Object(A.jsx)("div",{children:Object(A.jsx)(Re,{file:r,filename:r+"fromExamples",help:e.state.help,show:e.state.cursor,next:e.state.next})})})),e.setState((function(e){return e.files=[{name:r,size:"fromExamples"}]}))},autoWidth:!0,label:"score",children:["test_score2.xml","sonority.xml"].map((function(e){return Object(A.jsx)(S.a,{value:e,children:e})}))})]})}),Object(A.jsx)(p.a,{style:{textAlign:"center"},children:" or  "}),Object(A.jsx)(f.a,{onDrop:this.onDrop,maxFiles:1,accept:".xml,.musicXml,.mxl",children:function(r){var n=r.getRootProps,s=r.getInputProps;return Object(A.jsx)(_.a,{title:Object(A.jsx)(j,{help:"Dropzone"}),disableHoverListener:!e.state.help,children:Object(A.jsxs)("section",{className:"container",children:[Object(A.jsxs)("div",Object(u.a)(Object(u.a)({},n({className:"dropzone Upload"})),{},{style:{margin:20,padding:10,borderRadius:10,border:"2px dashed #4c4c48",backgroundColor:"#dcc4ac"},children:[Object(A.jsx)("input",Object(u.a)({},s())),Object(A.jsx)("p",{children:"Drop musicXML or click"})]})),Object(A.jsx)("aside",{children:Object(A.jsx)("div",{children:t})})]})})}})]}),r,this.state.osmd]}),Object(A.jsxs)("div",{style:{display:this.state.about,textAlign:"left",textJustify:"left",paddingInline:"20vw"},children:[Object(A.jsx)(zt,{}),Object(A.jsx)(k.a,{size:"small",onClick:function(){localStorage.clear(),localStorage.setItem("orchestrations",JSON.stringify([]))},variant:"contained",color:"warning",startIcon:Object(A.jsx)(Ht.a,{}),style:{padding:10,margin:5},children:" If you get errors, click here to clear all your orchestration data "})]})]}),Object(A.jsxs)(Ae.a,{sx:{color:"#fff",zIndex:function(e){return e.zIndex.drawer+1}},open:this.state.loading,children:[Object(A.jsx)(ke.a,{disableShrink:!0,color:"success"}),Object(A.jsx)(p.a,{children:" Cutting extra measures from your score. If there's 100s of bars, this can take awhile..."})]})]})}}]),r}(n.Component),Vt=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Wt(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}})).catch((function(e){console.error("Error during service worker registration:",e)}))}o.a.render(Object(A.jsx)(Ft,{}),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL(".",window.location).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat(".","/service-worker.js");Vt?(!function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):Wt(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):Wt(e)}))}}()}},[[273,1,2]]]);