(this["webpackJsonpreact-score-tool"]=this["webpackJsonpreact-score-tool"]||[]).push([[0],{157:function(e,t,n){},190:function(e,t,n){e.exports=n(245)},195:function(e,t,n){},198:function(e,t,n){},245:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(67),s=n.n(o),i=(n(195),n(5)),c=n(6),l=n(32),u=n(8),m=n(9),d=n(4),f=n(116),h=(n(198),n(47)),p=n(302),g=n(290),b=n(286),v=n(291),y=n(289),E=n(303),_=n(305),w=n(44),O=n.n(w),k=n(160),C={alto_flute:["normal"],alto_sax:["normal"],baritone_generic:["normal"],bassoon:["normal"],bass_cl:["normal"],bass_flute:["normal"],bass_trombone:["normal"],cello:["harmonics","normal","pizz","pizz_harmonics","sord","sord_trem","trem"],clarinet:["normal"],clarinet_eb:["normal"],crotale:["normal"],cymbal:["13crash_bell","13crash_bow","13crash_chokecrash","13crash_mallet","13crash_normal","13crash_roll","13crash_shoulder","16chinese_bell","16chinese_bow","16chinese_chokecrash","16chinese_mallet","16chinese_normal","16chinese_roll","16chinese_shoulder","17crash_bell","17crash_bow","17crash_chokecrash","17crash_mallet","17crash_normal","17crash_roll","17crash_shoulder","17orchcrash","18crash_bell","18crash_bow","18crash_chokecrash","18crash_mallet","18crash_normal","18crash_roll","18crash_shoulder","18orchcrash_french","18orchcrash_germanic","18orchcrash_viennese","19chinese_bell","19chinese_bow","19chinese_chokecrash","19chinese_mallet","19chinese_normal","19chinese_roll","19chinese_shoulder","20chinese_bell","20chinese_bow","20chinese_chokecrash","20chinese_mallet","20chinese_normal","20chinese_roll","20chinese_shoulder","20crash_bell","20crash_bow","20crash_chokecrash","20crash_mallet","20crash_normal","20crash_roll","20crash_shoulder","21ride_bell","21ride_mallet","21ride_normal","21ride_roll","21ride_shoulder","hihat_bell","hihat_footclose","hihat_footsplash","hihat_normal","hihat_shoulder","normal","smallmetals","splash_bell","splash_mallet","splash_roll","splash_splash","windgong","windgong_bow"],double_bass:["harmonics","normal","pizz","pizz_harmonics","trem"],english_horn:["normal"],flute:["normal","vib"],guitar:["normal","normal_sulA","normal_sulB","normal_sulD","normal_sulE","normal_sulG","normal_sul_E"],harp:["normal"],horn:["normal"],oboe:["normal"],percussion_misc:["castanet","guiro_away","guiro_toward","shakers"],piano:["normal"],piccolo:["normal"],solo_cello:["arco_sulA","arco_sulC","arco_sulD","arco_sulG","normal"],solo_double_bass:["arco_sulA","arco_sulD","arco_sulE","arco_sulG","normal","pizz","pizz_sulA","pizz_sulD","pizz_sulE","pizz_sulG"],solo_viola:["arco_sulA","arco_sulC","arco_sulD","arco_sulG","normal"],solo_violin:["arco_sulA","arco_sulD","arco_sulE","arco_sulG","normal"],soprano_generic:["normal"],soprano_sax:["normal","normal_Vib"],tambourine:["normal","normal_fingerroll","normal_sforzando","normal_shakeroll","normal_thumbroll"],tamtam:["bow","normal"],tamtam_22:["bow","normal"],tamtam_40:["bow","normal"],tenor_generic:["normal"],thaigong:["normal"],triangle_6:["normal","normal_roll"],triangle_8:["normal","normal_roll"],trumpet:["normal","vib"],tuba:["normal"],vibraphone:["normal","normal_bow"],viola:["harmonics","normal","pizz","sord","sord_trem","trem"],violin:["harmonics","normal","pizz","sord","sord_trem","tremolo"],woodblock:["clave","graniteblock","normal"],xylophone:["gliss_down","gliss_up","normal","normal_hardrubber"],tenor_trombone:["normal"],timp:["normal"]},x=n(23),S=n(14),N=n(299),j=n(292),T=n(308),I=n(309),A=n(304),D=n(282),P=n(68),M=n.n(P),L=n(81),z=L.a.Flow,R=function(e){Object(u.a)(n,e);var t=Object(m.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).notes=0,a.target=0,a.instruments=0,a.renderer=0,a.context=0,a.state={x:0,y:0},a}return Object(c.a)(n,[{key:"setupScore",value:function(){var e=document.createElement("div"),t=this.props,n=(t.id,t.notes),a=t.target,r=t.instruments,o=(t.setProps,t.width),s=t.height,i=t.t_score_y,c=t.b_score_y,l=t.target_color,u=t.text_space,m=t.highlights,d=t.indexing;this.notes=n,this.target=a,this.instruments=r,this.renderer=new z.Renderer(e,z.Renderer.Backends.SVG),this.renderer.resize(o+u,s);var f=this.renderer.getContext();this.context=f;var h=new z.Stave(20,i,o);h.addClef("treble"),h.setContext(this.context).draw();var p=new z.Stave(20,c,o);p.addClef("bass"),p.setContext(this.context).draw();var g=function(e,t,n){var a,r,o,s,i,c,l,u=[],f=[],h=[],p=[],g=[],b=[],v=[],y=[],E=[],_=[],w=[],O=[],k=[],C=[],x=[];for(a=0;a<e.length;a++){i=e[a],l=d?a+": "+t[a]:t[a];var S="";if("undefined"!==typeof m[a]&&(S=m[a]),r=i[0],o=i[i.length-1],s=i.length>2?i[1]:"n",c=r.concat("/",o),N=n[a],parseInt(o)>=4&&parseInt(o)<6){u.push(c),f.push(s),p.push(l),g.push(S);for(var N=0,j=0;j<n.length;j++)n[j]===a&&(N=1);h.push(N)}else if(parseInt(o)>=6){o-=2,c=r.concat("/",o),w.push(c),O.push(s),C.push(l),x.push(S);for(N=0,j=0;j<n.length;j++)n[j]===a&&(N=1);k.push(N)}else{b.push(c),v.push(s),E.push(l),_.push(S);for(N=0,j=0;j<n.length;j++)n[j]===a&&(N=1);y.push(N)}}return[u,f,h,b,v,y,p,E,g,_,w,O,k,C,x]}(this.notes,this.instruments,this.target);if(Array.isArray(g[10])&&g[10].length){var b=new z.Stave(20,40,o);b.addClef("treble"),b.setContext(this.context).draw(),this.context.fillText("15ma",b.x+6,b.y+26);for(var v=[],y=0;y<g[10].length;y++)v.push("c/4");var E=new z.StaveNote({clef:"treble",keys:v,duration:"q"});E.setStemStyle({strokeStyle:"none"}),E.setLedgerLineStyle({strokeStyle:"none"});for(y=0;y<g[10].length;y++)E.setKeyLine(y,y-1.5);var _=new z.StaveNote({clef:"treble",keys:g[10],duration:"q"}),w=g[13],O=g[14];for(y=0;y<g[11].length;y++){_.addAccidental(y,new z.Accidental(g[11][y]));var k=R(w[y],z.Modifier.Position.RIGHT);k.setOffsetX(-10),E.note_heads[y].glyph_code="v23",E.addModifier(y,k),O[y]&&_.setKeyStyle(y,{shadowColor:O[y],shadowBlur:100}),1===g[12][y]&&(_.setKeyStyle(y,{fillStyle:l}),E.setKeyStyle(y,{fillStyle:l}))}var C=new z.StaveConnector(b,p),x=new z.StaveConnector(b,p)}else C=new z.StaveConnector(h,p),x=new z.StaveConnector(h,p);C.setType(z.StaveConnector.type.SINGLE_LEFT),C.setContext(this.context),C.draw(),x.setType(z.StaveConnector.type.BRACKET),x.setContext(this.context),x.draw();var S=[];for(y=0;y<g[0].length;y++)S.push("c/4");var N=new z.StaveNote({clef:"treble",keys:S,duration:"q"});N.setStemStyle({strokeStyle:"none"}),N.setLedgerLineStyle({strokeStyle:"none"});for(y=0;y<g[0].length;y++)N.setKeyLine(y,y-1.5);var j=[];for(y=0;y<g[3].length;y++)j.push("c/3");var T=new z.StaveNote({clef:"bass",keys:j,duration:"q"});T.setStemStyle({strokeStyle:"none"}),T.setLedgerLineStyle({strokeStyle:"none"});for(y=0;y<g[3].length;y++)T.setKeyLine(y,y-1.5);var I=new z.StaveNote({clef:"treble",keys:g[0],duration:"q"}),A=new z.StaveNote({clef:"bass",keys:g[3],duration:"q"}),D=g[6],P=g[7],M=g[8],L=g[9];function R(e,t){return new z.FretHandFinger(e).setPosition(t)}for(y=0;y<g[1].length;y++){I.addAccidental(y,new z.Accidental(g[1][y]));var F=R(D[y],z.Modifier.Position.RIGHT);F.setOffsetX(-10),N.note_heads[y].glyph_code="v23",N.addModifier(y,F),M[y]&&I.setKeyStyle(y,{shadowColor:M[y],shadowBlur:100}),1===g[2][y]&&(I.setKeyStyle(y,{fillStyle:l}),N.setKeyStyle(y,{fillStyle:l}))}for(y=0;y<g[3].length;y++){A.addAccidental(y,new z.Accidental(g[4][y]));var V=R(P[y],z.Modifier.Position.RIGHT);V.setOffsetX(-10),T.note_heads[y].glyph_code="v23",T.addModifier(y,V),L[y]&&A.setKeyStyle(y,{shadowColor:L[y],shadowBlur:100}),1===g[5][y]&&(A.setKeyStyle(y,{fillStyle:l}),T.setKeyStyle(y,{fillStyle:l}))}if(Array.isArray(g[0])&&g[0].length){var W=new z.Voice({num_beats:1,beat_value:4}).setMode(2),G=new z.Voice({num_beats:1,beat_value:4}).setMode(2);W.addTickables([I]),G.addTickables([N]);(new z.Formatter).joinVoices([W]).format([W],o);(new z.Formatter).joinVoices([G]).format([G],o).tickContexts.array[0].x=o-40,W.draw(this.context,h),G.draw(this.context,h)}var K=new z.Voice({num_beats:1,beat_value:4}),B=new z.Voice({num_beats:1,beat_value:4});if(B.addTickables([T]),Array.isArray(g[3])&&g[3].length){K.addTickables([A]);(new z.Formatter).joinVoices([K]).format([K],o);(new z.Formatter).joinVoices([B]).format([B],o).tickContexts.array[0].x=o-40,K.draw(this.context,p),B.draw(this.context,p)}if(Array.isArray(g[10])&&g[10].length){var U=new z.Voice({num_beats:1,beat_value:4}).setMode(2),H=new z.Voice({num_beats:1,beat_value:4}).setMode(2);U.addTickables([_]),H.addTickables([E]);(new z.Formatter).joinVoices([U]).format([U],o);(new z.Formatter).joinVoices([H]).format([H],o).tickContexts.array[0].x=o-40,U.draw(this.context,b),H.draw(this.context,b);var J=[];for(y=0;y<v.length;y++){var q=new z.StaveLine({first_note:_,last_note:E,first_indices:[y],last_indices:[y]});q.render_options.line_width=3,q.render_options.padding_right=-4,O[y]&&(q.render_options.color=O[y]),1===g[12][y]&&(q.render_options.color=l),J.push(q)}for(var X=0;X<J.length;X++)J[X].setContext(f),J[X].draw()}var Y=[];for(y=0;y<S.length;y++){var Q=new z.StaveLine({first_note:I,last_note:N,first_indices:[y],last_indices:[y]});Q.render_options.line_width=3,Q.render_options.padding_right=-4,M[y]&&(Q.render_options.color=M[y]),1===g[2][y]&&(Q.render_options.color=l),Y.push(Q)}var $=[];for(y=0;y<j.length;y++){var Z=new z.StaveLine({first_note:A,last_note:T,first_indices:[y],last_indices:[y]});Z.render_options.line_width=3,Z.render_options.padding_right=-4,L[y]&&(Z.render_options.color=L[y]),1===g[5][y]&&(Z.render_options.color=l),$.push(Z)}for(X=0;X<Y.length;X++)Y[X].setContext(f),Y[X].draw();for(X=0;X<$.length;X++)$[X].setContext(f),$[X].draw();this.refs.outer.appendChild(e),this.refs.outer.addEventListener("click",this.orchClick.bind(this),!1)}},{key:"orchClick",value:function(e){var t=this.props,n=t.setProps,a=t.indexing;if(e.target.closest("text")&&a){var r=e.target.innerHTML.split(":"),o=parseInt(r[0]);n&&n({onClick:o}),console.log(o)}}},{key:"componentDidMount",value:function(){this.setupScore()}},{key:"componentDidUpdate",value:function(e){for(var t=this.refs.outer;t.hasChildNodes();)t.removeChild(t.lastChild);this.setupScore()}},{key:"render",value:function(){var e=this.props,t=e.id;e.notes,e.instruments,e.target;return r.a.createElement("div",{id:t,ref:"outer",style:{border:"none",padding:0,borderRadius:0,display:"inline-block"}})}}]),n}(a.Component);R.defaultProps={width:200,height:400,t_score_y:110,b_score_y:200,text_space:120,target_color:"red",highlights:[],indexing:!0};var F=L.a.Flow,V=function(e){Object(u.a)(n,e);var t=Object(m.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state={x:0,y:0},a}return Object(c.a)(n,[{key:"setupScore",value:function(){var e=document.createElement("div"),t=this.props,n=(t.id,t.masking_notevalues),a=t.masking_notesizes,r=t.masking_colors,o=t.target_notevalues,s=t.target_notesizes,i=t.target_colors,c=(t.setProps,new F.Renderer(e,F.Renderer.Backends.SVG));c.resize(100,250);var l=c.getContext(),u=new F.Stave(10,60,100);u.addClef("treble"),u.setContext(l).draw();var m=new F.Stave(10,120,100);m.addClef("bass"),m.setContext(l).draw();var d=new F.StaveConnector(u,m);d.setType(F.StaveConnector.type.SINGLE_LEFT),d.setContext(l),d.draw();var f=new F.StaveConnector(u,m);f.setType(F.StaveConnector.type.BRACKET),f.setContext(l),f.draw();for(var h=[],p=[],g=[],b=[],v=[],y=[],E=0;E<n.length;E++)n[E]>59?(h.push(n[E]),p.push(a[E]),g.push(r[E])):(b.push(n[E]),v.push(a[E]),y.push(r[E]));var _=[],w=[],O=[],k=[],C=[],x=[];for(E=0;E<o.length;E++)o[E]>59?(_.push(o[E]),w.push(s[E]),O.push(i[E])):(k.push(o[E]),C.push(s[E]),x.push(i[E]));var S=new Array,N=new Array,j=new Array,T=new Array;function I(e,t){var n=0;return 40===t&&(n=-1),(e=(e-t)/4)>1+n&&(e+=.25),e>3+n&&(e+=.25),e>4.5+n&&(e+=.25),e>6.5+n&&(e+=.25),e>8+n&&(e+=.25),e>10+n&&(e+=.25),e>13.5+n&&(e+=.25),e>15.5+n&&(e+=.25),e}var A=[];if(Array.isArray(b)&&b.length){for(E=0;E<b.length;E++){var D=I(b[E],40);(z=new F.NoteHead({duration:"128",line:D,custom_glyph_code:"vd2",glyph_font_scale:v[E],style:{fillStyle:"none"}})).setCenterAlignment(!0),N.push(z)}var P=new F.Voice({num_beats:1,beat_value:1}).setMode(2);P.addTickables(N);(new F.Formatter).joinVoices([P]).format([P],1);P.draw(l,m)}if(Array.isArray(h)&&h.length){for(E=0;E<h.length;E++){D=I(h[E],60);(z=new F.NoteHead({duration:"128",line:D,custom_glyph_code:"vd2",glyph_font_scale:p[E],style:{fillStyle:"none"}})).setCenterAlignment(!0),S.push(z)}var M=new F.Voice({num_beats:1,beat_value:1}).setMode(2);M.addTickables(S);(new F.Formatter).joinVoices([M]).format([M],1);M.draw(l,u)}if(Array.isArray(_)&&_.length){j.push(new F.GhostNote("q"));for(E=0;E<_.length;E++){D=I(_[E],60);(z=new F.NoteHead({duration:"128",displaced:!1,line:D,custom_glyph_code:"vb",glyph_font_scale:w[E],style:{fillStyle:O[E]}})).setCenterAlignment(!0),j.push(z)}var L=new F.Voice({num_beats:1,beat_value:1}).setMode(2);L.addTickables(j);(new F.Formatter).joinVoices([L]).format([L],10);L.draw(l,u)}if(Array.isArray(k)&&k.length){T.push(new F.GhostNote("q"));for(E=0;E<k.length;E++){var z;D=I(k[E],60);(z=new F.NoteHead({duration:"128",displaced:!1,line:D,custom_glyph_code:"vb",glyph_font_scale:C[E],style:{fillStyle:x[E]}})).setCenterAlignment(!0),T.push(z)}var R=new F.Voice({num_beats:1,beat_value:1}).setMode(2);R.addTickables(T);(new F.Formatter).joinVoices([R]).format([R],10);R.draw(l,u)}if(Array.isArray(b)&&b.length)for(E=0;E<b.length;E++)A.push(P.tickables[E].y);if(Array.isArray(h)&&h.length)for(E=0;E<h.length;E++)A.push(M.tickables[E].y);for(var V=0;V<A.length-1;V++)l.beginPath().moveTo(40,A[V]).lineTo(90,A[V]).lineTo(90,A[V+1]).lineTo(40,A[V+1]).closePath().fill({fill:r[V]});l.beginPath().closePath(),this.refs.outer2.appendChild(e)}},{key:"componentDidMount",value:function(){this.setupScore()}},{key:"componentDidUpdate",value:function(e){for(var t=this.refs.outer2;t.hasChildNodes();)t.removeChild(t.lastChild);this.setupScore()}},{key:"render",value:function(){var e=this.props.id;return r.a.createElement("div",{id:e,ref:"outer2",style:{border:"none",padding:0,borderRadius:0,display:"inline-block"}})}}]),n}(a.Component);V.defaultProps={};var W=n(295),G=n(12),K=n(301),B=Object(G.a)(K.a)((function(e){var t=e.theme;return Object(d.a)(Object(d.a)({},t.typography.body2),{},{backgroundColor:"#fffef0",padding:t.spacing(1),textAlign:"center",color:t.palette.text.secondary})}));function U(e){if(e.data.length<2)return null;var t=[{domain:{x:[0,1],y:[0,1]},value:e.data[2].var_coeff_graph,title:{text:"Orch. timbre homogeneity"},type:"indicator",mode:"gauge+number",gauge:{axis:{range:[null,100]}}}],n=e.data[2].fig_config,r=e.data[2].msking_graph.data,o=e.data[2].msking_graph.layout;return o.width=window.innerWidth-380,a.createElement("div",null,a.createElement(W.a,{style:{marginTop:.5},container:!0,direction:"row",justifyContent:"center",alignItems:"center",spacing:.5},a.createElement(W.a,{item:!0,xs:6,md:6},a.createElement(B,{style:{height:452,backgroundColor:"#fffef0"}},a.createElement(_.a,null,"Orchestration at clicked point"),a.createElement(R,{notes:e.data[4].notes,instruments:e.data[4].instruments,target:e.data[4].target,target_color:"green",highlights:e.data[4].highlights,width:200,text_space:200}))),a.createElement(W.a,{item:!0,xs:6,md:6},a.createElement(B,{style:{height:452,backgroundColor:"#fffef0"}},a.createElement(_.a,null,"Spectral centroid at clicked point"),a.createElement(R,{notes:e.data[2].centroid_graph.notes,instruments:e.data[2].centroid_graph.markings,target:[],width:150,text_space:200})))),a.createElement(W.a,{style:{marginTop:.5},container:!0,direction:"row",justifyContent:"center",alignItems:"center",spacing:.5},a.createElement(W.a,{item:!0,xs:6,md:6},a.createElement(B,{style:{height:452,backgroundColor:"#fffef0"}},a.createElement(_.a,null,"Timbre distance data"),a.createElement(_.a,null,"Target timbre distance from orchestration: ",e.data[2].distance_graph,"/100"),a.createElement(M.a,{data:t,layout:{width:350,margin:{t:0,b:0},plot_bgcolor:"#fffef0",paper_bgcolor:"#fffef0"},config:n}))),a.createElement(W.a,{item:!0,xs:6,md:6},a.createElement(B,{style:{height:452,backgroundColor:"#fffef0",verticalAlign:"center"}},a.createElement(_.a,null,"Masking staff graph"),a.createElement("br",null),a.createElement("br",null),a.createElement(V,{masking_notevalues:e.data[2].masking_score.masking_notevalues,masking_colors:e.data[2].masking_score.masking_colors,masking_notesizes:e.data[2].masking_score.masking_notesizes,target_notevalues:e.data[2].masking_score.target_notevalues,target_colors:e.data[2].masking_score.target_colors,target_notesizes:e.data[2].masking_score.target_notesizes})))),a.createElement(W.a,{style:{marginTop:.5},container:!0,direction:"row",justifyContent:"left",alignItems:"left",spacing:.5},a.createElement(W.a,{item:!0,xs:12,md:12},a.createElement(B,null,a.createElement(M.a,{data:r,layout:Object(d.a)(Object(d.a)({},o),{},{width:window.innerWidth-50}),config:n})))),a.createElement(W.a,{style:{marginTop:.5},container:!0,direction:"row",justifyContent:"center",alignItems:"center",spacing:.5},a.createElement(W.a,{item:!0,xs:4,md:4},a.createElement(B,{style:{height:452,backgroundColor:"#fffef0"}},a.createElement(_.a,null,"Summary of the current orchestration"),a.createElement("br",null),a.createElement("br",null),a.createElement(_.a,null,e.data[2].summary))),a.createElement(W.a,{item:!0,xs:8,md:8},a.createElement(B,null,a.createElement(M.a,{data:e.data[2].mfcc_graph.data,layout:Object(d.a)(Object(d.a)({},e.data[2].mfcc_graph.layout),{},{width:window.innerWidth/1.5-50}),config:n,width:200})))))}var H=n(134);function J(e){var t=function(e){var t=21,n={violin:2,viola:8,cello:11,double_bass:14,flute:15,oboe:16,clarinet:17,bassoon:18,horn:19,trumpet:22,tenor_trombone:23,bass_trombone:21,timpani:22,cymbal:24};return Object.keys(n).includes(e)&&(t=n[e]),t},n=[];e.instrumentList.map((function(e){return n.push(e[0])}));var r=[[10,50,3],[20,50,2],[30,50,1],[60,50,10],[70,50,11],[80,50,12],[15,35,6],[25,35,5],[40,40,4],[55,40,7],[65,35,8],[75,35,9],[86,35,13],[18,20,20],[32,20,19],[45,30,15],[50,30,16],[70,20,24],[80,20,14],[40,10,22],[50,10,21],[60,10,23],[45,20,17],[50,20,18],[45,55,25]],o=[];r.map((function(e){return o.push(!1)}));var s=a.useState({clicked:!1,over:!1,drop:"not yet",instrument_assignment:n.map((function(e){return t(e)})),hoverState:o,position:"audience",audio:""}),i=Object(S.a)(s,2),c=i[0],l=i[1];if(a.useEffect((function(){l((function(e){return Object(d.a)(Object(d.a)({},e),{},{instrument_assignment:n.map((function(e){return t(e)}))})}))}),[e]),0===e.instrumentList.length)return null;var u=function(e,t){if(console.log(e),t){var n=Object(x.a)(c.instrument_assignment);n[t.dragData.data]=e;var a=Object(x.a)(c.hoverState);a[e-1]=!1,l(Object(d.a)(Object(d.a)({},c),{},{instrument_assignment:n,hoverState:a}))}},m=function(e,t,n){var r=e+"%",o=t+"%";return a.createElement("div",{style:{left:r,position:"absolute",top:o}},a.createElement(H.DropTarget,{onHit:function(e){return u(n,e)},targetKey:"foo",onDragEnter:function(e){return function(e,t){var n=Object(x.a)(c.hoverState);n[e]=!0,l(Object(d.a)(Object(d.a)({},c),{},{hoverState:n}))}(n-1)},onDragLeave:function(e){return function(e,t){var n=Object(x.a)(c.hoverState);n[e]=!1,l(Object(d.a)(Object(d.a)({},c),{},{hoverState:n}))}(n-1)}},a.createElement("h2",{style:{backgroundColor:"rgba(0,255,0,0.3)",borderRadius:"30px",padding:6}},n," ",c.hoverState[n-1]?"DROP HERE":"")))};return a.createElement("div",{style:{maxWidth:800,textAlign:"center",margin:"auto",alignItems:"center"}},a.createElement("div",{style:{padding:20}},"Here you can listen how your orchestration sounds like played with real instruments in Helsinki Music Center hall. The algorithm utilize pre-calculated impulse responses. Helsinki Musiikkitalo spatial impulse response measurements are done by Aalto University. They are used here with permission from Prof. Tapio Lokki, who has computed the binaural responses"),a.createElement("div",{style:{marginTop:-20,padding:20}},"Drag the instruments of your orchestration to the place on stage you want them to play. Select the listening position, selecting 'conductor' places you on the conductor podium and 'audience' to the center of row 6. When you are ready, tap 'listen' and wait for a few seconds for calculations."),a.createElement(p.a,{onClick:function(){l(Object(d.a)(Object(d.a)({},c),{},{audio:""}));var t={orchestration:e.instrumentList.map((function(e){return e[0]+","+e[1]+","+e[2]+","+e[3]})),positions:c.instrument_assignment,listeningPosition:c.position};O.a.post("https://rest.score-tool.com/listen",t,{headers:{auth:"uljasPulkkis"}}).then((function(e){var t=a.createElement("div",null,a.createElement("audio",{controls:!0}," ",a.createElement("source",{src:e.data,type:"audio/x-wav"})," "));l(Object(d.a)(Object(d.a)({},c),{},{audio:t}))})).catch((function(e){return console.log(e)}))},variant:"contained"},"click here to calculate acoustics and listen"),c.audio,a.createElement("div",{style:{display:"block"}},a.createElement(E.a,{sx:{m:1,minWidth:50}},a.createElement(v.a,{id:"listen-select"},"Position"),a.createElement(b.a,{labelId:"listen-select",id:"listen-select",value:c.position,onChange:function(e){return l(Object(d.a)(Object(d.a)({},c),{},{position:e.target.value}))},autoWidth:!0,label:"listen-select"},a.createElement(y.a,{value:"audience"},"audience"),a.createElement(y.a,{value:"conductor"},"conductor")))),a.createElement("div",{style:{float:"left"}},n.map((function(e,t){return a.createElement(H.DragDropContainer,{dragClone:!1,targetKey:"foo",onDrop:u,dragData:{data:t}},a.createElement("div",{style:{backgroundColor:"rgba(0,255,255,0.3)",borderRadius:"30px",fontSize:24,padding:10}},e+": "+c.instrument_assignment[t]))}))),a.createElement("div",{style:{clear:"both"}},"\xa0"),a.createElement("div",{style:{backgroundImage:"url(./musatalo.jpg)",position:"relative",backgroundSize:"100% 120%",backgroundRepeat:"no-repeat"}},a.createElement("div",{style:{minHeight:"50vh"}},r.map((function(e){return m(e[0],e[1],e[2])})))))}function q(e){var t=e.text,n=e.orchestration,r=a.useState({textFieldValue:t,saved:!1}),o=Object(S.a)(r,2),s=o[0],i=o[1];a.useEffect((function(){i((function(e){return Object(d.a)(Object(d.a)({},e),{},{saved:!1,textFieldValue:t})}))}),[n]);var c=function(){if(n.length>0){var e=JSON.parse(localStorage.getItem("orchestrations")),t=0;null!=e&&(e.length>0&&(t=e[e.length-1].id+1),e.push({id:t,name:s.textFieldValue,data:n}),localStorage.setItem("orchestrations",JSON.stringify(e)),i((function(e){return Object(d.a)(Object(d.a)({},e),{},{saved:!0})})))}},l=function(e){var t=e.target.value;i((function(e){return Object(d.a)(Object(d.a)({},e),{},{textFieldValue:t})}))};return a.createElement("div",null,s.saved?a.createElement("div",{style:{textAlign:"center"}},"Saved!"):a.createElement("div",null,a.createElement(j.a,{fullWidth:!0,value:s.textFieldValue,label:"save name",onChange:l}),a.createElement(p.a,{fullWidth:!0,variant:"contained",color:"secondary",onClick:c}," Save to your list of orchestrations ")))}function X(e){var t=Object(a.useState)({idx:e.idx,scoreNames:e.row[0],scoreTechs:e.row[1],scoreDyns:e.row[2],scorePitch:e.row[3],scoreTgt:e.row[4],scoreOnoff:e.row[5],scoreIdx:e.row[6],color:e.color,scoreModify:0}),n=Object(S.a)(t,2),o=n[0],s=n[1],i=function(t,n){var a=0;0===o.scoreModify?a=-12:-12===o.scoreModify&&(a=12),s((function(t){return Object(d.a)(Object(d.a)({},t),{},{scoreModify:a,scorePitch:e.row[3]+a})})),e.onChange({idx:o.idx,row:[o.scoreNames,o.scoreTechs,o.scoreDyns,e.row[3]+a,o.scoreTgt,o.scoreOnoff,o.idx]})},c=[];return-12===o.scoreModify?c=r.a.createElement("div",{onClick:i,style:{backgroundColor:"rgba(123,30,30,0.3)",borderRadius:10,padding:3,textAlign:"center"}},"-12"):12===o.scoreModify?c=r.a.createElement("div",{onClick:i,style:{backgroundColor:"rgba(30,123,30,0.3)",borderRadius:10,padding:3,textAlign:"center"}},"12"):0===o.scoreModify&&(c=r.a.createElement("div",{onClick:i,style:{backgroundColor:"rgba(30,30,30,0.3)",borderRadius:10,padding:3,textAlign:"center"}},"0")),r.a.createElement("tr",null,r.a.createElement("td",{key:"scor"+o.idx,style:{backgroundColor:o.color}},o.scoreNames),r.a.createElement("td",{key:"tec"+o.idx},o.scoreTechs),r.a.createElement("td",{key:"dy"+o.idx},r.a.createElement("div",{onClick:function(t,n){var a="mf";"mf"===o.scoreDyns?a="f":"f"===o.scoreDyns&&(a="p"),s((function(e){return Object(d.a)(Object(d.a)({},e),{},{scoreDyns:a})})),e.onChange({idx:o.idx,row:[o.scoreNames,o.scoreTechs,a,o.scorePitch,o.scoreTgt,o.scoreOnoff,o.scoreIdx]})},style:{backgroundColor:"rgba(123,200,30,0.3)",borderRadius:10,padding:3,textAlign:"center"}}," ",o.scoreDyns," ")),r.a.createElement("td",{key:"tg"+o.idx},r.a.createElement("div",{onClick:function(t,n){s((function(e){return Object(d.a)(Object(d.a)({},e),{},{scoreTgt:!e.scoreTgt})})),e.onChange({idx:o.idx,row:[o.scoreNames,o.scoreTechs,o.scoreDyns,o.scorePitch,!o.scoreTgt,o.scoreOnoff,o.idx]})},style:{backgroundColor:"rgba(123,200,30,0.3)",borderRadius:10,padding:3,textAlign:"center"}},o.scoreTgt?"target":"orchestration")),r.a.createElement("td",{key:"onof"+o.idx}," ",r.a.createElement("div",{onClick:function(t,n){s((function(e){return Object(d.a)(Object(d.a)({},e),{},{scoreOnoff:!e.scoreOnoff})})),e.onChange({idx:o.idx,row:[o.scoreNames,o.scoreTechs,o.scoreDyns,o.scorePitch,o.scoreTgt,!o.scoreOnoff,o.idx]})},style:{backgroundColor:o.scoreOnoff?"rgba(123,200,30,0.3)":"rgba(200,123,30,0.3)",borderRadius:10,padding:3,textAlign:"center"}},o.scoreOnoff?"ON":"OFF"," ")),r.a.createElement("td",{key:"mo"+o.idx},c))}var Y=a.forwardRef((function(e,t){return a.createElement(D.a,Object.assign({direction:"up",ref:t},e))}));function Q(e){var t=a.useState(!1),n=Object(S.a)(t,2),r=n[0],o=n[1],s=a.useState([]),i=Object(S.a)(s,2),c=i[0],l=i[1],u=a.useState([]),m=Object(S.a)(u,2),d=m[0],f=m[1],h=a.useState([]),p=Object(S.a)(h,2),g=p[0],b=p[1],v=a.useState([]),y=Object(S.a)(v,2),E=y[0],w=y[1],k=a.useState(!1),C=Object(S.a)(k,2),j=(C[0],C[1],a.useState({textFieldValue:"Score Editor orchestration "+JSON.parse(localStorage.getItem("orchestrations")).length})),D=Object(S.a)(j,2),P=D[0],M=(D[1],[]);a.useEffect((function(){o((function(t){return e.open})),e.data.length>1&&(l((function(t){return e.data[1]})),f([])),e.data.length>1&&(b((function(t){return e.data[0].data})),e.data[1].map((function(e){return M.push("")})),e.data[0].data[3].map((function(e,t){M[e]=0===t?"red":1===t?"magenta":2===t?"yellow":""})),w(M))}),[e]);var L=function(t){var n=[];(n=0===d.length?Object(x.a)(c):Object(x.a)(d))[t.idx]=t.row,f((function(e){return n}));var a=[];n.map((function(e){e[5]&&a.push(e)})),O.a.post("https://rest.score-tool.com/modalSlice",a).then((function(t){var n=t.data;b((function(e){return e.data=n.data}));var r=[];e.data[1].map((function(e){return r.push("")})),n.data[3].map((function(t,n){if(0===n){var o=a[t][6];e.data[1].map((function(e,t){e[6]===o&&(r[t]="red")}))}else if(1===n){var s=a[t][6];e.data[1].map((function(e,t){e[6]===s&&(r[t]="magenta")}))}else if(2===n){var i=a[t][6];e.data[1].map((function(e,t){e[6]===i&&(r[t]="yellow")}))}})),w((function(e){return r}))}))},z=[];0===d.length?z=c:d.map((function(e){e[5]&&z.push(e)}));var R=["C","C#","D","D#","E","F","F#","G","G#","A","Bb","B"];return a.createElement("div",null,a.createElement(N.a,{fullScreen:!0,open:r,onClose:e.handleClose,TransitionComponent:Y,PaperProps:{style:{backgroundColor:"#fffef0"}}},a.createElement(T.a,{sx:{position:"relative",backgroundColor:"#dcc4ac",color:"#4c4c48"}},a.createElement(I.a,null,a.createElement(A.a,{edge:"start",color:"inherit",onClick:e.handleClose,"aria-label":"close"},a.createElement("div",null,"Click here, or press ESC to close")))),a.createElement("div",{style:{textAlign:"center"}},a.createElement(_.a,null,"You can alter the orchestration by clicking the colored values. The changes do not affect the original score."),a.createElement("table",{style:{margin:"auto",display:"inline"}},a.createElement("tbody",null,a.createElement("tr",null,a.createElement("td",null,"Instr."),a.createElement("td",null,"Tech."),a.createElement("td",null,"Dyn."),a.createElement("td",null,"Role"),a.createElement("td",null,"On/Off"),a.createElement("td",null,"Transpose +- oct.")),c.map((function(e,t){return a.createElement(X,{onChange:L,idx:t,row:e,color:""})})))),a.createElement("table",{style:{margin:"auto",display:"inline"}},a.createElement("tbody",null,a.createElement("tr",null,a.createElement("td",null,"maskers")),E.map((function(e,t){return a.createElement("tr",null,a.createElement("td",{style:{backgroundColor:e,borderRadius:10,padding:4,textAlign:"center",margin:4}},c[t][0]," ",(n=c[t][3],R[n%12]+(Math.floor(n/12)-1))));var n})))),a.createElement("br",null),a.createElement(q,{text:P.textFieldValue,orchestration:c}),a.createElement(U,{data:g}),a.createElement(J,{instrumentList:z}))))}var $=n(293),Z=n(284);function ee(e){var t=Object(a.useState)({idx:e.idx,instName:e.instName,scoreNames:e.scoreNames,scoreTechs:e.scoreTechs,scoreDyns:e.scoreDyns,scoreTgt:e.scoreTgt,scoreOnoff:e.scoreOnoff,scoreModify:e.scoreModify}),n=Object(S.a)(t,2),o=n[0],s=n[1];e.onChange({instName:o.instName,scoreNames:o.scoreNames,scoreTechs:o.scoreTechs,scoreDyns:o.scoreDyns,scoreTgt:o.scoreTgt,scoreOnoff:o.scoreOnoff,scoreModify:o.scoreModify});var i,c;return r.a.createElement("tr",null,r.a.createElement("td",{key:"nam"+o.idx},o.instName),r.a.createElement("td",{key:"scor"+o.idx},function(e,t){var n=Object.keys(C);return r.a.createElement("div",null,r.a.createElement(E.a,{sx:{m:1,minWidth:50}},r.a.createElement(v.a,{id:"instrument-select"},"Instr."),r.a.createElement(b.a,{labelId:"instrument-select",id:"instrument-sel"+t,value:e,onChange:function(e){return t=e,void s((function(e){return Object(d.a)(Object(d.a)({},e),{},{scoreNames:t.target.value})}));var t},autoWidth:!0,label:"instr."},n.map((function(e){return r.a.createElement(y.a,{value:e},e)})))))}(o.scoreNames,o.idx)),r.a.createElement("td",{key:"tec"+o.idx},function(e,t){var n=C[o.scoreNames];return r.a.createElement("div",null,r.a.createElement(E.a,{sx:{m:1,minWidth:50}},r.a.createElement(v.a,{id:"tech-select"},"Tech."),r.a.createElement(b.a,{labelId:"tech-select",id:"tech-sel"+t,value:e,onChange:function(e){return t=e,void s((function(e){return Object(d.a)(Object(d.a)({},e),{},{scoreTechs:t.target.value})}));var t},autoWidth:!0,label:"tech."},n.map((function(e){return r.a.createElement(y.a,{value:e},e)})))))}(o.scoreTechs,o.idx)),r.a.createElement("td",{key:"dy"+o.idx},(i=o.scoreDyns,c=o.idx,r.a.createElement("div",null,r.a.createElement(E.a,{sx:{m:1,minWidth:50}},r.a.createElement(v.a,{id:"dyn-select"},"Dyn."),r.a.createElement(b.a,{labelId:"dyn-select",id:"dyn-sel"+c,value:i,onChange:function(e){return t=e,void s((function(e){return Object(d.a)(Object(d.a)({},e),{},{scoreDyns:t.target.value})}));var t},autoWidth:!0,label:"dyn."},["from_score","p","mf","f"].map((function(e){return r.a.createElement(y.a,{value:e},e)}))))))),r.a.createElement("td",{key:"tg"+o.idx},r.a.createElement("div",{style:{border:"1px solid lightGray",borderRadius:5,padding:8}},r.a.createElement(Z.a,{direction:"row",spacing:1,alignItems:"center"},r.a.createElement(_.a,null,"orch."),r.a.createElement($.a,{key:"tgtswitch"+o.idx,checked:o.scoreTgt,color:"secondary",onChange:function(e){return o.idx,(t=e).persist(),void s((function(e){return Object(d.a)(Object(d.a)({},e),{},{scoreTgt:t.target.checked})}));var t}}),r.a.createElement(_.a,null,"tgt")))),r.a.createElement("td",{key:"onoff"+o.idx},r.a.createElement("div",{style:{border:"1px solid lightGray",borderRadius:5,padding:8}},r.a.createElement(Z.a,{direction:"row",spacing:1,alignItems:"center"},r.a.createElement(_.a,null,"off"),r.a.createElement($.a,{key:"onoffswitch"+o.idx,checked:o.scoreOnoff,onChange:function(e){return o.idx,(t=e).persist(),void s((function(e){return Object(d.a)(Object(d.a)({},e),{},{scoreOnoff:t.target.checked})}));var t}}),r.a.createElement(_.a,null,"on")))),r.a.createElement("td",{key:"mod"+o.idx},function(e,t){return r.a.createElement("div",null,r.a.createElement(E.a,{sx:{m:1,minWidth:50}},r.a.createElement(v.a,{id:"mod-select"},"Transpose"),r.a.createElement(b.a,{labelId:"mod-select",id:"mod-sel"+t,value:e,onChange:function(e){return t=e,void s((function(e){return Object(d.a)(Object(d.a)({},e),{},{scoreModify:t.target.value})}));var t},autoWidth:!0,label:"trans."},[0,12,-12,24,-24].map((function(e){return r.a.createElement(y.a,{value:e},e)})))))}(o.scoreModify,o.idx)))}var te=n(164),ne=Object(G.a)(K.a)((function(e){var t=e.theme;return Object(d.a)(Object(d.a)({},t.typography.body2),{},{backgroundColor:"#fffef0",padding:t.spacing(1),textAlign:"center",color:t.palette.text.secondary})})),ae=function(e){Object(u.a)(n,e);var t=Object(m.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state={dataReady:!1,loaded:!1,cur:!1,measureTimestamps:[],measureRange:[1,2],maxMeasure:2,instNames:[],scoreNames:[],scoreTechs:[],scoreDyns:[],scoreTgt:[],scoreOnoff:[],scoreModify:[],instData:{},open:!1,time:[],modalData:[]},a.osmd=void 0,a.orchestrationChords=void 0,a.cursor=void 0,a.next=void 0,a.show=!0,a.divRef=r.a.createRef(),a.measureHandleChange=a.measureHandleChange.bind(Object(l.a)(a)),a.calculateMasking=a.calculateMasking.bind(Object(l.a)(a)),a.update=a.update.bind(Object(l.a)(a)),a.handleClose=a.handleClose.bind(Object(l.a)(a)),a}return Object(c.a)(n,[{key:"setupOsmd",value:function(){var e=this,t={autoResize:void 0!==this.props.autoResize&&this.props.autoResize,drawTitle:void 0===this.props.drawTitle||this.props.drawTitle};this.osmd=new h.OpenSheetMusicDisplay(this.divRef.current,t),this.osmd.load(this.props.file).then((function(){var t=.5,n=e.osmd.sheet.staves.length;n>10?t=.4:n>20?t=.3:n>30?t=.2:n>40&&(t=.1),e.osmd.zoom=t;var a=[],r=[],o=[],s=[],i=[],c=[],l=[];e.osmd.sheet.staves.map((function(e){a.push(e.parentInstrument.nameLabel.text),r.push(Object(k.a)(e.parentInstrument.nameLabel.text,Object.keys(C))[0][0]),o.push("normal"),s.push("from_score"),i.push(0),c.push(1),l.push(0)})),console.log(e.osmd);var u=[];e.osmd.sheet.sourceMeasures.map((function(e){return u.push(e.absoluteTimestamp.realValue)})),u.push(999999),e.setState((function(t){t.measureRange=[1,e.osmd.sheet.SourceMeasures.length],t.maxMeasure=e.osmd.sheet.SourceMeasures.length,t.instNames=a,t.scoreNames=r,t.scoreTechs=o,t.scoreDyns=s,t.scoreTgt=i,t.scoreOnoff=c,t.scoreModify=l,t.measureTimestamps=u})),e.forceUpdate()}))}},{key:"update",value:function(){this.osmd.updateGraphic()}},{key:"renderScore",value:function(){var e=this;this.osmd.setOptions({drawFromMeasureNumber:this.state.measureRange[0],drawUpToMeasureNumber:this.state.measureRange[1]}),this.osmd.render(),this.setState((function(e){return e.loaded=!0}));for(var t=[],n=0;n<this.osmd.graphic.VerticalGraphicalStaffEntryContainers[0].StaffEntries.length;n++)t.push({0:"mf"});var a={},r={},o=[];o.length=this.state.instNames.length;for(var s=[],i=0;i<this.state.instNames.length;i++)s.push("mf");this.osmd.sheet.sourceMeasures.map((function(t){t.absoluteTimestamp.realValue<e.state.measureTimestamps[e.state.measureRange[0]-1]&&t.staffLinkedExpressions.map((function(e,t){console.log(e),e.length>0&&e.map((function(e){e.expressions.map((function(e){e.expression.dynamicEnum<=5?s[t]="p":e.expression.dynamicEnum<=7?s[t]="mf":e.expression.dynamicEnum<=13&&(s[t]="f")}))}))}))})),this.osmd.graphic.VerticalGraphicalStaffEntryContainers.map((function(n){var i=[];if(i.length=n.StaffEntries.length,n.absoluteTimestamp.realValue>=e.state.measureTimestamps[e.state.measureRange[0]-1]&&n.absoluteTimestamp.realValue<=e.state.measureTimestamps[e.state.measureRange[1]])for(var c=function(e){i[e]=[],n.StaffEntries[e]?("undefined"!==typeof n.StaffEntries[e].parentMeasure.parentStaffLine&&n.StaffEntries[e].parentMeasure.parentStaffLine.hasOwnProperty("abstractExpressions")&&n.StaffEntries[e].parentMeasure.parentStaffLine.abstractExpressions.map((function(n){n.SourceExpression.hasOwnProperty("multiExpression")&&(t[e][String(n.SourceExpression.multiExpression.AbsoluteTimestamp.realValue)]=n.Expression)})),n.StaffEntries[e].sourceStaffEntry.voiceEntries&&n.StaffEntries[e].sourceStaffEntry.voiceEntries[0].notes.map((function(a){a.halfTone>0&&(t[e].hasOwnProperty(String(n.AbsoluteTimestamp.realValue))&&(s[e]=t[e][String(n.AbsoluteTimestamp.realValue)]),r[String(n.AbsoluteTimestamp.realValue)]=n.StaffEntries[e].boundingBox.absolutePosition.x,i[e].push({note:a.halfTone,dynamic:s[e]}),o[e]={note:a.halfTone,start:n.AbsoluteTimestamp.realValue,duration:a.length.realValue})}))):o[e]&&(o[e].start+o[e].duration>=n.AbsoluteTimestamp.realValue?(t[e].hasOwnProperty(String(n.AbsoluteTimestamp.realValue))&&(s[e]=t[e][String(n.AbsoluteTimestamp.realValue)]),i[e].push({note:o[e].note,dynamic:s[e]})):o[e]=[])},l=0;l<n.StaffEntries.length;l++)c(l);a[n.AbsoluteTimestamp.realValue]=i})),this.orchestrationChords={instruments:this.state.instNames,databaseEntries:{inst:this.state.scoreNames,tech:this.state.scoreTechs,dyn:this.state.scoreDyns,tgt:this.state.scoreTgt,onoff:this.state.scoreOnoff,modify:this.state.scoreModify},dynamics:t,notes:a,xpos:r}}},{key:"resize",value:function(){}},{key:"handleClose",value:function(){this.setState((function(e){return e.open=!1}))}},{key:"measureHandleChange",value:function(e,t,n){var a=this;Array.isArray(t)&&this.setState((function(e){return Object(d.a)(Object(d.a)({},a.state),{},{measureRange:t})}))}},{key:"calculateMasking",value:function(){var e=0;function t(n){var a=this,r=this.osmd.graphic.VerticalGraphicalStaffEntryContainers[n];if(r.absoluteTimestamp.realValue>=this.state.measureTimestamps[this.state.measureRange[0]-1]&&r.absoluteTimestamp.realValue<=this.state.measureTimestamps[this.state.measureRange[1]]){var o=this.orchestrationChords.notes[r.absoluteTimestamp.realValue],s=[],i=[],c=!1;o.map((function(e,t){if(a.orchestrationChords.databaseEntries.tgt[t]&&i.push(t),e.length>0){var n=[];"from_score"!==a.orchestrationChords.databaseEntries.dyn[t]&&(n=a.orchestrationChords.databaseEntries.dyn[t]),a.orchestrationChords.databaseEntries.tgt[t]&&(c=!0),e.map((function(e){console.log(e.dynamic),console.log(["ppppp","pppp","ppp","pp","p"].includes(e.dynamic)),0===n.length&&["ppppp","pppp","ppp","pp","p"].includes(e.dynamic)?n="p":0===n.length&&["fffff","ffff","fff","ff","f","sfz","sf"].includes(e.dynamic)?n="f":0===n.length&&["mf","mp","mfz"].includes(e.dynamic)&&(n="mf"),s.push([a.orchestrationChords.databaseEntries.inst[t],a.orchestrationChords.databaseEntries.tech[t],n,e.note+12+a.orchestrationChords.databaseEntries.modify[t],a.orchestrationChords.databaseEntries.tgt[t],a.orchestrationChords.databaseEntries.onoff[t],t])}))}})),O.a.post("https://rest.score-tool.com/maskingSlice",s).then((function(e){var t=e.data,n=[];r.StaffEntries.map((function(e){return n=e.sourceStaffEntry.voiceEntries[0].notes[0]}));var o=n.parentStaffEntry.verticalContainerParent.parentMeasure.measureNumber,s=a.orchestrationChords.xpos[r.absoluteTimestamp.realValue]-1,l=a.osmd.graphic.MusicPages[0];t&&(c&&i.map((function(e){var n=a.osmd.graphic.musicSheet.sourceMeasures[o-1].verticalMeasureList[e].boundingBox.absolutePosition.y+2,r=new h.PointF2D(s,n),i=new h.PointF2D(s+2,n),c=[];c=t[0]>=75?"rgba(255,0,0,0.7)":t[0]>=55?"rgba(255,255,0,0.5)":"rgba(0,255,0,0.3)",console.log(t[0]),a.osmd.Drawer.DrawOverlayLine(r,i,l,c,4)})),t[1]&&t[1].map((function(e,t){var n=a.osmd.graphic.musicSheet.sourceMeasures[o-1].verticalMeasureList[e].boundingBox.absolutePosition.y+2,r=new h.PointF2D(s,n),i=new h.PointF2D(s+2,n),c=[];0===t?(c="rgba(255,0,0,0.5)",a.osmd.Drawer.DrawOverlayLine(r,i,l,c,4)):1===t?(c="rgba(0,0,255,0.5)",a.osmd.Drawer.DrawOverlayLine(r,i,l,c,4)):2===t&&(c="rgba(255,255,0,0.5)",a.osmd.Drawer.DrawOverlayLine(r,i,l,c,4))})))})).finally((function(){e++,a.osmd.graphic.VerticalGraphicalStaffEntryContainers.length>e&&t(e)}))}else e++,this.osmd.graphic.VerticalGraphicalStaffEntryContainers.length>e&&t(e)}(t=t.bind(this))(e)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.resize)}},{key:"componentDidUpdate",value:function(e){(this.props.drawTitle!==e.drawTitle||this.props.file!==e.file)&&this.setupOsmd();var t=!1;this.props.file&&"undefined"!==typeof this.osmd&&"undefined"!==typeof this.osmd.cursor&&(("undefined"===typeof this.osmd.cursor.hidden||this.osmd.cursor.hidden)&&(console.log(this.osmd.cursor.hidden),t=!0),this.props.show&&t&&this.osmd.cursor.show(),this.props.next!==e.next&&(this.osmd.cursor.next(),console.log(this.osmd.cursor),console.log(this.osmd.cursor.NotesUnderCursor()),console.log(this.osmd.cursor.VoicesUnderCursor()),console.log(this.osmd.cursor.iterator.currentTimeStamp.RealValue)),window.addEventListener("resize",this.resize))}},{key:"componentDidMount",value:function(){this.props.file&&this.setupOsmd()}},{key:"render",value:function(){var e=this,t=[],n="inline-block";this.state.loaded&&(n="none",t=r.a.createElement("div",null,r.a.createElement(p.a,{variant:"contained",onClick:function(){e.calculateMasking()}},"calculate masking"),r.a.createElement(p.a,{style:{marginInline:10},variant:"contained",onClick:function(){e.renderScore()}},"redraw score (remove masking indications)"),r.a.createElement(p.a,{variant:"contained",onClick:function(){return te.saveSvgAsPng(document.getElementById("osmdSvgPage1"),"score.png")}},"Download the score as PNG")));return r.a.createElement(r.a.Fragment,null,r.a.createElement(ne,{style:{textAlign:"center",justifyContent:"center",alignItems:"center",alignContent:"center",marginLeft:"auto",marginRight:"auto"}},r.a.createElement("div",null,r.a.createElement("table",{style:{margin:"auto"}},r.a.createElement("tr",null,r.a.createElement("th",null,"score name"),r.a.createElement("th",null,"instrument"),r.a.createElement("th",null,"technique"),r.a.createElement("th",null,"dynamic"),r.a.createElement("th",null,"orch/target"),r.a.createElement("th",null,"on/off"),r.a.createElement("th",null,"transpose")),this.state.instNames.map((function(t,n){return r.a.createElement(ee,{idx:n,instName:t,scoreNames:e.state.scoreNames[n],scoreTechs:e.state.scoreTechs[n],scoreDyns:e.state.scoreDyns[n],scoreTgt:e.state.scoreTgt[n],scoreOnoff:e.state.scoreOnoff[n],scoreModify:e.state.scoreModify[n],onChange:function(t){return a=n,r=t,void e.setState((function(e){e.scoreNames[a]=r.scoreNames,e.scoreTechs[a]=r.scoreTechs,e.scoreDyns[a]=r.scoreDyns,e.scoreTgt[a]=r.scoreTgt,e.scoreOnoff[a]=r.scoreOnoff,e.scoreModify[a]=r.scoreModify}));var a,r}})})))),r.a.createElement(_.a,null,"Select bar range with slider"),r.a.createElement(g.a,{value:this.state.measureRange,min:1,max:this.state.maxMeasure,step:1,marks:!0,onChange:this.measureHandleChange,valueLabelDisplay:"auto",disableSwap:!0}),r.a.createElement(p.a,{style:{display:n},variant:"contained",onClick:function(){e.renderScore()}},"Show score"),t),r.a.createElement(ne,null,r.a.createElement("div",{ref:this.divRef,style:{width:window.innerWidth-100},onClick:function(t){var n=t.clientX,a=t.clientY,r=new h.PointF2D(n,a);r=e.osmd.graphic.domToSvg(r),r=e.osmd.graphic.svgToOsmd(r);var o=e.osmd.graphic.GetNearestNote(r,{x:15,y:15});if("undefined"!==typeof o){var s=o.sourceNote.voiceEntry.parentSourceStaffEntry.AbsoluteTimestamp.realValue;for(e.osmd.cursor.hide(),e.osmd.cursor.reset();e.osmd.cursor.iterator.currentTimeStamp.RealValue!=s;)e.osmd.cursor.next();e.osmd.cursor.show();var i=e.orchestrationChords.notes[s],c=[],l=[],u=!1;i.map((function(t,n){if(e.orchestrationChords.databaseEntries.tgt[n]&&l.push(n),t.length>0){var a=[];"from_score"!==e.orchestrationChords.databaseEntries.dyn[n]&&(a=e.orchestrationChords.databaseEntries.dyn[n]),e.orchestrationChords.databaseEntries.tgt[n]&&(u=!0),t.map((function(t){0===a.length&&["ppppp","pppp","ppp","pp","p"].includes(t.dynamic)?a="p":0===a.length&&["fffff","ffff","fff","ff","f","sfz","sf"].includes(t.dynamic)?a="f":0===a.length&&["mf","mp","mfz"].includes(t.dynamic)&&(a="mf"),c.push([e.orchestrationChords.databaseEntries.inst[n],e.orchestrationChords.databaseEntries.tech[n],a,t.note+12+e.orchestrationChords.databaseEntries.modify[n],e.orchestrationChords.databaseEntries.tgt[n],e.orchestrationChords.databaseEntries.onoff[n],n])}))}})),console.log(c),O.a.post("https://rest.score-tool.com/modalSlice",c).then((function(t){console.log(c);var n=t.data;console.log(n);var a=o.sourceNote.parentStaffEntry.verticalContainerParent.parentMeasure.measureNumber,r=e.orchestrationChords.xpos[String(s)]-1;e.osmd.graphic.MusicPages[0];n&&(u&&l.map((function(t){var o=e.osmd.graphic.musicSheet.sourceMeasures[a-1].verticalMeasureList[t].boundingBox.absolutePosition.y+2;new h.PointF2D(r,o),new h.PointF2D(r+2,o);n[0]>=75||n[0]})),n[1]&&n[1].map((function(t,n){var o=e.osmd.graphic.musicSheet.sourceMeasures[a-1].verticalMeasureList[t].boundingBox.absolutePosition.y+2;new h.PointF2D(r,o),new h.PointF2D(r+2,o)}))),e.setState((function(e){return e.modalData=[n,c]}))})).finally((function(){e.setState((function(e){e.open=!0,e.time=Date.now()})),e.forceUpdate()}))}}})),r.a.createElement(Q,{handleClose:this.handleClose,open:this.state.open,time:this.state.time,data:this.state.modalData}))}}]),n}(a.Component),re=n(132),oe=(n(244),{alto_flute:{normal:{f:[55,92],mf:[54,92],p:[54,80]}},alto_sax:{normal:{f:[48,81],mf:[48,81],p:[48,81]}},baritone_generic:{normal:{f:[30,66],mf:[30,66],p:[30,66]}},bassoon:{normal:{f:[33,75],mf:[33,75],p:[33,75]}},bass_cl:{normal:{f:[36,83],mf:[36,83],p:[36,83]}},bass_flute:{normal:{f:[47,86],mf:[47,83],p:[47,77]}},bass_trombone:{normal:{f:[24,66],mf:[24,68],p:[23,71]}},cello:{harmonics:{f:[36,72],mf:[36,72],p:[36,72]},normal:{f:[36,74],mf:[36,74],p:[36,74]},pizz:{f:[35,67],mf:[35,67],p:[35,67]},pizz_harmonics:{f:[47,70],mf:[47,70],p:[47,70]},sord:{f:[36,74],mf:[36,74],p:[36,74]},sord_trem:{f:[35,73],mf:[35,73],p:[35,73]},trem:{f:[36,74],mf:[36,74],p:[36,74]}},clarinet:{normal:{f:[49,95],mf:[49,96],p:[49,95]}},clarinet_eb:{normal:{f:[54,94],mf:[54,96],p:[54,93]}},crotale:{normal:{f:[83,108],p:[83,108]}},cymbal:{"13crash_bell":{f:[60,60],mf:[60,60],p:[60,60]},"13crash_bow":{mf:[60,60]},"13crash_chokecrash":{mf:[60,60]},"13crash_mallet":{f:[60,60],mf:[60,60],p:[60,60]},"13crash_normal":{f:[60,60],mf:[60,60],p:[60,60]},"13crash_roll":{mf:[60,60]},"13crash_shoulder":{f:[60,60],mf:[60,60],p:[60,60]},"16chinese_bell":{f:[60,60],mf:[60,60],p:[60,60]},"16chinese_bow":{mf:[60,60]},"16chinese_chokecrash":{mf:[60,60]},"16chinese_mallet":{f:[60,60],mf:[60,60],p:[60,60]},"16chinese_normal":{f:[60,60],mf:[60,60],p:[60,60]},"16chinese_roll":{mf:[60,60]},"16chinese_shoulder":{f:[60,60],mf:[60,60],p:[60,60]},"17crash_bell":{f:[60,60],mf:[60,60],p:[60,60]},"17crash_bow":{mf:[60,60]},"17crash_chokecrash":{mf:[60,60]},"17crash_mallet":{f:[60,60],mf:[60,60],p:[60,60]},"17crash_normal":{f:[60,60],mf:[60,60],p:[60,60]},"17crash_roll":{mf:[60,60]},"17crash_shoulder":{f:[60,60],mf:[60,60],p:[60,60]},"17orchcrash":{f:[60,60],mf:[60,60],p:[60,60]},"18crash_bell":{f:[60,60]},"18crash_bow":{mf:[60,60]},"18crash_chokecrash":{mf:[60,60]},"18crash_mallet":{f:[60,60],mf:[60,60],p:[60,60]},"18crash_normal":{f:[60,60],mf:[60,60],p:[60,60]},"18crash_roll":{mf:[60,60]},"18crash_shoulder":{f:[60,60],mf:[60,60],p:[60,60]},"18orchcrash_french":{f:[60,60],mf:[60,60],p:[60,60]},"18orchcrash_germanic":{f:[60,60],mf:[60,60],p:[60,60]},"18orchcrash_viennese":{f:[60,60],mf:[60,60],p:[60,60]},"19chinese_bell":{f:[60,60],mf:[60,60],p:[60,60]},"19chinese_bow":{mf:[60,60]},"19chinese_chokecrash":{mf:[60,60]},"19chinese_mallet":{f:[60,60],mf:[60,60],p:[60,60]},"19chinese_normal":{f:[60,60],mf:[60,60],p:[60,60]},"19chinese_roll":{mf:[60,60]},"19chinese_shoulder":{f:[60,60],mf:[60,60],p:[60,60]},"20chinese_bell":{f:[60,60],mf:[60,60],p:[60,60]},"20chinese_bow":{mf:[60,60]},"20chinese_chokecrash":{mf:[60,60]},"20chinese_mallet":{f:[60,60],mf:[60,60],p:[60,60]},"20chinese_normal":{f:[60,60],mf:[60,60],p:[60,60]},"20chinese_roll":{mf:[60,60]},"20chinese_shoulder":{f:[60,60],mf:[60,60],p:[60,60]},"20crash_bell":{f:[60,60],mf:[60,60],p:[60,60]},"20crash_bow":{mf:[60,60]},"20crash_chokecrash":{mf:[60,60]},"20crash_mallet":{f:[60,60],mf:[60,60],p:[60,60]},"20crash_normal":{f:[60,60],mf:[60,60],p:[60,60]},"20crash_roll":{mf:[60,60]},"20crash_shoulder":{f:[60,60],mf:[60,60],p:[60,60]},"21ride_bell":{f:[60,60],mf:[60,60],p:[60,60]},"21ride_mallet":{f:[60,60],mf:[60,60],p:[60,60]},"21ride_normal":{f:[60,60],mf:[60,60],p:[60,60]},"21ride_roll":{mf:[60,60]},"21ride_shoulder":{f:[60,60],mf:[60,60],p:[60,60]},hihat_bell:{f:[60,60],mf:[60,60],p:[60,60]},hihat_footclose:{f:[60,60],mf:[60,60],p:[60,60]},hihat_footsplash:{f:[60,60],mf:[60,60],p:[60,60]},hihat_normal:{f:[60,60],mf:[60,60],p:[60,60]},hihat_shoulder:{f:[60,60],mf:[60,60],p:[60,60]},normal:{f:[60,60],mf:[60,60],p:[60,60]},smallmetals:{mf:[60,60]},splash_bell:{f:[60,60],mf:[60,60],p:[60,60]},splash_mallet:{f:[60,60],mf:[60,60],p:[60,60]},splash_roll:{mf:[60,60]},splash_splash:{f:[60,60],mf:[60,60],p:[60,60]},windgong:{f:[60,60],mf:[60,60],p:[60,60]},windgong_bow:{mf:[60,60]}},double_bass:{harmonics:{f:[39,72],mf:[39,72],p:[39,72]},normal:{f:[22,61],mf:[22,61],p:[22,61]},pizz:{f:[28,51],mf:[28,51],p:[28,51]},pizz_harmonics:{f:[39,63],mf:[39,63],p:[39,63]},trem:{f:[23,61],mf:[23,61],p:[23,61]}},english_horn:{normal:{f:[51,84],mf:[51,84],p:[51,84]}},flute:{normal:{f:[58,97],mf:[58,96],p:[58,95]},vib:{f:[58,97],mf:[58,97],p:[58,95]}},guitar:{normal:{f:[39,84],mf:[39,85],p:[38,85]},normal_sulA:{f:[43,66],mf:[43,66],p:[43,66]},normal_sulB:{f:[57,80],mf:[57,80],p:[57,80]},normal_sulD:{f:[48,70],mf:[48,70],p:[48,70]},normal_sulE:{f:[38,61],mf:[38,61],p:[38,61]},normal_sulG:{f:[53,75],mf:[53,75],p:[53,75]},normal_sul_E:{f:[62,84],mf:[62,85],p:[62,85]}},harp:{normal:{f:[17,90],mf:[19,90],p:[17,90]}},horn:{normal:{f:[32,79],mf:[32,79],p:[32,78]}},oboe:{normal:{f:[57,93],mf:[57,93],p:[57,92]}},percussion_misc:{castanet:{f:[60,60],mf:[60,60],p:[60,60]},guiro_away:{f:[60,60],mf:[60,60],p:[60,60]},guiro_toward:{f:[60,60],mf:[60,60]},shakers:{mf:[60,60]}},piano:{normal:{f:[20,108],mf:[22,108],p:[21,108]}},piccolo:{normal:{f:[74,109],mf:[74,109],p:[74,109]}},solo_cello:{arco_sulA:{f:[56,83],mf:[56,82],p:[56,84]},arco_sulC:{f:[35,61],mf:[35,62],p:[35,62]},arco_sulD:{f:[49,75],mf:[49,75],p:[49,75]},arco_sulG:{f:[42,69],mf:[42,68],p:[42,68]},normal:{f:[35,83],mf:[35,82],p:[35,83]}},solo_double_bass:{arco_sulA:{f:[32,58],mf:[32,58],p:[32,58]},arco_sulD:{f:[37,63],mf:[37,63],p:[37,63]},arco_sulE:{f:[27,51],mf:[27,51],p:[27,51]},arco_sulG:{f:[42,68],mf:[42,60],p:[42,68]},normal:{f:[27,68],mf:[27,68],p:[27,68]},pizz:{f:[27,68],mf:[27,68],p:[27,68]},pizz_sulA:{f:[32,58],mf:[32,58],p:[32,58]},pizz_sulD:{f:[37,63],mf:[37,63],p:[37,63]},pizz_sulE:{f:[27,53],mf:[27,53],p:[27,53]},pizz_sulG:{f:[42,68],mf:[42,68],p:[42,68]}},solo_viola:{arco_sulA:{f:[68,93],mf:[68,93],p:[68,92]},arco_sulC:{f:[47,72],mf:[47,72],p:[47,73]},arco_sulD:{f:[61,87],mf:[61,86],p:[61,84]},arco_sulG:{f:[54,81],mf:[54,79],p:[54,79]},normal:{f:[47,93],mf:[47,93],p:[47,91]}},solo_violin:{arco_sulA:{f:[68,92],mf:[68,93],p:[68,93]},arco_sulD:{f:[61,87],mf:[61,87],p:[61,85]},arco_sulE:{f:[75,108],mf:[75,105],p:[75,107]},arco_sulG:{f:[54,79],mf:[54,80],p:[54,78]},normal:{f:[54,108],mf:[54,105],p:[54,107]}},soprano_generic:{normal:{f:[59,82],mf:[59,82],p:[65,87]}},soprano_sax:{normal:{f:[55,88],mf:[55,88],p:[55,88]},normal_Vib:{f:[55,88],mf:[55,88],p:[55,88]}},tambourine:{normal:{f:[60,60],mf:[60,60],p:[60,60]},normal_fingerroll:{f:[60,60],mf:[60,60],p:[60,60]},normal_sforzando:{mf:[60,60]},normal_shakeroll:{f:[60,60],mf:[60,60],p:[60,60]},normal_thumbroll:{f:[60,60],mf:[60,60],p:[60,60]}},tamtam:{bow:{mf:[60,60]},normal:{f:[60,60],mf:[60,60],p:[60,60]}},tamtam_22:{bow:{mf:[60,60]},normal:{f:[60,60],mf:[60,60],p:[60,60]}},tamtam_40:{bow:{mf:[60,60]},normal:{f:[60,60],mf:[60,60],p:[60,60]}},TenorTrombone:{normal:{f:[39,73],mf:[39,73],p:[39,73]}},tenor_generic:{normal:{f:[49,72],mf:[49,72],p:[49,71]}},thaigong:{normal:{f:[59,73],mf:[59,73],p:[59,73]}},triangle_6:{normal:{f:[60,60],mf:[60,60],p:[60,60]},normal_roll:{f:[60,60],mf:[60,60],p:[60,60]}},triangle_8:{normal:{f:[60,60],mf:[60,60],p:[60,60]},normal_roll:{f:[60,60],mf:[60,60],p:[60,60]}},trumpet:{normal:{f:[51,88],mf:[51,87],p:[51,88]},vib:{f:[51,87],mf:[51,87],p:[51,87]}},tuba:{normal:{f:[23,61],mf:[23,61],p:[23,61]}},vibraphone:{normal:{f:[47,91],mf:[47,90],p:[47,90]},normal_bow:{mf:[47,90]}},viola:{harmonics:{f:[66,88],mf:[66,88],p:[66,88]},normal:{f:[48,86],mf:[48,86],p:[48,86]},pizz:{f:[47,85],mf:[47,85],p:[47,85]},sord:{f:[48,86],mf:[48,86],p:[48,86]},sord_trem:{f:[47,85],mf:[47,85],p:[47,85]},trem:{f:[47,85],mf:[47,85],p:[47,85]}},violin:{harmonics:{f:[66,104],mf:[66,104],p:[66,104]},normal:{f:[54,97],mf:[55,96],p:[55,96]},pizz:{f:[54,96],mf:[54,96],p:[54,96]},sord:{f:[55,93],mf:[55,93],p:[55,93]},sord_trem:{f:[55,96],mf:[55,96],p:[55,96]},tremolo:{f:[54,96],mf:[54,96],p:[55,96]}},woodblock:{clave:{f:[60,60],mf:[60,60],p:[60,60]},graniteblock:{f:[60,60],mf:[60,60],p:[60,60]},normal:{f:[60,60],mf:[60,60],p:[60,60]}},xylophone:{gliss_down:{mf:[59,60]},gliss_up:{mf:[60,60]},normal:{f:[64,108],mf:[64,108],p:[64,108]},normal_hardrubber:{f:[64,108],mf:[64,108],p:[64,108]}},tenor_trombone:{normal:{f:[39,73],mf:[39,73],p:[39,73]}},timp:{normal:{f:[37,61],mf:[37,61],p:[37,57]}}}),se=n(296),ie=n(310),ce=n(171),le=n(45),ue=n.n(le),me=n(76),de=n.n(me),fe=n(56),he=n.n(fe),pe=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],ge=["Db","Eb","Gb","Ab","Bb"],be={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11},ve=/([a-g])([#b]?)(\d+)/;var ye=he()(12,128).reduce((function(e,t){return e[t]=function(e){var t=(e-12)%12,n=Math.floor((e-12)/12),a=pe[t];return{note:"".concat(a).concat(n),pitchName:a,octave:n,midiNumber:e,isAccidental:ge.includes(a)}}(t),e}),{});function Ee(e){var t=ye[e];if(!t)throw Error("Invalid MIDI number");return t}var _e=he()(12,128).filter((function(e){return!Ee(e).isAccidental})),we={fromNote:function(e){if(!e)throw Error("Invalid note argument");var t=ve.exec(e.toLowerCase());if(!t)throw Error("Invalid note argument");var n=Object(S.a)(t,4),a=n[1],r=n[2],o=n[3],s="".concat(a.toUpperCase()).concat(r),i=be[s];if(null==i)throw Error("Invalid note argument");return 12+i+12*parseInt(o,10)},getAttributes:Ee,MIN_MIDI_NUMBER:12,MAX_MIDI_NUMBER:127,NATURAL_MIDI_NUMBERS:_e},Oe=function(e){Object(u.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).onPlayNoteInput=function(){e.props.onPlayNoteInput(e.props.midiNumber)},e.onStopNoteInput=function(){e.props.onStopNoteInput(e.props.midiNumber)},e.onLeaveNote=function(){e.props.onLeaveNote(e.props.midiNumber)},e}return Object(c.a)(n,[{key:"getAbsoluteKeyPosition",value:function(e){var t=we.getAttributes(e),n=t.octave,a=t.pitchName;return this.props.pitchPositions[a]+7*n}},{key:"getRelativeKeyPosition",value:function(e){return this.getAbsoluteKeyPosition(e)-this.getAbsoluteKeyPosition(this.props.noteRange.first)}},{key:"render",value:function(){var e=this.props,t=e.naturalKeyWidth,n=e.accidentalWidthRatio,a=e.midiNumber,o=e.gliss,s=e.useTouchEvents,i=e.accidental,c=e.active,l=e.disabled,u=e.children;return r.a.createElement("div",{className:ue()("ReactPiano__Key",{"ReactPiano__Key--accidental":i,"ReactPiano__Key--natural":!i,"ReactPiano__Key--disabled":l,"ReactPiano__Key--active":c}),style:{left:ke(this.getRelativeKeyPosition(a)*t),width:ke(i?n*t:t)},onMouseDown:s?null:this.onPlayNoteInput,onMouseUp:s?null:this.onStopNoteInput,onMouseEnter:null,onMouseLeave:o?this.onStopNoteInput:null,onTouchStart:s?this.onPlayNoteInput:null,onTouchCancel:s?this.onStopNoteInput:null,onTouchEnd:s?this.onStopNoteInput:null},r.a.createElement("div",{className:"ReactPiano__NoteLabelContainer"},u))}}]),n}(r.a.Component);function ke(e){return"".concat(100*e,"%")}Oe.defaultProps={accidentalWidthRatio:.65,pitchPositions:{C:0,Db:.55,D:1,Eb:1.8,E:2,F:3,Gb:3.5,G:4,Ab:4.7,A:5,Bb:5.85,B:6}};var Ce=Oe,xe=function(e){Object(u.a)(n,e);var t=Object(m.a)(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"getMidiNumbers",value:function(){return he()(this.props.noteRange.first,this.props.noteRange.last+1)}},{key:"getNaturalKeyCount",value:function(){return this.getMidiNumbers().filter((function(e){return!we.getAttributes(e).isAccidental})).length}},{key:"getNaturalKeyWidth",value:function(){return 1/this.getNaturalKeyCount()}},{key:"getWidth",value:function(){return this.props.width?this.props.width:"100%"}},{key:"getHeight",value:function(){if(!this.props.width)return"100%";var e=this.props.width*this.getNaturalKeyWidth();return"".concat(e/this.props.keyWidthToHeight,"px")}},{key:"render",value:function(){var e=this,t=this.getNaturalKeyWidth();return r.a.createElement("div",{className:ue()("ReactPiano__Keyboard",this.props.className),style:{width:this.getWidth(),height:this.getHeight()}},this.getMidiNumbers().map((function(n){var a=we.getAttributes(n),o=(a.note,a.isAccidental),s=!e.props.disabled&&e.props.activeNotes.includes(n);return r.a.createElement(Ce,{naturalKeyWidth:t,midiNumber:n,noteRange:e.props.noteRange,active:s,accidental:o,disabled:e.props.disabled,onPlayNoteInput:e.props.onPlayNoteInput,onStopNoteInput:e.props.onStopNoteInput,onLeaveNote:e.props.onLeaveNote,gliss:e.props.gliss,useTouchEvents:e.props.useTouchEvents,key:n},e.props.disabled?null:e.props.renderNoteLabel({isActive:s,isAccidental:o,midiNumber:n}))})))}}]),n}(r.a.Component);xe.defaultProps={disabled:!1,gliss:!1,useTouchEvents:!1,keyWidthToHeight:.33,renderNoteLabel:function(){}};var Se=xe,Ne=function(e){Object(u.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={isMouseDown:!1,useTouchEvents:!1},e.handleNoteChanges=function(t){var n=t.prevActiveNotes,a=t.nextActiveNotes;if(!e.props.disabled){var r=de()(n,a);de()(a,n).forEach((function(t){e.props.playNote(t)})),r.forEach((function(t){e.props.stopNote(t)}))}},e.getMidiNumberForKey=function(t){if(!e.props.keyboardShortcuts)return null;var n=e.props.keyboardShortcuts.find((function(e){return e.key===t}));return n&&n.midiNumber},e.getKeyForMidiNumber=function(t){if(!e.props.keyboardShortcuts)return null;var n=e.props.keyboardShortcuts.find((function(e){return e.midiNumber===t}));return n&&n.key},e.onKeyDown=function(t){if(!(t.ctrlKey||t.metaKey||t.shiftKey)){var n=e.getMidiNumberForKey(t.key);n&&e.onPlayNoteInput(n)}},e.onKeyUp=function(t){var n=e.getMidiNumberForKey(t.key);n&&e.onStopNoteInput(n)},e.onPlayNoteInput=function(t){e.props.disabled||e.props.onPlayNoteInput(t,e.props.activeNotes)},e.onStopNoteInput=function(t){e.props.disabled||e.props.onStopNoteInput(t,e.props.activeNotes)},e.onLeaveNote=function(t){e.props.disabled||e.props.onLeaveNote(t,e.props.activeNotes)},e.onMouseDown=function(){e.setState({isMouseDown:!0})},e.onMouseUp=function(){e.setState({isMouseDown:!1})},e.onTouchStart=function(){e.setState({useTouchEvents:!0})},e.renderNoteLabel=function(t){var n=t.midiNumber,a=t.isActive,r=t.isAccidental,o=e.getKeyForMidiNumber(n);return e.props.renderNoteLabel({keyboardShortcut:o,midiNumber:n,isActive:a,isAccidental:r})},e}return Object(c.a)(n,[{key:"componentDidMount",value:function(){window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}},{key:"componentDidUpdate",value:function(e,t){this.props.activeNotes!==e.activeNotes&&this.handleNoteChanges({prevActiveNotes:e.activeNotes||[],nextActiveNotes:this.props.activeNotes||[]})}},{key:"render",value:function(){return r.a.createElement("div",{style:{width:"100%",height:"100%"},onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onTouchStart:this.onTouchStart,"data-testid":"container"},r.a.createElement(Se,{noteRange:this.props.noteRange,onPlayNoteInput:this.onPlayNoteInput,onStopNoteInput:this.onStopNoteInput,onLeaveNote:this.onLeaveNote,activeNotes:this.props.activeNotes,className:this.props.className,disabled:this.props.disabled,width:this.props.width,keyWidthToHeight:this.props.keyWidthToHeight,gliss:this.state.isMouseDown,useTouchEvents:this.state.useTouchEvents,renderNoteLabel:this.renderNoteLabel}))}}]),n}(r.a.Component);Ne.defaultProps={renderNoteLabel:function(e){var t=e.keyboardShortcut,n=(e.midiNumber,e.isActive),a=e.isAccidental;return t?r.a.createElement("div",{className:ue()("ReactPiano__NoteLabel",{"ReactPiano__NoteLabel--active":n,"ReactPiano__NoteLabel--accidental":a,"ReactPiano__NoteLabel--natural":!a})},t):null}};var je=Ne,Te=["activeNotes","onPlayNoteInput","onStopNoteInput"],Ie=function(e){Object(u.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={activeNotes:e.props.activeNotes||[]},e.handlePlayNoteInput=function(t){e.setState((function(n){return e.props.onPlayNoteInput&&e.props.onPlayNoteInput(t,{prevActiveNotes:n.activeNotes}),n.activeNotes.includes(t)?null:{activeNotes:n.activeNotes.concat(t)}}))},e.handleStopNoteInput=function(t){e.setState((function(n){return e.props.onStopNoteInput&&e.props.onStopNoteInput(t),{activeNotes:n.activeNotes.filter((function(e){return t!==e}))}}))},e.handleLeave=function(t){e.setState((function(e){return{activeNotes:e.activeNotes.filter((function(e){return t!==e}))}}))},e}return Object(c.a)(n,[{key:"componentDidUpdate",value:function(e){e.activeNotes!==this.props.activeNotes&&this.state.activeNotes!==this.props.activeNotes&&this.setState({activeNotes:this.props.activeNotes||[]})}},{key:"render",value:function(){var e=this.props,t=(e.activeNotes,e.onPlayNoteInput,e.onStopNoteInput,Object(ce.a)(e,Te));return r.a.createElement(je,Object.assign({activeNotes:this.state.activeNotes,onLeaveNote:this.handleLeave,onPlayNoteInput:this.handlePlayNoteInput,onStopNoteInput:this.handleStopNoteInput},t))}}]),n}(r.a.Component),Ae=(n(157),n(65)),De=L.a.Flow,Pe=function(e){var t=e.note;return r.a.createElement("div",{ref:function(e){if(e){for(var n=e;n.hasChildNodes();)n.removeChild(n.lastChild);var a=new De.Renderer(n,De.Renderer.Backends.SVG);a.resize(100,100);var r=a.getContext();r.scale(.5,.5);var o=new Ae.a(20,40,150);o.setContext(r);var s=t.filter((function(e,t,n){return parseInt(e.slice(-1))<4})),i=t.filter((function(e,t,n){return parseInt(e.slice(-1))>=4})),c="treble";s.length>i.length&&(c="bass"),o.setClef(c);var l=[],u=[];if(t.map((function(e){var t=e.slice(0,-1)+"/"+e.slice(-1),n=e.slice(-2,-1);"#"!=n&&(n="n"),l.push(t),u.push(n)})),0===t.length)o.draw();else{var m=new De.StaveNote({clef:c,keys:l,duration:"4"});u.map((function(e,t){return m.addAccidental(t,new De.Accidental(e))}));var d=new De.Voice({num_beats:1,beat_value:4});d.addTickables([m]),o.draw();(new De.Formatter).joinVoices([d]).formatToStave([d],o);d.draw(r,o)}}}})};function Me(e){var t=Object(a.useState)({idx:e.data[6],scoreNames:e.data[0],scoreTechs:e.data[1],scoreDyns:e.data[2],scorePitch:e.data[3],scoreTgt:e.data[4],scoreOnoff:e.data[5],scoreIdx:e.data[6],scoreModify:0,popOpen:!1,anchorEl:null}),n=Object(S.a)(t,2),o=n[0],s=n[1],i=["C","C#","D","D#","E","F","F#","G","G#","A","Bb","B"];function c(e){return i[e%12]+(Math.floor(e/12)-1)}var l,u,m=function(e){var t=e.currentTarget;s((function(e){return Object(d.a)(Object(d.a)({},e),{},{popOpen:!e.popOpen,anchorEl:t})}))},f=function(){s((function(e){return Object(d.a)(Object(d.a)({},e),{},{anchorEl:null,popOpen:!1})})),e.onChange([o.scoreNames,o.scoreTechs,o.scoreDyns,o.scorePitch,o.scoreTgt,o.scoreOnoff,o.scoreIdx])};o.scorePitch.map((function(e){return c(e)}));return r.a.createElement("tr",null,r.a.createElement("td",{key:"nam"+o.idx},o.instName),r.a.createElement("td",{key:"scor"+o.idx},function(t,n){var a=Object.keys(oe);return r.a.createElement("div",null,r.a.createElement(E.a,{sx:{m:1,minWidth:50}},r.a.createElement(v.a,{id:"instrument-select"},"Instr."),r.a.createElement(b.a,{labelId:"instrument-select",id:"instrument-sel"+n,value:t,onChange:function(t){return function(t,n){var a=n.target.value;s((function(e){return Object(d.a)(Object(d.a)({},e),{},{popOpen:!1})})),s((function(e){return Object(d.a)(Object(d.a)({},e),{},{scoreNames:a,scoreTechs:"normal",scoreDyns:"mf"})})),e.onChange([a,"normal","mf",o.scorePitch,o.scoreTgt,o.scoreOnoff,o.scoreIdx])}(0,t)},autoWidth:!0,label:"instr."},a.map((function(e){return r.a.createElement(y.a,{value:e},e)})))))}(o.scoreNames,o.idx)),r.a.createElement("td",{key:"tec"+o.idx},function(t,n){var a=Object.keys(oe[o.scoreNames]);return r.a.createElement("div",null,r.a.createElement(E.a,{sx:{m:1,minWidth:50}},r.a.createElement(v.a,{id:"tech-select"},"Tech."),r.a.createElement(b.a,{labelId:"tech-select",id:"tech-sel"+n,value:t,onChange:function(t){return function(t,n){var a=n.target.value;s((function(e){return Object(d.a)(Object(d.a)({},e),{},{scoreTechs:a})})),e.onChange([o.scoreNames,a,o.scoreDyns,o.scorePitch,o.scoreTgt,o.scoreOnoff,o.scoreIdx])}(0,t)},autoWidth:!0,label:"tech."},a.map((function(e){return r.a.createElement(y.a,{value:e},e)})))))}(o.scoreTechs,o.idx)),r.a.createElement("td",{key:"dy"+o.idx},function(t,n){var a=Object.keys(oe[o.scoreNames][o.scoreTechs]);return r.a.createElement("div",null,r.a.createElement(E.a,{sx:{m:1,minWidth:50}},r.a.createElement(v.a,{id:"dyn-select"},"Dyn."),r.a.createElement(b.a,{labelId:"dyn-select",id:"dyn-sel"+n,value:t,onChange:function(t){return function(t,n){var a=n.target.value;s((function(e){return Object(d.a)(Object(d.a)({},e),{},{scoreDyns:a})})),e.onChange([o.scoreNames,o.scoreTechs,a,o.scorePitch,o.scoreTgt,o.scoreOnoff,o.scoreIdx])}(0,t)},autoWidth:!0,label:"dyn."},a.map((function(e){return r.a.createElement(y.a,{value:e},e)})))))}(o.scoreDyns,o.idx)),r.a.createElement("td",{key:"pi"+o.idx},function(e,t){var n=[oe[o.scoreNames][o.scoreTechs][o.scoreDyns][0],oe[o.scoreNames][o.scoreTechs][o.scoreDyns][oe[o.scoreNames][o.scoreTechs][o.scoreDyns].length-1]];return r.a.createElement("div",null,r.a.createElement("div",{"aria-describedby":t,onClick:m},r.a.createElement(Pe,{note:o.scorePitch.map((function(e){return c(e)}))})),r.a.createElement(se.a,{id:t,open:o.popOpen,anchorEl:o.anchorEl,onClose:f,style:{zIndex:1e4},anchorOrigin:{vertical:"center",horizontal:"right"},transformOrigin:{vertical:"center",horizontal:"left"}},r.a.createElement(ie.a,{sx:{border:1,p:1,bgcolor:"white"}},r.a.createElement(Ie,{noteRange:{first:n[0],last:n[1]},activeNotes:o.scorePitch,playNote:function(e){},stopNote:function(e){var t=Object(x.a)(o.scorePitch);if(t.includes(e)){var n=t.filter((function(t,n,a){return t!=e}));s((function(e){return Object(d.a)(Object(d.a)({},e),{},{scorePitch:n})}))}else t.push(e),s((function(e){return Object(d.a)(Object(d.a)({},e),{},{scorePitch:t})}))},width:400}))))}(o.scorePitch,"pi"+o.idx)),r.a.createElement("td",null," ",r.a.createElement(p.a,{variant:"outlined",color:"warning",onClick:function(){s((function(e){return Object(d.a)(Object(d.a)({},e),{},{popOpen:!1})})),s((function(e){return Object(d.a)(Object(d.a)({},e),{},{scorePitch:[]})})),e.onChange([o.scoreNames,o.scoreTechs,o.scoreDyns,[],o.scoreTgt,o.scoreOnoff,o.scoreIdx])},size:"small"}," clear notes ")),r.a.createElement("td",{key:"tg"+o.idx},r.a.createElement("div",{style:{border:"1px solid lightGray",borderRadius:5,padding:8}},r.a.createElement(Z.a,{direction:"row",spacing:1,alignItems:"center"},r.a.createElement(_.a,null,"orch."),r.a.createElement($.a,{key:"tgtswitch"+o.idx,checked:o.scoreTgt,color:"secondary",onChange:function(t){return function(t,n){var a=n.target.checked;s((function(e){return Object(d.a)(Object(d.a)({},e),{},{scoreTgt:a})})),e.onChange([o.scoreNames,o.scoreTechs,o.scoreDyns,o.scorePitch,a,o.scoreOnoff,o.scoreIdx])}(o.idx,t)}}),r.a.createElement(_.a,null,"tgt")))),r.a.createElement("td",{key:"onoff"+o.idx},r.a.createElement("div",{style:{border:"1px solid lightGray",borderRadius:5,padding:8}},r.a.createElement(Z.a,{direction:"row",spacing:1,alignItems:"center"},r.a.createElement(_.a,null,"off"),r.a.createElement($.a,{key:"onoffswitch"+o.idx,checked:o.scoreOnoff,onChange:function(t){return function(t,n){var a=n.target.checked;s((function(e){return Object(d.a)(Object(d.a)({},e),{},{scoreOnoff:a})})),e.onChange([o.scoreNames,o.scoreTechs,o.scoreDyns,o.scorePitch,o.scoreTgt,a,o.scoreIdx])}(o.idx,t)}}),r.a.createElement(_.a,null,"on")))),r.a.createElement("td",{key:"mod"+o.idx},(l=o.scoreModify,u=o.idx,r.a.createElement("div",null,r.a.createElement(E.a,{sx:{m:1,minWidth:50}},r.a.createElement(v.a,{id:"mod-select"},"Transpose"),r.a.createElement(b.a,{labelId:"mod-select",id:"mod-sel"+u,value:l,onChange:function(e){return function(e,t){var n=t.target.value;s((function(e){return Object(d.a)(Object(d.a)({},e),{},{scorePitch:e.scorePitch+n,scoreModify:0})}))}(0,e)},autoWidth:!0,label:"trans."},[0,12,-12,24,-24].map((function(e){return r.a.createElement(y.a,{value:e},e)}))))))),r.a.createElement("td",null," ",r.a.createElement(p.a,{variant:"outlined",color:"warning",onClick:function(t){return e.onDelete(o.scoreIdx)},size:"small"}," delete ")))}var Le=n(170),ze=n(300),Re=Object(Le.a)({palette:{neutral:{main:"#dcc4ac",contrastText:"#black"}}});function Fe(e){var t=Object(a.useState)({instList:[],listenList:[],data:[],selected:null,saved:!1,textFieldValue:"Chord Editor orchestration "+JSON.parse(localStorage.getItem("orchestrations")).length}),n=Object(S.a)(t,2),r=n[0],o=n[1];a.useEffect((function(){if(null!=sessionStorage.getItem("LastChord")){var e=JSON.parse(sessionStorage.getItem("LastChord"));o((function(t){return Object(d.a)(Object(d.a)({},t),{},{instList:e})})),s(e)}}),[]);var s=function(e){var t=[],n=0;e.map((function(e,a){e[3].map((function(a){t.push([e[0],e[1],e[2],a,e[4],e[5],n]),n+=1}))})),O.a.post("https://rest.score-tool.com/modalSlice",t).then((function(e){var n=e.data;o((function(e){return Object(d.a)(Object(d.a)({},e),{},{data:n.data,listenList:t})}))}))},i=function(e){e.persist();var t=e.target.textContent.toLowerCase(),n=Object(x.a)(r.instList),a="normal";"percussion_misc"===t&&(a="castanet");var s=[];oe[t][a].mf[0]===oe[t][a].mf[1]&&(s=[oe[t][a].mf[0]]),0===n.length?n.push([t,a,"mf",s,!1,!0,0]):n.push([t,a,"mf",s,!1,!0,n[n.length-1][6]+1]),console.log(n),o((function(e){return Object(d.a)(Object(d.a)({},e),{},{instList:n})}))},c=function(e){var t=r.instList.filter((function(t,n,a){return t[6]!=e}));o((function(e){return Object(d.a)(Object(d.a)({},e),{},{instList:t})})),s(t)};return a.createElement(a.Fragment,null,a.createElement(ze.a,{theme:Re},a.createElement(p.a,{variant:"contained",color:"warning",onClick:function(){o((function(e){return Object(d.a)(Object(d.a)({},e),{},{instList:[],listenList:[],data:[],selected:null,saved:!1})}))}}," Clear all instruments "),a.createElement(_.a,{style:{textAlign:"center"}}," Select orchestration from your saved orchestrations  "),a.createElement(E.a,{sx:{m:1,minWidth:50}},a.createElement(v.a,{id:"orchestration-select"},"Orchestrations"),a.createElement(b.a,{labelId:"orchestration-select",id:"orchestration-select1",value:r.selected,onChange:function(e){var t=e.target.value,n=JSON.parse(localStorage.getItem("orchestrations")).filter((function(e,n,a){return e.id===t}))[0].data.map((function(e,t){return[e[0],e[1],e[2],e[3],e[4],e[5],t]}));o((function(e){return Object(d.a)(Object(d.a)({},e),{},{instList:n,selected:t})})),s(n)},autoWidth:!0,label:"orch."},null===localStorage.getItem("orchestrations")?null:JSON.parse(localStorage.getItem("orchestrations")).map((function(e){return a.createElement(y.a,{value:e.id},e.name)})))),a.createElement(_.a,{style:{textAlign:"center"}}," or/and  "),a.createElement(_.a,{style:{textAlign:"center"}}," Click below to add instrument to orchestration  "),a.createElement("table",null,a.createElement("tbody",null,a.createElement("tr",null,a.createElement("td",null,"Woodwinds"),a.createElement("td",null,"Brass"),a.createElement("td",null,"Strings"),a.createElement("td",null,"Percussion"),a.createElement("td",null,"Various")),a.createElement("tr",null,a.createElement("td",null,["piccolo","flute","alto_flute","bass_flute","oboe","english_horn","clarinet","clarinet_eb","bass_cl","bassoon"].map((function(e){return a.createElement(p.a,{variant:"contained",onClick:i,color:"neutral",size:"small"},e)}))),a.createElement("td",null,["trumpet","horn","tenor_trombone","bass_trombone","soprano_sax","alto_sax"].map((function(e){return a.createElement(p.a,{variant:"contained",onClick:i,color:"neutral",size:"small"},e)}))),a.createElement("td",null,["violin","viola","cello","double_bass","solo_violin","solo_viola","solo_cello","solo_double_bass"].map((function(e){return a.createElement(p.a,{variant:"contained",onClick:i,color:"neutral",size:"small"},e)}))),a.createElement("td",null,["crotale","cymbal","percussion_misc","tambourine","tamtam","tamtam_22","tamtam_40","thaigong","triangle_6","triangle_8","vibraphone","woodblock","xylophone","timp"].map((function(e){return a.createElement(p.a,{variant:"contained",onClick:i,color:"neutral",size:"small"},e)}))),a.createElement("td",null,["piano","harp","guitar","soprano_generic","tenor_generic","baritone_generic"].map((function(e){return a.createElement(p.a,{variant:"contained",onClick:i,color:"neutral",size:"small"},e)}))))))),a.createElement("div",{style:{zoom:1}},a.createElement("table",null,r.instList.map((function(e,t){return a.createElement(Me,{key:e[0]+t,data:e,onChange:function(e){return function(e,t){var n=Object(x.a)(r.instList);n[e]=t,o((function(e){return Object(d.a)(Object(d.a)({},e),{},{instList:n,saved:!1})})),sessionStorage.setItem("LastChord",JSON.stringify(n)),s(n)}(t,e)},onDelete:c,idx:"fgfg"+t})})))),a.createElement(ze.a,{theme:Re},a.createElement(p.a,{variant:"contained",color:"neutral",onClick:function(){return s(r.instList)},style:{display:"none"}}," Click to update graphs "),a.createElement(q,{text:r.textFieldValue,orchestration:r.instList})),a.createElement(U,{data:r.data}),a.createElement(J,{instrumentList:r.listenList}))}var Ve=a.forwardRef((function(e,t){return a.createElement(D.a,Object.assign({direction:"up",ref:t},e))}));function We(e){var t=a.useState(!1),n=Object(S.a)(t,2),r=n[0],o=n[1];return a.useEffect((function(){o((function(t){return e.open}))}),[e]),a.createElement("div",null,a.createElement(N.a,{fullScreen:!0,open:r,onClose:e.handleClose,TransitionComponent:Ve,PaperProps:{style:{backgroundColor:"#fffef0"}}},a.createElement(T.a,{sx:{position:"relative",backgroundColor:"#dcc4ac",color:"#4c4c48"}},a.createElement(I.a,null,a.createElement(A.a,{edge:"start",color:"inherit",onClick:e.handleClose,"aria-label":"close"},a.createElement("div",null,"Click here, or press ESC to close Chord Editor")))),a.createElement(Fe,null)))}function Ge(e){var t=Object(a.useState)({idx:e.data[6],scoreNames:e.data[0],scoreTechs:e.data[1],scoreDyns:e.data[2],scorePitch:e.data[3],scoreTgt:e.data[4],scoreOnoff:e.data[5],scoreIdx:e.data[6],scoreModify:0,popOpen:!1,anchorEl:null}),n=Object(S.a)(t,2),o=n[0],s=n[1],i=["C","C#","D","D#","E","F","F#","G","G#","A","Bb","B"];var c,l,u=function(e){var t=e.currentTarget;s((function(e){return Object(d.a)(Object(d.a)({},e),{},{popOpen:!e.popOpen,anchorEl:t})}))},m=function(){s((function(e){return Object(d.a)(Object(d.a)({},e),{},{anchorEl:null,popOpen:!1})})),e.onChange([o.scoreNames,o.scoreTechs,o.scoreDyns,o.scorePitch,o.scoreTgt,o.scoreOnoff,o.scoreIdx])};return r.a.createElement("tr",null,r.a.createElement("td",{key:"nam"+o.idx},o.instName),r.a.createElement("td",{key:"scor"+o.idx},function(t,n){var a=Object.keys(oe);return r.a.createElement("div",null,r.a.createElement(E.a,{sx:{m:1,minWidth:50}},r.a.createElement(v.a,{id:"instrument-select"},"Instr."),r.a.createElement(b.a,{labelId:"instrument-select",id:"instrument-sel"+n,value:t,onChange:function(t){return function(t,n){var a=n.target.value;s((function(e){return Object(d.a)(Object(d.a)({},e),{},{popOpen:!1})})),s((function(e){return Object(d.a)(Object(d.a)({},e),{},{scoreNames:a,scoreTechs:"normal",scoreDyns:"mf"})})),e.onChange([a,"normal","mf",o.scorePitch,o.scoreTgt,o.scoreOnoff,o.scoreIdx])}(0,t)},autoWidth:!0,label:"instr."},a.map((function(e){return r.a.createElement(y.a,{value:e},e)})))))}(o.scoreNames,o.idx)),r.a.createElement("td",{key:"tec"+o.idx},function(t,n){var a=Object.keys(oe[o.scoreNames]);return r.a.createElement("div",null,r.a.createElement(E.a,{sx:{m:1,minWidth:50}},r.a.createElement(v.a,{id:"tech-select"},"Tech."),r.a.createElement(b.a,{labelId:"tech-select",id:"tech-sel"+n,value:t,onChange:function(t){return function(t,n){var a=n.target.value;s((function(e){return Object(d.a)(Object(d.a)({},e),{},{scoreTechs:a})})),e.onChange([o.scoreNames,a,o.scoreDyns,o.scorePitch,o.scoreTgt,o.scoreOnoff,o.scoreIdx])}(0,t)},autoWidth:!0,label:"tech."},a.map((function(e){return r.a.createElement(y.a,{value:e},e)})))))}(o.scoreTechs,o.idx)),r.a.createElement("td",{key:"dy"+o.idx},function(t,n){var a=Object.keys(oe[o.scoreNames][o.scoreTechs]);return r.a.createElement("div",null,r.a.createElement(E.a,{sx:{m:1,minWidth:50}},r.a.createElement(v.a,{id:"dyn-select"},"Dyn."),r.a.createElement(b.a,{labelId:"dyn-select",id:"dyn-sel"+n,value:t,onChange:function(t){return function(t,n){var a=n.target.value;s((function(e){return Object(d.a)(Object(d.a)({},e),{},{scoreDyns:a})})),e.onChange([o.scoreNames,o.scoreTechs,a,o.scorePitch,o.scoreTgt,o.scoreOnoff,o.scoreIdx])}(0,t)},autoWidth:!0,label:"dyn."},a.map((function(e){return r.a.createElement(y.a,{value:e},e)})))))}(o.scoreDyns,o.idx)),r.a.createElement("td",{key:"pi"+o.idx},function(e,t){var n,a=[oe[o.scoreNames][o.scoreTechs][o.scoreDyns][0],oe[o.scoreNames][o.scoreTechs][o.scoreDyns][oe[o.scoreNames][o.scoreTechs][o.scoreDyns].length-1]];return r.a.createElement("div",null,r.a.createElement("div",{"aria-describedby":t,onClick:u},r.a.createElement(Pe,{note:[(n=o.scorePitch,i[n%12]+(Math.floor(n/12)-1))]})),r.a.createElement(se.a,{id:t,open:o.popOpen,anchorEl:o.anchorEl,onClose:m,style:{zIndex:1e4},anchorOrigin:{vertical:"center",horizontal:"left"},transformOrigin:{vertical:"center",horizontal:"right"}},r.a.createElement(ie.a,{sx:{border:1,p:1,bgcolor:"white"}},r.a.createElement(re.a,{noteRange:{first:a[0],last:a[1]},activeNotes:[o.scorePitch],playNote:function(e){s((function(t){return Object(d.a)(Object(d.a)({},t),{},{scorePitch:e})}))},stopNote:function(e){},width:400}))))}(o.scorePitch,"pi"+o.idx)),r.a.createElement("td",{key:"mod"+o.idx},(c=o.scoreModify,l=o.idx,r.a.createElement("div",null,r.a.createElement(E.a,{sx:{m:1,minWidth:50}},r.a.createElement(v.a,{id:"mod-select"},"Transpose"),r.a.createElement(b.a,{labelId:"mod-select",id:"mod-sel"+l,value:c,onChange:function(e){return function(e,t){var n=t.target.value;s((function(e){return Object(d.a)(Object(d.a)({},e),{},{scorePitch:e.scorePitch+n,scoreModify:0})}))}(0,e)},autoWidth:!0,label:"trans."},[0,12,-12,24,-24].map((function(e){return r.a.createElement(y.a,{value:e},e)}))))))))}var Ke=Object(G.a)(K.a)((function(e){var t=e.theme;return Object(d.a)(Object(d.a)({},t.typography.body2),{},{backgroundColor:"#fffef0",padding:t.spacing(1),textAlign:"center",color:t.palette.text.secondary})}));function Be(e){var t=e.data;return t.length<2?null:a.createElement("div",null,a.createElement(W.a,{style:{marginTop:.5},container:!0,direction:"row",justifyContent:"center",alignItems:"center",spacing:.5},a.createElement(W.a,{item:!0,xs:6,md:6},a.createElement(Ke,{style:{height:452,backgroundColor:"#fffef0"}},a.createElement(_.a,null,"Overtone structure of ",t[3].instruments[0]),a.createElement(R,{notes:t[1].notes,instruments:t[1].instruments,target:t[1].target,target_color:"red",width:200,text_space:200}))),a.createElement(W.a,{item:!0,xs:6,md:6},a.createElement(Ke,{style:{height:452,backgroundColor:"#fffef0"}},a.createElement(_.a,null,"Overtone structure of ",t[3].instruments[1]),a.createElement(R,{notes:t[2].notes,instruments:t[2].instruments,target:t[2].target,target_color:"red",width:200,text_space:200}))),a.createElement(W.a,{style:{marginTop:.5},container:!0,direction:"row",justifyContent:"center",alignItems:"center",spacing:.5},a.createElement(W.a,{item:!0,xs:6,md:6},a.createElement(Ke,{style:{height:452,backgroundColor:"#fffef0"}},a.createElement(_.a,null,"Spectral centroids"),a.createElement(R,{notes:t[3].notes,instruments:t[3].instruments,target:[],width:150,text_space:200}))),a.createElement(W.a,{item:!0,xs:6,md:6},a.createElement(Ke,null,a.createElement(M.a,{data:t[0][1].data,layout:Object(d.a)(Object(d.a)({},t[0][1].layout),{},{width:window.innerWidth/2-50}),config:{displayModeBar:!1},width:200}))))),a.createElement(W.a,{style:{marginTop:.5},container:!0,direction:"row",justifyContent:"left",alignItems:"left",spacing:.5},a.createElement(W.a,{item:!0,xs:12,md:12},a.createElement(Ke,null,a.createElement(M.a,{data:t[0][0].data,layout:Object(d.a)(Object(d.a)({},t[0][0].layout),{},{width:window.innerWidth-50}),config:{displayModeBar:!1}})))))}Object(G.a)(K.a)((function(e){var t=e.theme;return Object(d.a)(Object(d.a)({},t.typography.body2),{},{backgroundColor:"#fffef0",padding:t.spacing(1),textAlign:"center",color:t.palette.text.secondary})}));var Ue=Object(Le.a)({palette:{neutral:{main:"#dcc4ac",contrastText:"#black"}}}),He=a.forwardRef((function(e,t){return a.createElement(D.a,Object.assign({direction:"up",ref:t},e))}));function Je(e){var t=a.useState(!1),n=Object(S.a)(t,2),r=n[0],o=n[1],s=a.useState([["flute","normal","mf",60,0,1,0],["flute","normal","mf",60,0,1,1]]),i=Object(S.a)(s,2),c=i[0],l=i[1],u=a.useState([]),m=Object(S.a)(u,2),d=m[0],f=m[1];a.useEffect((function(){o((function(t){return e.open}))}),[e]),a.useEffect((function(){if(null!=sessionStorage.getItem("LastCompare")){var e=JSON.parse(sessionStorage.getItem("LastCompare"));l((function(){return e})),g(e)}}),[]);var h=function(e){var t=Object(x.a)(c);t[e[6]]=e,l((function(){return t})),sessionStorage.setItem("LastCompare",JSON.stringify(t)),g(t)},g=function(e){var t=[];e.map((function(e){t.push([e[0],e[1],e[2],e[3]])})),O.a.post("https://rest.score-tool.com/compare",t).then((function(e){var t=e.data;f((function(){return t}))}))};return console.log(localStorage.getItem("orchestrations")),a.createElement("div",null,a.createElement(N.a,{fullScreen:!0,open:r,onClose:e.handleClose,TransitionComponent:He,PaperProps:{style:{backgroundColor:"#fffef0"}}},a.createElement(T.a,{sx:{position:"relative",backgroundColor:"#dcc4ac",color:"#4c4c48"}},a.createElement(I.a,null,a.createElement(A.a,{edge:"start",color:"inherit",onClick:e.handleClose,"aria-label":"close"},a.createElement("div",null,"Click here, or press ESC to close Compare Editor")))),a.createElement(_.a,{style:{textAlign:"center"}},"Compare two instrument timbres. Select instruments to compare below."),a.createElement("table",{style:{marginInline:"20vw"}},a.createElement("tbody",null,a.createElement(Ge,{data:c[0],onChange:h}),a.createElement(Ge,{data:c[1],onChange:h}))),a.createElement(ze.a,{theme:Ue},a.createElement(p.a,{variant:"contained",color:"neutral",onClick:function(){return g(c)},style:{display:"none"}}," Click to compare")),a.createElement(Be,{data:d})))}var qe=a.forwardRef((function(e,t){return a.createElement(D.a,Object.assign({direction:"up",ref:t},e))}));function Xe(e){var t=a.useState(!1),n=Object(S.a)(t,2),r=n[0],o=n[1];return a.useEffect((function(){o((function(t){return e.open}))}),[e]),a.createElement("div",null,a.createElement(N.a,{fullScreen:!0,open:r,onClose:e.handleClose,TransitionComponent:qe,PaperProps:{style:{backgroundColor:"#fffef0"}}},a.createElement(T.a,{sx:{position:"relative",backgroundColor:"#dcc4ac",color:"#4c4c48"}},a.createElement(I.a,null,a.createElement(A.a,{edge:"start",color:"inherit",onClick:e.handleClose,"aria-label":"close"},a.createElement("div",null,"Click here, or press ESC to close Search Panel")))),a.createElement(_.a,null,"NOT YET IMPLEMENTED")))}var Ye=a.forwardRef((function(e,t){return a.createElement(D.a,Object.assign({direction:"up",ref:t},e))}));function Qe(e){var t=a.useState(!1),n=Object(S.a)(t,2),r=n[0],o=n[1],s=a.useState([]),i=Object(S.a)(s,2),c=i[0],l=i[1];a.useEffect((function(){o((function(t){return e.open}))}),[e]),a.useEffect((function(){l((function(){return JSON.parse(localStorage.getItem("orchestrations"))}))}),[]),a.useEffect((function(){l((function(){return JSON.parse(localStorage.getItem("orchestrations"))}))}),[localStorage.getItem("orchestrations")]);return a.createElement("div",null,a.createElement(N.a,{fullScreen:!0,open:r,onClose:e.handleClose,TransitionComponent:Ye,PaperProps:{style:{backgroundColor:"#fffef0"}}},a.createElement(T.a,{sx:{position:"relative",backgroundColor:"#dcc4ac",color:"#4c4c48"}},a.createElement(I.a,null,a.createElement(A.a,{edge:"start",color:"inherit",onClick:e.handleClose,"aria-label":"close"},a.createElement("div",null,"Click here, or press ESC to close Manage Panel")))),a.createElement(_.a,{style:{textAlign:"center"}},"Here you can manage your saved orchestrations"),a.createElement(f.a,{onDrop:function(e){e.forEach((function(e){var t=new FileReader;t.onabort=function(){return console.log("file reading was aborted")},t.onerror=function(){return console.log("file reading has failed")},t.onload=function(){var e=JSON.parse(localStorage.getItem("orchestrations")),n=0;e.length>0&&(n=e[e.length-1].id+1);var a=JSON.parse(t.result);a.map((function(e){e.id,e.name,e.data})),a.map((function(t,a){var r=t;r.id=n+a,e.push(r)})),l((function(){return e})),localStorage.setItem("orchestrations",JSON.stringify(e))},t.readAsText(e)}))},maxFiles:1,accept:".chords"},(function(e){var t=e.getRootProps,n=e.getInputProps;return a.createElement("section",{className:"container"},a.createElement("div",Object.assign({},t({className:"dropzone Upload"}),{style:{margin:5,padding:5,borderRadius:10,border:"2px dashed #4c4c48"}}),a.createElement("input",n()),a.createElement("p",{style:{textAlign:"center"}},"Upload your saved file of orchestration chords")),a.createElement("aside",null,a.createElement("div",null)))})),0===c.length&&a.createElement(_.a,{style:{textAlign:"center"}},"Add some orchestrations to your list (Upload a pre-saved file, or click save either in Score Analyzer or in Chord Editor.)"),c.length>0&&a.createElement("div",null,a.createElement(p.a,{onClick:function(){var e=document.createElement("a"),t=new Blob([localStorage.getItem("orchestrations")],{type:"text/plain"});e.href=URL.createObjectURL(t),e.download="orchestration.chords",document.body.appendChild(e),e.click()},variant:"contained",color:"primary",style:{padding:10,margin:5}}," Download your orchestrations "),a.createElement(_.a,{style:{textAlign:"center"}},"List of your orchestrations"),c.map((function(e){return a.createElement("div",null," ",e.id," ",e.name,a.createElement(p.a,{onClick:function(t){return function(e,t){console.log(e);var n=JSON.parse(localStorage.getItem("orchestrations")).filter((function(t,n,a){return t.id!=e}));l((function(){return n})),localStorage.setItem("orchestrations",JSON.stringify(n))}(e.id)},variant:"contained",color:"warning",style:{padding:10,margin:5}}," DELETE "))})),a.createElement(p.a,{onClick:function(){l((function(){return[]})),localStorage.setItem("orchestrations",JSON.stringify([]))},variant:"contained",color:"warning",style:{padding:10,margin:5}}," Erase all your orchestrations "))))}function $e(e){return a.createElement("div",null,a.createElement(_.a,{variant:"h5"},"About"),a.createElement(_.a,null,"Score-Tool is an analysis tool for music orchestration. The purpose of the tool is to help composers, conductors and other musicians to extract information about audibility and timbre from the score. The analysis results are showed on graphs, and there is also a possibility to listen any orchestration chord in a real binaural simulation of the concert hall."),a.createElement(_.a,{variant:"h5"},"Score"),a.createElement(_.a,null,'For analysis, the score must be in uncompressed musicXML format. All current notation programs can export musicXML from the "SaveAs" menu. Drag and drop, or click drop area to upload your score to Score-Tool. Click "load score". Analyzed score can be downloaded as PNG file.'),a.createElement(_.a,{variant:"h5"},"Chord"),a.createElement(_.a,null,'The Chord editor can be used without any files. Click any instrument name to add it to your orchestration. Click the notation stave and add notes with piano keyboard. After editing the instrumentation press "Update graphs" to view the analysis information.'))}var Ze=n(167),et=n.n(Ze),tt=n(166),nt=n.n(tt),at=n(169),rt=n.n(at),ot=n(165),st=n.n(ot),it=n(168),ct=n.n(it),lt=n(285),ut=Object(Le.a)({palette:{neutral:{main:"#dcc4ac",contrastText:"#black"}}}),mt=Object(G.a)(K.a)((function(e){var t=e.theme;return Object(d.a)(Object(d.a)({},t.typography.body2),{},{backgroundColor:"#fffef0",padding:t.spacing(1),textAlign:"center",color:t.palette.text.secondary})})),dt=function(e){Object(u.a)(n,e);var t=Object(m.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state={file:"",cursor:!1,next:0,files:[],load:"none",chord:!1,compare:!1,search:!1,manage:!1,analyze:"none",about:"block",osmd:""},a.setcursor=a.setcursor.bind(Object(l.a)(a)),a.setnext=a.setnext.bind(Object(l.a)(a)),a.loadFile=a.loadFile.bind(Object(l.a)(a)),a.onDrop=function(e){a.setState({files:e})},document.title="Score-Tool 2.0",a}return Object(c.a)(n,[{key:"componentDidMount",value:function(){null===JSON.parse(localStorage.getItem("orchestrations"))&&localStorage.setItem("orchestrations",JSON.stringify([]))}},{key:"chordClose",value:function(){this.setState((function(e){return e.chord=!1}))}},{key:"compareClose",value:function(){this.setState((function(e){return e.compare=!1}))}},{key:"searchClose",value:function(){this.setState((function(e){return e.search=!1}))}},{key:"manageClose",value:function(){this.setState((function(e){return e.manage=!1}))}},{key:"setcursor",value:function(){this.setState((function(e){return e.cursor=!0}))}},{key:"loadFile",value:function(){var e=this;this.state.files.forEach((function(t){var n=new FileReader;n.onabort=function(){return console.log("file reading was aborted")},n.onerror=function(){return console.log("file reading has failed")},n.onload=function(){var t=n.result;e.setState((function(e){e.file=t,e.load="inline-block"})),e.forceUpdate()},n.readAsText(t)}))}},{key:"setnext",value:function(){var e=this.state.next;this.setState((function(t){return t.next=e+1}))}},{key:"handleClick",value:function(e){var t=e.target.value;this.setState((function(e){return e.file=t}))}},{key:"render",value:function(){var e=this,t=this.state.files.map((function(e){return r.a.createElement("li",{key:e.name},e.name," - ",e.size," bytes")})),n=[];if(this.state.files[0]){var a="inline-block";"inline-block"===this.state.load&&(a="none"),n=r.a.createElement("div",null,r.a.createElement("div",{style:{display:a}},r.a.createElement(p.a,{onClick:this.loadFile,variant:"contained"},"Load current file")),r.a.createElement("div",{style:{display:this.state.load}},r.a.createElement(ae,{file:this.state.file,show:this.state.cursor,next:this.state.next})))}return document.body.style.backgroundColor="#fffef0",r.a.createElement("div",{className:"App"},r.a.createElement(mt,null,r.a.createElement("header",{className:"App-header",style:{padding:10,borderRadius:20}},r.a.createElement("h1",{className:"App-title",style:{padding:10,borderRadius:20}},"Score-Tool 2.0"),r.a.createElement("h1",{className:"App-title",style:{padding:10,borderRadius:20}},"Created by Uljas Pulkkis")),r.a.createElement(ze.a,{theme:ut},r.a.createElement("div",{style:{padding:10}},r.a.createElement("div",{style:{display:"inline"}},r.a.createElement(p.a,{onClick:function(){return e.setState((function(e){return Object(d.a)(Object(d.a)({},e),{},{analyze:"none",about:"block"})}))},variant:"contained",color:"neutral",startIcon:r.a.createElement(st.a,null),style:{padding:10,margin:5}}," About Score-tool")),r.a.createElement("div",{style:{display:"inline"}},r.a.createElement(p.a,{onClick:function(){return e.setState((function(e){return Object(d.a)(Object(d.a)({},e),{},{analyze:"block",about:"none"})}))},variant:"contained",color:"neutral",startIcon:r.a.createElement(nt.a,null),style:{padding:10,margin:5}}," Open score analyzer")),r.a.createElement("div",{style:{display:"inline"}},r.a.createElement(p.a,{onClick:function(){return e.setState((function(e){return Object(d.a)(Object(d.a)({},e),{},{chord:!0,analyze:"none",about:"none"})}))},variant:"contained",color:"neutral",startIcon:r.a.createElement(et.a,null),style:{padding:10,margin:5}}," Open chord editor")),r.a.createElement("div",{style:{display:"inline"}},r.a.createElement(p.a,{onClick:function(){return e.setState((function(e){return Object(d.a)(Object(d.a)({},e),{},{compare:!0,analyze:"none",about:"none"})}))},variant:"contained",color:"neutral",startIcon:r.a.createElement(ct.a,null),style:{padding:10,margin:5}}," Open compare editor")),r.a.createElement("div",{style:{display:"inline"}},r.a.createElement(p.a,{onClick:function(){return e.setState((function(e){return Object(d.a)(Object(d.a)({},e),{},{search:!0,analyze:"none",about:"none"})}))},variant:"contained",color:"neutral",startIcon:r.a.createElement(lt.a,null),style:{padding:10,margin:5}}," Open search panel")),r.a.createElement("div",{style:{display:"inline"}},r.a.createElement(p.a,{onClick:function(){return e.setState((function(e){return Object(d.a)(Object(d.a)({},e),{},{manage:!0,analyze:"none",about:"none"})}))},variant:"contained",color:"neutral",startIcon:r.a.createElement(rt.a,null),style:{padding:10,margin:5}}," Manage your orchestrations ")))),r.a.createElement(We,{handleClose:this.chordClose.bind(this),open:this.state.chord}),r.a.createElement(Je,{handleClose:this.compareClose.bind(this),open:this.state.compare}),r.a.createElement(Xe,{handleClose:this.searchClose.bind(this),open:this.state.search}),r.a.createElement(Qe,{handleClose:this.manageClose.bind(this),open:this.state.manage}),r.a.createElement("div",{className:"",style:{display:this.state.analyze}},r.a.createElement(_.a,{style:{textAlign:"center"}}," Select an example score  "),r.a.createElement(E.a,{sx:{m:1,minWidth:150}},r.a.createElement(v.a,{id:"score-select"},"Scores"),r.a.createElement(b.a,{labelId:"score-select",id:"score-select1",value:this.state.selected,onChange:function(t){var n=t.target.value;e.setState((function(t){return t.osmd=r.a.createElement(ae,{file:n,show:e.state.cursor,next:e.state.next})}))},autoWidth:!0,label:"score"},["test_score2.xml"].map((function(e){return r.a.createElement(y.a,{value:e},e)})))),r.a.createElement(_.a,{style:{textAlign:"center"}}," or  "),r.a.createElement(f.a,{onDrop:this.onDrop,maxFiles:1,accept:"text/xml"},(function(e){var n=e.getRootProps,a=e.getInputProps;return r.a.createElement("section",{className:"container"},r.a.createElement("div",Object.assign({},n({className:"dropzone Upload"}),{style:{margin:20,padding:10,borderRadius:10,border:"2px dashed #4c4c48",backgroundColor:"#dcc4ac"}}),r.a.createElement("input",a()),r.a.createElement("p",null,"Drop musicXML or click")),r.a.createElement("aside",null,r.a.createElement("div",null,t)))})),n,this.state.osmd),r.a.createElement("div",{style:{display:this.state.about,textAlign:"left",textJustify:"left",paddingInline:"20vw"}},r.a.createElement($e,null))))}}]),n}(a.Component),ft=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ht(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}})).catch((function(e){console.error("Error during service worker registration:",e)}))}s.a.render(r.a.createElement(dt,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL(".",window.location).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat(".","/service-worker.js");ft?(!function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):ht(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):ht(e)}))}}()}},[[190,1,2]]]);