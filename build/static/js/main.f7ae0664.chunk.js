(this["webpackJsonpreact-score-tool"]=this["webpackJsonpreact-score-tool"]||[]).push([[0],{141:function(e,t,a){},169:function(e,t,a){e.exports=a(204)},174:function(e,t,a){},177:function(e,t,a){},204:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(58),o=a.n(s),l=(a(174),a(101)),i=(a(177),a(40)),c=a(264),m=a(252);function d(e){const[t,a]=n.useState({measureRange:[1,2],maxMeasure:2});n.useEffect(()=>{a(t=>({...t,measureRange:e.range,maxMeasure:e.max}))},[e]);return n.createElement(m.a,{value:t.measureRange,min:1,max:t.maxMeasure,step:1,marks:!0,onChange:(e,t,n)=>{if(!Array.isArray(t))return;let r=t;a(e=>({...e,measureRange:r}))},onChangeCommitted:e.measureHandleChange,valueLabelDisplay:"auto",disableSwap:!0})}var h=a(248),u=a(254),p=a(251),f=a(265),g=a(267),y=a(24),E=a.n(y),b=a(116);const v={alto_flute:["normal"],alto_sax:["normal"],baritone_generic:["normal"],bassoon:["normal"],bass_cl:["normal"],bass_flute:["normal"],bass_trombone:["normal"],cello:["harmonics","normal","pizz","pizz_harmonics","sord","sord_trem","trem"],clarinet:["normal"],clarinet_eb:["normal"],crotale:["normal"],cymbal:["13crash_bell","13crash_bow","13crash_chokecrash","13crash_mallet","13crash_normal","13crash_roll","13crash_shoulder","16chinese_bell","16chinese_bow","16chinese_chokecrash","16chinese_mallet","16chinese_normal","16chinese_roll","16chinese_shoulder","17crash_bell","17crash_bow","17crash_chokecrash","17crash_mallet","17crash_normal","17crash_roll","17crash_shoulder","17orchcrash","18crash_bell","18crash_bow","18crash_chokecrash","18crash_mallet","18crash_normal","18crash_roll","18crash_shoulder","18orchcrash_french","18orchcrash_germanic","18orchcrash_viennese","19chinese_bell","19chinese_bow","19chinese_chokecrash","19chinese_mallet","19chinese_normal","19chinese_roll","19chinese_shoulder","20chinese_bell","20chinese_bow","20chinese_chokecrash","20chinese_mallet","20chinese_normal","20chinese_roll","20chinese_shoulder","20crash_bell","20crash_bow","20crash_chokecrash","20crash_mallet","20crash_normal","20crash_roll","20crash_shoulder","21ride_bell","21ride_mallet","21ride_normal","21ride_roll","21ride_shoulder","hihat_bell","hihat_footclose","hihat_footsplash","hihat_normal","hihat_shoulder","normal","smallmetals","splash_bell","splash_mallet","splash_roll","splash_splash","windgong","windgong_bow"],double_bass:["harmonics","normal","pizz","pizz_harmonics","trem"],english_horn:["normal"],flute:["normal","vib"],guitar:["normal","normal_sulA","normal_sulB","normal_sulD","normal_sulE","normal_sulG","normal_sul_E"],harp:["normal"],horn:["normal"],oboe:["normal"],percussion_misc:["castanet","guiro_away","guiro_toward","shakers"],piano:["normal"],piccolo:["normal"],solo_cello:["arco_sulA","arco_sulC","arco_sulD","arco_sulG","normal"],solo_double_bass:["arco_sulA","arco_sulD","arco_sulE","arco_sulG","normal","pizz","pizz_sulA","pizz_sulD","pizz_sulE","pizz_sulG"],solo_viola:["arco_sulA","arco_sulC","arco_sulD","arco_sulG","normal"],solo_violin:["arco_sulA","arco_sulD","arco_sulE","arco_sulG","normal"],soprano_generic:["normal"],soprano_sax:["normal","normal_Vib"],tambourine:["normal","normal_fingerroll","normal_sforzando","normal_shakeroll","normal_thumbroll"],tamtam:["bow","normal"],tamtam_22:["bow","normal"],tamtam_40:["bow","normal"],tenor_generic:["normal"],thaigong:["normal"],triangle_6:["normal","normal_roll"],triangle_8:["normal","normal_roll"],trumpet:["normal","vib"],tuba:["normal"],vibraphone:["normal","normal_bow"],viola:["harmonics","normal","pizz","sord","sord_trem","trem"],violin:["harmonics","normal","pizz","sord","sord_trem","tremolo"],woodblock:["clave","graniteblock","normal"],xylophone:["gliss_down","gliss_up","normal","normal_hardrubber"],tenor_trombone:["normal"],timp:["normal"]},_={alto_flute:{normal:{f:[55,92],mf:[54,92],p:[54,80]}},alto_sax:{normal:{f:[48,81],mf:[48,81],p:[48,81]}},baritone_generic:{normal:{f:[30,66],mf:[30,66],p:[30,66]}},bassoon:{normal:{f:[33,75],mf:[33,75],p:[33,75]}},bass_cl:{normal:{f:[36,83],mf:[36,83],p:[36,83]}},bass_flute:{normal:{f:[47,86],mf:[47,83],p:[47,77]}},bass_trombone:{normal:{f:[24,66],mf:[24,68],p:[23,71]}},cello:{harmonics:{f:[36,72],mf:[36,72],p:[36,72]},normal:{f:[36,74],mf:[36,74],p:[36,74]},pizz:{f:[35,67],mf:[35,67],p:[35,67]},pizz_harmonics:{f:[47,70],mf:[47,70],p:[47,70]},sord:{f:[36,74],mf:[36,74],p:[36,74]},sord_trem:{f:[35,73],mf:[35,73],p:[35,73]},trem:{f:[36,74],mf:[36,74],p:[36,74]}},clarinet:{normal:{f:[49,95],mf:[49,96],p:[49,95]}},clarinet_eb:{normal:{f:[54,94],mf:[54,96],p:[54,93]}},crotale:{normal:{f:[83,108],p:[83,108]}},cymbal:{"13crash_bell":{f:[60,60],mf:[60,60],p:[60,60]},"13crash_bow":{mf:[60,60]},"13crash_chokecrash":{mf:[60,60]},"13crash_mallet":{f:[60,60],mf:[60,60],p:[60,60]},"13crash_normal":{f:[60,60],mf:[60,60],p:[60,60]},"13crash_roll":{mf:[60,60]},"13crash_shoulder":{f:[60,60],mf:[60,60],p:[60,60]},"16chinese_bell":{f:[60,60],mf:[60,60],p:[60,60]},"16chinese_bow":{mf:[60,60]},"16chinese_chokecrash":{mf:[60,60]},"16chinese_mallet":{f:[60,60],mf:[60,60],p:[60,60]},"16chinese_normal":{f:[60,60],mf:[60,60],p:[60,60]},"16chinese_roll":{mf:[60,60]},"16chinese_shoulder":{f:[60,60],mf:[60,60],p:[60,60]},"17crash_bell":{f:[60,60],mf:[60,60],p:[60,60]},"17crash_bow":{mf:[60,60]},"17crash_chokecrash":{mf:[60,60]},"17crash_mallet":{f:[60,60],mf:[60,60],p:[60,60]},"17crash_normal":{f:[60,60],mf:[60,60],p:[60,60]},"17crash_roll":{mf:[60,60]},"17crash_shoulder":{f:[60,60],mf:[60,60],p:[60,60]},"17orchcrash":{f:[60,60],mf:[60,60],p:[60,60]},"18crash_bell":{f:[60,60]},"18crash_bow":{mf:[60,60]},"18crash_chokecrash":{mf:[60,60]},"18crash_mallet":{f:[60,60],mf:[60,60],p:[60,60]},"18crash_normal":{f:[60,60],mf:[60,60],p:[60,60]},"18crash_roll":{mf:[60,60]},"18crash_shoulder":{f:[60,60],mf:[60,60],p:[60,60]},"18orchcrash_french":{f:[60,60],mf:[60,60],p:[60,60]},"18orchcrash_germanic":{f:[60,60],mf:[60,60],p:[60,60]},"18orchcrash_viennese":{f:[60,60],mf:[60,60],p:[60,60]},"19chinese_bell":{f:[60,60],mf:[60,60],p:[60,60]},"19chinese_bow":{mf:[60,60]},"19chinese_chokecrash":{mf:[60,60]},"19chinese_mallet":{f:[60,60],mf:[60,60],p:[60,60]},"19chinese_normal":{f:[60,60],mf:[60,60],p:[60,60]},"19chinese_roll":{mf:[60,60]},"19chinese_shoulder":{f:[60,60],mf:[60,60],p:[60,60]},"20chinese_bell":{f:[60,60],mf:[60,60],p:[60,60]},"20chinese_bow":{mf:[60,60]},"20chinese_chokecrash":{mf:[60,60]},"20chinese_mallet":{f:[60,60],mf:[60,60],p:[60,60]},"20chinese_normal":{f:[60,60],mf:[60,60],p:[60,60]},"20chinese_roll":{mf:[60,60]},"20chinese_shoulder":{f:[60,60],mf:[60,60],p:[60,60]},"20crash_bell":{f:[60,60],mf:[60,60],p:[60,60]},"20crash_bow":{mf:[60,60]},"20crash_chokecrash":{mf:[60,60]},"20crash_mallet":{f:[60,60],mf:[60,60],p:[60,60]},"20crash_normal":{f:[60,60],mf:[60,60],p:[60,60]},"20crash_roll":{mf:[60,60]},"20crash_shoulder":{f:[60,60],mf:[60,60],p:[60,60]},"21ride_bell":{f:[60,60],mf:[60,60],p:[60,60]},"21ride_mallet":{f:[60,60],mf:[60,60],p:[60,60]},"21ride_normal":{f:[60,60],mf:[60,60],p:[60,60]},"21ride_roll":{mf:[60,60]},"21ride_shoulder":{f:[60,60],mf:[60,60],p:[60,60]},hihat_bell:{f:[60,60],mf:[60,60],p:[60,60]},hihat_footclose:{f:[60,60],mf:[60,60],p:[60,60]},hihat_footsplash:{f:[60,60],mf:[60,60],p:[60,60]},hihat_normal:{f:[60,60],mf:[60,60],p:[60,60]},hihat_shoulder:{f:[60,60],mf:[60,60],p:[60,60]},normal:{f:[60,60],mf:[60,60],p:[60,60]},smallmetals:{mf:[60,60]},splash_bell:{f:[60,60],mf:[60,60],p:[60,60]},splash_mallet:{f:[60,60],mf:[60,60],p:[60,60]},splash_roll:{mf:[60,60]},splash_splash:{f:[60,60],mf:[60,60],p:[60,60]},windgong:{f:[60,60],mf:[60,60],p:[60,60]},windgong_bow:{mf:[60,60]}},double_bass:{harmonics:{f:[39,72],mf:[39,72],p:[39,72]},normal:{f:[22,61],mf:[22,61],p:[22,61]},pizz:{f:[28,51],mf:[28,51],p:[28,51]},pizz_harmonics:{f:[39,63],mf:[39,63],p:[39,63]},trem:{f:[23,61],mf:[23,61],p:[23,61]}},english_horn:{normal:{f:[51,84],mf:[51,84],p:[51,84]}},flute:{normal:{f:[58,97],mf:[58,96],p:[58,95]},vib:{f:[58,97],mf:[58,97],p:[58,95]}},guitar:{normal:{f:[39,84],mf:[39,85],p:[38,85]},normal_sulA:{f:[43,66],mf:[43,66],p:[43,66]},normal_sulB:{f:[57,80],mf:[57,80],p:[57,80]},normal_sulD:{f:[48,70],mf:[48,70],p:[48,70]},normal_sulE:{f:[38,61],mf:[38,61],p:[38,61]},normal_sulG:{f:[53,75],mf:[53,75],p:[53,75]},normal_sul_E:{f:[62,84],mf:[62,85],p:[62,85]}},harp:{normal:{f:[17,90],mf:[19,90],p:[17,90]}},horn:{normal:{f:[32,79],mf:[32,79],p:[32,78]}},oboe:{normal:{f:[57,93],mf:[57,93],p:[57,92]}},percussion_misc:{castanet:{f:[60,60],mf:[60,60],p:[60,60]},guiro_away:{f:[60,60],mf:[60,60],p:[60,60]},guiro_toward:{f:[60,60],mf:[60,60]},shakers:{mf:[60,60]}},piano:{normal:{f:[20,108],mf:[22,108],p:[21,108]}},piccolo:{normal:{f:[74,109],mf:[74,109],p:[74,109]}},solo_cello:{arco_sulA:{f:[56,83],mf:[56,82],p:[56,84]},arco_sulC:{f:[35,61],mf:[35,62],p:[35,62]},arco_sulD:{f:[49,75],mf:[49,75],p:[49,75]},arco_sulG:{f:[42,69],mf:[42,68],p:[42,68]},normal:{f:[35,83],mf:[35,82],p:[35,83]}},solo_double_bass:{arco_sulA:{f:[32,58],mf:[32,58],p:[32,58]},arco_sulD:{f:[37,63],mf:[37,63],p:[37,63]},arco_sulE:{f:[27,51],mf:[27,51],p:[27,51]},arco_sulG:{f:[42,68],mf:[42,60],p:[42,68]},normal:{f:[27,68],mf:[27,68],p:[27,68]},pizz:{f:[27,68],mf:[27,68],p:[27,68]},pizz_sulA:{f:[32,58],mf:[32,58],p:[32,58]},pizz_sulD:{f:[37,63],mf:[37,63],p:[37,63]},pizz_sulE:{f:[27,53],mf:[27,53],p:[27,53]},pizz_sulG:{f:[42,68],mf:[42,68],p:[42,68]}},solo_viola:{arco_sulA:{f:[68,93],mf:[68,93],p:[68,92]},arco_sulC:{f:[47,72],mf:[47,72],p:[47,73]},arco_sulD:{f:[61,87],mf:[61,86],p:[61,84]},arco_sulG:{f:[54,81],mf:[54,79],p:[54,79]},normal:{f:[47,93],mf:[47,93],p:[47,91]}},solo_violin:{arco_sulA:{f:[68,92],mf:[68,93],p:[68,93]},arco_sulD:{f:[61,87],mf:[61,87],p:[61,85]},arco_sulE:{f:[75,108],mf:[75,105],p:[75,107]},arco_sulG:{f:[54,79],mf:[54,80],p:[54,78]},normal:{f:[54,108],mf:[54,105],p:[54,107]}},soprano_generic:{normal:{f:[59,82],mf:[59,82],p:[65,87]}},soprano_sax:{normal:{f:[55,88],mf:[55,88],p:[55,88]},normal_Vib:{f:[55,88],mf:[55,88],p:[55,88]}},tambourine:{normal:{f:[60,60],mf:[60,60],p:[60,60]},normal_fingerroll:{f:[60,60],mf:[60,60],p:[60,60]},normal_sforzando:{mf:[60,60]},normal_shakeroll:{f:[60,60],mf:[60,60],p:[60,60]},normal_thumbroll:{f:[60,60],mf:[60,60],p:[60,60]}},tamtam:{bow:{mf:[60,60]},normal:{f:[60,60],mf:[60,60],p:[60,60]}},tamtam_22:{bow:{mf:[60,60]},normal:{f:[60,60],mf:[60,60],p:[60,60]}},tamtam_40:{bow:{mf:[60,60]},normal:{f:[60,60],mf:[60,60],p:[60,60]}},TenorTrombone:{normal:{f:[39,73],mf:[39,73],p:[39,73]}},tenor_generic:{normal:{f:[49,72],mf:[49,72],p:[49,71]}},thaigong:{normal:{f:[59,73],mf:[59,73],p:[59,73]}},triangle_6:{normal:{f:[60,60],mf:[60,60],p:[60,60]},normal_roll:{f:[60,60],mf:[60,60],p:[60,60]}},triangle_8:{normal:{f:[60,60],mf:[60,60],p:[60,60]},normal_roll:{f:[60,60],mf:[60,60],p:[60,60]}},trumpet:{normal:{f:[51,88],mf:[51,87],p:[51,88]},vib:{f:[51,87],mf:[51,87],p:[51,87]}},tuba:{normal:{f:[23,61],mf:[23,61],p:[23,61]}},vibraphone:{normal:{f:[47,91],mf:[47,90],p:[47,90]},normal_bow:{mf:[47,90]}},viola:{harmonics:{f:[66,88],mf:[66,88],p:[66,88]},normal:{f:[48,86],mf:[48,86],p:[48,86]},pizz:{f:[47,85],mf:[47,85],p:[47,85]},sord:{f:[48,86],mf:[48,86],p:[48,86]},sord_trem:{f:[47,85],mf:[47,85],p:[47,85]},trem:{f:[47,85],mf:[47,85],p:[47,85]}},violin:{harmonics:{f:[66,104],mf:[66,104],p:[66,104]},normal:{f:[54,97],mf:[55,96],p:[55,96]},pizz:{f:[54,96],mf:[54,96],p:[54,96]},sord:{f:[55,93],mf:[55,93],p:[55,93]},sord_trem:{f:[55,96],mf:[55,96],p:[55,96]},tremolo:{f:[54,96],mf:[54,96],p:[55,96]}},woodblock:{clave:{f:[60,60],mf:[60,60],p:[60,60]},graniteblock:{f:[60,60],mf:[60,60],p:[60,60]},normal:{f:[60,60],mf:[60,60],p:[60,60]}},xylophone:{gliss_down:{mf:[59,60]},gliss_up:{mf:[60,60]},normal:{f:[64,108],mf:[64,108],p:[64,108]},normal_hardrubber:{f:[64,108],mf:[64,108],p:[64,108]}},tenor_trombone:{normal:{f:[39,73],mf:[39,73],p:[39,73]}},timp:{normal:{f:[37,61],mf:[37,61],p:[37,57]}}};var x=a(261),C=a(255),k=a(270),w=a(271),S=a(266),N=a(244),T=a(59),I=a.n(T),A=a(72);const M=A.a.Flow;class O extends n.Component{constructor(e){super(e),this.notes=0,this.target=0,this.instruments=0,this.renderer=0,this.context=0,this.scale=1,this.state={x:0,y:0}}setupScore(){const e=document.createElement("div"),{id:t,notes:a,target:n,instruments:r,setProps:s,width:o,height:l,t_score_y:i,b_score_y:c,target_color:m,text_space:d,highlights:h,indexing:u,scale:p}=this.props;this.notes=a,this.target=n,this.instruments=r,this.scale=p,this.renderer=new M.Renderer(e,M.Renderer.Backends.SVG),this.renderer.resize(o+d,l);var f=this.renderer.getContext();this.context=f,this.context.scale(this.scale,this.scale);var g=new M.Stave(20,i,o);g.addClef("treble"),g.setContext(this.context).draw();var y=new M.Stave(20,c,o);y.addClef("bass"),y.setContext(this.context).draw();var E=function(e,t,a){var n,r,s,o,l,i,c,m=[],d=[],p=[],f=[],g=[],y=[],E=[],b=[],v=[],_=[],x=[],C=[],k=[],w=[],S=[];for(n=0;n<e.length;n++){l=e[n],c=u?n+": "+t[n]:t[n];var N="";if("undefined"!==typeof h[n]&&(N=h[n]),r=l[0],s=l[l.length-1],o=l.length>2?l[1]:"n",i=r.concat("/",s),T=a[n],parseInt(s)>=4&&parseInt(s)<6){m.push(i),d.push(o),f.push(c),g.push(N);for(var T=0,I=0;I<a.length;I++)a[I]===n&&(T=1);p.push(T)}else if(parseInt(s)>=6){s-=2,i=r.concat("/",s),x.push(i),C.push(o),w.push(c),S.push(N);for(T=0,I=0;I<a.length;I++)a[I]===n&&(T=1);k.push(T)}else{y.push(i),E.push(o),v.push(c),_.push(N);for(T=0,I=0;I<a.length;I++)a[I]===n&&(T=1);b.push(T)}}return[m,d,p,y,E,b,f,v,g,_,x,C,k,w,S]}(this.notes,this.instruments,this.target);if(Array.isArray(E[10])&&E[10].length){var b=new M.Stave(20,40,o);b.addClef("treble"),b.setContext(this.context).draw(),this.context.fillText("15ma",b.x+6,b.y+26);for(var v=[],_=0;_<E[10].length;_++)v.push("c/4");var x=new M.StaveNote({clef:"treble",keys:v,duration:"q"});x.setStemStyle({strokeStyle:"none"}),x.setLedgerLineStyle({strokeStyle:"none"});for(_=0;_<E[10].length;_++)x.setKeyLine(_,_-1.5);var C=new M.StaveNote({clef:"treble",keys:E[10],duration:"q"}),k=E[13],w=E[14];for(_=0;_<E[11].length;_++){C.addAccidental(_,new M.Accidental(E[11][_]));var S=V(k[_],M.Modifier.Position.RIGHT);S.setOffsetX(-10),x.note_heads[_].glyph_code="v23",x.addModifier(_,S),w[_]&&C.setKeyStyle(_,{shadowColor:w[_],shadowBlur:100}),1===E[12][_]&&(C.setKeyStyle(_,{fillStyle:m}),x.setKeyStyle(_,{fillStyle:m}))}var N=new M.StaveConnector(b,y),T=new M.StaveConnector(b,y)}else N=new M.StaveConnector(g,y),T=new M.StaveConnector(g,y);N.setType(M.StaveConnector.type.SINGLE_LEFT),N.setContext(this.context),N.draw(),T.setType(M.StaveConnector.type.BRACKET),T.setContext(this.context),T.draw();var I=[];for(_=0;_<E[0].length;_++)I.push("c/4");var A=new M.StaveNote({clef:"treble",keys:I,duration:"q"});A.setStemStyle({strokeStyle:"none"}),A.setLedgerLineStyle({strokeStyle:"none"});for(_=0;_<E[0].length;_++)A.setKeyLine(_,_-1.5);var O=[];for(_=0;_<E[3].length;_++)O.push("c/3");var P=new M.StaveNote({clef:"bass",keys:O,duration:"q"});P.setStemStyle({strokeStyle:"none"}),P.setLedgerLineStyle({strokeStyle:"none"});for(_=0;_<E[3].length;_++)P.setKeyLine(_,_-1.5);var D=new M.StaveNote({clef:"treble",keys:E[0],duration:"q"}),L=new M.StaveNote({clef:"bass",keys:E[3],duration:"q"}),z=E[6],R=E[7],F=E[8],W=E[9];function V(e,t){return new M.FretHandFinger(e).setPosition(t)}for(_=0;_<E[1].length;_++){D.addAccidental(_,new M.Accidental(E[1][_]));var j=V(z[_],M.Modifier.Position.RIGHT);j.setOffsetX(-10),A.note_heads[_].glyph_code="v23",A.addModifier(_,j),F[_]&&D.setKeyStyle(_,{shadowColor:F[_],shadowBlur:100}),1===E[2][_]&&(D.setKeyStyle(_,{fillStyle:m}),A.setKeyStyle(_,{fillStyle:m}))}for(_=0;_<E[3].length;_++){L.addAccidental(_,new M.Accidental(E[4][_]));var G=V(R[_],M.Modifier.Position.RIGHT);G.setOffsetX(-10),P.note_heads[_].glyph_code="v23",P.addModifier(_,G),W[_]&&L.setKeyStyle(_,{shadowColor:W[_],shadowBlur:100}),1===E[5][_]&&(L.setKeyStyle(_,{fillStyle:m}),P.setKeyStyle(_,{fillStyle:m}))}if(Array.isArray(E[0])&&E[0].length){var K=new M.Voice({num_beats:1,beat_value:4}).setMode(2),B=new M.Voice({num_beats:1,beat_value:4}).setMode(2);K.addTickables([D]),B.addTickables([A]);(new M.Formatter).joinVoices([K]).format([K],o);(new M.Formatter).joinVoices([B]).format([B],o).tickContexts.array[0].x=o-40,K.draw(this.context,g),B.draw(this.context,g)}var U=new M.Voice({num_beats:1,beat_value:4}),H=new M.Voice({num_beats:1,beat_value:4});if(H.addTickables([P]),Array.isArray(E[3])&&E[3].length){U.addTickables([L]);(new M.Formatter).joinVoices([U]).format([U],o);(new M.Formatter).joinVoices([H]).format([H],o).tickContexts.array[0].x=o-40,U.draw(this.context,y),H.draw(this.context,y)}if(Array.isArray(E[10])&&E[10].length){var J=new M.Voice({num_beats:1,beat_value:4}).setMode(2),q=new M.Voice({num_beats:1,beat_value:4}).setMode(2);J.addTickables([C]),q.addTickables([x]);(new M.Formatter).joinVoices([J]).format([J],o);(new M.Formatter).joinVoices([q]).format([q],o).tickContexts.array[0].x=o-40,J.draw(this.context,b),q.draw(this.context,b);var X=[];for(_=0;_<v.length;_++){var Y=new M.StaveLine({first_note:C,last_note:x,first_indices:[_],last_indices:[_]});Y.render_options.line_width=3,Y.render_options.padding_right=-4,w[_]&&(Y.render_options.color=w[_]),1===E[12][_]&&(Y.render_options.color=m),X.push(Y)}for(var Q=0;Q<X.length;Q++)X[Q].setContext(f),X[Q].draw()}var $=[];for(_=0;_<I.length;_++){var Z=new M.StaveLine({first_note:D,last_note:A,first_indices:[_],last_indices:[_]});Z.render_options.line_width=3,Z.render_options.padding_right=-4,F[_]&&(Z.render_options.color=F[_]),1===E[2][_]&&(Z.render_options.color=m),$.push(Z)}var ee=[];for(_=0;_<O.length;_++){var te=new M.StaveLine({first_note:L,last_note:P,first_indices:[_],last_indices:[_]});te.render_options.line_width=3,te.render_options.padding_right=-4,W[_]&&(te.render_options.color=W[_]),1===E[5][_]&&(te.render_options.color=m),ee.push(te)}for(Q=0;Q<$.length;Q++)$[Q].setContext(f),$[Q].draw();for(Q=0;Q<ee.length;Q++)ee[Q].setContext(f),ee[Q].draw();this.refs.outer.appendChild(e),this.refs.outer.addEventListener("click",this.orchClick.bind(this),!1)}orchClick(e){const{setProps:t,indexing:a}=this.props;if(e.target.closest("text")&&a){var n=e.target.innerHTML.split(":"),r=parseInt(n[0]);t&&t({onClick:r}),console.log(r)}}componentDidMount(){this.setupScore()}componentDidUpdate(e){for(var t=this.refs.outer;t.hasChildNodes();)t.removeChild(t.lastChild);this.setupScore()}render(){const{id:e,notes:t,instruments:a,target:n}=this.props;return r.a.createElement("div",{id:e,ref:"outer",style:{border:"none",padding:0,borderRadius:0,display:"inline-block"}})}}O.defaultProps={width:200,height:400,t_score_y:110,b_score_y:200,text_space:120,target_color:"red",highlights:[],indexing:!0};const P=A.a.Flow;class D extends n.Component{constructor(e){super(e),this.state={x:0,y:0}}setupScore(){const e=document.createElement("div"),{id:t,masking_notevalues:a,masking_notesizes:n,masking_colors:r,target_notevalues:s,target_notesizes:o,target_colors:l,setProps:i}=this.props;var c=new P.Renderer(e,P.Renderer.Backends.SVG);c.resize(100,250);var m=c.getContext(),d=new P.Stave(10,60,100);d.addClef("treble"),d.setContext(m).draw();var h=new P.Stave(10,120,100);h.addClef("bass"),h.setContext(m).draw();var u=new P.StaveConnector(d,h);u.setType(P.StaveConnector.type.SINGLE_LEFT),u.setContext(m),u.draw();var p=new P.StaveConnector(d,h);p.setType(P.StaveConnector.type.BRACKET),p.setContext(m),p.draw();for(var f=[],g=[],y=[],E=[],b=[],v=[],_=0;_<a.length;_++)a[_]>59?(f.push(a[_]),g.push(n[_]),y.push(r[_])):(E.push(a[_]),b.push(n[_]),v.push(r[_]));var x=[],C=[],k=[],w=[],S=[],N=[];for(_=0;_<s.length;_++)s[_]>59?(x.push(s[_]),C.push(o[_]),k.push(l[_])):(w.push(s[_]),S.push(o[_]),N.push(l[_]));var T=new Array,I=new Array,A=new Array,M=new Array;function O(e,t){var a=0;return 40===t&&(a=-1),(e=(e-t)/4)>1+a&&(e+=.25),e>3+a&&(e+=.25),e>4.5+a&&(e+=.25),e>6.5+a&&(e+=.25),e>8+a&&(e+=.25),e>10+a&&(e+=.25),e>13.5+a&&(e+=.25),e>15.5+a&&(e+=.25),e}var D=[];if(Array.isArray(E)&&E.length){for(_=0;_<E.length;_++){var L=O(E[_],40);(W=new P.NoteHead({duration:"128",line:L,custom_glyph_code:"vd2",glyph_font_scale:b[_],style:{fillStyle:"none"}})).setCenterAlignment(!0),I.push(W)}var z=new P.Voice({num_beats:1,beat_value:1}).setMode(2);z.addTickables(I);(new P.Formatter).joinVoices([z]).format([z],1);z.draw(m,h)}if(Array.isArray(f)&&f.length){for(_=0;_<f.length;_++){L=O(f[_],60);(W=new P.NoteHead({duration:"128",line:L,custom_glyph_code:"vd2",glyph_font_scale:g[_],style:{fillStyle:"none"}})).setCenterAlignment(!0),T.push(W)}var R=new P.Voice({num_beats:1,beat_value:1}).setMode(2);R.addTickables(T);(new P.Formatter).joinVoices([R]).format([R],1);R.draw(m,d)}if(Array.isArray(x)&&x.length){A.push(new P.GhostNote("q"));for(_=0;_<x.length;_++){L=O(x[_],60);(W=new P.NoteHead({duration:"128",displaced:!1,line:L,custom_glyph_code:"vb",glyph_font_scale:C[_],style:{fillStyle:k[_]}})).setCenterAlignment(!0),A.push(W)}var F=new P.Voice({num_beats:1,beat_value:1}).setMode(2);F.addTickables(A);(new P.Formatter).joinVoices([F]).format([F],10);F.draw(m,d)}if(Array.isArray(w)&&w.length){M.push(new P.GhostNote("q"));for(_=0;_<w.length;_++){var W;L=O(w[_],60);(W=new P.NoteHead({duration:"128",displaced:!1,line:L,custom_glyph_code:"vb",glyph_font_scale:S[_],style:{fillStyle:N[_]}})).setCenterAlignment(!0),M.push(W)}var V=new P.Voice({num_beats:1,beat_value:1}).setMode(2);V.addTickables(M);(new P.Formatter).joinVoices([V]).format([V],10);V.draw(m,d)}if(Array.isArray(E)&&E.length)for(_=0;_<E.length;_++)D.push(z.tickables[_].y);if(Array.isArray(f)&&f.length)for(_=0;_<f.length;_++)D.push(R.tickables[_].y);for(var j=0;j<D.length-1;j++)m.beginPath().moveTo(40,D[j]).lineTo(90,D[j]).lineTo(90,D[j+1]).lineTo(40,D[j+1]).closePath().fill({fill:r[j]});m.beginPath().closePath(),this.refs.outer2.appendChild(e)}componentDidMount(){this.setupScore()}componentDidUpdate(e){for(var t=this.refs.outer2;t.hasChildNodes();)t.removeChild(t.lastChild);this.setupScore()}render(){const{id:e}=this.props;return r.a.createElement("div",{id:e,ref:"outer2",style:{border:"none",padding:0,borderRadius:0,display:"inline-block"}})}}D.defaultProps={};var L=a(257),z=a(6),R=a(263);const F=Object(z.a)(R.a)(e=>{let{theme:t}=e;return{...t.typography.body2,backgroundColor:"#fffef0",padding:t.spacing(1),textAlign:"center",color:t.palette.text.secondary}});function W(e){const t=["C","C#","D","D#","E","F","F#","G","G#","A","B#","B"];if(e.data.length<2)return null;const a=[{domain:{x:[0,1],y:[0,1]},value:e.data[2].var_coeff_graph,title:{text:"Orch. timbre homogeneity"},type:"indicator",mode:"gauge+number",gauge:{axis:{range:[null,100]}}}],r=e.data[2].fig_config,s=e.data[2].msking_graph.data,o=e.data[2].msking_graph.layout;return o.width=window.innerWidth-380,n.createElement("div",null,n.createElement(L.a,{style:{marginTop:.5},container:!0,direction:"row",justifyContent:"center",alignItems:"center",spacing:.5},n.createElement(L.a,{item:!0,xs:12,md:6},n.createElement(F,{style:{height:452,backgroundColor:"#fffef0"}},n.createElement(g.a,null,"Orchestration at clicked point"),n.createElement("div",{style:{backgroundColor:"rgba(0,255,0,0.3)",display:"inline"}},"Target"),n.createElement("div",{style:{backgroundColor:"rgba(255,0,0,0.5)",display:"inline"}}," Heaviest masker"),n.createElement("div",{style:{backgroundColor:"rgba(255,0,255,0.5)",display:"inline"}}," 2nd masker"),n.createElement("div",{style:{backgroundColor:"rgba(255,255,0,0.5)",display:"inline"}}," 3rd masker "),n.createElement(O,{notes:e.data[4].notenumbers.map(e=>function(e){var a=e-Math.floor(e);let n=Math.round(e),r=t[n%12];return a>=.2&&a<.5?/[#]/.test(r)?r=t[(n+1)%12]+"d":r+="+":a>=.5&&a<=.8&&(/[#]/.test(r)?r=t[(n-1)%12]+"+":r+="d"),r+(Math.floor(n/12)-1)}(e)),instruments:e.data[4].instruments,target:e.data[4].target,target_color:"green",highlights:e.data[4].highlights,width:200,text_space:200}))),n.createElement(L.a,{item:!0,xs:12,md:6},n.createElement(F,{style:{height:452,backgroundColor:"#fffef0"}},n.createElement(g.a,null,"Spectral centroid at clicked point"),n.createElement(O,{notes:e.data[2].centroid_graph.notes,instruments:e.data[2].centroid_graph.markings,target:[],width:150,text_space:200})))),n.createElement(L.a,{style:{marginTop:.5},container:!0,direction:"row",justifyContent:"center",alignItems:"center",spacing:.5},n.createElement(L.a,{item:!0,xs:12,md:6},n.createElement(F,{style:{height:452,backgroundColor:"#fffef0"}},n.createElement(g.a,null,"Timbre distance data"),n.createElement(g.a,null,"Target timbre distance from orchestration: ",e.data[2].distance_graph,"/100"),n.createElement(I.a,{data:a,layout:{width:350,margin:{t:0,b:0},plot_bgcolor:"#fffef0",paper_bgcolor:"#fffef0"},config:r}))),n.createElement(L.a,{item:!0,xs:12,md:6},n.createElement(F,{style:{height:452,backgroundColor:"#fffef0",verticalAlign:"center"}},n.createElement(g.a,null,"Masking staff graph"),n.createElement("br",null),n.createElement("br",null),n.createElement(D,{masking_notevalues:e.data[2].masking_score.masking_notevalues,masking_colors:e.data[2].masking_score.masking_colors,masking_notesizes:e.data[2].masking_score.masking_notesizes,target_notevalues:e.data[2].masking_score.target_notevalues,target_colors:e.data[2].masking_score.target_colors,target_notesizes:e.data[2].masking_score.target_notesizes})))),n.createElement(L.a,{style:{marginTop:.5,marginInline:0},container:!0,direction:"row",justifyContent:"left",alignItems:"left",spacing:.5},n.createElement(L.a,{item:!0,xs:12,md:12},n.createElement(F,null,n.createElement(I.a,{data:s,layout:{...o,width:window.innerWidth-50,margin:{l:0,r:0}},config:r})))),n.createElement(L.a,{style:{marginTop:.5},container:!0,direction:"row",justifyContent:"center",alignItems:"center",spacing:.5},n.createElement(L.a,{item:!0,xs:12,md:8},n.createElement(F,null,n.createElement(I.a,{data:e.data[2].mfcc_graph.data,layout:{...e.data[2].mfcc_graph.layout,width:window.innerWidth/1.5-50,margin:{l:0,r:0},legend:{orientation:"h"}},config:r,width:200}))),n.createElement(L.a,{item:!0,xs:12,md:4},n.createElement(F,{style:{height:452,backgroundColor:"#fffef0"}},n.createElement(g.a,null,"Summary of the current orchestration"),n.createElement("br",null),n.createElement("br",null),n.createElement(g.a,null,e.data[2].summary)))))}var V=a(122);function j(e){const t=e=>{let t=21;const a={violin:2,viola:8,cello:11,double_bass:14,flute:15,oboe:16,clarinet:17,bassoon:18,horn:19,trumpet:22,tenor_trombone:23,bass_trombone:21,timpani:22,cymbal:24};return Object.keys(a).includes(e)&&(t=a[e]),t};let a=[];e.instrumentList.map(e=>a.push(e[0]));const r=[[10,50,3],[20,50,2],[30,50,1],[60,50,10],[70,50,11],[80,50,12],[15,35,6],[25,35,5],[40,40,4],[55,40,7],[65,35,8],[75,35,9],[86,35,13],[18,20,20],[32,20,19],[45,30,15],[50,30,16],[70,20,24],[80,20,14],[40,10,22],[50,10,21],[60,10,23],[45,20,17],[50,20,18],[45,55,25]];let s=[];r.map(e=>s.push(!1));const[o,l]=n.useState({clicked:!1,over:!1,drop:"not yet",instrument_assignment:a.map(e=>t(e)),hoverState:s,position:"audience",audio:"",play:!1});if(n.useEffect(()=>{l(e=>({...e,instrument_assignment:a.map(e=>t(e))}))},[e]),n.useEffect(()=>{o.play&&document.getElementById("AUDIOPLAY").play()},[]),0===e.instrumentList.length)return null;const i=(e,t)=>{if(console.log(e),t){const a=[...o.instrument_assignment];a[t.dragData.data]=e;const n=[...o.hoverState];n[e-1]=!1,l({...o,instrument_assignment:a,hoverState:n})}},m=(e,t,a)=>{const r=e+"%",s=t+"%";return n.createElement("div",{style:{left:r,position:"absolute",top:s}},n.createElement(V.DropTarget,{onHit:e=>i(a,e),targetKey:"foo",onDragEnter:e=>((e,t)=>{const a=[...o.hoverState];a[e]=!0,l({...o,hoverState:a})})(a-1),onDragLeave:e=>((e,t)=>{const a=[...o.hoverState];a[e]=!1,l({...o,hoverState:a})})(a-1)},n.createElement("h2",{style:{backgroundColor:"rgba(0,255,0,0.3)",borderRadius:"30px",padding:6}},a," ",o.hoverState[a-1]?"DROP HERE":"")))};return n.createElement("div",{style:{maxWidth:800,textAlign:"center",margin:"auto",alignItems:"center"}},n.createElement("div",{style:{padding:20}},"Here you can listen how your orchestration sounds like played with real instruments in Helsinki Music Center hall. The algorithm utilize pre-calculated impulse responses. Helsinki Musiikkitalo spatial impulse response measurements are done by Aalto University. They are used here with permission from Prof. Tapio Lokki, who has computed the binaural responses"),n.createElement("div",{style:{marginTop:-20,padding:20}},"Drag the instruments of your orchestration to the place on stage you want them to play. Select the listening position, selecting 'conductor' places you on the conductor podium and 'audience' to the center of row 6. When you are ready, tap 'listen' and wait for a few seconds for calculations."),n.createElement(c.a,{onClick:()=>{l({...o,audio:""});const t={orchestration:e.instrumentList.map(e=>e[0]+","+e[1]+","+e[2]+","+e[3]),positions:o.instrument_assignment,listeningPosition:o.position};E.a.post("https://rest.score-tool.com/listen",t,{headers:{auth:"uljasPulkkis"}}).then(e=>{const t=n.createElement("div",null,n.createElement("audio",{controls:!0,autoPlay:"true",id:"AUDIOPLAY"}," ",n.createElement("source",{src:e.data,type:"audio/x-wav"})," "));l({...o,audio:t,play:!0})}).catch(e=>console.log(e))},variant:"contained"},"click here to calculate acoustics and listen"),o.audio,n.createElement("div",{style:{display:"block"}},n.createElement(f.a,{sx:{m:1,minWidth:50}},n.createElement(u.a,{id:"listen-select"},"Position"),n.createElement(h.a,{labelId:"listen-select",id:"listen-select",value:o.position,onChange:e=>l({...o,position:e.target.value}),autoWidth:!0,label:"listen-select"},n.createElement(p.a,{value:"audience"},"audience"),n.createElement(p.a,{value:"conductor"},"conductor")))),n.createElement("div",{style:{float:"left"}},a.map((e,t)=>n.createElement(V.DragDropContainer,{dragClone:!1,targetKey:"foo",onDrop:i,dragData:{data:t}},n.createElement("div",{style:{backgroundColor:"rgba(0,255,255,0.3)",borderRadius:"30px",fontSize:24,padding:10}},e+": "+o.instrument_assignment[t])))),n.createElement("div",{style:{clear:"both"}},"\xa0"),n.createElement("div",{style:{backgroundImage:"url(./musatalo.jpg)",position:"relative",backgroundSize:"100% 120%",backgroundRepeat:"no-repeat"}},n.createElement("div",{style:{minHeight:"50vh"}},r.map(e=>m(e[0],e[1],e[2])))))}function G(e){let{text:t,orchestration:a}=e;const[r,s]=n.useState({textFieldValue:t,saved:!1});n.useEffect(()=>{s(e=>({...e,saved:!1,textFieldValue:t}))},[a]);const o=()=>{if(a.length>0){let e=JSON.parse(localStorage.getItem("orchestrations")),t=0;null!=e&&(e.length>0&&(t=e[e.length-1].id+1),console.log(a),console.log(typeof a[0][3]),"number"===typeof a[0][3]?e.push({id:t,name:r.textFieldValue,data:a.map(e=>[e[0],e[1],e[2],[e[3]],e[4],e[5],e[6]])}):e.push({id:t,name:r.textFieldValue,data:a}),localStorage.setItem("orchestrations",JSON.stringify(e)),s(e=>({...e,saved:!0})))}},l=e=>{const t=e.target.value;s(e=>({...e,textFieldValue:t}))};return n.createElement("div",null,r.saved?n.createElement("div",{style:{textAlign:"center"}},"Saved!"):n.createElement("div",null,n.createElement(C.a,{fullWidth:!0,value:r.textFieldValue,label:"save name",onChange:l}),n.createElement(c.a,{fullWidth:!0,variant:"contained",color:"secondary",onClick:o}," Save to your list of orchestrations ")))}var K=a(243),B=a(242);function U(e){const[t,a]=Object(n.useState)({idx:e.idx,scoreNames:e.row[0],scoreTechs:e.row[1],scoreDyns:e.row[2],scorePitch:e.row[3],scoreTgt:e.row[4],scoreOnoff:e.row[5],scoreIdx:e.row[6],scoreMicro:0,color:e.color,scoreModify:0}),s=(n,r)=>{let s=0;0===t.scoreModify?s=-12:-12===t.scoreModify&&(s=12),a(t=>({...t,scoreModify:s,scorePitch:e.row[3]+s})),e.onChange({idx:t.idx,row:[t.scoreNames,t.scoreTechs,t.scoreDyns,e.row[3]+s,t.scoreTgt,t.scoreOnoff,t.scoreIdx,t.scoreMicro]})};let o=[];-12===t.scoreModify?o=r.a.createElement("div",{onClick:s,style:{backgroundColor:"rgba(123,30,30,0.3)",borderRadius:10,padding:3,textAlign:"center"}},"-12"):12===t.scoreModify?o=r.a.createElement("div",{onClick:s,style:{backgroundColor:"rgba(30,123,30,0.3)",borderRadius:10,padding:3,textAlign:"center"}},"12"):0===t.scoreModify&&(o=r.a.createElement("div",{onClick:s,style:{backgroundColor:"rgba(30,30,30,0.3)",borderRadius:10,padding:3,textAlign:"center"}},"0"));const l=(e,t)=>{a(e=>({...e,scoreMicro:t}))},i=(a,n)=>{e.onChange({idx:t.idx,row:[t.scoreNames,t.scoreTechs,t.scoreDyns,t.scorePitch,t.scoreTgt,t.scoreOnoff,t.scoreIdx,t.scoreMicro]})};return r.a.createElement("tr",null,r.a.createElement("td",{key:"scor"+t.idx,style:{backgroundColor:t.color}},t.scoreNames),r.a.createElement("td",{key:"tec"+t.idx},t.scoreTechs),r.a.createElement("td",{key:"dy"+t.idx},r.a.createElement("div",{onClick:(n,r)=>{let s="mf";"mf"===t.scoreDyns?s="f":"f"===t.scoreDyns&&(s="p"),a(e=>({...e,scoreDyns:s})),e.onChange({idx:t.idx,row:[t.scoreNames,t.scoreTechs,s,t.scorePitch,t.scoreTgt,t.scoreOnoff,t.scoreIdx,t.scoreMicro]})},style:{backgroundColor:"rgba(123,200,30,0.3)",borderRadius:10,padding:3,textAlign:"center"}}," ",t.scoreDyns," ")),r.a.createElement("td",{key:"micro"+t.idx},r.a.createElement(B.a,{sx:{width:60,height:15,verticalAlign:"top",marginTop:-2}},r.a.createElement(K.a,{spacing:1,direction:"row",sx:{mb:1},alignItems:"center"},r.a.createElement("img",{src:"/flat.png",height:"15"}),r.a.createElement(m.a,{valueLabelDisplay:"auto","aria-label":"tune",size:"small",min:-.49,step:.01,max:.49,value:t.scoreMicro,onChangeCommitted:i,onChange:l}),r.a.createElement("img",{src:"/sharp.png",height:"15"})))),r.a.createElement("td",{key:"tg"+t.idx},r.a.createElement("div",{onClick:(n,r)=>{a(e=>({...e,scoreTgt:!e.scoreTgt})),e.onChange({idx:t.idx,row:[t.scoreNames,t.scoreTechs,t.scoreDyns,t.scorePitch,!t.scoreTgt,t.scoreOnoff,t.scoreIdx,t.scoreMicro]})},style:{backgroundColor:"rgba(123,200,30,0.3)",borderRadius:10,padding:3,textAlign:"center"}},t.scoreTgt?"target":"orchestration")),r.a.createElement("td",{key:"onof"+t.idx}," ",r.a.createElement("div",{onClick:(n,r)=>{a(e=>({...e,scoreOnoff:!e.scoreOnoff})),e.onChange({idx:t.idx,row:[t.scoreNames,t.scoreTechs,t.scoreDyns,t.scorePitch,t.scoreTgt,!t.scoreOnoff,t.scoreIdx,t.scoreMicro]})},style:{backgroundColor:t.scoreOnoff?"rgba(123,200,30,0.3)":"rgba(200,123,30,0.3)",borderRadius:10,padding:3,textAlign:"center"}},t.scoreOnoff?"ON":"OFF"," ")),r.a.createElement("td",{key:"mo"+t.idx},o))}var H=a(272);function J(e){let t=[];e.instrumentList.map(e=>t.push(e[0]));const a=e=>{let t=21;const a={violin:2,viola:8,cello:11,double_bass:14,flute:15,oboe:16,clarinet:17,bassoon:18,horn:19,trumpet:22,tenor_trombone:23,bass_trombone:21,timpani:22,cymbal:24};return Object.keys(a).includes(e)&&(t=a[e]),t},[r,s]=n.useState({instrument_assignment:t.map(e=>a(e))});n.useEffect(()=>{s(e=>({...e,instrument_assignment:t.map(e=>a(e))}))},[e]);return n.createElement("div",{style:{transform:"scale(0.8,0.8)"}},n.createElement(c.a,{size:"small",onClick:()=>{s({...r,audio:""});const t={orchestration:e.instrumentList.map(e=>e[0]+","+e[1]+","+e[2]+","+e[3]),positions:r.instrument_assignment,listeningPosition:"audience"};E.a.post("https://rest.score-tool.com/listen",t,{headers:{auth:"uljasPulkkis"}}).then(e=>{const t=n.createElement("div",{style:{transform:"scale(0.5,0.5)"}},n.createElement("audio",{controls:!0,autoPlay:"true",id:"AUDIOPLAY"}," ",n.createElement("source",{src:e.data,type:"audio/x-wav"})," "));s({...r,audio:t})}).catch(e=>console.log(e))},variant:"contained"},"Quick listen"),r.audio)}const q=n.forwardRef((function(e,t){return n.createElement(N.a,Object.assign({direction:"up",ref:t},e))}));function X(e){const[t,a]=n.useState(!1),[r,s]=n.useState([]),[o,l]=n.useState([]),[i,c]=n.useState([]),[m,d]=n.useState([]),[h,u]=n.useState([]),[p,f]=n.useState(!1),[y,b]=n.useState({textFieldValue:"orchestration"}),[v,_]=n.useState(0);let C=[],N=[];n.useEffect(()=>{a(t=>e.open),e.data.length>1&&(s(t=>e.data[1]),l([])),e.data.length>1&&(_(t=>100-e.data[0].data[2].masking_percent),c(t=>e.data[0].data),b(t=>({...t,textFieldValue:JSON.parse(localStorage.getItem("orchestrations")).length+": "+e.data[2]})),e.data[1].map(e=>{C.push(""),N.push("")}),e.data[0].data[3].map((e,t)=>{0===t?(C[e]="red",N[e]="strongest masker"):1===t?(C[e]="magenta",N[e]="2nd masker"):2===t?(C[e]="yellow",N[e]="3rd masker"):(C[e]="",N[e]="")}),d(C),u(N))},[e]);const T=t=>{let a=[];a=0===o.length?[...r]:[...o],a[t.idx]=t.row,l(e=>a);let n=[];a.map(e=>{e[5]&&n.push(e)}),E.a.post("https://rest.score-tool.com/modalSlice",n).then(t=>{var a=t.data;c(e=>e.data=a.data),_(e=>100-a.data[2].masking_percent);let r=[],s=[];e.data[1].map(e=>{r.push(""),s.push("")}),a.data[3].map((t,a)=>{if(0===a){const a=n[t][6];e.data[1].map((e,t)=>{e[6]===a&&(r[t]="red",s[t]="strongest masker")})}else if(1===a){const a=n[t][6];e.data[1].map((e,t)=>{e[6]===a&&(r[t]="magenta",s[t]="2nd masker")})}else if(2===a){const a=n[t][6];e.data[1].map((e,t)=>{e[6]===a&&(r[t]="yellow",s[t]="3rd masker")})}}),d(e=>r),u(s)})};let I=[];0===o.length?I=r:o.map(e=>{e[5]&&I.push([e[0],e[1],e[2],e[3]+e[7]])});const A=["C","C#","D","D#","E","F","F#","G","G#","A","Bb","B"];return n.createElement("div",null,n.createElement(x.a,{fullScreen:!0,open:t,onClose:e.handleClose,TransitionComponent:q,PaperProps:{style:{backgroundColor:"#fffef0"}}},n.createElement(k.a,{sx:{position:"relative",backgroundColor:"#dcc4ac",color:"#4c4c48"}},n.createElement(w.a,null,n.createElement(S.a,{edge:"start",color:"inherit",onClick:e.handleClose,"aria-label":"close"},n.createElement("div",null,"Click here, or press ESC to close")))),n.createElement("div",{style:{textAlign:"center"}},n.createElement(g.a,null,"You can alter the orchestration by clicking the colored values. The changes do not affect the original score."),n.createElement("table",{style:{margin:"auto",display:"inline"}},n.createElement("tbody",null,n.createElement("tr",null,n.createElement("td",null,"Instr."),n.createElement("td",null,"Tech."),n.createElement("td",null,"Dyn."),n.createElement("td",null,"Tune"),n.createElement("td",null,"Role"),n.createElement("td",null,"On/Off"),n.createElement("td",null,"Transpose +- oct.")),r.map((e,t)=>n.createElement(U,{onChange:T,idx:t,row:e,color:""})))),n.createElement("table",{style:{margin:"auto",display:"inline"}},n.createElement("tbody",null,n.createElement("tr",null,n.createElement("td",null,"maskers")),m.map((e,t)=>{return n.createElement("tr",null,n.createElement("td",{style:{backgroundColor:e,borderRadius:10,padding:4,textAlign:"center",margin:4}},r[t][0]," ",(a=r[t][3],A[a%12]+(Math.floor(a/12)-1))," "+h[t]));var a}))),n.createElement("br",null),n.createElement(g.a,{variant:"caption",component:"div",color:"text.secondary"},"Target audibility:"),n.createElement(B.a,{sx:{position:"relative",display:"inline-flex"}},n.createElement(H.a,{variant:"determinate",value:v,color:v<=30?"error":v<=50?"warning":"success"}),n.createElement(B.a,{sx:{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center"}},n.createElement(g.a,{variant:"caption",component:"div",color:"text.secondary"},"".concat(Math.round(v),"%")))),n.createElement("br",null),n.createElement(G,{text:y.textFieldValue,orchestration:r}),n.createElement(J,{instrumentList:I}),n.createElement(W,{data:i}),n.createElement(j,{instrumentList:I}))))}var Y=a(273);function Q(e){const[t,a]=Object(n.useState)({idx:e.idx,instName:e.instName,scoreNames:e.scoreNames,scoreTechs:e.scoreTechs,scoreDyns:e.scoreDyns,scoreTgt:e.scoreTgt,scoreOnoff:e.scoreOnoff,scoreModify:e.scoreModify});e.onChange({instName:t.instName,scoreNames:t.scoreNames,scoreTechs:t.scoreTechs,scoreDyns:t.scoreDyns,scoreTgt:t.scoreTgt,scoreOnoff:t.scoreOnoff,scoreModify:t.scoreModify});return r.a.createElement("tr",null,r.a.createElement("td",{key:"nam"+t.idx},t.instName),r.a.createElement("td",{key:"scor"+t.idx},((e,t)=>{const n=Object.keys(v);return r.a.createElement("div",null,r.a.createElement(f.a,{sx:{m:1,minWidth:50}},r.a.createElement(u.a,{id:"instrument-select"},"Instr."),r.a.createElement(h.a,{labelId:"instrument-select",id:"instrument-sel"+t,value:e,onChange:e=>{return t=e,void a(e=>({...e,scoreNames:t.target.value}));var t},autoWidth:!0,label:"instr."},n.map(e=>r.a.createElement(p.a,{value:e},e)))))})(t.scoreNames,t.idx)),r.a.createElement("td",{key:"tec"+t.idx},((e,n)=>{const s=v[t.scoreNames];return r.a.createElement("div",null,r.a.createElement(f.a,{sx:{m:1,minWidth:50}},r.a.createElement(u.a,{id:"tech-select"},"Tech."),r.a.createElement(h.a,{labelId:"tech-select",id:"tech-sel"+n,value:e,onChange:e=>{return t=e,void a(e=>({...e,scoreTechs:t.target.value}));var t},autoWidth:!0,label:"tech."},s.map(e=>r.a.createElement(p.a,{value:e},e)))))})(t.scoreTechs,t.idx)),r.a.createElement("td",{key:"dy"+t.idx},(s=t.scoreDyns,o=t.idx,r.a.createElement("div",null,r.a.createElement(f.a,{sx:{m:1,minWidth:50}},r.a.createElement(u.a,{id:"dyn-select"},"Dyn."),r.a.createElement(h.a,{labelId:"dyn-select",id:"dyn-sel"+o,value:s,onChange:e=>{return t=e,void a(e=>({...e,scoreDyns:t.target.value}));var t},autoWidth:!0,label:"dyn."},["from_score","p","mf","f"].map(e=>r.a.createElement(p.a,{value:e},e))))))),r.a.createElement("td",{key:"tg"+t.idx},r.a.createElement("div",{style:{border:"1px solid lightGray",borderRadius:5,padding:8}},r.a.createElement(K.a,{direction:"row",spacing:1,alignItems:"center"},r.a.createElement(g.a,null,"orch."),r.a.createElement(Y.a,{key:"tgtswitch"+t.idx,checked:t.scoreTgt,color:"secondary",onChange:e=>{return t.idx,(n=e).persist(),void a(e=>({...e,scoreTgt:n.target.checked}));var n}}),r.a.createElement(g.a,null,"tgt")))),r.a.createElement("td",{key:"onoff"+t.idx},r.a.createElement("div",{style:{border:"1px solid lightGray",borderRadius:5,padding:8}},r.a.createElement(K.a,{direction:"row",spacing:1,alignItems:"center"},r.a.createElement(g.a,null,"off"),r.a.createElement(Y.a,{key:"onoffswitch"+t.idx,checked:t.scoreOnoff,onChange:e=>{return t.idx,(n=e).persist(),void a(e=>({...e,scoreOnoff:n.target.checked}));var n}}),r.a.createElement(g.a,null,"on")))),r.a.createElement("td",{key:"mod"+t.idx},((e,t)=>r.a.createElement("div",null,r.a.createElement(f.a,{sx:{m:1,minWidth:50}},r.a.createElement(u.a,{id:"mod-select"},"Transpose"),r.a.createElement(h.a,{labelId:"mod-select",id:"mod-sel"+t,value:e,onChange:e=>{return t=e,void a(e=>({...e,scoreModify:t.target.value}));var t},autoWidth:!0,label:"trans."},[0,12,-12,24,-24].map(e=>r.a.createElement(p.a,{value:e},e))))))(t.scoreModify,t.idx)));var s,o}var $=a(145);const Z=Object(z.a)(R.a)(e=>{let{theme:t}=e;return{...t.typography.body2,backgroundColor:"#fffef0",padding:t.spacing(1),textAlign:"center",color:t.palette.text.secondary}});class ee extends n.Component{constructor(e){super(e),this.state={dataReady:!1,loading:[],loaded:!1,cur:!1,calculIndications:!1,measureTimestamps:[],measureRange:[1,2],maxMeasure:2,instNames:[],scoreNames:[],scoreTechs:[],scoreDyns:[],scoreTgt:[],scoreOnoff:[],scoreModify:[],instData:{},open:!1,time:[],modalData:[]},this.osmd=void 0,this.orchestrationChords=void 0,this.cursor=void 0,this.next=void 0,this.show=!0,this.divRef=r.a.createRef(),this.measureHandleChange=this.measureHandleChange.bind(this),this.calculateMasking=this.calculateMasking.bind(this),this.update=this.update.bind(this),this.handleClose=this.handleClose.bind(this)}setupOsmd(){this.setState(e=>({...e,loading:r.a.createElement(H.a,{color:"success"})}));const e={autoResize:void 0!==this.props.autoResize&&this.props.autoResize,drawTitle:void 0===this.props.drawTitle||this.props.drawTitle,loadUrlTimeout:1e4,drawSlurs:!1};this.osmd=new i.OpenSheetMusicDisplay(this.divRef.current,e),this.osmd.load(this.props.file).then(()=>{let e=.5;const t=this.osmd.sheet.staves.length;t>10?e=.4:t>20?e=.2:t>30?e=.1:t>40&&(e=.05),this.osmd.zoom=e;let a=[],n=[],r=[],s=[],o=[],l=[],i=[];this.osmd.sheet.staves.map(e=>{a.push(e.parentInstrument.nameLabel.text),n.push((e=>{let t=e;e.toLowerCase().startsWith("clarinet in b")&&(t="clarinet"),e.toLowerCase().startsWith("bass clarinet")&&(t="bass_cl"),e.toLowerCase().startsWith("solo")&&(t=e.substr(5)),e.toLowerCase().startsWith("trombone")&&(t="tenor_trombone"),e.toLowerCase().startsWith("contrabass")&&(t="double_bass"),"baritone"===e.toLowerCase()&&(t="tuba"),t.toLowerCase().startsWith("natural")&&(t="horn");return Object(b.a)(t,Object.keys(v))[0][0]})(e.parentInstrument.nameLabel.text)),r.push("normal"),s.push("from_score"),o.push(0),l.push(1),i.push(0)});let c=[];this.osmd.sheet.sourceMeasures.map(e=>c.push(e.absoluteTimestamp.realValue)),c.push(999999),this.setState(e=>{e.measureRange=[1,this.osmd.sheet.SourceMeasures.length],e.maxMeasure=this.osmd.sheet.SourceMeasures.length,e.instNames=a,e.scoreNames=n,e.scoreTechs=r,e.scoreDyns=s,e.scoreTgt=o,e.scoreOnoff=l,e.scoreModify=i,e.measureTimestamps=c}),this.forceUpdate()}).then(()=>this.setState(e=>({...e,loading:[]}))).catch(()=>this.setState(e=>({...e,loading:r.a.createElement("div",null," ERROR LOADING FILE")})))}update(){this.osmd.updateGraphic()}setLoading(){this.setState(e=>({...e,loading:r.a.createElement(H.a,{color:"success"})})),setTimeout(()=>this.renderScore(),200)}renderScore(){this.osmd.setOptions({drawFromMeasureNumber:this.state.measureRange[0],drawUpToMeasureNumber:this.state.measureRange[1],backend:"svg"}),this.osmd.render(),this.setState(e=>e.loaded=!0);let e=[];for(let s=0;s<this.osmd.graphic.VerticalGraphicalStaffEntryContainers[0].StaffEntries.length;s++)e.push({0:"mf"});let t={},a={},n=[];n.length=this.state.instNames.length;let r=[];for(let s=0;s<this.state.instNames.length;s++)r.push("mf");this.osmd.sheet.sourceMeasures.map(e=>{e.absoluteTimestamp.realValue<this.state.measureTimestamps[this.state.measureRange[0]-1]&&e.staffLinkedExpressions.map((e,t)=>{e.length>0&&e.map(e=>{e.expressions.map(e=>{e.expression.dynamicEnum<=5?r[t]="p":e.expression.dynamicEnum<=7?r[t]="mf":e.expression.dynamicEnum<=13&&(r[t]="f")})})})}),this.osmd.graphic.VerticalGraphicalStaffEntryContainers.map(s=>{let o=[];if(o.length=s.StaffEntries.length,s.absoluteTimestamp.realValue>=this.state.measureTimestamps[this.state.measureRange[0]-1]&&s.absoluteTimestamp.realValue<=this.state.measureTimestamps[this.state.measureRange[1]])for(let t=0;t<s.StaffEntries.length;t++)o[t]=[],s.StaffEntries[t]?("undefined"!==typeof s.StaffEntries[t].parentMeasure.parentStaffLine&&s.StaffEntries[t].parentMeasure.parentStaffLine.hasOwnProperty("abstractExpressions")&&s.StaffEntries[t].parentMeasure.parentStaffLine.abstractExpressions.map(a=>{a.SourceExpression.hasOwnProperty("multiExpression")&&(e[t][String(a.SourceExpression.multiExpression.AbsoluteTimestamp.realValue)]=a.Expression)}),s.StaffEntries[t].sourceStaffEntry.voiceEntries&&s.StaffEntries[t].sourceStaffEntry.voiceEntries[0].notes.map(l=>{l.halfTone>0&&(e[t].hasOwnProperty(String(s.AbsoluteTimestamp.realValue))&&(r[t]=e[t][String(s.AbsoluteTimestamp.realValue)]),a[String(s.AbsoluteTimestamp.realValue)]=s.StaffEntries[t].boundingBox.absolutePosition.x,o[t].push({note:Math.round(l.halfTone),dynamic:r[t]}),n[t]={note:Math.round(l.halfTone),start:s.AbsoluteTimestamp.realValue,duration:l.length.realValue})})):n[t]&&(n[t].start+n[t].duration>=s.AbsoluteTimestamp.realValue?(e[t].hasOwnProperty(String(s.AbsoluteTimestamp.realValue))&&(r[t]=e[t][String(s.AbsoluteTimestamp.realValue)]),o[t].push({note:n[t].note,dynamic:r[t]})):n[t]=[]);t[s.AbsoluteTimestamp.realValue]=o}),this.orchestrationChords={instruments:this.state.instNames,databaseEntries:{inst:this.state.scoreNames,tech:this.state.scoreTechs,dyn:this.state.scoreDyns,tgt:this.state.scoreTgt,onoff:this.state.scoreOnoff,modify:this.state.scoreModify},dynamics:e,notes:t,xpos:a},this.setState(e=>({...e,loading:[]}))}resize(){}handleClose(){this.setState(e=>e.open=!1)}measureHandleChange(e,t,a){Array.isArray(t)&&this.setState(e=>({...this.state,measureRange:t}))}calculateMasking(){let e=0;function t(a){let n=this.osmd.graphic.VerticalGraphicalStaffEntryContainers[a];if(n.absoluteTimestamp.realValue>=this.state.measureTimestamps[this.state.measureRange[0]-1]&&n.absoluteTimestamp.realValue<=this.state.measureTimestamps[this.state.measureRange[1]]){let a=this.orchestrationChords.notes[n.absoluteTimestamp.realValue],r=[],s=[],o=!1;a.map((e,t)=>{if(this.orchestrationChords.databaseEntries.tgt[t]&&s.push(t),e.length>0){let a=[];"from_score"!==this.orchestrationChords.databaseEntries.dyn[t]&&(a=this.orchestrationChords.databaseEntries.dyn[t]),this.orchestrationChords.databaseEntries.tgt[t]&&(o=!0),e.map(e=>{0===a.length&&["ppppp","pppp","ppp","pp","p"].includes(e.dynamic)?a="p":0===a.length&&["fffff","ffff","fff","ff","f","sfz","sf"].includes(e.dynamic)?a="f":0===a.length&&["mf","mp","mfz"].includes(e.dynamic)&&(a="mf"),r.push([this.orchestrationChords.databaseEntries.inst[t],this.orchestrationChords.databaseEntries.tech[t],a,e.note+12+this.orchestrationChords.databaseEntries.modify[t],this.orchestrationChords.databaseEntries.tgt[t],this.orchestrationChords.databaseEntries.onoff[t],t])})}}),r=r.filter((e,t,a)=>{if(!e[5])return!1;try{return e[3]>=_[e[0]][e[1]][e[2]][0]&&e[3]<=_[e[0]][e[1]][e[2]][1]}catch{return!1}});const l=e=>{let t="rgba(0,255,0,0.3)";if(e>=75){const a=1-(e-74.9)/50;t="rgba(".concat(Math.round(255*a),",0,0,0.7)")}else if(e>=50){const a=1-(e-54.9)/25;t="rgba(255,".concat(Math.round(255*a),",0,0.5)")}else if(e>=25){const a=(e-24.9)/25;t="rgba(".concat(Math.round(255*a),",255,0,0.5)")}return t};E.a.post("https://rest.score-tool.com/maskingSlice",r).then(e=>{var t=e.data;let a=[];n.StaffEntries.map(e=>a=e.sourceStaffEntry.voiceEntries[0].notes[0]);var r=a.parentStaffEntry.verticalContainerParent.parentMeasure.measureNumber;const c=this.orchestrationChords.xpos[n.absoluteTimestamp.realValue]-1;var m=this.osmd.graphic.MusicPages[0];t&&(o&&s.map(e=>{var a=this.osmd.graphic.musicSheet.sourceMeasures[r-1].verticalMeasureList[e].boundingBox.absolutePosition.y+2;const n=new i.PointF2D(c,a),s=new i.PointF2D(c+2,a);let o=l(t[0]);this.osmd.Drawer.DrawOverlayLine(n,s,m,o,4)}),t[1]&&t[1].map((e,t)=>{var a=this.osmd.graphic.musicSheet.sourceMeasures[r-1].verticalMeasureList[e].boundingBox.absolutePosition.y+2;const n=new i.PointF2D(c,a),s=new i.PointF2D(c+2,a);let o=[];0===t?(o="rgba(255,51,255,0.5)",this.osmd.Drawer.DrawOverlayLine(n,s,m,o,4)):1===t?(o="rgba(255,153,51,0.5)",this.osmd.Drawer.DrawOverlayLine(n,s,m,o,4)):2===t&&(o="rgba(51,153,355,0.5)",this.osmd.Drawer.DrawOverlayLine(n,s,m,o,4))}))}).finally(()=>{e++,this.osmd.graphic.VerticalGraphicalStaffEntryContainers.length>e&&t(e)})}else e++,this.osmd.graphic.VerticalGraphicalStaffEntryContainers.length>e&&t(e)}(t=t.bind(this))(e),this.setState(e=>e.calculIndications=!0)}componentWillUnmount(){window.removeEventListener("resize",this.resize)}componentDidUpdate(e){(this.props.drawTitle!==e.drawTitle||this.props.file!==e.file)&&this.setupOsmd();var t=!1;this.props.file&&"undefined"!==typeof this.osmd&&"undefined"!==typeof this.osmd.cursor&&(("undefined"===typeof this.osmd.cursor.hidden||this.osmd.cursor.hidden)&&(t=!0),this.props.show&&t&&this.osmd.cursor.show(),this.props.next!==e.next&&(this.osmd.cursor.next(),console.log(this.osmd.cursor),console.log(this.osmd.cursor.NotesUnderCursor()),console.log(this.osmd.cursor.VoicesUnderCursor()),console.log(this.osmd.cursor.iterator.currentTimeStamp.RealValue)),window.addEventListener("resize",this.resize))}componentDidMount(){this.props.file&&this.setupOsmd()}render(){let e=[],t="inline-block";this.state.loaded&&(t="none",e=r.a.createElement("div",null,r.a.createElement(c.a,{variant:"contained",color:"secondary",onClick:()=>{this.calculateMasking()}},"calculate masking"),r.a.createElement(c.a,{style:{marginInline:10},variant:"contained",color:"warning",onClick:()=>{this.renderScore()}},"redraw score (remove masking indications)"),r.a.createElement(c.a,{variant:"contained",color:"primary",onClick:()=>$.saveSvgAsPng(document.getElementById("osmdSvgPage1"),"score.png")},"Download the score as PNG"),r.a.createElement(g.a,{variant:"h5",style:{display:"block"}}," Click any note in score for full analysis.")));const a=(e,t)=>{this.setState(a=>{a.scoreNames[e]=t.scoreNames,a.scoreTechs[e]=t.scoreTechs,a.scoreDyns[e]=t.scoreDyns,a.scoreTgt[e]=t.scoreTgt,a.scoreOnoff[e]=t.scoreOnoff,a.scoreModify[e]=t.scoreModify})};return r.a.createElement(r.a.Fragment,null,r.a.createElement(Z,{style:{textAlign:"center",justifyContent:"center",alignItems:"center",alignContent:"center",marginLeft:"auto",marginRight:"auto"}},r.a.createElement("div",null,r.a.createElement("table",{style:{margin:"auto"}},r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("th",null,"score name"),r.a.createElement("th",null,"instrument"),r.a.createElement("th",null,"technique"),r.a.createElement("th",null,"dynamic"),r.a.createElement("th",null,"orch/target"),r.a.createElement("th",null,"on/off"),r.a.createElement("th",null,"transpose")),this.state.instNames.map((e,t)=>r.a.createElement(Q,{idx:t,instName:e,scoreNames:this.state.scoreNames[t],scoreTechs:this.state.scoreTechs[t],scoreDyns:this.state.scoreDyns[t],scoreTgt:this.state.scoreTgt[t],scoreOnoff:this.state.scoreOnoff[t],scoreModify:this.state.scoreModify[t],onChange:e=>a(t,e)}))))),r.a.createElement(g.a,null,"Select bar range with slider"),r.a.createElement(d,{range:this.state.measureRange,max:this.state.maxMeasure,measureHandleChange:this.measureHandleChange}),this.state.loading,r.a.createElement(c.a,{style:{display:t},variant:"contained",onClick:()=>{this.setLoading()}},"Show score"),e),this.state.calculIndications&&r.a.createElement(g.a,{style:{display:"inline"}},"Color indications:",r.a.createElement("div",{style:{backgroundImage:"linear-gradient(to right, rgba(120,0,0,0.7) , rgba(255,0,0,0.5))",display:"inline",marginInline:2}}," Target masked"),r.a.createElement("div",{style:{backgroundImage:"linear-gradient(to right, rgba(255,0,0,0.5) , rgba(255,255,0,0.5))",display:"inline",marginInline:2}}," Target nearly masked"),r.a.createElement("div",{style:{backgroundImage:"linear-gradient(to right, rgba(255,255,0,0.5) , rgba(0,255,0,0.3))",display:"inline",marginInline:2}}," Target audible"),r.a.createElement("div",{style:{backgroundColor:"rgba(255,51,255,0.5)",display:"inline"}}," Orchestration heaviest masker"),r.a.createElement("div",{style:{backgroundColor:"rgba(255,153,51,0.5)",display:"inline"}}," Orchestration second heaviest masker"),r.a.createElement("div",{style:{backgroundColor:"rgba(51,153,255,0.5)",display:"inline"}}," Orchestration third heaviest masker ")),r.a.createElement(Z,null,r.a.createElement("div",{ref:this.divRef,style:{width:window.innerWidth-100},onClick:e=>{let t=e.clientX,a=e.clientY;var n=new i.PointF2D(t,a);n=this.osmd.graphic.domToSvg(n),n=this.osmd.graphic.svgToOsmd(n);const r=this.osmd.graphic.GetNearestNote(n,{x:15,y:15});if("undefined"!==typeof r){const e=r.sourceNote.voiceEntry.parentSourceStaffEntry.AbsoluteTimestamp.realValue;let t="";try{t=r.ParentMusicPage.labels[0].label.text+", Bar:"+r.vfnote[0].stave.MeasureNumber+", Position:"+r.parentVoiceEntry.parentStaffEntry.relInMeasureTimestamp.realValue}catch{t="Score orchestral chord"}for(this.osmd.cursor.hide(),this.osmd.cursor.reset();this.osmd.cursor.iterator.currentTimeStamp.RealValue!=e;)this.osmd.cursor.next();this.osmd.cursor.show();let a=this.orchestrationChords.notes[e],n=[],s=[],o=!1;a.map((e,t)=>{if(this.orchestrationChords.databaseEntries.tgt[t]&&s.push(t),e.length>0){let a=[];"from_score"!==this.orchestrationChords.databaseEntries.dyn[t]&&(a=this.orchestrationChords.databaseEntries.dyn[t]),this.orchestrationChords.databaseEntries.tgt[t]&&(o=!0),e.map(e=>{0===a.length&&["ppppp","pppp","ppp","pp","p"].includes(e.dynamic)?a="p":0===a.length&&["fffff","ffff","fff","ff","f","sfz","sf"].includes(e.dynamic)?a="f":0===a.length&&["mf","mp","mfz"].includes(e.dynamic)&&(a="mf"),n.push([this.orchestrationChords.databaseEntries.inst[t],this.orchestrationChords.databaseEntries.tech[t],a,e.note+12+this.orchestrationChords.databaseEntries.modify[t],this.orchestrationChords.databaseEntries.tgt[t],this.orchestrationChords.databaseEntries.onoff[t],t,0])})}}),n=n.filter((e,t,a)=>{if(!e[5])return!1;try{return e[3]>=_[e[0]][e[1]][e[2]][0]&&e[3]<=_[e[0]][e[1]][e[2]][1]}catch{return!1}}),E.a.post("https://rest.score-tool.com/modalSlice",n).then(a=>{var l=a.data,c=r.sourceNote.parentStaffEntry.verticalContainerParent.parentMeasure.measureNumber;const m=this.orchestrationChords.xpos[String(e)]-1;this.osmd.graphic.MusicPages[0];l&&(o&&s.map(e=>{var t=this.osmd.graphic.musicSheet.sourceMeasures[c-1].verticalMeasureList[e].boundingBox.absolutePosition.y+2;new i.PointF2D(m,t),new i.PointF2D(m+2,t);let a=[];a=l[0]>=75?"rgba(255,0,0,0.7)":l[0]>=55?"rgba(255,255,0,0.5)":"rgba(0,255,0,0.3)"}),l[1]&&l[1].map((e,t)=>{var a=this.osmd.graphic.musicSheet.sourceMeasures[c-1].verticalMeasureList[e].boundingBox.absolutePosition.y+2;new i.PointF2D(m,a),new i.PointF2D(m+2,a);let n=[];0===t?n="rgba(255,153,51,0.5)":1===t?n="rgba(255,51,255,0.5)":2===t&&(n="rgba(51,153,355,0.5)")})),this.setState(e=>e.modalData=[l,n,t])}).finally(()=>{this.setState(e=>{e.open=!0,e.time=Date.now()}),this.forceUpdate()})}}})),r.a.createElement(X,{handleClose:this.handleClose,open:this.state.open,time:this.state.time,data:this.state.modalData}))}}var te=ee,ae=a(117),ne=(a(203),a(258)),re=a(38),se=a.n(re),oe=a(67),le=a.n(oe),ie=a(50),ce=a.n(ie);const me=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],de=["Db","Eb","Gb","Ab","Bb"],he={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11},ue=/([a-g])([#b]?)(\d+)/;const pe=ce()(12,128).reduce((e,t)=>(e[t]=function(e){const t=(e-12)%12,a=Math.floor((e-12)/12),n=me[t];return{note:"".concat(n).concat(a),pitchName:n,octave:a,midiNumber:e,isAccidental:de.includes(n)}}(t),e),{});function fe(e){const t=pe[e];if(!t)throw Error("Invalid MIDI number");return t}const ge=ce()(12,128).filter(e=>!fe(e).isAccidental);var ye={fromNote:function(e){if(!e)throw Error("Invalid note argument");const t=ue.exec(e.toLowerCase());if(!t)throw Error("Invalid note argument");const[,a,n,r]=t,s="".concat(a.toUpperCase()).concat(n),o=he[s];if(null==o)throw Error("Invalid note argument");return 12+o+12*parseInt(r,10)},getAttributes:fe,MIN_MIDI_NUMBER:12,MAX_MIDI_NUMBER:127,NATURAL_MIDI_NUMBERS:ge};class Ee extends r.a.Component{constructor(){super(...arguments),this.onPlayNoteInput=()=>{this.props.onPlayNoteInput(this.props.midiNumber)},this.onStopNoteInput=()=>{this.props.onStopNoteInput(this.props.midiNumber)},this.onLeaveNote=()=>{this.props.onLeaveNote(this.props.midiNumber)}}getAbsoluteKeyPosition(e){const{octave:t,pitchName:a}=ye.getAttributes(e);return this.props.pitchPositions[a]+7*t}getRelativeKeyPosition(e){return this.getAbsoluteKeyPosition(e)-this.getAbsoluteKeyPosition(this.props.noteRange.first)}render(){const{naturalKeyWidth:e,accidentalWidthRatio:t,midiNumber:a,gliss:n,useTouchEvents:s,accidental:o,active:l,disabled:i,children:c}=this.props;return r.a.createElement("div",{className:se()("ReactPiano__Key",{"ReactPiano__Key--accidental":o,"ReactPiano__Key--natural":!o,"ReactPiano__Key--disabled":i,"ReactPiano__Key--active":l}),style:{left:be(this.getRelativeKeyPosition(a)*e),width:be(o?t*e:e)},onMouseDown:s?null:this.onPlayNoteInput,onMouseUp:s?null:this.onStopNoteInput,onMouseEnter:null,onMouseLeave:n?this.onStopNoteInput:null,onTouchStart:s?this.onPlayNoteInput:null,onTouchCancel:n?this.onStopNoteInput:null,onTouchMove:null,onTouchEnd:s?this.onStopNoteInput:null},r.a.createElement("div",{className:"ReactPiano__NoteLabelContainer"},c))}}function be(e){return"".concat(100*e,"%")}Ee.defaultProps={accidentalWidthRatio:.65,pitchPositions:{C:0,Db:.55,D:1,Eb:1.8,E:2,F:3,Gb:3.5,G:4,Ab:4.7,A:5,Bb:5.85,B:6}};var ve=Ee;class _e extends r.a.Component{getMidiNumbers(){return ce()(this.props.noteRange.first,this.props.noteRange.last+1)}getNaturalKeyCount(){return this.getMidiNumbers().filter(e=>{const{isAccidental:t}=ye.getAttributes(e);return!t}).length}getNaturalKeyWidth(){return 1/this.getNaturalKeyCount()}getWidth(){return this.props.width?this.props.width:"100%"}getHeight(){if(!this.props.width)return"100%";const e=this.props.width*this.getNaturalKeyWidth();return"".concat(e/this.props.keyWidthToHeight,"px")}render(){const e=this.getNaturalKeyWidth();return r.a.createElement("div",{className:se()("ReactPiano__Keyboard",this.props.className),style:{width:this.getWidth(),height:this.getHeight()}},this.getMidiNumbers().map(t=>{const{note:a,isAccidental:n}=ye.getAttributes(t),s=!this.props.disabled&&this.props.activeNotes.includes(t);return r.a.createElement(ve,{naturalKeyWidth:e,midiNumber:t,noteRange:this.props.noteRange,active:s,accidental:n,disabled:this.props.disabled,onPlayNoteInput:this.props.onPlayNoteInput,onStopNoteInput:this.props.onStopNoteInput,onLeaveNote:this.props.onLeaveNote,gliss:this.props.gliss,useTouchEvents:this.props.useTouchEvents,key:t},this.props.disabled?null:this.props.renderNoteLabel({isActive:s,isAccidental:n,midiNumber:t}))}))}}_e.defaultProps={disabled:!1,gliss:!1,useTouchEvents:!1,keyWidthToHeight:.33,renderNoteLabel:()=>{}};var xe=_e;class Ce extends r.a.Component{constructor(){super(...arguments),this.state={isMouseDown:!1,useTouchEvents:!1},this.handleNoteChanges=e=>{let{prevActiveNotes:t,nextActiveNotes:a}=e;if(this.props.disabled)return;const n=le()(t,a);le()(a,t).forEach(e=>{this.props.playNote(e)}),n.forEach(e=>{this.props.stopNote(e)})},this.getMidiNumberForKey=e=>{if(!this.props.keyboardShortcuts)return null;const t=this.props.keyboardShortcuts.find(t=>t.key===e);return t&&t.midiNumber},this.getKeyForMidiNumber=e=>{if(!this.props.keyboardShortcuts)return null;const t=this.props.keyboardShortcuts.find(t=>t.midiNumber===e);return t&&t.key},this.onKeyDown=e=>{if(e.ctrlKey||e.metaKey||e.shiftKey)return;const t=this.getMidiNumberForKey(e.key);t&&this.onPlayNoteInput(t)},this.onKeyUp=e=>{const t=this.getMidiNumberForKey(e.key);t&&this.onStopNoteInput(t)},this.onPlayNoteInput=e=>{this.props.disabled||this.props.onPlayNoteInput(e,this.props.activeNotes)},this.onStopNoteInput=e=>{this.props.disabled||this.props.onStopNoteInput(e,this.props.activeNotes)},this.onLeaveNote=e=>{this.props.disabled||this.props.onLeaveNote(e,this.props.activeNotes)},this.onMouseDown=()=>{this.setState({isMouseDown:!0})},this.onMouseUp=()=>{this.setState({isMouseDown:!1})},this.onTouchStart=()=>{this.setState({useTouchEvents:!0})},this.renderNoteLabel=e=>{let{midiNumber:t,isActive:a,isAccidental:n}=e;const r=this.getKeyForMidiNumber(t);return this.props.renderNoteLabel({keyboardShortcut:r,midiNumber:t,isActive:a,isAccidental:n})}}componentDidMount(){window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)}componentWillUnmount(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}componentDidUpdate(e,t){this.props.activeNotes!==e.activeNotes&&this.handleNoteChanges({prevActiveNotes:e.activeNotes||[],nextActiveNotes:this.props.activeNotes||[]})}render(){return r.a.createElement("div",{style:{width:"100%",height:"100%"},onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onTouchStart:this.onTouchStart,"data-testid":"container"},r.a.createElement(xe,{noteRange:this.props.noteRange,onPlayNoteInput:this.onPlayNoteInput,onStopNoteInput:this.onStopNoteInput,onLeaveNote:this.onLeaveNote,activeNotes:this.props.activeNotes,className:this.props.className,disabled:this.props.disabled,width:this.props.width,keyWidthToHeight:this.props.keyWidthToHeight,gliss:this.state.isMouseDown,useTouchEvents:this.state.useTouchEvents,renderNoteLabel:this.renderNoteLabel}))}}Ce.defaultProps={renderNoteLabel:e=>{let{keyboardShortcut:t,midiNumber:a,isActive:n,isAccidental:s}=e;return t?r.a.createElement("div",{className:se()("ReactPiano__NoteLabel",{"ReactPiano__NoteLabel--active":n,"ReactPiano__NoteLabel--accidental":s,"ReactPiano__NoteLabel--natural":!s})},t):null}};var ke=Ce;class we extends r.a.Component{constructor(){super(...arguments),this.state={activeNotes:this.props.activeNotes||[]},this.handlePlayNoteInput=e=>{this.setState(t=>(this.props.onPlayNoteInput&&this.props.onPlayNoteInput(e,{prevActiveNotes:t.activeNotes}),t.activeNotes.includes(e)?null:{activeNotes:t.activeNotes.concat(e)}))},this.handleStopNoteInput=e=>{this.setState(t=>(this.props.onStopNoteInput&&this.props.onStopNoteInput(e),{activeNotes:t.activeNotes.filter(t=>e!==t)}))},this.handleLeave=e=>{this.setState(t=>({activeNotes:t.activeNotes.filter(t=>e!==t)}))}}componentDidUpdate(e){e.activeNotes!==this.props.activeNotes&&this.state.activeNotes!==this.props.activeNotes&&this.setState({activeNotes:this.props.activeNotes||[]})}render(){const{activeNotes:e,onPlayNoteInput:t,onStopNoteInput:a,...n}=this.props;return r.a.createElement(ke,Object.assign({activeNotes:this.state.activeNotes,onLeaveNote:this.handleLeave,onPlayNoteInput:this.handlePlayNoteInput,onStopNoteInput:this.handleStopNoteInput},n))}}var Se=we,Ne=(a(141),a(57));const Te=A.a.Flow;var Ie=e=>{let{note:t}=e;return r.a.createElement("div",{ref:e=>{if(e){const n=e;for(;n.hasChildNodes();)n.removeChild(n.lastChild);const r=new Te.Renderer(n,Te.Renderer.Backends.SVG);r.resize(100,100);var a=r.getContext();a.scale(.5,.5);const s=new Ne.a(20,40,150);s.setContext(a);const o=t.filter((function(e,t,a){return parseInt(e.slice(-1))<4})),l=t.filter((function(e,t,a){return parseInt(e.slice(-1))>=4}));let i="treble";o.length>l.length&&(i="bass"),s.setClef(i);let c=[],m=[];if(t.map(e=>{var t=e.slice(0,1)+"/"+e.slice(-1),a=e.slice(-2,-1);/[#db+n]/.test(a)||(a="n"),c.push(t),m.push(a)}),0===t.length)s.draw();else{const e=new Te.StaveNote({clef:i,keys:c,duration:"4"});m.map((t,a)=>e.addAccidental(a,new Te.Accidental(t)));const t=new Te.Voice({num_beats:1,beat_value:4});t.addTickables([e]),s.draw();(new Te.Formatter).joinVoices([t]).formatToStave([t],s);t.draw(a,s)}}}})};function Ae(e){let t=0;"number"===typeof e.data[7]&&(t=e.data[7]);const[a,s]=Object(n.useState)({idx:e.data[6],scoreNames:e.data[0],scoreTechs:e.data[1],scoreDyns:e.data[2],scorePitch:e.data[3],scoreTgt:e.data[4],scoreOnoff:e.data[5],scoreIdx:e.data[6],scoreMicro:t,scoreModify:0,popOpen:!1,anchorEl:null}),o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function l(e){var t=e-Math.floor(e);let a=Math.round(e),n=o[a%12];return t>=.2&&t<.5?/[#]/.test(n)?n=o[(a+1)%12]+"d":n+="+":t>=.5&&t<=.8&&(/[#]/.test(n)?n=o[(a-1)%12]+"+":n+="d"),n+(Math.floor(a/12)-1)}const i=e=>{const t=e.currentTarget;s(e=>({...e,popOpen:!e.popOpen,anchorEl:t}))},d=()=>{s(e=>({...e,anchorEl:null,popOpen:!1})),e.onChange([a.scoreNames,a.scoreTechs,a.scoreDyns,a.scorePitch,a.scoreTgt,a.scoreOnoff,a.scoreIdx,a.scoreMicro])},y=(e,t)=>{s(e=>({...e,scoreMicro:t}))},E=(t,n)=>{e.onChange([a.scoreNames,a.scoreTechs,a.scoreDyns,a.scorePitch,a.scoreTgt,a.scoreOnoff,a.scoreIdx,a.scoreMicro])},b=()=>s(e=>({...e,scoreMicro:0}));a.scorePitch.map(e=>l(e));return r.a.createElement("tr",null,r.a.createElement("td",{key:"nam"+a.idx},a.instName),r.a.createElement("td",{key:"scor"+a.idx},((t,n)=>{const o=Object.keys(_);return r.a.createElement("div",null,r.a.createElement(f.a,{sx:{m:1,minWidth:50}},r.a.createElement(u.a,{id:"instrument-select"},"Instr."),r.a.createElement(h.a,{labelId:"instrument-select",id:"instrument-sel"+n,value:t,onChange:t=>((t,n)=>{const r=n.target.value;s(e=>({...e,popOpen:!1})),s(e=>({...e,scoreNames:r,scoreTechs:"normal",scoreDyns:"mf"})),e.onChange([r,"normal","mf",a.scorePitch,a.scoreTgt,a.scoreOnoff,a.scoreIdx,a.scoreMicro])})(0,t),autoWidth:!0,label:"instr."},o.map(e=>r.a.createElement(p.a,{value:e},e)))))})(a.scoreNames,a.idx)),r.a.createElement("td",{key:"tec"+a.idx},((t,n)=>{const o=Object.keys(_[a.scoreNames]);return r.a.createElement("div",null,r.a.createElement(f.a,{sx:{m:1,minWidth:50}},r.a.createElement(u.a,{id:"tech-select"},"Tech."),r.a.createElement(h.a,{labelId:"tech-select",id:"tech-sel"+n,value:t,onChange:t=>((t,n)=>{const r=n.target.value;s(e=>({...e,scoreTechs:r})),e.onChange([a.scoreNames,r,a.scoreDyns,a.scorePitch,a.scoreTgt,a.scoreOnoff,a.scoreIdx,a.scoreMicro])})(0,t),autoWidth:!0,label:"tech."},o.map(e=>r.a.createElement(p.a,{value:e},e)))))})(a.scoreTechs,a.idx)),r.a.createElement("td",{key:"dy"+a.idx},((t,n)=>{const o=Object.keys(_[a.scoreNames][a.scoreTechs]);return r.a.createElement("div",null,r.a.createElement(f.a,{sx:{m:1,minWidth:50}},r.a.createElement(u.a,{id:"dyn-select"},"Dyn."),r.a.createElement(h.a,{labelId:"dyn-select",id:"dyn-sel"+n,value:t,onChange:t=>((t,n)=>{const r=n.target.value;s(e=>({...e,scoreDyns:r})),e.onChange([a.scoreNames,a.scoreTechs,r,a.scorePitch,a.scoreTgt,a.scoreOnoff,a.scoreIdx,a.scoreMicro])})(0,t),autoWidth:!0,label:"dyn."},o.map(e=>r.a.createElement(p.a,{value:e},e)))))})(a.scoreDyns,a.idx)),r.a.createElement("td",{key:"mi"+a.idx},(a.scoreMicro,a.idx,r.a.createElement(B.a,{sx:{width:70}},r.a.createElement(K.a,{spacing:0,direction:"row",sx:{mb:1},alignItems:"center"},r.a.createElement(g.a,{variant:"caption",style:{textAlign:"center"}}," tune "),r.a.createElement(S.a,{"aria-label":"zero",size:"small",onClick:b},r.a.createElement(g.a,{variant:"caption",style:{textAlign:"center"}}," (reset) "))),r.a.createElement(K.a,{spacing:1,direction:"row",sx:{mb:1},alignItems:"center"},r.a.createElement("img",{src:"/flat.png",height:"20"}),r.a.createElement(m.a,{valueLabelDisplay:"auto","aria-label":"tune",size:"small",min:-.49,step:.01,max:.49,value:a.scoreMicro,onChangeCommitted:E,onChange:y}),r.a.createElement("img",{src:"/sharp.png",height:"20"}))))),r.a.createElement("td",{key:"pi"+a.idx},((e,t)=>{const n=[_[a.scoreNames][a.scoreTechs][a.scoreDyns][0],_[a.scoreNames][a.scoreTechs][a.scoreDyns][_[a.scoreNames][a.scoreTechs][a.scoreDyns].length-1]];return r.a.createElement("div",null,r.a.createElement("div",{"aria-describedby":t,onClick:i},r.a.createElement(Ie,{note:a.scorePitch.sort().map(e=>l(e+a.scoreMicro))})),r.a.createElement(ne.a,{id:t,open:a.popOpen,anchorEl:a.anchorEl,onClose:d,style:{zIndex:1e4},anchorOrigin:{vertical:"bottom",horizontal:"left"},sx:{marginTop:3},transformOrigin:{vertical:"bottom",horizontal:"right"}},r.a.createElement(B.a,{sx:{border:1,p:1,bgcolor:"white"}},r.a.createElement(Se,{noteRange:{first:n[0],last:n[1]},activeNotes:a.scorePitch,playNote:e=>{},stopNote:e=>{let t=[...a.scorePitch];if(t.includes(e)){const a=t.filter((function(t,a,n){return t!=e}));s(e=>({...e,scorePitch:a}))}else t.push(e),s(e=>({...e,scorePitch:t}))},width:400}))))})(a.scorePitch,"pi"+a.idx)),r.a.createElement("td",null," ",r.a.createElement(c.a,{variant:"outlined",color:"warning",onClick:()=>{s(e=>({...e,popOpen:!1})),s(e=>({...e,scorePitch:[]})),s(e=>({...e,scoreMicro:0})),e.onChange([a.scoreNames,a.scoreTechs,a.scoreDyns,[],a.scoreTgt,a.scoreOnoff,a.scoreIdx,0])},size:"small"}," clear notes ")),r.a.createElement("td",{key:"tg"+a.idx},r.a.createElement("div",{style:{border:"1px solid lightGray",borderRadius:5,padding:8}},r.a.createElement(K.a,{direction:"row",spacing:1,alignItems:"center"},r.a.createElement(g.a,null,"orch."),r.a.createElement(Y.a,{key:"tgtswitch"+a.idx,checked:a.scoreTgt,color:"secondary",onChange:t=>((t,n)=>{const r=n.target.checked;s(e=>({...e,scoreTgt:r})),e.onChange([a.scoreNames,a.scoreTechs,a.scoreDyns,a.scorePitch,r,a.scoreOnoff,a.scoreIdx,a.scoreMicro])})(a.idx,t)}),r.a.createElement(g.a,null,"tgt")))),r.a.createElement("td",{key:"onoff"+a.idx},r.a.createElement("div",{style:{border:"1px solid lightGray",borderRadius:5,padding:8}},r.a.createElement(K.a,{direction:"row",spacing:1,alignItems:"center"},r.a.createElement(g.a,null,"off"),r.a.createElement(Y.a,{key:"onoffswitch"+a.idx,checked:a.scoreOnoff,onChange:t=>((t,n)=>{const r=n.target.checked;s(e=>({...e,scoreOnoff:r})),e.onChange([a.scoreNames,a.scoreTechs,a.scoreDyns,a.scorePitch,a.scoreTgt,r,a.scoreIdx,a.scoreMicro])})(a.idx,t)}),r.a.createElement(g.a,null,"on")))),r.a.createElement("td",{key:"mod"+a.idx},(v=a.scoreModify,x=a.idx,r.a.createElement("div",null,r.a.createElement(f.a,{sx:{m:1,minWidth:50}},r.a.createElement(u.a,{id:"mod-select"},"Transpose"),r.a.createElement(h.a,{labelId:"mod-select",id:"mod-sel"+x,value:v,onChange:t=>((t,n)=>{const r=n.target.value;let o=a.scorePitch.map(e=>e+r>=_[a.scoreNames][a.scoreTechs][a.scoreDyns][0]&&e+r<=_[a.scoreNames][a.scoreTechs][a.scoreDyns][1]?e+r:null);o=o.filter((e,t,a)=>null!=e),console.log(o),s(e=>({...e,scorePitch:o,scoreModify:0})),e.onChange([a.scoreNames,a.scoreTechs,a.scoreDyns,o,a.scoreTgt,a.scoreOnoff,a.scoreIdx,a.scoreMicro])})(0,t),autoWidth:!0,label:"trans."},[0,12,-12,24,-24].map(e=>r.a.createElement(p.a,{value:e},e))))))),r.a.createElement("td",null," ",r.a.createElement(c.a,{variant:"outlined",color:"warning",onClick:t=>e.onDelete(a.scoreIdx),size:"small"}," delete ")));var v,x}var Me=a(124),Oe=a(262);const Pe=Object(Me.a)({palette:{neutral:{main:"#dcc4ac",contrastText:"#black"}}});function De(e){const[t,a]=Object(n.useState)({instList:[],listenList:[],data:[],selected:null,saved:!1,audibilityPercent:0,textFieldValue:"Chord Editor orchestration "+JSON.parse(localStorage.getItem("orchestrations")).length});n.useEffect(()=>{if(null!=sessionStorage.getItem("LastChord")){const e=JSON.parse(sessionStorage.getItem("LastChord"));a(t=>({...t,instList:e})),r(e)}},[]);const r=e=>{let t=[],n=[],r=0;e.map((e,a)=>{e[3].map(a=>{let s=0;"number"===typeof e[7]&&(s=e[7]),e[5]&&(t.push([e[0],e[1],e[2],a,e[4],e[5],r,s]),n.push([e[0],e[1],e[2],a+s,e[4],e[5],r])),r+=1})}),E.a.post("https://rest.score-tool.com/modalSlice",t).then(e=>{var t=e.data;a(e=>({...e,data:t.data,listenList:n,audibilityPercent:100-t.data[2].masking_percent}))})},s=e=>{e.persist();const n=e.target.textContent.toLowerCase();let r=[...t.instList],s="normal";"percussion_misc"===n&&(s="castanet");let o="mf";"crotale"===n&&(o="f");let l=[];_[n][s][o][0]===_[n][s][o][1]&&(l=[_[n][s][o][0]]),0===r.length?r.push([n,s,o,l,!1,!0,0]):r.push([n,s,o,l,!1,!0,r[r.length-1][6]+1]),console.log(r),a(e=>({...e,instList:r}))},o=e=>{console.log(t.instList);var n=t.instList.filter((function(t,a,n){return t[6]!=e}));console.log(n),a(e=>({...e,instList:n})),r(n)};return n.createElement(n.Fragment,null,n.createElement(Oe.a,{theme:Pe},n.createElement(c.a,{variant:"contained",color:"warning",onClick:()=>{a(e=>({...e,instList:[],listenList:[],data:[],selected:null,saved:!1}))}}," Clear all instruments "),n.createElement(g.a,{style:{textAlign:"center"}}," Select orchestration from your saved orchestrations  "),n.createElement(f.a,{sx:{m:1,minWidth:50}},n.createElement(u.a,{id:"orchestration-select"},"Orchestrations"),n.createElement(h.a,{labelId:"orchestration-select",id:"orchestration-select1",value:t.selected,onChange:e=>{const t=e.target.value,n=JSON.parse(localStorage.getItem("orchestrations")).filter((e,a,n)=>e.id===t)[0].data.map((e,t)=>[e[0],e[1],e[2],e[3],e[4],e[5],t]);a(e=>({...e,instList:n,selected:t})),r(n)},autoWidth:!0,label:"orch."},null===localStorage.getItem("orchestrations")?null:JSON.parse(localStorage.getItem("orchestrations")).map(e=>n.createElement(p.a,{value:e.id},e.name)))),n.createElement(g.a,{style:{textAlign:"center"}}," or/and  "),n.createElement(g.a,{style:{textAlign:"center"}}," Click below to add instrument to orchestration  "),n.createElement("table",null,n.createElement("tbody",null,n.createElement("tr",null,n.createElement("td",null,"Woodwinds"),n.createElement("td",null,"Brass"),n.createElement("td",null,"Strings"),n.createElement("td",null,"Percussion"),n.createElement("td",null,"Various")),n.createElement("tr",null,n.createElement("td",null,["piccolo","flute","alto_flute","bass_flute","oboe","english_horn","clarinet","clarinet_eb","bass_cl","bassoon"].map(e=>n.createElement(c.a,{variant:"contained",onClick:s,color:"neutral",size:"small"},e))),n.createElement("td",null,["trumpet","horn","tenor_trombone","bass_trombone","soprano_sax","alto_sax"].map(e=>n.createElement(c.a,{variant:"contained",onClick:s,color:"neutral",size:"small"},e))),n.createElement("td",null,["violin","viola","cello","double_bass","solo_violin","solo_viola","solo_cello","solo_double_bass"].map(e=>n.createElement(c.a,{variant:"contained",onClick:s,color:"neutral",size:"small"},e))),n.createElement("td",null,["crotale","cymbal","percussion_misc","tambourine","tamtam","tamtam_22","tamtam_40","thaigong","triangle_6","triangle_8","vibraphone","woodblock","xylophone","timp"].map(e=>n.createElement(c.a,{variant:"contained",onClick:s,color:"neutral",size:"small"},e))),n.createElement("td",null,["piano","harp","guitar","soprano_generic","tenor_generic","baritone_generic"].map(e=>n.createElement(c.a,{variant:"contained",onClick:s,color:"neutral",size:"small"},e))))))),n.createElement("div",{style:{zoom:1}},n.createElement("table",null,t.instList.map((e,s)=>n.createElement(Ae,{key:e,data:e,onChange:e=>((e,n)=>{let s=[...t.instList];s[e]=n,a(e=>({...e,instList:s,saved:!1})),sessionStorage.setItem("LastChord",JSON.stringify(s)),r(s)})(s,e),onDelete:o,idx:"fgfg"+s})))),n.createElement("br",null),n.createElement("div",{style:{margin:"auto",textAlign:"center"}},n.createElement(g.a,{variant:"caption",component:"div",color:"text.secondary"},"Target audibility:"),n.createElement(B.a,{sx:{position:"relative",display:"inline-flex"}},n.createElement(H.a,{variant:"determinate",value:t.audibilityPercent,color:t.audibilityPercent<=30?"error":t.audibilityPercent<=50?"warning":"success"}),n.createElement(B.a,{sx:{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center"}},n.createElement(g.a,{variant:"caption",component:"div",color:"text.secondary"},"".concat(Math.round(t.audibilityPercent),"%"))))),n.createElement("br",null),n.createElement(Oe.a,{theme:Pe},n.createElement(c.a,{variant:"contained",color:"neutral",onClick:()=>r(t.instList),style:{display:"none"}}," Click to update graphs "),n.createElement(G,{text:t.textFieldValue,orchestration:t.instList})),n.createElement("div",{style:{textAlign:"center",margin:"auto"}},n.createElement(J,{instrumentList:t.listenList})),n.createElement(W,{data:t.data}),n.createElement(j,{instrumentList:t.listenList}))}const Le=n.forwardRef((function(e,t){return n.createElement(N.a,Object.assign({direction:"up",ref:t},e))}));function ze(e){const[t,a]=n.useState(!1);return n.useEffect(()=>{a(t=>e.open)},[e]),n.createElement("div",null,n.createElement(x.a,{fullScreen:!0,open:t,onClose:e.handleClose,TransitionComponent:Le,PaperProps:{style:{backgroundColor:"#fffef0"}}},n.createElement(k.a,{sx:{position:"relative",backgroundColor:"#dcc4ac",color:"#4c4c48"}},n.createElement(w.a,null,n.createElement(S.a,{edge:"start",color:"inherit",onClick:e.handleClose,"aria-label":"close"},n.createElement("div",null,"Click here, or press ESC to close Chord Editor")))),n.createElement(De,null)))}function Re(e){const[t,a]=Object(n.useState)({idx:e.data[6],scoreNames:e.data[0],scoreTechs:e.data[1],scoreDyns:e.data[2],scorePitch:e.data[3],scoreTgt:e.data[4],scoreOnoff:e.data[5],scoreIdx:e.data[6],scoreModify:0,popOpen:!1,anchorEl:null}),s=["C","C#","D","D#","E","F","F#","G","G#","A","Bb","B"];const o=e=>{const t=e.currentTarget;a(e=>({...e,popOpen:!e.popOpen,anchorEl:t}))},l=()=>{a(e=>({...e,anchorEl:null,popOpen:!1})),e.onChange([t.scoreNames,t.scoreTechs,t.scoreDyns,t.scorePitch,t.scoreTgt,t.scoreOnoff,t.scoreIdx])};return r.a.createElement("tr",null,r.a.createElement("td",{key:"nam"+t.idx},t.instName),r.a.createElement("td",{key:"scor"+t.idx},((n,s)=>{const o=Object.keys(_);return r.a.createElement("div",null,r.a.createElement(f.a,{sx:{m:1,minWidth:50}},r.a.createElement(u.a,{id:"instrument-select"},"Instr."),r.a.createElement(h.a,{labelId:"instrument-select",id:"instrument-sel"+s,value:n,onChange:n=>((n,r)=>{const s=r.target.value;a(e=>({...e,popOpen:!1}));let o="mf";"crotale"===s&&(o="f");let l="normal";"percussion_misc"===s&&(l="castanet");let i=60;_[s][l][o][0]>60&&(i=_[s][l][o][0]),_[s][l][o][1]<60&&(i=_[s][l][o][0]),a(e=>({...e,scorePitch:i,scoreNames:s,scoreTechs:l,scoreDyns:o})),e.onChange([s,l,o,i,t.scoreTgt,t.scoreOnoff,t.scoreIdx])})(0,n),autoWidth:!0,label:"instr."},o.map(e=>r.a.createElement(p.a,{value:e},e)))))})(t.scoreNames,t.idx)),r.a.createElement("td",{key:"tec"+t.idx},((n,s)=>{const o=Object.keys(_[t.scoreNames]);return r.a.createElement("div",null,r.a.createElement(f.a,{sx:{m:1,minWidth:50}},r.a.createElement(u.a,{id:"tech-select"},"Tech."),r.a.createElement(h.a,{labelId:"tech-select",id:"tech-sel"+s,value:n,onChange:n=>((n,r)=>{const s=r.target.value;a(e=>({...e,scoreTechs:s})),e.onChange([t.scoreNames,s,t.scoreDyns,t.scorePitch,t.scoreTgt,t.scoreOnoff,t.scoreIdx])})(0,n),autoWidth:!0,label:"tech."},o.map(e=>r.a.createElement(p.a,{value:e},e)))))})(t.scoreTechs,t.idx)),r.a.createElement("td",{key:"dy"+t.idx},((n,s)=>{const o=Object.keys(_[t.scoreNames][t.scoreTechs]);return r.a.createElement("div",null,r.a.createElement(f.a,{sx:{m:1,minWidth:50}},r.a.createElement(u.a,{id:"dyn-select"},"Dyn."),r.a.createElement(h.a,{labelId:"dyn-select",id:"dyn-sel"+s,value:n,onChange:n=>((n,r)=>{const s=r.target.value;a(e=>({...e,scoreDyns:s})),e.onChange([t.scoreNames,t.scoreTechs,s,t.scorePitch,t.scoreTgt,t.scoreOnoff,t.scoreIdx])})(0,n),autoWidth:!0,label:"dyn."},o.map(e=>r.a.createElement(p.a,{value:e},e)))))})(t.scoreDyns,t.idx)),r.a.createElement("td",{key:"pi"+t.idx},((e,n)=>{const i=[_[t.scoreNames][t.scoreTechs][t.scoreDyns][0],_[t.scoreNames][t.scoreTechs][t.scoreDyns][_[t.scoreNames][t.scoreTechs][t.scoreDyns].length-1]];return r.a.createElement("div",null,r.a.createElement("div",{"aria-describedby":n,onClick:o},r.a.createElement(Ie,{note:[(c=t.scorePitch,s[c%12]+(Math.floor(c/12)-1))]})),r.a.createElement(ne.a,{id:n,open:t.popOpen,anchorEl:t.anchorEl,onClose:l,style:{zIndex:1e4},anchorOrigin:{vertical:"bottom",horizontal:"left"},sx:{marginTop:3},transformOrigin:{vertical:"bottom",horizontal:"right"}},r.a.createElement(B.a,{sx:{border:1,p:1,bgcolor:"white"}},r.a.createElement(ae.a,{noteRange:{first:i[0],last:i[1]},activeNotes:[t.scorePitch],playNote:e=>{},onPlayNoteInput:e=>{a(t=>({...t,scorePitch:e}))},stopNote:e=>null,width:400}))));var c})(t.scorePitch,"pi"+t.idx)),r.a.createElement("td",{key:"mod"+t.idx},(i=t.scoreModify,c=t.idx,r.a.createElement("div",null,r.a.createElement(f.a,{sx:{m:1,minWidth:50}},r.a.createElement(u.a,{id:"mod-select"},"Transpose"),r.a.createElement(h.a,{labelId:"mod-select",id:"mod-sel"+c,value:i,onChange:e=>((e,t)=>{const n=t.target.value;a(e=>({...e,scorePitch:e.scorePitch+n,scoreModify:0}))})(0,e),autoWidth:!0,label:"trans."},[0,12,-12,24,-24].map(e=>r.a.createElement(p.a,{value:e},e))))))));var i,c}const Fe=Object(z.a)(R.a)(e=>{let{theme:t}=e;return{...t.typography.body2,backgroundColor:"#fffef0",padding:t.spacing(1),textAlign:"center",color:t.palette.text.secondary}});function We(e){let{data:t}=e;return t.length<2?null:n.createElement("div",null,n.createElement(L.a,{style:{marginTop:.5},container:!0,direction:"row",justifyContent:"center",alignItems:"center",spacing:.5},n.createElement(L.a,{item:!0,xs:12,md:6},n.createElement(Fe,{style:{height:452,backgroundColor:"#fffef0"}},n.createElement(g.a,null,"Overtone structure of ",t[3].instruments[0]),n.createElement(O,{notes:t[1].notes,instruments:t[1].instruments,target:t[1].target,target_color:"red",width:200,text_space:200}))),n.createElement(L.a,{item:!0,xs:12,md:6},n.createElement(Fe,{style:{height:452,backgroundColor:"#fffef0"}},n.createElement(g.a,null,"Overtone structure of ",t[3].instruments[1]),n.createElement(O,{notes:t[2].notes,instruments:t[2].instruments,target:t[2].target,target_color:"red",width:200,text_space:200}))),n.createElement(L.a,{style:{marginTop:.5},container:!0,direction:"row",justifyContent:"center",alignItems:"center",spacing:.5},n.createElement(L.a,{item:!0,xs:12,md:6},n.createElement(Fe,{style:{height:452,backgroundColor:"#fffef0"}},n.createElement(g.a,null,"Spectral centroids"),n.createElement(O,{notes:t[3].notes,instruments:t[3].instruments,target:[],width:150,text_space:200}))),n.createElement(L.a,{item:!0,xs:12,md:6},n.createElement(Fe,null,n.createElement(I.a,{data:t[0][1].data,layout:{...t[0][1].layout,width:window.innerWidth/2-50,margin:{l:0,r:0},legend:{orientation:"h"}},config:{displayModeBar:!1},width:200}))))),n.createElement(L.a,{style:{marginTop:.5},container:!0,direction:"row",justifyContent:"left",alignItems:"left",spacing:.5},n.createElement(L.a,{item:!0,xs:12,md:12},n.createElement(Fe,null,n.createElement(I.a,{data:t[0][0].data,layout:{...t[0][0].layout,width:window.innerWidth-50,margin:{l:0,r:0},legend:{orientation:"h"},xaxis:{title:{text:"Frequency in Hz",standoff:3},type:"log",showgrid:!1,range:[1.6,4.3]}},config:{displayModeBar:!1}})))))}Object(z.a)(R.a)(e=>{let{theme:t}=e;return{...t.typography.body2,backgroundColor:"#fffef0",padding:t.spacing(1),textAlign:"center",color:t.palette.text.secondary}});const Ve=Object(Me.a)({palette:{neutral:{main:"#dcc4ac",contrastText:"#black"}}}),je=n.forwardRef((function(e,t){return n.createElement(N.a,Object.assign({direction:"up",ref:t},e))}));function Ge(e){const[t,a]=n.useState(!1),[r,s]=n.useState([["flute","normal","mf",60,0,1,0],["flute","normal","mf",60,0,1,1]]),[o,l]=n.useState([]);n.useEffect(()=>{a(t=>e.open)},[e]),n.useEffect(()=>{if(null!=sessionStorage.getItem("LastCompare")){const e=JSON.parse(sessionStorage.getItem("LastCompare"));s(()=>e),m(e)}},[]);const i=e=>{let t=[...r];t[e[6]]=e,s(()=>t),sessionStorage.setItem("LastCompare",JSON.stringify(t)),m(t)},m=e=>{let t=[];e.map(e=>{t.push([e[0],e[1],e[2],e[3]])}),E.a.post("https://rest.score-tool.com/compare",t).then(e=>{var t=e.data;l(()=>t)})};return n.createElement("div",null,n.createElement(x.a,{fullScreen:!0,open:t,onClose:e.handleClose,TransitionComponent:je,PaperProps:{style:{backgroundColor:"#fffef0"}}},n.createElement(k.a,{sx:{position:"relative",backgroundColor:"#dcc4ac",color:"#4c4c48"}},n.createElement(w.a,null,n.createElement(S.a,{edge:"start",color:"inherit",onClick:e.handleClose,"aria-label":"close"},n.createElement("div",null,"Click here, or press ESC to close Compare Editor")))),n.createElement(g.a,{style:{textAlign:"center"}},"Compare two instrument timbres. Select instruments to compare below."),n.createElement("table",{style:{marginInline:"20vw"}},n.createElement("tbody",null,n.createElement(Re,{data:r[0],onChange:i}),n.createElement(Re,{data:r[1],onChange:i}))),n.createElement(Oe.a,{theme:Ve},n.createElement(c.a,{variant:"contained",color:"neutral",onClick:()=>m(r),style:{display:"none"}}," Click to compare")),n.createElement(We,{data:o})))}var Ke=a(246),Be=a(274),Ue=a(253);const He=n.forwardRef((function(e,t){return n.createElement(N.a,Object.assign({direction:"up",ref:t},e))}));function Je(e){const t=["piccolo","flute","alto_flute","bass_flute","oboe","english_horn","clarinet","clarinet_eb","bass_cl","bassoon"],a=["trumpet","horn","tenor_trombone","bass_trombone","soprano_sax","alto_sax"],r=["crotale","cymbal","percussion_misc","tambourine","tamtam","tamtam_22","tamtam_40","thaigong","triangle_6","triangle_8","vibraphone","woodblock","xylophone","timp"],s=["piano","harp","guitar","soprano_generic","tenor_generic","baritone_generic"],o=["violin","viola","cello","double_bass","solo_violin","solo_viola","solo_cello","solo_double_bass"],l=["p","mf","f"],i=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],m=[1,2,3,4,5,6,7,8];function d(e){var t=e-Math.floor(e);let a=Math.round(e),n=i[a%12];return t>=.2&&t<.5?/[#]/.test(n)?n=i[(a+1)%12]+"d":n+="+":t>=.5&&t<=.8&&(/[#]/.test(n)?n=i[(a-1)%12]+"+":n+="d"),n+(Math.floor(a/12)-1)}const[y,b]=n.useState(!1),[v,C]=n.useState({selected:null,instList:[],searchInstruments:t.concat(a).concat(o),searchTechs:["normal"],availableTechs:[],searchPitch:i,searchOct:m,searchDyn:l,searchMethod:["peaks"],searchPeaks:3,toggle:[!0,!0,!0,!1,!1,!1],result:null});n.useEffect(()=>{b(t=>e.open)},[e]),n.useEffect(()=>{let e=[];v.searchInstruments.map(t=>{Object.keys(_[t]).map(t=>{e.includes(t)||e.push(t)})}),C(t=>({...t,availableTechs:e}))},[v.searchInstruments]);const N=(e,t,a)=>{if(a.target.checked){let e=[...v.searchInstruments];e.push(t),C(t=>({...t,searchInstruments:e}))}else{const e=v.searchInstruments.filter((function(e,a,n){return e!==t}));C(t=>({...t,searchInstruments:e}))}},T=(e,n)=>{let l=[...v.toggle];if(l[e]=!l[e],C(e=>({...e,toggle:l})),0===e)if(l[e]){const e=v.searchInstruments.concat(t);C(t=>({...t,searchInstruments:e}))}else{let e=v.searchInstruments.filter((e,a,n)=>!t.includes(e));C(t=>({...t,searchInstruments:e}))}if(1===e)if(l[e]){const e=v.searchInstruments.concat(a);C(t=>({...t,searchInstruments:e}))}else{let e=v.searchInstruments.filter((e,t,n)=>!a.includes(e));C(t=>({...t,searchInstruments:e}))}if(2===e)if(l[e]){const e=v.searchInstruments.concat(o);C(t=>({...t,searchInstruments:e}))}else{let e=v.searchInstruments.filter((e,t,a)=>!o.includes(e));C(t=>({...t,searchInstruments:e}))}if(3===e)if(l[e]){const e=v.searchInstruments.concat(r);C(t=>({...t,searchInstruments:e}))}else{let e=v.searchInstruments.filter((e,t,a)=>!r.includes(e));C(t=>({...t,searchInstruments:e}))}if(4===e)if(l[e]){const e=v.searchInstruments.concat(s);C(t=>({...t,searchInstruments:e}))}else{let e=v.searchInstruments.filter((e,t,a)=>!s.includes(e));C(t=>({...t,searchInstruments:e}))}if(5===e)if(l[e]){const e=v.searchTechs.concat(v.availableTechs);C(t=>({...t,searchTechs:e}))}else C(e=>({...e,searchTechs:["normal"]}))};return n.createElement("div",null,n.createElement(x.a,{fullScreen:!0,open:y,onClose:e.handleClose,TransitionComponent:He,PaperProps:{style:{backgroundColor:"#fffef0"}}},n.createElement(k.a,{sx:{position:"relative",backgroundColor:"#dcc4ac",color:"#4c4c48"}},n.createElement(w.a,null,n.createElement(S.a,{edge:"start",color:"inherit",onClick:e.handleClose,"aria-label":"close"},n.createElement("div",null,"Click here, or press ESC to close Search Panel")))),n.createElement(g.a,{style:{textAlign:"center"}}," Select search source from your saved orchestrations  "),n.createElement(f.a,{sx:{m:1,minWidth:50}},n.createElement(u.a,{id:"orchestration-select"},"Orchestrations"),n.createElement(h.a,{labelId:"orchestration-select",id:"orchestration-select1",value:v.selected,onChange:e=>{const t=e.target.value,a=JSON.parse(localStorage.getItem("orchestrations")).filter((e,a,n)=>e.id===t)[0].data.map((e,t)=>[e[0],e[1],e[2],e[3],e[4],e[5],t,e[7]]);C(e=>({...e,instList:a,selected:t}))},autoWidth:!0,label:"orch."},null===localStorage.getItem("orchestrations")?null:JSON.parse(localStorage.getItem("orchestrations")).map(e=>n.createElement(p.a,{value:e.id},e.name)))),n.createElement(g.a,{variant:"h5",style:{textAlign:"center",margin:"auto"}},"Search source"),(e=>{if(e.length>0){let t=[],a=0;e.map((e,n)=>{e[3].map(n=>{let r=0;"number"===typeof e[7]&&(r=e[7]),t.push([e[0],e[1],e[2],n,e[4],e[5],a,r]),a+=1})}),t.sort((function(e,t){return e[3]-t[3]}));let r=t.map(e=>d(e[3]+e[7])),s=t.map(e=>e[0]);return n.createElement("div",{style:{textAlign:"center",margin:"auto"}},n.createElement(O,{notes:r,instruments:s,target:[],scale:.8,width:200,height:250,t_score_y:110,b_score_y:170,text_space:100}))}})(v.instList),n.createElement(g.a,{variant:"h5",style:{textAlign:"center",margin:"auto"}},"Search space"),n.createElement("table",null,n.createElement("tbody",null,n.createElement("tr",null,n.createElement("td",null,n.createElement(g.a,null,"Woodwinds"),n.createElement(Be.a,{style:{color:"green"},label:"toggle all",control:n.createElement(Ue.a,{checked:v.toggle[0],size:"small",color:"success",onChange:e=>T(0)})})),n.createElement("td",null,n.createElement(g.a,null,"Brass"),n.createElement(Be.a,{style:{color:"green"},label:"toggle all",control:n.createElement(Ue.a,{checked:v.toggle[1],size:"small",color:"success",onChange:e=>T(1)})})),n.createElement("td",null,n.createElement(g.a,null,"Strings"),n.createElement(Be.a,{style:{color:"green"},label:"toggle all",control:n.createElement(Ue.a,{checked:v.toggle[2],color:"success",size:"small",onChange:e=>T(2)})})),n.createElement("td",null,n.createElement(g.a,null,"Percussion"),n.createElement(Be.a,{style:{color:"green"},label:"toggle all",control:n.createElement(Ue.a,{checked:v.toggle[3],color:"success",size:"small",onChange:e=>T(3)})})),n.createElement("td",null,n.createElement(g.a,null,"Other"),n.createElement(Be.a,{style:{color:"green"},label:"toggle all",control:n.createElement(Ue.a,{checked:v.toggle[4],color:"success",size:"small",onChange:e=>T(4)})}))),n.createElement("tr",null,n.createElement("td",null,n.createElement(Ke.a,{sx:{display:"inline"}},t.map((e,t)=>n.createElement(Be.a,{label:e,control:n.createElement(Ue.a,{checked:v.searchInstruments.includes(e),size:"small",onChange:t=>N(0,e,t)})})))),n.createElement("td",null,n.createElement(Ke.a,{sx:{display:"inline"}},a.map((e,t)=>n.createElement(Be.a,{label:e,control:n.createElement(Ue.a,{checked:v.searchInstruments.includes(e),size:"small",onChange:t=>N(0,e,t)})})))),n.createElement("td",null,n.createElement(Ke.a,{sx:{display:"inline"}},o.map((e,t)=>n.createElement(Be.a,{label:e,control:n.createElement(Ue.a,{checked:v.searchInstruments.includes(e),size:"small",onChange:t=>N(0,e,t)})})))),n.createElement("td",null,n.createElement(Ke.a,{sx:{display:"inline"}},r.map((e,t)=>n.createElement(Be.a,{label:e,control:n.createElement(Ue.a,{checked:v.searchInstruments.includes(e),size:"small",onChange:t=>N(0,e,t)})})))),n.createElement("td",null,n.createElement(Ke.a,{sx:{display:"inline"}},s.map((e,t)=>n.createElement(Be.a,{label:e,control:n.createElement(Ue.a,{checked:v.searchInstruments.includes(e),onChange:t=>N(0,e,t)})}))))))),n.createElement(g.a,null,"Techniques"),n.createElement(Be.a,{style:{color:"green"},label:"toggle all",control:n.createElement(Ue.a,{checked:v.toggle[5],color:"success",size:"small",onChange:e=>T(5)})}),n.createElement(Ke.a,{sx:{display:"inline"}},v.availableTechs.map((e,t)=>n.createElement(Be.a,{label:e,control:n.createElement(Ue.a,{checked:v.searchTechs.includes(e),size:"small",onChange:t=>((e,t,a)=>{if(a.target.checked){let e=[...v.searchTechs];e.push(t),C(t=>({...t,searchTechs:e}))}else{const e=v.searchTechs.filter((function(e,a,n){return e!==t}));C(t=>({...t,searchTechs:e}))}})(0,e,t)})}))),n.createElement(g.a,null,"Dynamics"),n.createElement(Ke.a,{sx:{display:"inline"}},l.map((e,t)=>n.createElement(Be.a,{label:e,control:n.createElement(Ue.a,{checked:v.searchDyn.includes(e),size:"small",onChange:t=>((e,t,a)=>{if(a.target.checked){let e=[...v.searchDyn];e.push(t),C(t=>({...t,searchDyn:e}))}else{const e=v.searchDyn.filter((function(e,a,n){return e!==t}));C(t=>({...t,searchDyn:e}))}})(0,e,t)})}))),n.createElement(g.a,null,"Pitch classes"),n.createElement(Ke.a,{sx:{display:"inline"}},i.map((e,t)=>n.createElement(Be.a,{label:e,control:n.createElement(Ue.a,{checked:v.searchPitch.includes(e),size:"small",onChange:t=>((e,t,a)=>{if(a.target.checked){let e=[...v.searchPitch];e.push(t),C(t=>({...t,searchPitch:e}))}else{const e=v.searchPitch.filter((function(e,a,n){return e!==t}));C(t=>({...t,searchPitch:e}))}})(0,e,t)})}))),n.createElement(g.a,null,"Octaves"),n.createElement(Ke.a,{sx:{display:"inline"}},m.map((e,t)=>n.createElement(Be.a,{label:e,control:n.createElement(Ue.a,{checked:v.searchOct.includes(e),size:"small",onChange:t=>((e,t,a)=>{if(a.target.checked){let e=[...v.searchOct];e.push(t),C(t=>({...t,searchOct:e}))}else{const e=v.searchOct.filter((function(e,a,n){return e!==t}));C(t=>({...t,searchOct:e}))}})(0,e,t)})}))),n.createElement(g.a,null,"Search method"),n.createElement(Ke.a,{sx:{display:"inline"}},["mfcc","centroid","masking_curve","peaks"].map((e,t)=>n.createElement(Be.a,{label:e,control:n.createElement(Ue.a,{checked:v.searchMethod.includes(e),size:"small",onChange:t=>((e,t,a)=>{if(a.target.checked){let e=[...v.searchMethod];e.push(t),C(t=>({...t,searchMethod:e}))}else{const e=v.searchMethod.filter((function(e,a,n){return e!==t}));C(t=>({...t,searchMethod:e}))}})(0,e,t)})})),n.createElement(f.a,{fullWidth:!0},n.createElement(u.a,{id:"overlapping"},"Overlappin partials for peaks"),n.createElement(h.a,{labelId:"overlapping",id:"overlapping-select",value:v.searchPeaks,label:"Overlappin partials for peaks",onChange:e=>{const t=e.target.value;C(e=>({...e,searchPeaks:t}))}},[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15].map(e=>n.createElement(p.a,{value:e},e))))),n.createElement(c.a,{onClick:()=>{C(e=>({...e,result:""}));let e=[];v.instList.map((t,a)=>{t[3].map(a=>{e.push(t[0]+","+t[1]+","+t[2]+","+Math.round(a))})});const t=[e,v.searchMethod,v.searchInstruments,v.searchTechs,v.searchDyn,v.searchPitch,v.searchOct,v.searchPeaks];E.a.post("https://rest.score-tool.com/search",t).then(e=>{const t=e.data,a=n.createElement("div",{id:t[0]},n.createElement(g.a,{style:{textAlign:"center",margin:"auto"}}," Search result: ",t[0][0]," ",t[0][1]," ",t[0][2]," ",d(t[0][3])),n.createElement("div",{style:{textAlign:"center",margin:"auto"}},n.createElement(O,{notes:[d(t[0][3])],instruments:[t[0][0]],target:[],scale:.8,width:200,height:250,t_score_y:50,b_score_y:140,text_space:100})),n.createElement(g.a,{style:{textAlign:"center",margin:"auto"}}," Play search result, ",t[0][0],": "),n.createElement("div",null,n.createElement("audio",{controls:!0,id:"yks"+t[0]}," ",n.createElement("source",{src:t[1],autoPlay:"true",type:"audio/x-wav"})," ")),n.createElement(g.a,{style:{textAlign:"center",margin:"auto"}}," Play search source: "),n.createElement("div",null,n.createElement("audio",{controls:!0,id:"kaks"+t[0]}," ",n.createElement("source",{src:t[2],type:"audio/x-wav"})," ")),n.createElement(g.a,{style:{textAlign:"center",margin:"auto"}}," Play both together: "),n.createElement("div",null,n.createElement("audio",{controls:!0,id:"kol"+t[0]},"  ",n.createElement("source",{src:t[3],type:"audio/x-wav"})," ")),n.createElement(c.a,{onClick:e=>((e,t)=>{let a=[...v.instList];a.push([e[0],e[1],e[2],[e[3]],0,1,a[a.length-1][6]+1],0),C(e=>({...e,instList:a}))})(t[0]),variant:"contained",color:"secondary",style:{padding:10,margin:5}}," Add search result to search source "),n.createElement(c.a,{onClick:e=>((e,t)=>{let a=[...v.instList];a.push([e[0],e[1],e[2],[e[3]],0,1,a[a.length-1][6]+1],0),C(e=>({...e,instList:a}));let n=JSON.parse(localStorage.getItem("orchestrations"));n[v.selected].data=a,localStorage.setItem("orchestrations",JSON.stringify(n))})(t[0]),variant:"contained",color:"secondary",style:{padding:10,margin:5}}," Update your saved orchestration with search result "));C(e=>({...e,result:a}))})},variant:"contained",color:"primary",style:{padding:10,margin:5}}," SEARCH "),n.createElement("br",null),v.result))}const qe=n.forwardRef((function(e,t){return n.createElement(N.a,Object.assign({direction:"up",ref:t},e))}));function Xe(e){const t=["C","C#","D","D#","E","F","F#","G","G#","A","B#","B"];const[a,r]=n.useState(!1),[s,o]=n.useState([]),[i,m]=n.useState([]);n.useEffect(()=>{r(t=>e.open);let t=[];t.length=JSON.parse(localStorage.getItem("orchestrations")).length,m(()=>t)},[e]),n.useEffect(()=>{o(()=>JSON.parse(localStorage.getItem("orchestrations")));let e=[];e.length=JSON.parse(localStorage.getItem("orchestrations")).length,m(()=>e)},[]),n.useEffect(()=>{o(()=>JSON.parse(localStorage.getItem("orchestrations")));let e=[];e.length=JSON.parse(localStorage.getItem("orchestrations")).length,m(()=>e)},[localStorage.getItem("orchestrations")]);const d=e=>{if(e.length>0){let a=[],r=0;e.map((e,t)=>{e[3].map(t=>{let n=0;"number"===typeof e[7]&&(n=e[7]),a.push([e[0],e[1],e[2],t+n,e[4],e[5],r]),r+=1})}),a.sort((function(e,t){return e[3]-t[3]}));let s=a.map(e=>function(e){var a=e-Math.floor(e);let n=Math.round(e),r=t[n%12];return a>=.2&&a<.5?/[#]/.test(r)?r=t[(n+1)%12]+"d":r+="+":a>=.5&&a<=.8&&(/[#]/.test(r)?r=t[(n-1)%12]+"+":r+="d"),r+(Math.floor(n/12)-1)}(e[3])),o=a.map(e=>e[0]);return n.createElement("div",{style:{textAlign:"center",margin:"auto"}},n.createElement(O,{notes:s,instruments:o,target:[],scale:.3,width:150,height:90,t_score_y:110,b_score_y:170,text_space:30}))}};return n.createElement("div",null,n.createElement(x.a,{fullScreen:!0,open:a,onClose:e.handleClose,TransitionComponent:qe,PaperProps:{style:{backgroundColor:"#fffef0"}}},n.createElement(k.a,{sx:{position:"relative",backgroundColor:"#dcc4ac",color:"#4c4c48"}},n.createElement(w.a,null,n.createElement(S.a,{edge:"start",color:"inherit",onClick:e.handleClose,"aria-label":"close"},n.createElement("div",null,"Click here, or press ESC to close Manage Panel")))),n.createElement(g.a,{style:{textAlign:"center"}},"Here you can manage your saved orchestrations"),n.createElement(l.a,{onDrop:e=>{e.forEach(e=>{const t=new FileReader;t.onabort=()=>console.log("file reading was aborted"),t.onerror=()=>console.log("file reading has failed"),t.onload=()=>{let e=JSON.parse(localStorage.getItem("orchestrations")),a=0;e.length>0&&(a=e[e.length-1].id+1);const n=JSON.parse(t.result);n.map(e=>{e.id,e.name,e.data}),n.map((t,n)=>{let r=t;r.id=a+n,e.push(r)}),o(()=>e),localStorage.setItem("orchestrations",JSON.stringify(e))},t.readAsText(e)})},maxFiles:1,accept:".chords"},e=>{let{getRootProps:t,getInputProps:a}=e;return n.createElement("section",{className:"container"},n.createElement("div",Object.assign({},t({className:"dropzone Upload"}),{style:{margin:5,padding:5,borderRadius:10,border:"2px dashed #4c4c48"}}),n.createElement("input",a()),n.createElement("p",{style:{textAlign:"center"}},"Upload your saved file of orchestration chords")),n.createElement("aside",null,n.createElement("div",null)))}),0===s.length&&n.createElement(g.a,{style:{textAlign:"center"}},"Add some orchestrations to your list (Upload a pre-saved file, or click save either in Score Analyzer or in Chord Editor.)"),s.length>0&&n.createElement("div",null,n.createElement(c.a,{onClick:()=>{const e=document.createElement("a"),t=new Blob([localStorage.getItem("orchestrations")],{type:"text/plain"});e.href=URL.createObjectURL(t),e.download="orchestration.chords",document.body.appendChild(e),e.click()},variant:"contained",color:"primary",style:{padding:10,margin:5}}," Download your orchestrations "),n.createElement(g.a,{style:{textAlign:"center"}},"List of your orchestrations"),n.createElement("table",{style:{textAlign:"center",margin:"auto"}},n.createElement("tbody",null,n.createElement("tr",null,n.createElement("td",null,"Name"),n.createElement("td",null,"Orchestration"),n.createElement("td",null,"Listen"),n.createElement("td",null,"Delete")),s.map((e,t)=>n.createElement("tr",null," ",n.createElement("td",null,e.name),"  ",n.createElement("td",null,d(e.data)),n.createElement("td",null,n.createElement(c.a,{onClick:a=>((e,t,a)=>{let r=[];t.map((e,t)=>{e[3].map(t=>{let a=0;"number"===typeof e[7]&&(a=e[7]),r.push(e[0]+","+e[1]+","+e[2]+","+(t+a))})}),E.a.post("https://rest.score-tool.com/listen",{orchestration:r,positions:Array(r.length).fill(17),listeningPosition:"audience"},{headers:{auth:"uljasPulkkis"}}).then(t=>{const a=n.createElement("div",null,n.createElement("audio",{controls:!0,autoPlay:"true"}," ",n.createElement("source",{src:t.data,type:"audio/x-wav"})," "));let r=[...i];r[e]=a,m(()=>r)})})(t,e.data),variant:"contained",color:"secondary",style:{padding:10,margin:5}}," LISTEN "),i[t]),n.createElement("td",null,n.createElement(c.a,{onClick:t=>((e,t)=>{console.log(e);const a=JSON.parse(localStorage.getItem("orchestrations")).filter((t,a,n)=>t.id!=e);o(()=>a),localStorage.setItem("orchestrations",JSON.stringify(a))})(e.id),variant:"contained",color:"warning",style:{padding:10,margin:5}}," DELETE ")))))),n.createElement(c.a,{onClick:()=>{o(()=>[]),localStorage.setItem("orchestrations",JSON.stringify([]))},variant:"contained",color:"error",style:{padding:10,margin:5}}," Erase all your orchestrations "))))}function Ye(e){return n.createElement("div",null,n.createElement(g.a,{variant:"h4",style:{border:"1px solid",padding:5}},"This is a completely new version of Score-Tool. If you want to use the old version, visit ",n.createElement("a",{href:"https://old.score-tool.com",target:"_blank"},"old.score-tool.com")," "),n.createElement(g.a,{variant:"h5"},"About"),n.createElement(g.a,null,"Score-Tool is an analysis tool for music orchestration. The purpose of the tool is to help composers, conductors and other musicians to extract information about audibility and timbre from the score. The analysis results are showed on graphs, and there is also a possibility to listen any orchestration chord in a real binaural simulation of the concert hall."),n.createElement(g.a,{variant:"h5"},"Score"),n.createElement(g.a,null,'For analysis, the score must be in musicXML or mxl (compressed musicXML) format. All current notation programs can export musicXML from the "SaveAs" menu. Drag and drop, or click drop area to upload your score to Score-Tool. Click "load score". Analyzed score can be downloaded as PNG file.'),n.createElement(g.a,{variant:"h5"},"Chord"),n.createElement(g.a,null,'The Chord editor can be used without any files. Click any instrument name to add it to your orchestration. Click the notation stave and add notes with piano keyboard. After editing the instrumentation press "Update graphs" to view the analysis information.'),n.createElement(g.a,{variant:"h5"},"Compare"),n.createElement(g.a,null,"The Compare editor lets you compare two individual timbres. Click the mini-staff to select pitch for each instrument. The graphs show the overtone structure and timbre data of both instruments."),n.createElement(g.a,{variant:"h5"},"Search"),n.createElement(g.a,null,"The Search feature requires you to save some orchestrations first. Orchestrations can be saved in Score and Chord editors. Select the search source from your saved orchestrations, select search space from orchestra instruments, select search method(s) and click SEARCH. As result you will get the closest match from database, which can be added to your saved orchestration."),n.createElement(g.a,{variant:"h5"},"Manage"),n.createElement(g.a,null,"Here you can manage your saved orchestrations. You can listen individual chords, and delete the ones you don't need anymore. The saved chords are already in your machine, in browser's local storage, but here you can also download them as file, or upload your orchestratrions to browser."),n.createElement(g.a,{variant:"h6",style:{padding:10}},"Created in 2021 by ",n.createElement("a",{href:"https://uljaspulkkis.com",target:"_blank"},"Uljas Pulkkis")," "))}var Qe=a(148),$e=a.n(Qe),Ze=a(147),et=a.n(Ze),tt=a(150),at=a.n(tt),nt=a(146),rt=a.n(nt),st=a(149),ot=a.n(st),lt=a(247);const it=Object(Me.a)({palette:{neutral:{main:"#dcc4ac",contrastText:"#black"}}}),ct=Object(z.a)(R.a)(e=>{let{theme:t}=e;return{...t.typography.body2,backgroundColor:"#fffef0",padding:t.spacing(1),textAlign:"center",color:t.palette.text.secondary}});class mt extends n.Component{constructor(e){super(e),this.state={file:"",cursor:!1,next:0,files:[],load:"none",chord:!1,compare:!1,search:!1,manage:!1,analyze:"none",about:"block",osmd:""},this.setcursor=this.setcursor.bind(this),this.setnext=this.setnext.bind(this),this.loadFile=this.loadFile.bind(this),this.onDrop=e=>{this.setState({files:e})},document.title="Score-Tool 2.0"}componentDidMount(){null===JSON.parse(localStorage.getItem("orchestrations"))&&localStorage.setItem("orchestrations",JSON.stringify([]))}chordClose(){this.setState(e=>e.chord=!1)}compareClose(){this.setState(e=>e.compare=!1)}searchClose(){this.setState(e=>e.search=!1)}manageClose(){this.setState(e=>e.manage=!1)}setcursor(){this.setState(e=>e.cursor=!0)}loadFile(){this.state.files.forEach(e=>{const t=new FileReader;t.onabort=()=>console.log("file reading was aborted"),t.onerror=()=>console.log("file reading has failed"),t.onload=()=>{const e=t.result;this.setState(t=>{t.file=e,t.load="inline-block"}),this.forceUpdate()};var a=e.name;a.toLowerCase().indexOf(".xml")>0||a.toLowerCase().indexOf(".musicxml")>0?t.readAsText(e):a.toLowerCase().indexOf(".mxl")>0?t.readAsBinaryString(e):alert("No vaild .xml/.mxl/.musicxml file!")})}setnext(){var e=this.state.next;this.setState(t=>t.next=e+1)}handleClick(e){const t=e.target.value;this.setState(e=>e.file=t)}render(){const e=this.state.files.map(e=>r.a.createElement("li",{key:e.name},e.name," - ",e.size," bytes"));var t=[];if(this.state.files[0]){let e="inline-block";"inline-block"===this.state.load&&(e="none"),t=r.a.createElement("div",null,r.a.createElement("div",{style:{display:e}},r.a.createElement(c.a,{onClick:this.loadFile,variant:"contained"},"Load current file")),r.a.createElement("div",{style:{display:this.state.load}},r.a.createElement(te,{file:this.state.file,show:this.state.cursor,next:this.state.next})))}return document.body.style.backgroundColor="#fffef0",r.a.createElement("div",{className:"App"},r.a.createElement(ct,null,r.a.createElement("header",{className:"App-header",style:{padding:10,borderRadius:20}},r.a.createElement("h1",{className:"App-title",style:{padding:10,borderRadius:20}},"Score-Tool 2.0"),r.a.createElement("h1",{className:"App-title",style:{padding:10,borderRadius:20}},"Psychoacoustic orchestration tool by Uljas Pulkkis 2021")),r.a.createElement(Oe.a,{theme:it},r.a.createElement("div",{style:{padding:10}},r.a.createElement("div",{style:{display:"inline"}},r.a.createElement(c.a,{onClick:()=>this.setState(e=>({...e,analyze:"none",about:"block"})),variant:"contained",color:"neutral",startIcon:r.a.createElement(rt.a,null),style:{padding:10,margin:5}}," About Score-tool")),r.a.createElement("div",{style:{display:"inline"}},r.a.createElement(c.a,{onClick:()=>this.setState(e=>({...e,analyze:"block",about:"none"})),variant:"contained",color:"neutral",startIcon:r.a.createElement(et.a,null),style:{padding:10,margin:5}}," Open score analyzer")),r.a.createElement("div",{style:{display:"inline"}},r.a.createElement(c.a,{onClick:()=>this.setState(e=>({...e,chord:!0,analyze:"none",about:"none"})),variant:"contained",color:"neutral",startIcon:r.a.createElement($e.a,null),style:{padding:10,margin:5}}," Open chord editor")),r.a.createElement("div",{style:{display:"inline"}},r.a.createElement(c.a,{onClick:()=>this.setState(e=>({...e,compare:!0,analyze:"none",about:"none"})),variant:"contained",color:"neutral",startIcon:r.a.createElement(ot.a,null),style:{padding:10,margin:5}}," Open compare editor")),r.a.createElement("div",{style:{display:"inline"}},r.a.createElement(c.a,{onClick:()=>this.setState(e=>({...e,search:!0,analyze:"none",about:"none"})),variant:"contained",color:"neutral",startIcon:r.a.createElement(lt.a,null),style:{padding:10,margin:5}}," Open search panel")),r.a.createElement("div",{style:{display:"inline"}},r.a.createElement(c.a,{onClick:()=>this.setState(e=>({...e,manage:!0,analyze:"none",about:"none"})),variant:"contained",color:"neutral",startIcon:r.a.createElement(at.a,null),style:{padding:10,margin:5}}," Manage your orchestrations ")))),r.a.createElement(ze,{handleClose:this.chordClose.bind(this),open:this.state.chord}),r.a.createElement(Ge,{handleClose:this.compareClose.bind(this),open:this.state.compare}),r.a.createElement(Je,{handleClose:this.searchClose.bind(this),open:this.state.search}),r.a.createElement(Xe,{handleClose:this.manageClose.bind(this),open:this.state.manage}),r.a.createElement("div",{className:"",style:{display:this.state.analyze}},r.a.createElement(g.a,{style:{textAlign:"center"}}," Select an example score  "),r.a.createElement(f.a,{sx:{m:1,minWidth:150}},r.a.createElement(u.a,{id:"score-select"},"Scores"),r.a.createElement(h.a,{labelId:"score-select",id:"score-select1",value:this.state.selected,onChange:e=>{const t=e.target.value;this.setState(e=>e.osmd=r.a.createElement(te,{file:t,show:this.state.cursor,next:this.state.next}))},autoWidth:!0,label:"score"},["test_score2.xml","sonority.xml"].map(e=>r.a.createElement(p.a,{value:e},e)))),r.a.createElement(g.a,{style:{textAlign:"center"}}," or  "),r.a.createElement(l.a,{onDrop:this.onDrop,maxFiles:1},t=>{let{getRootProps:a,getInputProps:n}=t;return r.a.createElement("section",{className:"container"},r.a.createElement("div",Object.assign({},a({className:"dropzone Upload"}),{style:{margin:20,padding:10,borderRadius:10,border:"2px dashed #4c4c48",backgroundColor:"#dcc4ac"}}),r.a.createElement("input",n()),r.a.createElement("p",null,"Drop musicXML or click")),r.a.createElement("aside",null,r.a.createElement("div",null,e)))}),t,this.state.osmd),r.a.createElement("div",{style:{display:this.state.about,textAlign:"left",textJustify:"left",paddingInline:"20vw"}},r.a.createElement(Ye,null))))}}var dt=mt;const ht=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ut(e){navigator.serviceWorker.register(e).then(e=>{e.onupdatefound=()=>{const t=e.installing;t.onstatechange=()=>{"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(e=>{console.error("Error during service worker registration:",e)})}o.a.render(r.a.createElement(dt,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL(".",window.location).origin!==window.location.origin)return;window.addEventListener("load",()=>{const e="".concat(".","/service-worker.js");ht?(!function(e){fetch(e).then(t=>{404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(e=>{e.unregister().then(()=>{window.location.reload()})}):ut(e)}).catch(()=>{console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(()=>{console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):ut(e)})}}()}},[[169,1,2]]]);